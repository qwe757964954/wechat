{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/game/scripts/NodeUserCtr.ts"],"names":["Prefab","_decorator","BaseComponent","PlayerMgr","RoomMgr","FXJRes","GameEvent","CardUtil","NodeUserPrefabCtr","ccclass","property","menu","NodeUserCtr","userSeats","userNodes","onInitModuleEvent","addModelListener","VIEW_BROADCAST_PLAYER_EXIT","palyerExit","event","uid","player","getInstance","findPlayerWithUserId","seatID","calculatePlayerSeat","mySeatId","seatId","filter","num","i","length","node","getComponent","UID","removeFromParent","splice","console","log","showUserView","data","self","getPreLoaderRes","Prefab_NodeUser","bundle","path","res","comp","isValid","posID","indexOf","push","addChild","active","initData","forEach"],"mappings":"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","sourcesContent":["\nimport { Node, Prefab, _decorator } from 'cc';\nimport { BaseComponent } from '../../../framework/vc/BaseComponent';\nimport { PlayerMgr } from '../cache/PlayerMgr';\nimport { RoomMgr } from '../cache/RoomMgr';\nimport { FXJRes } from '../common/FXJRes';\nimport { GameEvent } from '../common/GameEvent';\nimport { Common } from '../common/idl/Common';\nimport { CardUtil } from '../util/CardUtil';\nimport { NodeUserPrefabCtr } from './NodeUserPrefabCtr';\nconst { ccclass, property, menu } = _decorator;\n\n/**\n * Name = NodeUserCtr\n * URL = db://assets/package/game/scripts/NodeUserCtr.ts\n * Time = Mon Jul 31 2023 15:54:59 GMT+0800 (中国标准时间)\n * Author = harvyson\n *\n * Life: onLoad-->onInitModuleEvent-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n * \n */\n\n@ccclass('NodeUserCtr')\n//方便编辑器识别的菜单项目\n@menu('prefab/game/NodeUserCtr')\nexport class NodeUserCtr extends BaseComponent {\n    private userSeats: number[] = [];\n    private userNodes: Node[] = [];\n    /** override 初始化模块事件 */\n    protected onInitModuleEvent() {\n        this.addModelListener(GameEvent.VIEW_BROADCAST_PLAYER_EXIT, this.palyerExit);\n    };\n\n    palyerExit(event, uid: number = null){\n        let player:Common.IPlayerInfo = PlayerMgr.getInstance().findPlayerWithUserId(uid);\n        let seatID: number = CardUtil.calculatePlayerSeat(RoomMgr.getInstance().mySeatId, player.seatId);\n        this.userSeats = this.userSeats.filter(num => num !== seatID);\n\n        for(let i =0;i<this.userNodes.length;i++){\n            let node = this.userNodes[i];\n            if(node.getComponent(NodeUserPrefabCtr).UID === uid){\n                node.removeFromParent();\n                this.userNodes.splice(i,1);\n            } \n        }\n        console.log(\"palyerExit__________________\",this.userNodes,this.userSeats);\n    }\n\n    /** 显示人物信息 */\n    showUserView(data) {\n        let self = this;\n        this.getPreLoaderRes(FXJRes.Prefab_NodeUser.bundle, FXJRes.Prefab_NodeUser.path, Prefab, (res) => {\n            let comp: NodeUserPrefabCtr = res.getComponent(NodeUserPrefabCtr);\n            if (!self.node || self.node.isValid == false) {\n                return;\n            }\n            let seatID: number = CardUtil.calculatePlayerSeat(RoomMgr.getInstance().mySeatId, data.posID);\n\n            if (this.userSeats.indexOf(seatID) === -1) {\n                this.userSeats.push(seatID);\n                self.node.addChild(res);\n                this.userNodes.push(res);\n                res.active = true;\n                data.posID = seatID;\n                comp.initData(data);//此处做刷新\n            }\n            console.log(\"showUserView__________________\",this.userNodes,this.userSeats);\n            this.userNodes.forEach(node => {\n                node.active = true;\n            });\n\n\n\n            // comp.initData(data);//此处做刷新\n            // for (let i = 0; i < self.node.children.length; i++) {\n            // \tlet node = self.node.children[i];\n            // \tlet nodeComp = node.getComponent(NodeUserPrefabCtr);\n            // \tif (nodeComp.PosID == seatID) {\n            // \t\tnode.active = true;\n            // \t\tisAdd = true;\n            // \t\tcomp = nodeComp;\n            // \t\tbreak;\n            // \t}\n            // }\n\n            // if (isAdd == false) {\n\n            // }\n            // comp.node.active = true;\n\n        })\n    }\n\n}\n\n"]}