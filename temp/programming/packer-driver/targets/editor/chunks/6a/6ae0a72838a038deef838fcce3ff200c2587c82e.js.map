{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/game/module/settle/src/settle.ts"],"names":["Color","Label","Layout","Node","Prefab","ScrollView","Sprite","SpriteAtlas","Vec3","_decorator","instantiate","Utils","EventManager","BaseComponent","PlayerMgr","SettleMgr","FXJEvent","FXJRes","FXJUIID","FXJSound","GameEvent","Card","BottomItem","FanItem","List","ccclass","property","TitleColor","Gender","VictoryStatus","settle","titleMap","Map","_moneyResKey","_huResKey","onInitModuleEvent","onLoad","set","fanExtendInfos","getInstance","filterFanExtendInfo","moneyScroll","numItems","length","opponentInfos","getOpponentTotalInfo","bottomScroll","updateSettleInfo","onListBottomHRender","item","idx","info","scriptPlayer","getComponent","updateItemProps","onListMoneyVRender","fanExtendInfo","myInfo","getMyTotalInfo","fanData","getMaxWinType","tittle_str","string","settleType","get","fanName","colorStr","bWin","Win","Fail","normalColor","color","bgStr","leftStr","titleStr","forward","moneyAtlas","Prefab_Settle_Win","Prefab_Settle_Fail","huAtlas","Prefab_Settle_Hu_Win","Prefab_Settle_Hu_Fail","frameBg","string_format","Prefab_Settle_Image","plistKey","frameLeft","frameTitle","updatePlayerStatus","getPreLoaderRes","bundle","path","atlas","bgAtlas","getSpriteFrame","bg","spriteFrame","leftAtlas","left_bg","titleAtlas","title_bg","moneyStr","winMoney","numList","String","split","numKeyList","i","push","createNumSprImg","moneyLayout","updateMyselfCards","updateWinCards","gameUserInfo","JSON","parse","strUserInfo","playerAtlas","sex","Prefab_Settle_Xiaobo","Prefab_Settle_Xiaoya","playerName","Male","Female","playerStatus","playerFrame","playerSprite","array","getMyhands","cardValue","node","card_Prefab","setCardByte","setCardSize","setCardAngle","setCardAlbedo","card_layout","addChild","asyncForLoop","winPlayer","getWinPlayerInfo","Promise","resolve","handCards","filter","huCard","hu_node","isNull","console","log","hutag","huTag","active","setPosition","onCreateNextGame","dispatch","GAME_CLOSE_POPUP","GameSettlePrefab","SYS_PLAY_EFFECT","CommClick","EXITS_SETTLE_VIEW","NEXT_GAME_OPERATION","onCloseGame","parent","plist","keyList","dianPosY","removeAllChildren","forEach","key","index","sprNode","create_2DSprite","position","x","z"],"mappings":"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","sourcesContent":["\n\nimport { Color, Label, Layout, Node, Prefab, ScrollView, Sprite, SpriteAtlas, Vec3, _decorator, instantiate } from 'cc';\nimport { Utils } from '../../../../../framework/Utils';\nimport { EventManager } from '../../../../../framework/manager/EventManager';\nimport { BaseComponent } from '../../../../../framework/vc/BaseComponent';\nimport { PlayerMgr } from '../../../cache/PlayerMgr';\nimport { SettleMgr } from '../../../cache/SettleMgr';\nimport { FXJEvent } from '../../../common/FXJEvent';\nimport { FXJRes, FXJUIID } from '../../../common/FXJRes';\nimport { FXJSound } from '../../../common/FXJSound';\nimport { GameEvent } from '../../../common/GameEvent';\nimport { Common } from '../../../common/idl/Common';\nimport { Game } from '../../../common/idl/Game';\nimport { Card } from '../../card/src/Card';\nimport { BottomItem } from './BottomItem';\nimport { FanItem } from './FanItem';\nimport List from './list/List';\nconst { ccclass, property } = _decorator;\n/**\n * Name = settle\n * URL = db://assets/package/game/module/settle/src/settle.ts\n * Time = Wed Aug 02 2023 10:58:00 GMT+0800 (中国标准时间)\n * Author = qwe757964\n *\n * Life: onLoad-->onInitModuleEvent-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n * \n */\n\nexport enum TitleColor {\n\tWin = \"#D23A00\",\n\tFail = \"#667AD2\"\n}\n\nexport enum Gender {\n\tMale = \"xiaobo\",\n\tFemale = \"xiaoya\",\n}\n\nexport enum VictoryStatus {\n\tWin = \"win\",\n\tFail = \"fail\",\n}\n\n@ccclass('settle')\nexport class settle extends BaseComponent {\n\t@property(Sprite)\n\tpublic bg: Sprite | null = null;\n\n\t@property(Sprite)\n\tpublic left_bg: Sprite | null = null;\n\n\t@property(Sprite)\n\tpublic title: Sprite | null = null;\n\n\t@property(Sprite)\n\tpublic title_bg: Sprite | null = null;\n\n\t@property(Sprite)\n\tpublic playerSprite: Sprite | null = null;\n\n\n\t@property(ScrollView)\n\tpublic scrollView: ScrollView | null = null;\n\n\t@property(Node)\n\tpublic huLayout: Node | null = null;\n\n\t@property(Node)\n\tpublic moneyLayout: Node | null = null;\n\n\t@property(Label)\n\tpublic tittle_str: Label | null = null;\n\n\t@property(Layout)\n\tpublic card_layout: Layout | null = null;\n\n\t@property(Prefab)\n\tpublic card_Prefab: Prefab | null = null;\n\n\t@property(Node)\n\tpublic huTag: Node | null = null;\n\n\t//水平列表\n\t@property(List)\n\tbottomScroll: List = null;\n\n\t//垂直列表\n\t@property(List)\n\tmoneyScroll: List = null;\n\n\t//code 对应的图集\n\ttitleMap = new Map<string, string>();\n\n\tprivate _moneyResKey = { \"+\": \"+\", \"-\": \"-\", \".\": \".\", \"万\": \"wan\", \"亿\": \"yi\", \"0\": \"0\", \"1\": \"1\", \"2\": \"2\", \"3\": \"3\", \"4\": \"4\", \"5\": \"5\", \"6\": \"6\", \"7\": \"7\", \"8\": \"8\", \"9\": \"9\", };\n\tprivate _huResKey = { \"共胡\": \"gonghu\", \"次\": \"ci\", \"0\": \"0\", \"1\": \"1\", \"2\": \"2\", \"3\": \"3\", \"4\": \"4\", \"5\": \"5\", \"6\": \"6\", \"7\": \"7\", \"8\": \"8\", \"9\": \"9\", };\n\n\t/** override 初始化模块事件 */\n\tprotected onInitModuleEvent() {\n\n\t};\n\n\tonLoad() {\n\t\tthis.titleMap.set(\"common_hu\", \"平胡\");\n\t\tthis.titleMap.set(\"zi_mo\", \"自摸\");\n\t\tthis.titleMap.set(\"huang_zhuang\", \"黄庄\");\n\t\tlet fanExtendInfos: Game.ISettleFanExtendInfo[] = SettleMgr.getInstance().filterFanExtendInfo();\n\t\tthis.moneyScroll.numItems = fanExtendInfos.length;\n\t\tlet opponentInfos: Game.ITotalInfo[] = SettleMgr.getInstance().getOpponentTotalInfo();\n\t\tthis.bottomScroll.numItems = opponentInfos.length;\n\t\tthis.updateSettleInfo();\n\t};\n\n\tonListBottomHRender(item: Node, idx: number) {\n\t\tlet opponentInfos: Game.ITotalInfo[] = SettleMgr.getInstance().getOpponentTotalInfo();\n\t\tlet info: Game.ITotalInfo = opponentInfos[idx];\n\t\tvar scriptPlayer: BottomItem = item.getComponent(BottomItem);\n\t\tscriptPlayer.updateItemProps(info);\n\t}\n\n\tonListMoneyVRender(item: Node, idx: number) {\n\t\tlet fanExtendInfos: Game.ISettleFanExtendInfo[] = SettleMgr.getInstance().filterFanExtendInfo();\n\t\tlet fanExtendInfo: Game.ISettleFanExtendInfo = fanExtendInfos[idx];\n\t\tvar scriptPlayer: FanItem = item.getComponent(FanItem);\n\t\tscriptPlayer.updateItemProps(idx, fanExtendInfo);\n\t}\n\n\tupdateSettleInfo() {\n\t\tlet myInfo: Game.ITotalInfo = SettleMgr.getInstance().getMyTotalInfo();\n\t\tlet fanData: Game.IFanInfo = SettleMgr.getInstance().getMaxWinType();\n\t\tthis.tittle_str.string = SettleMgr.getInstance().settleType === \"huang_zhuang\" ? this.titleMap.get(SettleMgr.getInstance().settleType) : fanData.fanName;\n\t\tlet colorStr: string = myInfo.bWin !== -1 ? TitleColor.Win : TitleColor.Fail;\n\t\tlet normalColor = new Color(colorStr);\n\t\tthis.tittle_str.color = normalColor;\n\n\t\tlet bgStr: string = myInfo.bWin !== -1 ? \"win_bg\" : \"failure_bg\";\n\t\tlet leftStr: string = myInfo.bWin !== -1 ? \"settle_win\" : \"settle_failure\";\n\t\tlet titleStr: string = myInfo.bWin !== -1 ? \"win_title_bg\" : \"fail_title_bg\";\n\t\tlet forward: string = myInfo.bWin !== -1 ? \"+\" : \"\";\n\t\tlet moneyAtlas = myInfo.bWin !== -1 ? FXJRes.Prefab_Settle_Win : FXJRes.Prefab_Settle_Fail;\n\t\tlet huAtlas = myInfo.bWin !== -1 ? FXJRes.Prefab_Settle_Hu_Win : FXJRes.Prefab_Settle_Hu_Fail;\n\t\tlet frameBg = Utils.string_format(FXJRes.Prefab_Settle_Image.plistKey, bgStr)\n\t\tlet frameLeft = Utils.string_format(FXJRes.Prefab_Settle_Image.plistKey, leftStr)\n\t\tlet frameTitle = Utils.string_format(FXJRes.Prefab_Settle_Image.plistKey, titleStr)\n\n\t\tthis.updatePlayerStatus();\n\n\t\tthis.getPreLoaderRes(FXJRes.Prefab_Settle_Image.bundle, FXJRes.Prefab_Settle_Image.path, SpriteAtlas, (atlas) => {\n\t\t\tif (!atlas) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tlet bgAtlas = atlas.getSpriteFrame(frameBg);\n\t\t\tif (bgAtlas) {\n\t\t\t\tthis.bg.spriteFrame = bgAtlas;\n\t\t\t}\n\t\t\tlet leftAtlas = atlas.getSpriteFrame(frameLeft);\n\t\t\tif (leftAtlas) {\n\t\t\t\tthis.left_bg.spriteFrame = leftAtlas;\n\t\t\t}\n\t\t\tlet titleAtlas = atlas.getSpriteFrame(frameTitle);\n\t\t\tif (titleAtlas) {\n\t\t\t\tthis.title_bg.spriteFrame = titleAtlas;\n\t\t\t}\n\t\t});\n\t\tlet moneyStr: string = `${forward}${myInfo.winMoney}`;\n\t\tlet numList = String(moneyStr).split(\"\");\n\t\tlet numKeyList = [];\n\t\tfor (let i = 0; i < numList.length; i++) {\n\t\t\tnumKeyList.push(this._moneyResKey[numList[i]])\n\t\t}\n\t\tthis.createNumSprImg(this.moneyLayout, moneyAtlas, numKeyList, 0);\n\n\t\t// let fanStr:string = `${myInfo.totalFanStr}次`;\n\n\t\t// let fanList = String(fanStr).split(\"\");\n\t\t// if (fanList.length > 0) {\n\t\t// \tfanList.unshift(\"共胡\");\n\t\t// }\n\t\t// let fanKeyList = [];\n\t\t// for (let i = 0; i < fanList.length; i++) {\n\t\t// \tfanKeyList.push(this._huResKey[fanList[i]])\n\t\t// }\n\t\t// this.createNumSprImg(this.huLayout, huAtlas, fanKeyList, 0);\n\t\tif (SettleMgr.getInstance().settleType === \"huang_zhuang\") {\n\t\t\tthis.updateMyselfCards();\n\t\t} else {\n\t\t\tthis.updateWinCards();\n\t\t}\n\n\t}\n\n\tupdatePlayerStatus() {\n\t\tlet myInfo: Game.ITotalInfo = SettleMgr.getInstance().getMyTotalInfo();\n\t\tlet gameUserInfo: Common.GameUserInfo = JSON.parse(myInfo.strUserInfo);\n\t\tlet playerAtlas = gameUserInfo.sex !== 2 ? FXJRes.Prefab_Settle_Xiaobo : FXJRes.Prefab_Settle_Xiaoya;\n\t\tlet playerName = gameUserInfo.sex !== 2 ? Gender.Male : Gender.Female;\n\t\tlet playerStatus = myInfo.bWin !== -1 ? VictoryStatus.Win : VictoryStatus.Fail;\n\t\tlet playerFrame = `${playerName}_${playerStatus}`;\n\n\t\tthis.getPreLoaderRes(playerAtlas.bundle, playerAtlas.path, SpriteAtlas, (atlas) => {\n\t\t\tif (!atlas) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tlet bgAtlas = atlas.getSpriteFrame(playerFrame);\n\t\t\tif (bgAtlas) {\n\t\t\t\tthis.playerSprite.spriteFrame = bgAtlas;\n\t\t\t}\n\t\t});\n\t}\n\n\tupdateMyselfCards() {\n\t\tlet array = PlayerMgr.getInstance().getMyhands();\n\t\tfor (let i = 0; i < array.length; i++) {\n\t\t\tlet cardValue: number = array[i];\n\t\t\tlet node = instantiate(this.card_Prefab);\n\t\t\tnode.getComponent(Card).setCardByte(cardValue);\n\t\t\tnode.getComponent(Card).setCardSize(50,70);\n\t\t\tnode.getComponent(Card).setCardAngle(90,0,0);\n            node.getComponent(Card).setCardAlbedo(0.8, 0.8, 0.8);\n\t\t\tthis.card_layout.node.addChild(node);\n\t\t}\n\t}\n\n\t// 封装带有异步操作的for循环\n\tasyncForLoop(): Promise<void> {\n\t\tlet winPlayer: Common.IPlayerInfo = SettleMgr.getInstance().getWinPlayerInfo();\n\t\treturn new Promise((resolve) => {\n\t\t\tlet array = winPlayer.handCards.filter(item => item !== winPlayer.huCard); // 移除值为3的元素\n\t\t\tfor (let i = 0; i < array.length; i++) {\n\t\t\t\tlet cardValue: number = winPlayer.handCards[i];\n\t\t\t\tlet node = instantiate(this.card_Prefab);\n\t\t\t\tnode.getComponent(Card).setCardByte(cardValue);\n\t\t\t\tnode.getComponent(Card).setCardSize(50,70);\n\t\t\t\tnode.getComponent(Card).setCardAngle(90,0,0);\n                node.getComponent(Card).setCardAlbedo(0.8, 0.8, 0.8);\n\t\t\t\tthis.card_layout.node.addChild(node);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\tasync updateWinCards() {\n\t\tlet winPlayer: Common.IPlayerInfo = SettleMgr.getInstance().getWinPlayerInfo();\n\t\tif (winPlayer === null) {\n\t\t\treturn;\n\t\t}\n\t\tawait this.asyncForLoop(); // 等待for循环执行完毕\n\t\tlet hu_node = instantiate(this.card_Prefab);\n\t\tif (Utils.isNull(winPlayer.huCard)) {\n\t\t\treturn;\n\t\t}\n\t\tconsole.log(\"winPlayer.huCard_________________\", winPlayer.huCard);\n\t\thu_node.getComponent(Card).setCardByte(winPlayer.huCard);\n\t\thu_node.getComponent(Card).setCardSize(50,70);\n\t\thu_node.getComponent(Card).setCardAngle(90,0,0);\n        hu_node.getComponent(Card).setCardAlbedo(0.8, 0.8, 0.8);\n\t\tthis.card_layout.node.addChild(hu_node);\n\t\tlet hutag = instantiate(this.huTag);\n\t\thutag.active = true;\n\t\thu_node.addChild(hutag);\n\t\thutag.setPosition(-10.006, 17.419);\n\t}\n\n\tonCreateNextGame() {\n\t\tEventManager.dispatch(FXJEvent.GAME_CLOSE_POPUP, FXJUIID.GameSettlePrefab);\n\t\tEventManager.dispatch(FXJEvent.SYS_PLAY_EFFECT, FXJSound.CommClick);\n\n\n\t\tEventManager.dispatch(GameEvent.EXITS_SETTLE_VIEW);\n\t\tEventManager.dispatch(GameEvent.NEXT_GAME_OPERATION);\n\t}\n\n\tonCloseGame() {\n\t\tEventManager.dispatch(FXJEvent.GAME_CLOSE_POPUP, FXJUIID.GameSettlePrefab);\n\t\tEventManager.dispatch(FXJEvent.SYS_PLAY_EFFECT, FXJSound.CommClick);\n\t\tEventManager.dispatch(GameEvent.EXITS_SETTLE_VIEW);\n\t}\n\n\t/** 创建数字图片集合 */\n\tcreateNumSprImg(parent: Node, plist: { bundle: string, path: string }, keyList: Array<string>, dianPosY: number = 0) {\n\t\tparent.removeAllChildren();\n\t\tif (!keyList || keyList.length == 0) {\n\t\t\treturn;\n\t\t}\n\t\tthis.getPreLoaderRes(plist.bundle, plist.path, SpriteAtlas, (atlas) => {\n\t\t\tkeyList.forEach((key, index) => {\n\t\t\t\tlet spriteFrame = atlas.getSpriteFrame(key)\n\t\t\t\tif (spriteFrame) {\n\t\t\t\t\tlet sprNode = Utils.create_2DSprite(spriteFrame, key);\n\t\t\t\t\tparent.addChild(sprNode);\n\t\t\t\t\t// if ((key == \".\" || key == \"coin_dian\") && dianPosY != null) {\n\t\t\t\t\tsprNode.setPosition(new Vec3(sprNode.position.x, dianPosY, sprNode.position.z));\n\t\t\t\t\t// }\n\t\t\t\t}\n\n\t\t\t})\n\t\t});\n\t\tparent.active = true;\n\t}\n\n}\n\n"]}