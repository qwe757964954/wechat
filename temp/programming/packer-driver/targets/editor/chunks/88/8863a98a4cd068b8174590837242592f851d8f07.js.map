{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/login/scripts/loginCtr.ts"],"names":["Button","EditBox","Node","Toggle","Widget","_decorator","GCache","AppEvent","AppSound","GConstants","StoreKey","GameRes","UIID","LocalStorage","Logger","AudioManager","EventManager","Utils","BaseComponent","Platform","ccclass","property","menu","loginCtr","tooltip","type","constructor","isChangeScene","autoSettingButton","autoSettingButtonVisible","loginParam","access_token","openId","userinfo","_isWxLogin","_lastLoginFailCode","firstRunLoadSuccess","getInstance","releaseAll","dispatch","SYS_PLAY_MUSIC","BgHall","onInitModuleEvent","addModelListener","PLATFORM_AUTHSETTING_UPDATE","respAuthButtonCreator","LOGIN_PLATFORM_FAIL","respPlatformFail","LOGIN_PLATFORM_SUCCESS","respPlatformSuccess","LOGIN_AGREE_PRIVATE","respUserAgreePrivate","onLoad","btnLogin","node","getComponent","updateAlignment","WxAuthSettingButtonParam","node_PositionSizeToScreen","AppCommon_Login_WX","path","isWXPlatform","updateLoginButtonVisible","editBoxNode","active","LOGIN_SEND_SHOW","onReceiveLoginData","start","checkIsAgree","res","get","LOGIN_LAST_CHECK_AGREE","console","log","callbackArgs","onAdded","handler","onCallbackOpenView","onRemoved","onCallbackCloseView","VIEW_UI_OPEN","UserAgreePrivate","toggleAgreeGou","isChecked","startLogin","isAgree","NET_GOTO_START_LOGIN","event","param","updateLoginView","editBox","string","nullToDefault","User","getLastlocalLoginToken","getLastLoginValueByKey","lastLoginInfo","getLastlocalLoginInfo","print","getLoginState","UserLoginState","None","logView","string_isEmpty","cleanLastlocalLoginToken","WxLoginCode","reqPlatformLoginInfo","errorCode","LoginStateCode","platform_fail_wx_access_token_error","platform_fail_wx_notAuthSetting","table","state","button","WxAuthSettingUserInfo","updateEditBoxEnd","string_trim","string_clearBr","visible","updateWxAuthSettingButtonVisible","isValid","onClickKefu","SYS_PLAY_EFFECT","CommClick","openCustomerServiceConversation","onClickLogin","onClickNotice","PictureDialog","onClickUserAgreePrivate","set","onNeedPrivacyAuthorization_WX","onClickUserAgree","onClickPrivate","onDestroy"],"mappings":"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","sourcesContent":["\nimport { Button, EditBox, EventTouch, Node, Toggle, Widget, _decorator } from 'cc';\nimport { GCache } from '../../../cache/GCache';\nimport { AppEvent } from '../../../config/AppEvent';\nimport { AppSound } from '../../../config/AppSound';\nimport { GConstants, StoreKey } from '../../../config/GameConstant';\nimport { GameRes } from '../../../config/GameRes';\nimport { UIID } from '../../../config/UIConfig';\nimport { inf_LoginViewInfo } from '../../../framework/InterfaceDefines';\nimport { LocalStorage } from '../../../framework/LocalStorage';\nimport { Logger } from '../../../framework/log/Logger';\nimport { AudioManager } from '../../../framework/manager/AudioManager';\nimport { EventManager } from '../../../framework/manager/EventManager';\nimport { Utils } from '../../../framework/Utils';\nimport { BaseComponent } from '../../../framework/vc/BaseComponent';\nimport { Platform } from '../../../platform/Platform';\nconst { ccclass, property, menu } = _decorator;\n\n/**\n * Name = loginCtr\n * URL = db://assets/package/login/scripts/loginCtr.ts\n * Time = Tue Sep 06 2022 14:45:40 GMT+0800 (中国标准时间)\n * Author = Tomoe\n *\n * Life: onLoad-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n */\n\n@ccclass('loginCtr')\n//方便编辑器识别的菜单项目\n@menu('prefab/login/loginCtr')\nexport class loginCtr extends BaseComponent {\n\n\t//开始游戏按钮节点\n\t@property({ tooltip: \"开始游戏按钮组件\", type: Button })\n\tprivate btnLogin: Button | null = null;\n\n\t//输入框节点\n\t@property({ tooltip: \"输入框节点\", type: Node })\n\tprivate editBoxNode: Node | null = null;\n\n\t//输入框\n\t@property({ tooltip: \"输入框\", type: EditBox })\n\tprivate editBox: EditBox | null = null;\n\n\t//用户协议和隐私政策勾选框\n\t@property({ tooltip: \"用户协议和隐私政策勾选框\", type: Toggle })\n\tprivate toggleAgreeGou: Toggle | null = null;\n\n\tisChangeScene: boolean = false;\n\n\t//wx平台的授权按钮\n\tautoSettingButton = null;\n\t//wx平台的授权按钮上次的显示状态\n\tautoSettingButtonVisible = false;\n\t//登录传递的参数\n\tloginParam: inf_LoginViewInfo = { access_token: null, openId: null, userinfo: null };\n\t//是否是微信登录\n\t_isWxLogin: boolean = false;\n\t//上次登录的错误吗\n\t_lastLoginFailCode: number = 0;\n\tconstructor() {\n\t\tsuper();\n\t\tif (GCache.firstRunLoadSuccess) {\n\t\t\tAudioManager.getInstance().releaseAll();\n\t\t}\n\t\tEventManager.dispatch(AppEvent.SYS_PLAY_MUSIC, AppSound.BgHall);\n\t}\n\n\t/** overload */\n\tonInitModuleEvent() {\n\t\t//授权按钮创建成功/授权成功\n\t\tthis.addModelListener(AppEvent.PLATFORM_AUTHSETTING_UPDATE, this.respAuthButtonCreator)\n\t\t//平台登录失败\n\t\tthis.addModelListener(AppEvent.LOGIN_PLATFORM_FAIL, this.respPlatformFail)\n\t\t//平台获取数据成功\n\t\tthis.addModelListener(AppEvent.LOGIN_PLATFORM_SUCCESS, this.respPlatformSuccess)\n\t\t//用户隐私同意状态有更新\n\t\tthis.addModelListener(AppEvent.LOGIN_AGREE_PRIVATE, this.respUserAgreePrivate)\n\n\t}\n\n\tonLoad() {\n\t\t//设置授权按钮的坐标\n\t\tthis.btnLogin.node.getComponent(Widget).updateAlignment();\n\t\tPlatform.WxAuthSettingButtonParam = Utils.node_PositionSizeToScreen(this.btnLogin.node);\n\t\tPlatform.WxAuthSettingButtonParam[\"img\"] = GameRes.AppCommon_Login_WX.path;\n\n\t\tthis._isWxLogin = Platform.isWXPlatform();\n\t\tthis.updateLoginButtonVisible(false);\n\t\tthis.editBoxNode.active = false;\n\n\t\tthis.loginParam = { access_token: null, openId: null, userinfo: null };\n\n\t\tthis.addModelListener(AppEvent.LOGIN_SEND_SHOW, this.onReceiveLoginData)\n\t};\n\n\tstart() {\n\n\t};\n\n\t//获取用户协议与隐私政策同意状态 \n\tcheckIsAgree(): boolean {\n\t\tlet res = LocalStorage.get(StoreKey.LOGIN_LAST_CHECK_AGREE, false);\n\t\tconsole.log(\"获取用户协议与隐私政策同意状态===>\", res)\n\t\tif (!res) {\n\t\t\tlet callbackArgs = {\n\t\t\t\tonAdded: Utils.handler(this, this.onCallbackOpenView),\n\t\t\t\tonRemoved: Utils.handler(this, this.onCallbackCloseView),\n\t\t\t}\n\t\t\tEventManager.dispatch(AppEvent.VIEW_UI_OPEN, UIID.UserAgreePrivate, null, callbackArgs);\n\t\t}\n\t\tthis.toggleAgreeGou.isChecked = res;\n\t\treturn res\n\t}\n\n\t//二级页面的打开回调\n\tonCallbackOpenView() {\n\t\tthis.updateLoginButtonVisible(false);\n\t}\n\n\t//二级页面的关闭回调\n\tonCallbackCloseView() {\n\t\tthis.updateLoginButtonVisible(true);\n\t}\n\n\t//开始登录\n\tstartLogin() {\n\t\tif (this.loginParam.access_token == null) {\n\t\t\tthis.editBoxNode.active = (this._isWxLogin == false);\n\t\t\tthis.updateLoginButtonVisible(true);\n\t\t\treturn\n\t\t}\n\t\t/** 判断是否同意用户协议与隐私政策 */\n\t\tlet isAgree = this.checkIsAgree();\n\t\tif (isAgree) {\n\t\t\t//发送登录命令\n\t\t\tEventManager.dispatch(AppEvent.NET_GOTO_START_LOGIN, this.loginParam)\n\t\t}\n\t\t// GCache.User.cleanLastlocalLoginInfo();\n\n\t\t// if (this.toggleAgree.isChecked == false) {\n\t\t// \tthis.editBoxNode.active = (this._isWxLogin == false);\n\t\t// \tthis.updateLoginButtonVisible(true);\n\t\t// \tEventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: GameTxt.loginCheckAgree });\n\t\t// \treturn;\n\t\t// }\n\t\t//* 注意:若上次记录的token和本次不一致 则清空上次的登录记录\n\t\t// let lastKey = GCache.User.getLastlocalLoginToken();\n\t\t// if (!this._isWxLogin) {\n\t\t// \tlastKey = GCache.User.getLastLoginValueByKey(\"guid\", null);\n\t\t// }\n\t\t// if (lastKey != this.loginParam.openId) {\n\t\t// GCache.User.cleanLastlocalLoginInfo();\n\t\t// }\n\n\t}\n\n\t/** 外部传递的事件 */\n\tonReceiveLoginData(event, param: any) {\n\t\tconsole.log(\"登录界面:外部传递 刷新UI\", param)\n\t\t//执行到这 肯定加载完毕了\n\t\tthis.updateLoginView();\n\t}\n\n\t/** 加载结束之后 */\n\tupdateLoginView() {\n\t\tif (this._isWxLogin) {\n\t\t\tthis.editBox.string = Utils.nullToDefault(GCache.User.getLastlocalLoginToken(), \"\");\n\t\t} else {\n\t\t\tlet access_token = GCache.User.getLastLoginValueByKey(\"access_token\");\n\t\t\tthis.editBox.string = Utils.nullToDefault(access_token, \"\");\n\t\t\tthis.loginParam.access_token = access_token;\n\t\t}\n\n\t\t/** 先判断是否有登录成功的记录 */\n\t\tlet lastLoginInfo = GCache.User.getLastlocalLoginInfo();\n\t\tthis.print(\"updateLoginView\", \"lastLoginInfo\", lastLoginInfo);\n\t\t/** 判断是否同意用户协议与隐私政策 */\n\t\tlet isAgree = this.checkIsAgree();\n\n\t\tthis.print(\"updateLoginView\", \"isAgree\", isAgree);\n\t\tif (isAgree && lastLoginInfo && GCache.User.getLoginState() == GConstants.UserLoginState.None) {\n\t\t\tLogger.logView(\"[Login] 检测到有上次登录历史，开始自动登录\")\n\t\t\tthis.updateLoginButtonVisible(false);\n\t\t\tthis.editBoxNode.active = false;\n\n\t\t\tthis.loginParam = { access_token: null, openId: null, userinfo: null };\n\n\t\t\tif (this._isWxLogin) {\n\t\t\t\tthis.loginParam.access_token = GCache.User.getLastlocalLoginToken();\n\t\t\t\tif (Utils.string_isEmpty(this.loginParam.access_token) == false && Utils.string_isEmpty(this.loginParam.openId) == false) {\n\t\t\t\t\tEventManager.dispatch(AppEvent.NET_GOTO_START_LOGIN, this.loginParam);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tthis.loginParam.access_token = GCache.User.getLastLoginValueByKey(\"guid\");\n\t\t\t\tif (Utils.string_isEmpty(this.loginParam.access_token) == false) {\n\t\t\t\t\tEventManager.dispatch(AppEvent.NET_GOTO_START_LOGIN, this.loginParam);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t//走到这了 肯定不能自动登录 清除快捷登录token\n\t\tGCache.User.cleanLastlocalLoginToken();\n\t\tif (this._isWxLogin) {\n\t\t\tthis.editBoxNode.active = false\n\t\t\tif (isAgree == false) {\n\t\t\t\tthis.loginParam = { access_token: null, openId: Platform.WxLoginCode, userinfo: null };\n\t\t\t\tthis.updateLoginButtonVisible(true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (Platform.WxLoginCode) {\n\t\t\t\tthis.loginParam = { access_token: null, openId: Platform.WxLoginCode, userinfo: null };\n\n\t\t\t\tthis.updateLoginButtonVisible(true);\n\t\t\t} else {\n\t\t\t\tthis.updateLoginButtonVisible(false);\n\t\t\t\t//请求平台获取用户信息\n\t\t\t\tPlatform.reqPlatformLoginInfo()\n\t\t\t}\n\t\t} else {\n\t\t\tthis.updateLoginButtonVisible(true);\n\t\t\tthis.editBoxNode.active = true\n\t\t}\n\t}\n\n\t//平台返回的登录失败\n\trespPlatformFail(event, errorCode: number) {\n\t\tLogger.logView(`平台返回的登录失败 errorCode = ${errorCode}`)\n\t\tthis._lastLoginFailCode = errorCode;\n\t\tif (errorCode <= GConstants.LoginStateCode.platform_fail_wx_access_token_error) {\n\t\t\t//全是wx平台的错误\n\t\t\tif (errorCode == GConstants.LoginStateCode.platform_fail_wx_notAuthSetting) {\n\t\t\t\t//未取得授权\n\n\t\t\t} else {\n\t\t\t\t//其他错误\n\n\t\t\t}\n\t\t\tthis.loginParam = { access_token: null, openId: null, userinfo: null };\n\t\t\tthis.updateLoginButtonVisible(true);\n\t\t}\n\t}\n\t//平台获取用户信息成功\n\trespPlatformSuccess(event, param) {\n\t\tLogger.logView(\"平台获取登录信息成功===>\")\n\t\tLogger.table(param)\n\t\tthis.updateLoginButtonVisible(false);\n\t\tthis.loginParam = param;\n\t\t//暂时直接登录成功\n\t\tthis.startLogin()\n\t}\n\t//用户隐私协议状态有更新\n\trespUserAgreePrivate(event, state) {\n\t\tthis.toggleAgreeGou.isChecked = state;\n\t}\n\t//授权按钮创建成功/授权成功\n\trespAuthButtonCreator(event, button) {\n\t\tif (button) {\n\t\t\tthis.updateLoginButtonVisible(true);\n\t\t} else {//授权成功销毁\n\t\t\tthis.updateLoginButtonVisible();\n\t\t\tif (Platform.WxAuthSettingUserInfo == 1) {//授权成功\n\t\t\t\tPlatform.reqPlatformLoginInfo(true);\n\t\t\t}\n\t\t}\n\t}\n\n\t//编辑结束\n\tupdateEditBoxEnd() {\n\t\tthis.editBox.string = Utils.nullToDefault(Utils.string_trim(this.editBox.string), \"\");\n\t\tthis.editBox.string = Utils.nullToDefault(Utils.string_clearBr(this.editBox.string), \"\");\n\n\t\tthis.loginParam = { access_token: this.editBox.string, openId: null, userinfo: null };\n\t\tthis.startLogin()\n\t}\n\n\t//更新登录按钮的显示和隐藏状态\n\tupdateLoginButtonVisible(visible?: boolean) {\n\t\tif (this._isWxLogin == true) {\n\t\t\tPlatform.updateWxAuthSettingButtonVisible(visible);\n\t\t\tif (this.node && this.node.isValid) {\n\t\t\t\tthis.btnLogin.node.active = false;\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.btnLogin.node && this.btnLogin.node.isValid) {\n\t\t\t\tthis.btnLogin.node.active = visible;\n\t\t\t}\n\t\t}\n\t}\n\n\n\t//联系客服事件监听\n\tonClickKefu(event: Event) {\n\t\tconsole.log(\"联系客服======>>\");\n\t\tEventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n\t\tPlatform.openCustomerServiceConversation();\n\t}\n\n\t//登录按钮事件监听\n\tonClickLogin(event: Event) {\n\t\t// if (Utils.string_isEmpty(this.exidLabel.string)) {\n\t\t// alert(\"账号不能为空\");\n\t\t// \treturn;\n\t\t// }\n\n\t\tif (event && event.type == \"touch-end\") {\n\t\t\tEventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n\t\t\tif (this.loginParam.access_token == null) {\n\t\t\t\tif (this._isWxLogin) {\n\t\t\t\t\tthis.updateLoginButtonVisible(false);\n\t\t\t\t\t//请求平台获取用户信息\n\t\t\t\t\tPlatform.reqPlatformLoginInfo();\n\n\t\t\t\t} else {\n\t\t\t\t\tthis.updateEditBoxEnd();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.updateEditBoxEnd();\n\t\t\t}\n\t\t}\n\t}\n\n\t//点击了适龄提示\n\tonClickNotice(event: EventTouch) {\n\t\tEventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n\t\tlet callbackArgs = {\n\t\t\tonAdded: Utils.handler(this, this.onCallbackOpenView),\n\t\t\tonRemoved: Utils.handler(this, this.onCallbackCloseView),\n\t\t}\n\t\tEventManager.dispatch(AppEvent.VIEW_UI_OPEN, UIID.PictureDialog, \"适龄提示\", callbackArgs)\n\t}\n\t/** 点击了用户协议和隐私政策的钩 */\n\tonClickUserAgreePrivate(event: EventTouch) {\n\t\tlet state = !this.toggleAgreeGou.isChecked;\n\t\tconsole.log(\"点击了用户协议和隐私政策的钩\" + state)\n\t\tEventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n\t\tLocalStorage.set(StoreKey.LOGIN_LAST_CHECK_AGREE, state);\n\t\tif (state == true) {\n\t\t\tPlatform.onNeedPrivacyAuthorization_WX(\"exposureAuthorization\");\n\t\t\tPlatform.onNeedPrivacyAuthorization_WX(\"agree\");\n\t\t}\n\t}\n\t/** 点击了用户协议 */\n\tonClickUserAgree(event: EventTouch) {\n\t\tEventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n\t\tlet callbackArgs = {\n\t\t\tonAdded: Utils.handler(this, this.onCallbackOpenView),\n\t\t\tonRemoved: Utils.handler(this, this.onCallbackCloseView),\n\t\t}\n\t\tEventManager.dispatch(AppEvent.VIEW_UI_OPEN, UIID.UserAgreePrivate, { type: 1 }, callbackArgs);\n\t}\n\t/** 点击了隐私政策 */\n\tonClickPrivate(event: EventTouch) {\n\t\tEventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n\t\tlet callbackArgs = {\n\t\t\tonAdded: Utils.handler(this, this.onCallbackOpenView),\n\t\t\tonRemoved: Utils.handler(this, this.onCallbackCloseView),\n\t\t}\n\t\tEventManager.dispatch(AppEvent.VIEW_UI_OPEN, UIID.UserAgreePrivate, { type: 2 }, callbackArgs);\n\t}\n\n\t//销毁\n\tonDestroy() {\n\n\t};\n\n}\n\n"]}