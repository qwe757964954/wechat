{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/proj/servers/PopupServers.ts"],"names":["PopupServers","AppEvent","UIID","LayerManager","EventManager","Utils","BaseControll","getInstance","_instance","MainLayerCode","_curMainLayer","constructor","name","_mainLayerArray","_dequeAnim","_handlerNetOutTime","init","clear","onInitModuleEvent","addModelListener","VIEW_UI_MAIN_UPDATE","updateMainLayer","VIEW_UI_MAIN_ROLLBACK","rollBackMainLayer","VIEW_UI_OPEN","onOpenView","VIEW_UI_CLOSE","onCloseView","VIEW_UI_OPENED","onOpenedView","VIEW_UI_CLOSED","onClosedView","SYS_SHOW_NETLOADING","showNetLoading","SYS_CLOSE_NETLOADING","closeNetLoading","SYS_TOAST_TIP","showToastTips","event","code","print","push","length","splice","uiId","uiArgs","callbacks","parent","isClickSpanceClose","isAutoRecover","open","remove","viewParam","time","NetLoading","stopScheduler","addSchedulerOnce","dispatch","param","content","string_isEmpty","ToastTip"],"mappings":"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","sourcesContent":["/**\n * Name = PopupServers\n * URL = db://assets/proj/servers/servers/PopupServers.ts\n * Time = Sat Nov 26 2022 18:06:36 GMT+0800 (中国标准时间)\n * Author = xueya\n * 弹窗控制器\n */\n\nimport { AppEvent } from \"../../config/AppEvent\";\nimport { UIID } from \"../../config/UIConfig\";\nimport { inf_UICallbacks } from \"../../framework/InterfaceDefines\";\nimport { LayerManager } from \"../../framework/layer/LayerManager\";\nimport { EventManager } from \"../../framework/manager/EventManager\";\nimport { Utils } from \"../../framework/Utils\";\nimport { BaseControll } from \"../../framework/vc/BaseController\";\n\nexport class PopupServers extends BaseControll {\n\tprivate static _instance = null;\n\tpublic static getInstance(): PopupServers {\n\t\tif (!this._instance || this._instance == null) {\n\t\t\tthis._instance = new PopupServers(\"PopupServers\");\n\t\t}\n\t\treturn this._instance;\n\t}\n\n\tprivate _curMainLayer = null;\n\tprivate _mainLayerArray: Array<any> = [];\n\t/** 恭喜获得弹窗队列 */\n\tprivate _dequeAnim: Array<any> = [];\n\t/** 网络加载超时句柄 */\n\tprivate _handlerNetOutTime = null;\n\n\n\tget MainLayerCode() {\n\t\treturn this._curMainLayer;\n\t}\n\t//实例化\n\tconstructor(name: string) {\n\t\tsuper(name);\n\t};\n\tpublic static init(): PopupServers {\n\t\tif (this._instance) {\n\t\t\tthis._instance.clear()\n\t\t}\n\t\tthis._instance = null\n\t\tPopupServers.getInstance();\n\t\treturn\n\t}\n\n\t/**初始化添加事件绑定 */\n\tprotected onInitModuleEvent(): void {\n\t\t//更新主场景标志\n\t\tthis.addModelListener(AppEvent.VIEW_UI_MAIN_UPDATE, this.updateMainLayer)\n\t\t//回滚主场景标志\n\t\tthis.addModelListener(AppEvent.VIEW_UI_MAIN_ROLLBACK, this.rollBackMainLayer)\n\n\t\t//将要打开界面\n\t\tthis.addModelListener(AppEvent.VIEW_UI_OPEN, this.onOpenView)\n\t\t//将要关闭界面\n\t\tthis.addModelListener(AppEvent.VIEW_UI_CLOSE, this.onCloseView)\n\n\t\t//打开了界面\n\t\tthis.addModelListener(AppEvent.VIEW_UI_OPENED, this.onOpenedView)\n\t\t//关闭了界面\n\t\tthis.addModelListener(AppEvent.VIEW_UI_CLOSED, this.onClosedView)\n\n\t\t//显示网络loading\n\t\tthis.addModelListener(AppEvent.SYS_SHOW_NETLOADING, this.showNetLoading)\n\t\t//关闭网络loading\n\t\tthis.addModelListener(AppEvent.SYS_CLOSE_NETLOADING, this.closeNetLoading)\n\n\t\t//显示吐司提示\n\t\tthis.addModelListener(AppEvent.SYS_TOAST_TIP, this.showToastTips)\n\n\n\t}\n\n\t/** 更新主场景标志 */\n\tprivate updateMainLayer(event: string, code) {\n\t\tthis.print(\"更新主场景标志: code=\", code)\n\t\tthis._curMainLayer = code;\n\t\tthis._mainLayerArray.push(this._curMainLayer);\n\t}\n\t/** 回滚主场景标志 */\n\tprivate rollBackMainLayer(event: string) {\n\t\tthis.print(\"回滚主场景标志: 当前：\", this._curMainLayer, \"上一个:\", this._mainLayerArray[this._mainLayerArray.length - 2])\n\t\tif (this._mainLayerArray.length >= 2) {\n\t\t\tthis._curMainLayer = this._mainLayerArray[this._mainLayerArray.length - 2];\n\t\t\tthis._mainLayerArray.splice(this._mainLayerArray.length - 1, 1);\n\t\t} else {\n\t\t\tthis._curMainLayer = this._mainLayerArray[0] != null ? this._mainLayerArray[0] : null;\n\t\t\tthis._mainLayerArray = [];\n\t\t}\n\t\tthis.print(\"回滚主场景标志: 回滚后：\", this._curMainLayer)\n\t}\n\n\t/** 即将打开界面 */\n\tprivate onOpenView(event: string, uiId: number, uiArgs: any = null, callbacks: inf_UICallbacks = null, parent = null, isClickSpanceClose: boolean = false, isAutoRecover: boolean = false) {\n\t\tthis.print(\"[OpenView]即将打开界面:\" + uiId)\n\t\tLayerManager.open(uiId, uiArgs, callbacks, parent, isClickSpanceClose, isAutoRecover);\n\t}\n\t/** 即将关闭界面 */\n\tprivate onCloseView(event: string, uiId: number, parent = null) {\n\t\tthis.print(\"[CloseView]即将关闭界面:\" + uiId)\n\t\tLayerManager.remove(uiId, true, parent);\n\t}\n\t/** 打开了界面 */\n\tprivate onOpenedView(event: string, viewParam: Object) {\n\t\tthis.print(\"[OpenedView]打开了界面:\" + viewParam[\"Prefab\"])\n\t}\n\t/** 关闭了界面 */\n\tprivate onClosedView(event: string, viewParam: Object) {\n\t\tthis.print(\"[ClosedView]关闭了界面:\" + viewParam[\"Prefab\"])\n\t}\n\n\t/**显示网络loading */\n\tprivate showNetLoading(event: string = null, time = 15) {\n\t\tthis.print(\"===开启网络加载===\")\n\t\tthis.onOpenView(null, UIID.NetLoading, { time: time });\n\t\tthis.stopScheduler(this._handlerNetOutTime);\n\t\tthis._handlerNetOutTime = this.addSchedulerOnce(time, () => {\n\t\t\tEventManager.dispatch(AppEvent.SYS_CLOSE_NETLOADING);\n\t\t});\n\t}\n\t/**关闭网络loading */\n\tprivate closeNetLoading(event: string = null) {\n\t\tthis.print(\"===关闭网络加载===\")\n\t\tthis.stopScheduler(this._handlerNetOutTime);\n\t\tthis._handlerNetOutTime = null;\n\t\tthis.onCloseView(null, UIID.NetLoading);\n\t}\n\n\t/**显示吐司提示 */\n\tprivate showToastTips(event: string, param: any) {\n\t\tthis.print(\"显示吐司===>\")\n\t\tif (param && param.content && Utils.string_isEmpty(param.content) == false) {\n\t\t\tthis.onOpenView(null, UIID.ToastTip, param);\n\t\t}\n\t}\n\n\n\n\n\n\n}\n\n"]}