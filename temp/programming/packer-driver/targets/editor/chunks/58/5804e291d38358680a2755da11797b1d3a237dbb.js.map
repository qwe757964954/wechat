{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/giftbag/script/giftDiscountCtr.ts"],"names":["LabelComponent","Layout","Node","ScrollView","Sprite","UITransform","_decorator","instantiate","GCache","AppEvent","AppSound","GConstants","ReportConfig","Utils","ButtonSimple","DelegateComponent","resLoader","EventManager","BaseComponent","Platform","ccclass","property","giftDiscountCtr","tooltip","type","_holidayConf","_selectedIndex","_currowSelectItemBg","_cloneBtnBuyicon","_FowardPayScene","_sendCheckWatchADsData","onInitModuleEvent","addModelListener","NET_RESP_SHARE_AWARD","respShareAndAdsAward","NET_RESP_ADS_AWARD","ACTIVITY_UPDATE_HOLIDAYSGIFTPACKAGE","updateView","NOTIFY_UPDATE_RED_DOT","redDotUpdate","NET_FORWARD_REPORT_PAY_ORDER","respPayOrder","onLoad","param","getComponent","getParams","console","log","initView","dispatch","NET_REQ_HOLIDAYS_GIFTPACKAGE","RedDot","update_reddot_gift_holiday","start","REPORT_CLIENT_CLICK","eventID","gift_holiday_2","event","isSuccess","respData","reqData","nodeBoxGift","active","scrollowView","node","itemPanel","btnBuy","btnClose","detailData","Activity","getHolidaysGiftPackage","refreshImageBg","self","loadRemote","ext","err","imageAsset","isValid","spriteFrame","image_ImageAssetToSpriteFrame","bgNode","maxDataItem","table_verify","length","i","data","getItemData","hadNum","maxNum","currowNum","children","addChild","removeFromParent","count","nodeItem","updateItemBox","layout","spacingX","updateLayout","addSchedulerOnce","width","enabled","scrollToLeft","updateButton","item","buyBtnIcon","idx","table_isEmpty","goodsId","number_valueOf","SYS_TOAST_TIP","content","payData","ShopInfo","getPriceByGoodsSceneId","GoodsListID","limitPack","isLimit","num","icon","select","getChildByName","bg","check","mask","buy","imgLabel","labelNum","iconUrl","getPreLoaderRemoteRes","spriteComponent","buttonSimple","Interactable","string","onClickChooseItem","currentTarget","SYS_PLAY_EFFECT","CommClick","conf","gid","gift_holiday_3","body","gsubname","oldSelect","getParent","newSelect","onClickBuyButton","_buyItem","gift_holiday_12","payID","boughtNum","PayType","RMB","CurrowPaySceneType","OTHER_PAY_WILL","SHARE","_allowShareMsg","ShareInfo","shareTimeAllowed","ShareSceneConf","shopshare","shareWXFriends","handler","__doCallBackShare","VIDEO","playerAdVideo","__doCallBackWatchADs","goodsID","NET_REQ_SHARE_AWARD","ReqUrl","shareType","shop","status","NET_REQ_ADS_AWARD","onClickClose","destroy","onDestroy","keyType","RedDotConf","Holiday"],"mappings":"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","sourcesContent":["\nimport { EventTouch, LabelComponent, Layout, Node, ScrollView, Sprite, UITransform, _decorator, instantiate } from 'cc';\nimport { GCache } from '../../../cache/GCache';\nimport { AppEvent } from '../../../config/AppEvent';\nimport { AppSound } from '../../../config/AppSound';\nimport { GConstants } from '../../../config/GameConstant';\nimport { ReportConfig } from '../../../config/ReportConfig';\nimport { Utils } from '../../../framework/Utils';\nimport ButtonSimple from '../../../framework/gui/button/ButtonSimple';\nimport { DelegateComponent } from '../../../framework/layer/DelegateComponent';\nimport { resLoader } from '../../../framework/loader/ResLoader';\nimport { EventManager } from '../../../framework/manager/EventManager';\nimport { BaseComponent } from '../../../framework/vc/BaseComponent';\nimport { Platform } from '../../../platform/Platform';\nconst { ccclass, property } = _decorator;\n\n/**\n * Name = giftDiscountCtr\n * URL = db://assets/package/giftbag/scripts/giftDiscountCtr.ts\n * Time = Sun Jan 29 2023 14:47:26 GMT+0800 (中国标准时间)\n * Author = xueya\n * Life: onLoad-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n * 每日特价礼包，支持RMB看视频分享购买\n */\n\n@ccclass('giftDiscountCtr')\nexport class giftDiscountCtr extends BaseComponent {\n\n\t//礼包克隆节点\n\t@property({ tooltip: \"礼包克隆节点\", type: Node })\n\tprivate nodeBoxGift: Node | null = null;\n\t//礼包box容器节点\n\t@property({ tooltip: \"礼包滚动容器\", type: ScrollView })\n\tprivate scrollowView: ScrollView | null = null;\n\n\t//礼包box容器节点\n\t@property({ tooltip: \"礼包box容器节点\", type: Node })\n\tprivate itemPanel: Node | null = null;\n\t//关闭节点\n\t@property({ tooltip: \"关闭节点\", type: Node })\n\tprivate btnClose: Node | null = null;\n\t//购买节点\n\t@property({ tooltip: \"购买节点\", type: Node })\n\tprivate btnBuy: Node | null = null;\n\n\t//背景节点\n\t@property({ tooltip: \"背景节点\", type: Node })\n\tprivate bgNode: Node | null = null;\n\t/** 基本配置 */\n\tprivate _holidayConf={}\n\t/** 当前选中的Item索引 （-1：未选择 0 1 2） */\n\tprivate _selectedIndex = -1;\n\t/** 当前选中的Item背景图片 */\n\tprivate _currowSelectItemBg = null;\n\n\tprivate _cloneBtnBuyicon = null;\n\t/** 上一个跳转过来的付费场景 */\n\tprivate _FowardPayScene: string = null;\n\t/** 发送的看广告的数据 */\n\tprivate _sendCheckWatchADsData = null;\n\t/**初始化添加事件绑定 */\n\tprotected onInitModuleEvent(): void {\n\t\t/** 请求分享领奖返回 */\n\t\tthis.addModelListener(AppEvent.NET_RESP_SHARE_AWARD, this.respShareAndAdsAward)\n\t\t/** 请求看视频领奖返回 */\n\t\tthis.addModelListener(AppEvent.NET_RESP_ADS_AWARD, this.respShareAndAdsAward);\t\n\n\t\t//限时礼包活动更新\n\t\tthis.addModelListener(AppEvent.ACTIVITY_UPDATE_HOLIDAYSGIFTPACKAGE, this.updateView)\n\t\t/** 礼包红点更新 */\n\t\tthis.addModelListener(AppEvent.NOTIFY_UPDATE_RED_DOT, this.redDotUpdate);\n\n\t\t//rmb支付回调\n\t\tthis.addModelListener(AppEvent.NET_FORWARD_REPORT_PAY_ORDER, this.respPayOrder);\n\t}\n\n\tonLoad() {\n\t\t//获取上一个付费场景\n\t\tlet param = this.getComponent(DelegateComponent).getParams();\n\t\tconsole.log(param, 'param');\n\t\tthis._FowardPayScene = param ? param[\"pay_scene\"] : null;\n\t\tthis.initView();\n\t\tthis.updateView();\n\t\t//请求限时折扣配置数据\n\t\tEventManager.dispatch(AppEvent.NET_REQ_HOLIDAYS_GIFTPACKAGE);\n\t\tGCache.RedDot.update_reddot_gift_holiday();\n\t};\n\n\tstart() {\n\t\tEventManager.dispatch(AppEvent.REPORT_CLIENT_CLICK, { eventID: ReportConfig.gift_holiday_2 });\n\t};\n\n\t/** 请求看视频领奖和分享领奖返回 */\n\trespShareAndAdsAward(event, isSuccess, respData, reqData) {\n\t\tconsole.log(\"respShareAndAdsAward\",isSuccess,respData,reqData)\n        if (isSuccess == false) {\n            return;\n\t\t}\n        EventManager.dispatch(AppEvent.NET_REQ_HOLIDAYS_GIFTPACKAGE);\n\t}\n\n\n\t/** 支付订单返回 */\n\trespPayOrder(event, isSuccess, respData, reqData) {\n\t\tconsole.log(\"respPayOrder:discount\",isSuccess,respData,reqData)\n        if (isSuccess == false) {\n            return;\n\t\t}\n        EventManager.dispatch(AppEvent.NET_REQ_HOLIDAYS_GIFTPACKAGE);\n\t}\n\n\t/** 初始化界面 */\n\tinitView() {\n\t\tthis.nodeBoxGift.active = false;\n\t\tthis.scrollowView.node.active = true;\n\t\tthis.itemPanel.active = true;\n\t\tthis.btnBuy.active = false;\n\t\tthis.btnClose.active = true;\n\t\tthis.detailData();\n\t\tthis.updateView();\n\t}\n\n\t/** 处理数据 */\n\tdetailData() {\n\t\tthis._holidayConf = GCache.Activity.getHolidaysGiftPackage()\n\t}\n\t\n\t/** 更新背景 */\n\trefreshImageBg() {\n\t\tlet self = this;\n\t\tif (this._holidayConf && this._holidayConf[\"basemap\"] != \"\") {\n\t\t\tresLoader.loadRemote(this._holidayConf[\"basemap\"], { ext: `.jpg` }, (err, imageAsset) => {\n\t\t\t\tif (!imageAsset) { //资源可能还在加载中\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif (!self.node || self.node.isValid == false) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet spriteFrame = Utils.image_ImageAssetToSpriteFrame(imageAsset)\n\t\t\t\tif (spriteFrame) {\n\t\t\t\t\tthis.bgNode.getComponent(Sprite).spriteFrame = spriteFrame;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t/** 更新界面 */\n\tupdateView() {\n\t\t//当有更新时，重新获取一次礼包缓存数据\n\t\tthis.detailData();\n\t\t// this.refreshImageBg()\n\t\tlet maxDataItem = Utils.table_verify(this._holidayConf['giftpack'], true).length\n\t\tthis._selectedIndex = -1;\n\t\tfor (let i = 0; i < maxDataItem; i++) {\n\t\t\tlet data = this.getItemData(i);\n\t\t\tif (data) {\t\n\t\t\t\tif (data.hadNum < data.maxNum || data.maxNum==0) {\n\t\t\t\t\tthis._selectedIndex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tlet currowNum = this.itemPanel.children.length;\n\t\tif (currowNum < maxDataItem) {\n\t\t\tfor (let i = currowNum; i < maxDataItem; i++) {\n\t\t\t\tlet node = instantiate(this.nodeBoxGift);\n\t\t\t\tthis.itemPanel.addChild(node);\n\t\t\t}\n\t\t} else if (currowNum > maxDataItem) {\n\t\t\tfor (let i = (currowNum - 1); i >= maxDataItem; i--) {\n\t\t\t\tlet node = this.itemPanel.children[i];\n\t\t\t\tif (node) {\n\t\t\t\t\tnode.removeFromParent();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._currowSelectItemBg = null;\n\t\tlet count = 0;\n\t\tfor (let i = 0; i < this.itemPanel.children.length; i++) {\n\t\t\tlet nodeItem = this.itemPanel.children[i];\n\t\t\tcount = count + 1;\n\t\t\tthis.updateItemBox(nodeItem, i);\n\t\t}\n\t\tlet self = this;\n\t\tlet layout = self.itemPanel.getComponent(Layout);\n\t\tlayout.spacingX = (count == 2 ? 100 : 0);\n\t\tlayout.updateLayout();\n\t\tthis.addSchedulerOnce(0, () => {\n\t\t\tif (self.itemPanel.getComponent(UITransform).width > self.scrollowView.node.getComponent(UITransform).width) {\n\t\t\t\tself.scrollowView.enabled = true;\n\t\t\t\tself.scrollowView.scrollToLeft(0.01, false);\n\t\t\t} else {\n\t\t\t\tself.scrollowView.enabled = false;\n\t\t\t}\n\t\t})\n\t\tthis.updateButton()\n\t}\n\n\t/** 更新按钮 */\n\tupdateButton() {\n\t\tlet self = this;\n\t\tif (this._holidayConf['giftpack']) { \n\t\t\tlet item = this._holidayConf['giftpack'][this._selectedIndex];\n\t\t\tif (item.buyBtnIcon) {\n\t\t\t\tresLoader.loadRemote(item.buyBtnIcon, { ext: `.jpg` }, (err, imageAsset) => {\n\t\t\t\t\tif (!imageAsset) { //资源可能还在加载中\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tif (!self.node || self.node.isValid == false) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tlet spriteFrame = Utils.image_ImageAssetToSpriteFrame(imageAsset)\n\t\t\t\t\tif (spriteFrame) {\n\t\t\t\t\t\tthis.btnBuy.getComponent(Sprite).spriteFrame = spriteFrame;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.btnBuy.active = true;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.btnBuy.active = false;\n\t\t}\n\t\t\n\t}\n\n\t\n\t/**\n\t * 获取单个item的数据\n\t * @param idx 数据下标 0 1 2\n\t * @returns {}\n\t */\n\tgetItemData(idx) {\n\t\tif (this._holidayConf==null || this._holidayConf['giftpack']==null) {\n\t\t\treturn null;\n\t\t}\n\t\tlet item = this._holidayConf['giftpack'][idx]\n\t\tif (Utils.table_isEmpty(item)) {\n\t\t\treturn null;\n\t\t}\n\t\tlet goodsId = Utils.number_valueOf(item['gid'], 0)\n\t\t\n\t\tif (goodsId<=0) {\n\t\t\tEventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: \"err:找不到商品数据\" });\n\t\t\treturn;\n\t\t}\n\t\tlet payData = GCache.ShopInfo.getPriceByGoodsSceneId(GConstants.GoodsListID.limitPack, goodsId);\n\t\tlet maxNum = Utils.number_valueOf(payData['limitNum'], 0);\n\t\tlet isLimit = Utils.number_valueOf(payData['limit_buy_way'], 0);\n\t\tmaxNum = isLimit > 0 ? maxNum : 0;\n\t\treturn {\n\t\t\tmaxNum:maxNum,\n\t\t\thadNum: item.num,\n\t\t\ticon:item.icon\n\t\t}\n\t}\n\t\n\n\t/**\n\t * \n\t * @param node 节点\n\t * @param idx 索引\n\t * @returns \n\t */\n\tupdateItemBox(node: Node, idx) {\n\t\tlet select = node.getChildByName(\"select\");\n\t\tlet bg = node.getChildByName(\"bg\");\n\t\t//选中\n\t\tlet check = bg.getChildByName(\"check\");\n\t\t//蒙版\n\t\tlet mask = bg.getChildByName(\"mask\");\n\t\t//购买\n\t\tlet buy=bg.getChildByName(\"buy\");\n\t\tlet imgLabel = node.getChildByName(\"imgLabel\");\n\t\tlet labelNum = imgLabel.getChildByName(\"labelNum\")\n\t\tlet data = this.getItemData(idx);\n\t\tif (!data) {\n\t\t\tnode.active = false;\n\t\t\treturn;\n\t\t}\n\n\t\t//初始化\n\t\tnode.active = true;\n\t\tcheck.active = false;\n\t\tselect.active = false;\n\t\tmask.active = false;\n\t\tbuy.active = false;\n\n\t\tnode[\"Index\"] = idx;\n\t\tlet iconUrl = data.icon;\n\t\tconsole.log(\"_selectedIndex:updateItemBox:\",this._selectedIndex)\n\t\tif (data.hadNum < data.maxNum || data.maxNum==0) {\n\t\t\tif (this._selectedIndex == idx) {\n\t\t\t\tthis._currowSelectItemBg = bg;\n\t\t\t\tcheck.active = true;\n\t\t\t\tselect.active = true;\n\t\t\t}\n\t\t} else {\n\t\t\t//已经购买\n\t\t\tmask.active = true\n\t\t\tbuy.active = true\n\t\t\timgLabel.active = false;\n\t\t\tlabelNum.active = false;\n\t\t}\n\t\tthis.getPreLoaderRemoteRes(iconUrl, '.jpg', (imageAsset) => {\n\t\t\tif (!imageAsset) { //资源可能还在加载中\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (!bg || bg.isValid == false) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet spriteFrame = Utils.image_ImageAssetToSpriteFrame(imageAsset)\n\t\t\tif (spriteFrame) {\n\t\t\t\tlet spriteComponent = bg.getComponent(Sprite);\n\t\t\t\tspriteComponent.spriteFrame = spriteFrame;\n\t\t\t}\n\t\t})\n\t\tlet buttonSimple = node.getComponent(ButtonSimple);\n\t\tif (data.maxNum>0) {\n\t\t\tbuttonSimple.Interactable = (data.hadNum < data.maxNum);\n\t\t\tlabelNum.getComponent(LabelComponent).string = data.hadNum + \"/\" + data.maxNum;\n\t\t}\n\t\telse {\n\t\t\timgLabel.active = false;\n\t\t\tlabelNum.active = false;\n\t\t}\t\t\n\t}\n\n\t/**\n\t * 点击了单个Item\n\t * @param event \n\t * @returns \n\t */\n\tonClickChooseItem(event: EventTouch) {\n\t\tif (event.currentTarget[\"Index\"] == null) {\n\t\t\treturn;\n\t\t}\n\t\tlet idx = event.currentTarget[\"Index\"];\n\t\tif (this._selectedIndex == idx) {\n\t\t\treturn;\n\t\t}\n\t\tEventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n\t\tlet conf = this._holidayConf['giftpack'][idx]\n\t\tlet goodsId = Utils.number_valueOf(conf.gid, 0)\n\t\tEventManager.dispatch(AppEvent.REPORT_CLIENT_CLICK, { eventID: ReportConfig.gift_holiday_3, body: { gsubname: goodsId } });\n        //让当前选的进入选中状态,让老的选中进入未选中状态\n\t\tlet _currowSelectItemBg = this._currowSelectItemBg;\n\t\t//老的成为未选中\n\t\t_currowSelectItemBg.getChildByName(\"check\").active = false;\n\t\tlet oldSelect = _currowSelectItemBg.getParent().getChildByName(\"select\");\n\t\toldSelect.active = false;\n\t\tthis._currowSelectItemBg = event.currentTarget.getChildByName(\"bg\");\n\t\tthis._currowSelectItemBg.getChildByName(\"check\").active = true;\n\t\tlet newSelect = this._currowSelectItemBg.getParent().getChildByName(\"select\");\n\t\tnewSelect.active = true;\n\t\tthis._selectedIndex = idx;\n\t\tconsole.log(\"_selectedIndex:onClickChooseItem:\", this._selectedIndex);\n\t\tthis.updateButton();\n\t}\n\n\t\n\t/** 点击了购买 */\n\tonClickBuyButton(event: EventTouch) {\n\t\tif (this._selectedIndex == -1) {\n\t\t\treturn;\n\t\t}\n\t\tEventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\t\t\n\t\tthis._buyItem(this._selectedIndex);\n\t}\n\t\n\t/**\n\t * 点击购买每日特价礼包\n\t * @param idx 索引\n\t * @returns \n\t */\n\t_buyItem(idx) {\n\t\tlet conf = this._holidayConf['giftpack'][idx]\n\t\tlet goodsId = Utils.number_valueOf(conf.gid,0)\n\t\tif (Utils.table_isEmpty(conf) || goodsId<=0) {\n\t\t\tEventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: \"err:找不到商品数据，支付失败\" });\n\t\t\treturn;\n\t\t}\n\t\tEventManager.dispatch(AppEvent.REPORT_CLIENT_CLICK, { eventID: ReportConfig.gift_holiday_12, body: { gsubname: goodsId } });\n\t\tlet payData = GCache.ShopInfo.getPriceByGoodsSceneId(GConstants.GoodsListID.limitPack, goodsId);\n\t\tconsole.log(\"paydata:\", payData)\n\t\tlet payID = Utils.number_valueOf(payData['payID'], 0)\n\t\tif (payID<=0) {\n\t\t\tEventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: \"err:找不到商品支付方式，支付失败\" });\n\t\t\treturn;\n\t\t}\n\t\tlet boughtNum = Utils.number_valueOf(conf[\"num\"], 0);\n\t\tlet maxNum = Utils.number_valueOf(payData[\"limitNum\"], 0)\n\t\tlet isLimit = Utils.number_valueOf(payData['limit_buy_way'], 0);\n\t\tmaxNum = isLimit > 0 ? maxNum : 0;\n\t\tif (boughtNum >= maxNum && maxNum > 0) {\n\t\t\tEventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: \"已超过最大购买上限\" })\n\t\t\treturn;\n\t\t}\n\t\tswitch (payID) {\n\t\t\tcase GConstants.PayType.RMB: //rmb 1\n\t\t\t\tGCache.CurrowPaySceneType = GConstants.GoodsListID.limitPack;\n\t\t\t\tEventManager.dispatch(AppEvent.OTHER_PAY_WILL, GConstants.GoodsListID.limitPack, goodsId);\n\t\t\t\tbreak;\n\t\t\tcase GConstants.PayType.SHARE://分享支付\n\t\t\t\tlet self = this\n\t\t\t\tlet _allowShareMsg = GCache.ShareInfo.shareTimeAllowed(goodsId, GConstants.ShareSceneConf.shopshare);\n                if (_allowShareMsg['allowShare']) {\n\t\t\t\t\tPlatform.shareWXFriends(_allowShareMsg['shareParams'], Utils.handler(self, self.__doCallBackShare), goodsId);\n                } else {\n                    EventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: `请勿在短时间内重复分享` });\n\t\t\t\t}\n\t\t\t\tbreak;\t\n\t\t\tcase GConstants.PayType.VIDEO://看视频\n\t\t\t\tPlatform.playerAdVideo(Utils.handler(this, this.__doCallBackWatchADs), goodsId)\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tEventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: \"err:不支持的支付方式 code=\"+payID });\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * 分享完商品发放奖励发奖励\n\t * @param goodsID 商品ID\n\t */\n\t__doCallBackShare(goodsID) {\n\t\tconsole.log('__doCallBackShare',goodsID)\n\t\tEventManager.dispatch(AppEvent.NET_REQ_SHARE_AWARD, goodsID, GConstants.ReqUrl.shareType.shop, true)\n\t}\n\n\t\n\t/**\n\t * 看完视频广告发奖励\n\t * @param status 是否成功\n\t * @param goodsID 商品ID\n\t * @returns \n\t */\n\t__doCallBackWatchADs(status:boolean, goodsID) {\n\t\tif (status != true) {\n\t\t\tEventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: \"err:看广告失败\" });\n\t\t\treturn;\n\t\t}\n\t\tEventManager.dispatch(AppEvent.NET_REQ_ADS_AWARD, goodsID, GConstants.ReqUrl.shareType.shop,true)\n\t}\n\n\n\n\n\t/** 点击了关闭 */\n\tonClickClose(event: EventTouch) {\n\t\tEventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n\t\tthis.node.destroy();\n\t}\n\n\t//销毁\n\tonDestroy() {\n\n\t};\n\n\t/**\n\t * 红点更新\n\t * @param event \n\t * @param keyType 红点类型\n\t */\n\tredDotUpdate(event, keyType) {\n\t\tif (keyType == GConstants.RedDotConf.Holiday) {\n\t\t\t\n\t\t}\n\t}\n\t\n}\n\n"]}