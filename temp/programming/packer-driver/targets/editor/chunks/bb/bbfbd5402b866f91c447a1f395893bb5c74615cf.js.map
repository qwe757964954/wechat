{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/game/module/opInfo/src/OpInfo.ts"],"names":["Layout","Node","Prefab","_decorator","EventManager","Utils","BaseComponent","OperationMgr","RoomMgr","GameStatus","OPCode","GameEvent","Card","ccclass","property","OpInfo","tooltip","type","btnCodeMap","Map","opTypeArr","_handlerTimeUpdate","getShowBtn","code","opCode","btn","onInitModuleEvent","onLoad","updateCodeMap","set","OPE_PASS","guoBtn","OPE_RIGHT_CHI","chiBtn","OPE_MIDDLE_CHI","OPE_LEFT_CHI","OPE_PENG","pengBtn","OPE_QIANG_PENG","OPE_HU","huLayout","OPE_ZI_MO","zimoLayout","OPE_AN_GANG","gangBtn","OPE_GANG","OPE_BU_GANG","startOperationTime","stopSchedulerOnce","timeOut","getInstance","getTimeOut","OPERATION","addSchedulerOnce","handler","resetView","opClick","opInfo","req","opCard","getPassNumber","opCards","getOprationListNumber","seatId","userId","dispatch","SEND_PLAYER_OPERATION","myOpCode","updateOpration","resp","opGroups","length","console","log","forEach","active","info","node","push","card","getChildByName","getComponent","setCardByte","off","EventType","TOUCH_END","on","result","findOpTypesWithSameNodeAndCode","i","cardArr","opTypes","opTypesMap","opType","key","name","has","get","_","group","ganghuaLayout"],"mappings":"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","sourcesContent":["import { Layout, Node, Prefab, _decorator } from 'cc';\nimport { EventManager } from '../../../../../framework/manager/EventManager';\nimport { Utils } from '../../../../../framework/Utils';\nimport { BaseComponent } from '../../../../../framework/vc/BaseComponent';\nimport { OperationMgr } from '../../../cache/OperationMgr';\nimport { RoomMgr } from '../../../cache/RoomMgr';\nimport { GameStatus, OPCode } from '../../../common/FXJConfig';\nimport { GameEvent } from '../../../common/GameEvent';\nimport { Common } from '../../../common/idl/Common';\nimport { Game } from '../../../common/idl/Game';\nimport { Card } from '../../card/src/Card';\nconst { ccclass, property } = _decorator;\n\ninterface OpType {\n    node?: Node | Layout | null;\n    code?: number | null;\n}\n\n@ccclass('OpInfo')\nexport class OpInfo extends BaseComponent {\n    @property(Node)\n    public opBtns: Node | null = null;\n\n    @property(Node)\n    public guoBtn: Node | null = null;\n\n    @property(Node)\n    public huBtn: Node | null = null;\n\n    @property(Node)\n    public gangBtn: Node | null = null;\n\n    @property(Node)\n    public pengBtn: Node | null = null;\n\n    @property(Node)\n    public chiBtn: Node | null = null;\n\n    @property(Layout)\n    public huLayout: Layout | null = null;\n\n    @property(Layout)\n    public zimoLayout: Layout | null = null;\n\n    @property(Layout)\n    public ganghuaLayout: Layout | null = null;\n\n    // 手牌节点\n\t@property({ tooltip: \"手牌预制体\", type: Prefab })\n\tprivate CardItemPrefab: Prefab | null = null;\n    //可以显示响应按钮的opCode\n    btnCodeMap = new Map<number, Node | Layout>();\n\n    opTypeArr:OpType[] = [];\n\n    /** 时间更新句柄 */\n\t_handlerTimeUpdate = null;\n\n    protected onInitModuleEvent() {\n\t\t\n\t};\n\n    onLoad () {\n        this.updateCodeMap();\n\t};\n\n    updateCodeMap(){\n        this.btnCodeMap.set(OPCode.OPE_PASS, this.guoBtn);\n        this.btnCodeMap.set(OPCode.OPE_RIGHT_CHI, this.chiBtn);\n        this.btnCodeMap.set(OPCode.OPE_MIDDLE_CHI, this.chiBtn);\n        this.btnCodeMap.set(OPCode.OPE_LEFT_CHI, this.chiBtn);\n        this.btnCodeMap.set(OPCode.OPE_PENG, this.pengBtn);\n        this.btnCodeMap.set(OPCode.OPE_QIANG_PENG, this.pengBtn);\n        this.btnCodeMap.set(OPCode.OPE_HU, this.huLayout);\n        this.btnCodeMap.set(OPCode.OPE_ZI_MO, this.zimoLayout);\n        this.btnCodeMap.set(OPCode.OPE_AN_GANG, this.gangBtn);\n        this.btnCodeMap.set(OPCode.OPE_GANG, this.gangBtn);\n        this.btnCodeMap.set(OPCode.OPE_BU_GANG, this.gangBtn);\n    }\n\n\t/** 开始更新时间 */\n\tstartOperationTime() {\n        this.stopSchedulerOnce(this._handlerTimeUpdate);\n\t\tthis._handlerTimeUpdate = null;\n        let timeOut:number = RoomMgr.getInstance().getTimeOut(GameStatus.OPERATION);\n        this._handlerTimeUpdate = this.addSchedulerOnce(timeOut, Utils.handler(this, this.resetView))\n\t}\n\n\n    //点击操作,发送操作code  碰/杠/胡/过\n    opClick(opInfo:Common.IOpGroup) {\n        let req: Game.ISendOperation = {\n            opCard:OperationMgr.getInstance().getPassNumber(),\n\t\t\topCode:opInfo.opCode,\n\t\t\topCards:OperationMgr.getInstance().getOprationListNumber(opInfo.opCode),\n\t\t\tseatId:OperationMgr.getInstance().seatId,\n\t\t\tuserId:OperationMgr.getInstance().userId\n        } \n        EventManager.dispatch(GameEvent.SEND_PLAYER_OPERATION, req);\n        OperationMgr.getInstance().myOpCode = opInfo.opCode;\n        this.resetView();\n    }\n\n    getShowBtn = function (code: number): Node | null {\n        for (let [opCode, btn] of this.btnCodeMap) {\n            if (code == opCode) {\n                return btn;\n            }\n        }\n        return null;\n\n    }\n\n    \n\n    updateOpration(resp:Game.IOperation){\n        this.resetView();\n        //抓牌\n        if(resp.opGroups.length === 1){\n            return;\n        }\n        console.log(\"updateOpration______________\",resp.opGroups);\n        this.opTypeArr = [];\n        resp.opGroups.forEach((opInfo:Common.IOpGroup) => {\n            let btn = this.getShowBtn(opInfo.opCode);\n            console.log(\"==this.btnCodeMap==\", this.btnCodeMap, opInfo,btn)\n            if (btn) {\n                btn.active = true;\n                let info:OpType = {code:opInfo.opCode,node:btn};\n                this.opTypeArr.push(info);\n                console.log(\"==btn==\", btn.active)\n            }\n            \n            if (btn instanceof Layout) {\n                btn.node.active = true;\n                var card: Card = btn.node.getChildByName(\"Card\").getComponent(Card);\n                card.setCardByte(OperationMgr.getInstance().getPassNumber());\n                btn = btn.node.getChildByName(\"hu\");\n            }\n            if(btn){\n                btn.off(Node.EventType.TOUCH_END);\n                btn.on(Node.EventType.TOUCH_END, () => {\n                    this.opClick(opInfo);\n                }, this);\n            }\n            \n        });\n        let result:OpType[][] = this.findOpTypesWithSameNodeAndCode(this.opTypeArr);\n        for (let i = 0; i < result.length; i++) {\n            let cardArr:number[] = OperationMgr.getInstance().getOprationListNumber\n        }\n\n\n        this.startOperationTime();\n    }\n\n    findOpTypesWithSameNodeAndCode(opTypes: OpType[]): OpType[][] {\n        const opTypesMap: Map<string, OpType[]> = new Map();\n    \n        // 遍历 opTypes 数组，将具有相同 node 和 code 的 OpType 放入映射中\n        for (const opType of opTypes) {\n            const key = opType.node.name;\n            if (!opTypesMap.has(key)) {\n                opTypesMap.set(key, []);\n            }\n            opTypesMap.get(key)?.push(opType);\n        }\n    \n        // 从映射中提取所有具有相同 node 和 code 的 OpType 数组\n        const result: OpType[][] = [];\n        for (const [_, group] of opTypesMap) {\n            if (group.length > 1) {\n                result.push(group);\n            }\n        }\n        return result;\n    }\n\n    resetView() {\n        this.guoBtn.active = false;\n        this.huLayout.node.active = false;\n        this.zimoLayout.node.active = false;\n        this.ganghuaLayout.node.active = false;\n        this.gangBtn.active = false;\n        this.pengBtn.active = false;\n        this.chiBtn.active = false;\n    }\n}"]}