{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/game/cache/SettleMgr.ts"],"names":["SettleMgr","BaseCache","CardUtil","PlayerMgr","RoomMgr","constructor","name","settleType","isShowGameOver","isBaoSanJia","jiesuanCustomData","settleModel","getInstance","instance","updateSelectInfo","resp","sortTotalInfo","setFanInfoSeatStr","moneyList","moneyItemList","forEach","moneyItem","i","fanExtendInfo","length","fanData","seatStr","calculatePlayerPosition","mySeatId","getTotalInfoIndex","index","totalInfo","info","bWin","getMaxWinType","item","winSeatId","settleInfo","num","fanInfo","parseInt","fan","player","findPlayerWithUserId","userId","seatId","sortPlayersBySeatId","getOpponentTotalInfo","myPlayer","getMyPlayerInfo","opponentInfo","filter","getMyTotalInfo","getWinPlayerInfo","findPlayerWithSeatId","filterFanExtendInfo","filteredFanExtendInfo","clear"],"mappings":"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","sourcesContent":["import { BaseCache } from \"../../../framework/vc/BaseCache\";\nimport { Common } from \"../common/idl/Common\";\nimport { Game } from \"../common/idl/Game\";\nimport { CardUtil } from \"../util/CardUtil\";\nimport { PlayerMgr } from \"./PlayerMgr\";\nimport { RoomMgr } from \"./RoomMgr\";\n\n\n\n\nexport class SettleMgr extends BaseCache {\n    \n    public settleType?: string = \"\";\n    \n    public isShowGameOver?: number = 0;\n\n    public isBaoSanJia?: boolean = false;\n\n    public jiesuanCustomData?: string = \"\";\n\n    public settleModel?: Game.ISettleModel = null;\n\n    // public isBaoSanJia?: boolean = false;\n\n    private static instance: SettleMgr | null = null;\n    \n\n    constructor(name = \"\") {\n\t\tsuper(name);\n\t};\n    public static getInstance(): SettleMgr {\n        if (!SettleMgr.instance) {\n            SettleMgr.instance = new SettleMgr();\n        }\n        return SettleMgr.instance;\n    }\n    updateSelectInfo(resp:Game.ISettleItem){\n        this.settleType = resp.settleType;\n        this.isShowGameOver = resp.isShowGameOver;\n        this.isBaoSanJia = resp.isBaoSanJia;\n        this.jiesuanCustomData = resp.jiesuanCustomData;\n        this.settleModel = resp.settleModel;\n        this.sortTotalInfo();\n        this.setFanInfoSeatStr();\n    }\n\n    setFanInfoSeatStr(){\n        let moneyList = this.settleModel.moneyItemList;\n        moneyList.forEach(moneyItem => {\n            for(let i=0;i<moneyItem.fanExtendInfo.length;i++){\n                let fanData = moneyItem.fanExtendInfo[i];\n                fanData.seatStr = CardUtil.calculatePlayerPosition(RoomMgr.getInstance().mySeatId,i);\n            }\n        });\n    }\n\n    getTotalInfoIndex(){\n        let index = 0;\n        for (let i =0;i<this.settleModel.totalInfo.length;i++ ){\n            let info:Game.ITotalInfo = this.settleModel.totalInfo[i];\n            if(info.bWin === 1){\n                index = i;\n                break;\n            }\n        }\n        return index;\n    }\n\n    getMaxWinType():Game.IFanInfo{\n        let fanData:Game.IFanInfo = null;\n        this.settleModel.moneyItemList.forEach((item:Game.ISettleMoneyItem) => {\n            let winSeatId:number = item.winSeatId;\n            let settleInfo:Game.ISettleFanExtendInfo = item.fanExtendInfo[winSeatId -1];\n            let num = -1;\n            settleInfo.fanInfo.forEach(info => {\n                if(parseInt(info.fan) > num){\n                    fanData = info;\n                }\n            });\n        });\n        return fanData;\n    }\n\n    sortTotalInfo(){\n        this.settleModel.totalInfo.forEach(info => {\n            let player:Common.IPlayerInfo = PlayerMgr.getInstance().findPlayerWithUserId(info.userId);\n            info.seatId = player.seatId;\n        });\n        this.settleModel.totalInfo = CardUtil.sortPlayersBySeatId(this.settleModel.totalInfo,RoomMgr.getInstance().mySeatId);\n    }\n    \n\n    getOpponentTotalInfo():Game.ITotalInfo[]{\n        let myPlayer:Common.IPlayerInfo = PlayerMgr.getInstance().getMyPlayerInfo();\n        let opponentInfo:Game.ITotalInfo[] = this.settleModel.totalInfo.filter(item => item.userId !== myPlayer.userId);\n        return opponentInfo;\n    }\n\n    getMyTotalInfo():Game.ITotalInfo{\n        let myPlayer:Common.IPlayerInfo = PlayerMgr.getInstance().getMyPlayerInfo();\n        let opponentInfo:Game.ITotalInfo = this.settleModel.totalInfo.filter(item => item.userId === myPlayer.userId)[0];\n        return opponentInfo;\n    }\n\n    getWinPlayerInfo():Common.IPlayerInfo{\n        let player:Common.IPlayerInfo = null;\n        this.settleModel.moneyItemList.forEach((item:Game.ISettleMoneyItem) => {\n            player = PlayerMgr.getInstance().findPlayerWithSeatId(item.winSeatId);\n        });\n        return player\n    }\n    filterFanExtendInfo():Game.ISettleFanExtendInfo[]{\n        if(this.settleModel.moneyItemList.length === 0){\n            return [];\n        }\n        const filteredFanExtendInfo:Game.ISettleFanExtendInfo[] = this.settleModel.moneyItemList[0].fanExtendInfo.filter(item => item.fanInfo.length > 0);\n        return filteredFanExtendInfo;\n    }\n    //清理房间数据\n\tpublic clear(): void {\n\t\t\n\t}\n}\n"]}