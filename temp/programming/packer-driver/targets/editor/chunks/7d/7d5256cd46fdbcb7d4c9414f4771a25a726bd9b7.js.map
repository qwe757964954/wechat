{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/framework/gui/sprite/SpriteLoad.ts"],"names":["Component","Enum","ImageAsset","Sprite","UITransform","_decorator","resLoader","Utils","ccclass","property","menu","SpriteLoadModel","SpriteLoad","tooltip","type","visible","checkSpriteComp","modelType","REMOTE","LOCAL","constructor","name","_className","_realLoadSprite","_isLoad","_uiHaveSprite","_isCanOnloadRevire","checkPreLoad","string_isEmpty","bundleName","resPath","remoteUrl","preLoadUrl","setRemoteUrl","uiTransform","node","getComponent","addComponent","width","height","sprite","spriteFrame","image_CreateDefaultSpriteFrame","sizeMode","onLoad","updateView","start","setLocalLoad","bundle","path","console","error","self","load","err","imageAsset","isValid","url","String","includes","loadRemote","ext","image_ImageAssetToSpriteFrame"],"mappings":"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","sourcesContent":["import { Component, Enum, ImageAsset, Sprite, SpriteFrame, UITransform, _decorator } from 'cc';\nimport { resLoader } from '../../loader/ResLoader';\nimport { Utils } from '../../Utils';\nconst { ccclass, property, menu } = _decorator;\n\n/** spriteFrame支持加载的类型 */\nexport enum SpriteLoadModel {\n\t/** 本地路径 */\n\tLOCAL,\n\t/** 远端路径Url */\n\tREMOTE,\n}\n\n@ccclass('SpriteLoad')\n//方便编辑器识别的菜单项目\n@menu('gui/sprite/SpriteLoad')\nexport default class SpriteLoad extends Component {\n\t/** 加载模式 */\n\t@property({\n\t\ttooltip: \"设置要加载的模式 LOCAL:本地 REMOTE:远端\",\n\t\ttype: Enum(SpriteLoadModel),\n\t\tvisible() {\n\t\t\tthis.checkSpriteComp();\n\t\t\treturn true;\n\t\t}\n\t})\n\tmodelType = SpriteLoadModel.LOCAL;\n\n\t/*******************远端加载**************************/\n\t@property({\n\t\ttooltip: \"远端图片地址Url\",\n\t\tvisible() {\n\t\t\tif (this.modelType != SpriteLoadModel.REMOTE) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t})\n\tremoteUrl: string = \"\"!;\n\n\t@property({\n\t\ttooltip: \"是否提前做预加载\",\n\t\tvisible() {\n\t\t\tif (this.modelType != SpriteLoadModel.REMOTE) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t})\n\tpreLoadUrl: boolean = true;\n\n\t/*******************本地加载**************************/\n\t@property({\n\t\ttooltip: \"分包包名,不填则默认为'resources'\",\n\t\tvisible() {\n\t\t\tif (this.modelType != SpriteLoadModel.LOCAL) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t})\n\tbundleName: string = \"resources\"!;\n\n\t@property({\n\t\ttooltip: \"相对包名的相对资源路径,不可为空,不带后缀\",\n\t\tvisible() {\n\t\t\tif (this.modelType != SpriteLoadModel.LOCAL) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t})\n\tresPath: string = \"\"!;\n\n\tprivate _className: string = \"SpriteLoad\";\n\t/** 真实加载的资源数据 */\n\tprivate _realLoadSprite: ImageAsset = null;\n\t/** 本类是否加载完毕 */\n\tprivate _isLoad = false;\n\t/** ui界面原本是否有Sprite组件(非代码添加) */\n\tprivate _uiHaveSprite = true;\n\t/** 是否可以一启动就加载 */\n\tprivate _isCanOnloadRevire = false;\n\t//实例化\n\tconstructor(name?: string) {\n\t\tsuper(name);\n\t\tthis.checkPreLoad();\n\t};\n\n\t/** 检查预加载 */\n\tprivate checkPreLoad() {\n\t\tthis._isCanOnloadRevire = false;\n\t\tif (this.modelType == SpriteLoadModel.LOCAL) {\n\t\t\tif (Utils.string_isEmpty(this.bundleName) == false && Utils.string_isEmpty(this.resPath) == false) {\n\t\t\t\tthis._isCanOnloadRevire = true;\n\t\t\t}\n\t\t} else if (this.modelType == SpriteLoadModel.REMOTE) {\n\t\t\tif (Utils.string_isEmpty(this.remoteUrl) == false) {\n\t\t\t\tthis._isCanOnloadRevire = true;\n\t\t\t}\n\t\t}\n\t\tif (this.modelType == SpriteLoadModel.REMOTE && this.preLoadUrl == true) {\n\t\t\tthis.setRemoteUrl(this.remoteUrl);\n\t\t}\n\t}\n\t/** 检查uiTransform和spritefram组件 */\n\tprivate checkSpriteComp(): Sprite {\n\t\tlet uiTransform = this.node.getComponent(UITransform);\n\t\tif (!uiTransform) {\n\t\t\tuiTransform = this.node.addComponent(UITransform);\n\t\t\tuiTransform.width = 100;\n\t\t\tuiTransform.height = 100;\n\t\t}\n\t\tlet sprite = this.node.getComponent(Sprite);\n\t\tif (!sprite) {\n\t\t\tsprite = this.node.addComponent(Sprite);\n\t\t\tsprite.spriteFrame = Utils.image_CreateDefaultSpriteFrame(uiTransform.width, uiTransform.height);\n\t\t\tsprite.sizeMode = 0;\n\t\t\tsprite.type = 0;\n\t\t\tthis._uiHaveSprite = false;\n\t\t} else {\n\t\t\tif (this._uiHaveSprite == true) {\n\t\t\t\tif (sprite.spriteFrame == null) {\n\t\t\t\t\tsprite.spriteFrame = Utils.image_CreateDefaultSpriteFrame(uiTransform.width, uiTransform.height);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn sprite;\n\t}\n\tonLoad() {\n\t\tthis._isLoad = true;\n\t\tthis.updateView();\n\t}\n\tstart() {\n\n\t}\n\n\t/** Local:本地图片资源加载 */\n\tsetLocalLoad(bundle: string, path: string) {\n\t\tif ((bundle == null || bundle == \"\") && (path == null || path == \"\")) {\n\t\t\treturn;\n\t\t}\n\t\tif (Utils.string_isEmpty(bundle) || Utils.string_isEmpty(bundle)) {\n\t\t\tconsole.error(`${this._className} 本地资源加载失败，bundle:${bundle} path:${path}`);\n\t\t\treturn;\n\t\t}\n\t\tlet self = this;\n\t\tthis.bundleName = bundle;\n\t\tthis.resPath = path;\n\t\tresLoader.load(this.bundleName, this.resPath, ImageAsset, (err: Error | null, imageAsset) => {\n\n\t\t\tif (err) {\n\t\t\t\tconsole.error(`${this._className} 加载资源出错，bundle:${bundle} path:${path}`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!self.node || self.node.isValid == false) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!imageAsset) { //资源可能还在加载中\n\t\t\t\treturn\n\t\t\t}\n\t\t\tself._realLoadSprite = imageAsset;\n\t\t\tif (self._isLoad == true) {\n\t\t\t\tself._isCanOnloadRevire = true;\n\t\t\t\tself.updateView();\n\t\t\t}\n\t\t})\n\t}\n\t/** REMOTE:设置Url */\n\tsetRemoteUrl(url: string) {\n\t\tif (url == null || url == \"\") {\n\t\t\treturn;\n\t\t}\n\t\tlet self = this;\n\t\tthis.remoteUrl = url;\n\t\tif (String(url).includes(\"http://\") || String(url).includes(\"https://\")) {\n\t\t\tresLoader.loadRemote(url, { ext: `.jpg` }, (err, imageAsset) => {\n\t\t\t\tif (!imageAsset) { //资源可能还在加载中\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tself._realLoadSprite = imageAsset;\n\t\t\t\tif (self._isLoad == true) {\n\t\t\t\t\tself._isCanOnloadRevire = true;\n\t\t\t\t\tself.updateView();\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tconsole.error(`${this._className}加载Url出错 url不正确 url=${url}`)\n\t\t}\n\t}\n\n\t/** 更新界面 */\n\tupdateView() {\n\t\tif (this._isLoad == false || this._isCanOnloadRevire != true) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.modelType == SpriteLoadModel.REMOTE) {\n\t\t\tif (!this._realLoadSprite) {\n\t\t\t\tthis.setRemoteUrl(this.remoteUrl);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet sprite = this.checkSpriteComp();\n\t\t\tlet spriteFrame: SpriteFrame = Utils.image_ImageAssetToSpriteFrame(this._realLoadSprite);\n\t\t\tif (this._uiHaveSprite == false) {//自己添加的 就改为自适应\n\t\t\t\tsprite.sizeMode = 2;\n\t\t\t\tsprite.type = 0;\n\t\t\t}\n\t\t\tsprite.spriteFrame = spriteFrame;\n\t\t} else {\n\t\t\tif (!this._realLoadSprite) {\n\t\t\t\tthis.setLocalLoad(this.bundleName, this.resPath);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet sprite = this.checkSpriteComp();\n\t\t\tlet spriteFrame: SpriteFrame = Utils.image_ImageAssetToSpriteFrame(this._realLoadSprite);\n\t\t\tif (this._uiHaveSprite == false) {//自己添加的 就改为和父节点一致\n\t\t\t\tsprite.sizeMode = 0;\n\t\t\t\tsprite.type = 0;\n\t\t\t}\n\t\t\tsprite.spriteFrame = spriteFrame;\n\t\t}\n\t}\n}\n"]}