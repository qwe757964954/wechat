{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/game/common/server/ChatServer.ts"],"names":["ChatServer","GCache","EventManager","BaseControll","FXJCMDHead","FXJEvent","GameEvent","instance","_instance","constructor","name","onInitModuleEvent","addModelListener","GAME_REQ_PLAYER_CHAET_MSG","reqGameChatMsg","GAME_REQ_PLAYER_CHAET_EMOJI","reqGameChatEmoji","GAME_REQ_EMOJI_PROPS_MSG","reqGameEmojiProps","event","index","text","req","msg","sendMsg","cmd","C2S","ROOM_USER_CHAT","body","dispatch","NET_SEND_MSG","mid","User","getUserMid","VIEW_PLAYER_CHAT_SHOW","num","parseInt","vipType","faceValue","Math","pow","ROOM_USER_FACE","VIEW_PLAYER_EMOJ_SHOW","receiveGameChatMsg","console","log"],"mappings":"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","sourcesContent":["/**\n * Name = ChatServer\n * URL = db://assets/package/game/common/server/ChatServer.ts\n * Time = Thu Jul 27 2023 17:20:44 GMT+0800 (中国标准时间)\n * Author = harvyson\n * 聊天服务\n */\n\nimport { GCache } from \"../../../../cache/GCache\";\nimport { EventManager } from \"../../../../framework/manager/EventManager\";\nimport { BaseControll } from \"../../../../framework/vc/BaseController\";\nimport { FXJCMDHead } from \"../../net/FXJCmd\";\nimport { FXJEvent } from \"../FXJEvent\";\nimport { GameEvent } from \"../GameEvent\";\n\n\n\nexport interface FaceType {\n    /** vipType  */\n    vipType?: (number | null);\n\n    /** faceValue  */\n    faceValue?: (number | null);\n    /** mid  */\n    mid?: (number | null);\n}\n\nexport interface MsgType {\n    /** vipType  */\n    // index?: (number | null);\n    index?: (string | null);\n\n    /** faceValue  */\n    msg?: (string | null);\n    /** mid  */\n    mid?: (number | null);\n}\n\n\nexport class ChatServer extends BaseControll {\n    private static _instance = null;\n    public static get instance(): ChatServer {\n        if (!this._instance || this._instance == null) {\n            this._instance = new ChatServer(\"ChatServer\");\n        }\n        return this._instance;\n    }\n    //实例化\n    constructor(name: string = null) {\n        super(name)\n    };\n    /**初始化添加事件绑定 */\n    protected onInitModuleEvent(): void {\n        //请求:文字聊天\n        this.addModelListener(FXJEvent.GAME_REQ_PLAYER_CHAET_MSG, this.reqGameChatMsg);\n        //请求:表情聊天\n        this.addModelListener(FXJEvent.GAME_REQ_PLAYER_CHAET_EMOJI, this.reqGameChatEmoji);\n\n        //请求:互动表情\n        this.addModelListener(FXJEvent.GAME_REQ_EMOJI_PROPS_MSG, this.reqGameEmojiProps);\n    }\n    // let req: Game.ISendOperation = {\n    //     opCard:OperationMgr.getInstance().getSendCardListNumber(index)[0],\n    //     opCode:OPCode.OPE_OUT_CARD,\n    //     opCards:OperationMgr.getInstance().getSendCardListNumber(index),\n    //     seatId:OperationMgr.getInstance().seatId,\n    //     userId:OperationMgr.getInstance().userId\n    // }\n\n\n    /** 请求发送聊天文本 */\n    reqGameChatMsg(event, index, text) {\n        if (index == null || text == null) {\n            return;\n        }\n        let req: MsgType = {\n            index: index,\n            msg: text,\n        };\n\n        let sendMsg = {\n            cmd: FXJCMDHead.C2S.ROOM_USER_CHAT,\n            body: req,\n        }\n        EventManager.dispatch(FXJEvent.NET_SEND_MSG, sendMsg);\n        req.mid = GCache.User.getUserMid();\n        EventManager.dispatch(FXJEvent.VIEW_PLAYER_CHAT_SHOW, req);\n    }\n    /** 请求发送表情聊天 */\n    reqGameChatEmoji(event, index) {\n        if (index == null) {\n            return;\n        }\n        const num: number = parseInt(index);\n        let req: FaceType = {\n            vipType: 1,\n            faceValue: num + Math.pow(2, 16),\n        };\n\n        let sendMsg = {\n            cmd: FXJCMDHead.C2S.ROOM_USER_FACE,\n            body: req,\n        }\n        EventManager.dispatch(FXJEvent.NET_SEND_MSG, sendMsg);\n        req.mid = GCache.User.getUserMid();\n        EventManager.dispatch(GameEvent.VIEW_PLAYER_EMOJ_SHOW, req);\n    }\n\n\n    receiveGameChatMsg() {\n\n    }\n\n    /** 请求发送互动道具 */\n    reqGameEmojiProps(event, index, text) {\n        if (index == null || text == null) {\n            return;\n        }\n        let req = {\n            index: index, //道具ID\n            msg: text,  // json from  to {from: to:}\n        };\n\n        let sendMsg = {\n            cmd: FXJCMDHead.C2S.ROOM_USER_CHAT,\n            body: req,\n        }\n        console.log(\"reqGameEmojiProps\", sendMsg)\n        EventManager.dispatch(FXJEvent.NET_SEND_MSG, sendMsg);\n    }\n\n}\n\n"]}