{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/game/module/opInfo/src/Carditem.ts"],"names":["instantiate","Layout","Node","Prefab","UITransform","_decorator","EventManager","BaseComponent","OperationMgr","GameEvent","Card","Item","ccclass","property","Carditem","tooltip","type","onInitModuleEvent","updateCardItemProp","opTypes","opNode","node","removeAllChildren","getComponent","width","item_width","rowNum","i","length","opType","cardList","getInstance","getOprationCardList","code","idx","item","itemPrefab","cardInfo","cards","getOprationListNumber","sort","a","b","forEach","cardValue","CardPrefab","setCardByte","setCardSize","addChild","index","constraint","Constraint","FIXED_COL","constraintNum","off","EventType","TOUCH_END","on","event","id_num","target","opClick","updateLayout","cardLayout","height","Math","round","spacingX","opCode","req","opCard","getPassNumber","opCards","seatId","userId","dispatch","SEND_PLAYER_OPERATION","CLOSE_OPRATION_INFO","myOpCode"],"mappings":"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","sourcesContent":["\nimport { instantiate, Layout, Node, Prefab, UITransform, _decorator } from 'cc';\nimport { EventManager } from '../../../../../framework/manager/EventManager';\nimport { BaseComponent } from '../../../../../framework/vc/BaseComponent';\nimport { OperationMgr } from '../../../cache/OperationMgr';\nimport { GameEvent } from '../../../common/GameEvent';\nimport { Common } from '../../../common/idl/Common';\nimport { Game } from '../../../common/idl/Game';\nimport { Card } from '../../card/src/Card';\nimport { Item } from './Item';\nimport { OpType } from './OpInfo';\nconst { ccclass, property } = _decorator;\n\n/**\n * Name = Carditem\n * URL = db://assets/package/game/module/opInfo/src/Carditem.ts\n * Time = Fri Aug 18 2023 15:19:38 GMT-0700 (北美太平洋夏令时间)\n * Author = qwe757964\n *\n * Life: onLoad-->onInitModuleEvent-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n * \n */\n \n@ccclass('Carditem')\nexport class Carditem extends BaseComponent {\n\t@property({ tooltip: \"手牌预制体\", type: Prefab })\n\tprivate CardPrefab: Prefab | null = null;\n\t@property(Prefab)\n\tprivate itemPrefab: Prefab | null = null;\n\t@property(Layout)\n\tprivate opCards: Layout | null = null;\n\t/** override 初始化模块事件 */\n\tprotected onInitModuleEvent() {\n\n\t};\n\n\tpublic updateCardItemProp(opTypes:OpType[]){\n\t\tlet opNode = opTypes[0].node;\n\t\tthis.node.removeAllChildren();\n\t\tthis.node.getComponent(UITransform).width = 0;\n\t\tlet item_width = 0;\n\t\tlet rowNum = 0;\n\t\tfor (let i = 0;i<opTypes.length;i++){\n\t\t\tlet opType:OpType = opTypes[i];\n\t\t\tlet cardList:Common.ICards[] = OperationMgr.getInstance().getOprationCardList(opType.code);\n\t\t\tfor (let idx = 0; idx < cardList.length; idx++) {\n\t\t\t\tlet item = instantiate(this.itemPrefab);\n\t\t\t\titem.getComponent(UITransform).width = 0;\n\t\t\t\titem.removeAllChildren();\n\t\t\t\tlet cardInfo:Common.ICards = cardList[idx];\n\t\t\t\tlet cards:number[] = OperationMgr.getInstance().getOprationListNumber(opType.code,idx);\n\t\t\t\tcards.sort((a, b) => b - a);\n\t\t\t\tcards.forEach(cardValue => {\n\t\t\t\t\tlet node = instantiate(this.CardPrefab);\n\t\t\t\t\tnode.getComponent(Card).setCardByte(cardValue);\n\t\t\t\t\tnode.getComponent(Card).setCardSize(52,85);\n\t\t\t\t\titem.addChild(node);\n\t\t\t\t});\n\t\t\t\titem.getComponent(Item).index = idx;\n\t\t\t\titem.getComponent(Layout).constraint = Layout.Constraint.FIXED_COL;\n\t\t\t\titem.getComponent(Layout).constraintNum = cards.length;\n\t\t\t\titem.off(Node.EventType.TOUCH_END);\n\t\t\t\titem.on(Node.EventType.TOUCH_END, (event) => {\n\t\t\t\t\tlet id_num:number =  event.target.getComponent(Item).index;\n\t\t\t\t\tthis.opClick(opType.code,id_num);\n\t\t\t\t}, this);\n\t\t\t\trowNum++;\n\t\t\t\titem_width = cards.length * 53\n\t\t\t\t//= item_width;\n\t\t\t\titem.getComponent(Layout).updateLayout();\n\t\t\t\t// item_width = item.getComponent(UITransform).width \n\t\t\t\tthis.node.addChild(item);\n\t\t\t}\n\t\t}\n\t\tlet cardLayout:Layout = this.node.getComponent(Layout);\n\t\tlet constraintNum:number = rowNum > 2 ? 2 : rowNum;\n\t\tcardLayout.updateLayout();\n\t\tthis.node.getComponent(UITransform).height = Math.round(rowNum / 2) * 86;\n\t\tthis.node.getComponent(UITransform).width = constraintNum * (item_width + cardLayout.spacingX);\n\t\topNode.node.addChild(this.node);\n\t\topNode.node.getComponent(Layout).updateLayout();\n\t}\n\n\tpublic opClick(opCode?:number,index?:number){\n\t\tlet req: Game.ISendOperation = {\n            opCard:OperationMgr.getInstance().getPassNumber(),\n\t\t\topCode:opCode,\n\t\t\topCards:OperationMgr.getInstance().getOprationListNumber(opCode,index),\n\t\t\tseatId:OperationMgr.getInstance().seatId,\n\t\t\tuserId:OperationMgr.getInstance().userId\n        }\n\t\tEventManager.dispatch(GameEvent.SEND_PLAYER_OPERATION, req);\n\t\tEventManager.dispatch(GameEvent.CLOSE_OPRATION_INFO);\n        OperationMgr.getInstance().myOpCode = opCode;\n\t}\n}\n\n"]}