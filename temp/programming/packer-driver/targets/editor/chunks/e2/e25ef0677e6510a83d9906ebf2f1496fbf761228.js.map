{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/proj/PayAgent.ts"],"names":["OrderRecode","PayAgent","GCache","AppEvent","ClientInfo","GConstants","GameTxt","Logger","EventManager","Utils","BaseControll","Platform","GlobalCMD","PayAgentState","Check","Start","Waiting","DoOrder","End","_handlerSendScheduler","_OuttimeOrderMap","_OuttimeHandlerMap","_FailOrderMap","_checkTime","maxOuttime","maxFailNum","print","args","logPay","instance","_instance","onInitModuleEvent","addModelListener","LOGIN_STATE_CHANGE","loginStateChange","NET_FORWARD_PAYMENT_ORDER","respForWardOrder","setOrder","id","order","reportData","isNotRun","number_valueOf","txt","dispatch","SYS_TOAST_TIP","content","OrderList","length","stopRun","oneRecord","push","startRun","getOrder","shift","reqSendOrder","addScheduler","dt","User","isLoginSuccesed","oneOrder","self","getUserMid","PLogInfo","access_token","updateReFreshAccessToken","state","isLogined","sendMsg","cmd","PHP_SEND_PAYMENT_ORDER","body","checkOuttime","pay_creater_order","NET_SEND_MSG","orderid","stopScheduler","handler","updateOuttime","event","isSuccess","respData","reqData","undefined","tab","console","log","pay_success","NET_REQ_REPORT_PAY_ORDER","pay_failed","string_isEmpty","UserLoginState","LoginSuccess","stopAllScheduler","orderID","Object","prototype","hasOwnProperty","call","oneRecode","waitingOrderList","PayReqSceneiIDRecord","constructor","param","_data","_code","_currowGoodGift","_agentState","_doPayCallback","_delegateCallback","_zoneId","_orderParam","_orderReportParam","timeEx","doPayCallback","isNotNull","doCheck","dump","ACTIVITY_GOODSLIST_UPDATE","doCheckAgain","setPayParam","oldNum","newNum","goodInfo","GoodsData","getGoodsGiftByGoodsID","pay_fail_no_goods","NET_REQ_GOODS_INFO","scene","code","getOneGoodGift","nullToDefault","doPay","doEnd","GoodMoneyType","rmb","price","createOrderParam","reqSendPay","num","callback","gid","zoneId","diamond","gold","isRMB","_type","PayType","FREE","SILVER","TICKET","SHARE","VIDEO","item_id","ptype","sceneId","v","isAndroid","operation","PhoneCardType","bundleId","BundleId","mobileid","hall_version","HallVer","key","value","other_param","env","WX_PayEnv","offerId","WX_PayOfferId","openId","time","payType","gameID","levelID","pmode","currency","pamount","pchips","sceneType","respParam","AppPayResult","UNINE","pay_fail_platform_not_support","SUCCESS","doReqOrder","pay_fail_platform_error","release","clear"],"mappings":"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","sourcesContent":["/**\n * Name = PayAgent\n * URL = db://assets/proj/PayAgent.ts\n * Time = Tue Jun 28 2022 20:52:03 GMT+0800 (中国标准时间)\n * Author = xueya\n * 支付代理类\n */\n\nimport { GCache } from \"../cache/GCache\";\nimport { AppEvent } from \"../config/AppEvent\";\nimport { ClientInfo } from \"../config/GameConfig\";\nimport { GConstants } from \"../config/GameConstant\";\nimport { GameTxt } from \"../config/GameTxt\";\nimport { inf_OrderRecord } from \"../framework/InterfaceDefines\";\nimport { Logger } from \"../framework/log/Logger\";\nimport { EventManager } from \"../framework/manager/EventManager\";\nimport { Utils } from \"../framework/Utils\";\nimport { BaseControll } from \"../framework/vc/BaseController\";\nimport { Platform } from \"../platform/Platform\";\nimport { GlobalCMD } from \"./gnet/GlobalCMD\";\n\nconst PayAgentState = {\n\tCheck: 0,\n\tStart: 1,\n\tWaiting: 2,\n\tDoOrder: 3,\n\tEnd: 4,\n}\n/** 订单记录 */\nexport class OrderRecode extends BaseControll {\n\tprivate static _instance = null;\n\t/** 代发送订单记录{订单号：ArrayObject} */\n\tpublic static OrderList: Array<inf_OrderRecord> = [];\n\t/** 等待核实的订单(已发送 未返回) */\n\tpublic static waitingOrderList: Array<inf_OrderRecord> = [];\n\n\tpublic static get instance(): OrderRecode {\n\t\tif (!this._instance || this._instance == null) {\n\t\t\tthis._instance = new OrderRecode(\"OrderRecode\");\n\t\t}\n\t\treturn this._instance;\n\t}\n\t/** 定时检查句柄 */\n\tprivate _handlerSendScheduler = null;\n\t/** 超时 order -> handler 映射{}*/\n\tprivate _OuttimeOrderMap = {};\n\t/** 超时  handler->order 映射{}*/\n\tprivate _OuttimeHandlerMap = {};\n\t/** 失败的订单记录 orderid->num*/\n\tprivate _FailOrderMap = {};\n\t/** 检查发送间隔时间 */\n\tprivate _checkTime = 5;\n\t/** 最大超时时长 */\n\tprivate maxOuttime = 4;\n\t/** 最大失败次数 */\n\tprivate maxFailNum = 2;\n\n\tprotected onInitModuleEvent(): void {\n\t\t//登录状态变化\n\t\tthis.addModelListener(AppEvent.LOGIN_STATE_CHANGE, this.loginStateChange);\n\t\t//订单回调\n\t\tthis.addModelListener(AppEvent.NET_FORWARD_PAYMENT_ORDER, this.respForWardOrder);\n\n\t}\n\n\t/** 插入一个订单 */\n\tsetOrder(id, order, reportData, isNotRun: boolean = false) {\n\t\tif (id && order) {\n\t\t\t//达到最大失败次数 不再请求\n\t\t\tif (Utils.number_valueOf(this._FailOrderMap[id]) > this.maxFailNum) {\n\t\t\t\tthis.print(`Fail:当前订单code:${id} 已达最大失败次数，停止请求！！！`, order, reportData);\n\t\t\t\tlet txt = \"Error:创建订单失败，已达失败上限！\";\n\t\t\t\tEventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: txt });\n\n\t\t\t\tif (OrderRecode.OrderList.length == 0) {\n\t\t\t\t\tthis.stopRun();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.print(`开始插入一个订单 当前订单code:${id},订单数据:`, order);\n\t\t\tlet oneRecord: inf_OrderRecord = { id: id, order: order, reportData: reportData };\n\t\t\tOrderRecode.OrderList.push(oneRecord);\n\n\t\t\tif (isNotRun == false) {\n\t\t\t\tthis.startRun();\n\t\t\t}\n\t\t}\n\t}\n\t/** 取出一个订单 */\n\tgetOrder(): inf_OrderRecord | null {\n\t\tif (OrderRecode.OrderList.length == 0) {\n\t\t\treturn null;\n\t\t}\n\t\treturn OrderRecode.OrderList.shift();\n\t}\n\t//开始执行\n\tstartRun() {\n\t\tthis.stopRun();\n\t\tif (OrderRecode.OrderList.length > 0) {\n\t\t\tthis.print(`执行订单检测函数==>待处理数目:${OrderRecode.OrderList.length}`);\n\t\t\tif (this._checkTime > 0) {\n\t\t\t\tthis.reqSendOrder();\n\t\t\t}\n\t\t\tthis._handlerSendScheduler = this.addScheduler(this._checkTime, this.reqSendOrder);\n\t\t}\n\t}\n\t/** 发送订单 */\n\treqSendOrder(dt?: number): void {\n\t\tif (GCache.User.isLoginSuccesed() == false) {\n\t\t\treturn;\n\t\t}\n\t\tlet oneOrder = OrderRecode.instance.getOrder();\n\t\tif (!oneOrder) {\n\t\t\tOrderRecode.instance.stopRun();\n\t\t\treturn;\n\t\t}\n\t\t//请求更新微信登录凭据\n\t\tlet self = this;\n\t\tthis.print(`MID:${GCache.User.getUserMid()},请求发送订单,当前订单code=${oneOrder.id} 订单数据:`, oneOrder.order);\n\t\tthis.print(`实时更新access_token,之前:${Platform.PLogInfo.access_token} `);\n\t\tPlatform.updateReFreshAccessToken((state) => {\n\t\t\tlet isLogined = GCache.User.isLoginSuccesed();\n\t\t\tthis.print(`实时更新access_token,之后:${Platform.PLogInfo.access_token},登录状态:${isLogined},更新状态:${state}`);\n\t\t\tif (isLogined == false || state != true) {\n\t\t\t\tthis.print(`Fail:无法执行创建订单,即将插入缓存队列，等待后续执行,当前登录状态:${isLogined},更新状态:${state}`);\n\t\t\t\tOrderRecode.instance.setOrder(oneOrder.id, oneOrder.order, oneOrder.reportData, isLogined == false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t//使用最新的access_token\n\t\t\tif (oneOrder.order[\"otherEx\"]) {\n\t\t\t\toneOrder.order[\"otherEx\"][\"access_token\"] = Platform.PLogInfo.access_token;\n\t\t\t}\n\t\t\tlet sendMsg = {\n\t\t\t\tcmd: GlobalCMD.PHP_SEND_PAYMENT_ORDER,\n\t\t\t\tbody: oneOrder.order,\n\t\t\t}\n\t\t\tself.checkOuttime(oneOrder.id, oneOrder.order, oneOrder.reportData);\n\n\t\t\tself.print(`ToServer:请求创建订单:code=${oneOrder.id}`);\n\t\t\tEventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: GameTxt.pay_creater_order });\n\t\t\tEventManager.dispatch(AppEvent.NET_SEND_MSG, sendMsg)\n\n\n\t\t});\n\t}\n\t//开启超时检测\n\tcheckOuttime(orderid, order, reportData) {\n\t\tthis.print(`开启创建订单的超时检测 code=${orderid}`);\n\t\tif (!orderid) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._OuttimeOrderMap[orderid]) {\n\t\t\tthis.stopScheduler(this._OuttimeOrderMap[orderid][\"handler\"]);\n\t\t\tthis._OuttimeOrderMap[orderid][\"handler\"] = null;\n\t\t\tthis._OuttimeOrderMap[orderid][\"order\"] = order;\n\t\t\tthis._OuttimeOrderMap[orderid][\"reportData\"] = reportData;\n\t\t} else {\n\t\t\tthis._OuttimeOrderMap[orderid] = {\n\t\t\t\thandler: null,\n\t\t\t\torder: order,\n\t\t\t\treportData: reportData\n\t\t\t};\n\t\t}\n\t\tlet handler = this.addScheduler(this.maxOuttime, this.updateOuttime);\n\t\tthis._OuttimeHandlerMap[handler] = orderid;\n\t\tthis._OuttimeOrderMap[orderid][\"handler\"] = handler;\n\t}\n\t/** 检测超时回调 */\n\tupdateOuttime(dt, handler) {\n\t\tif (!this._OuttimeHandlerMap[handler]) {\n\t\t\treturn;\n\t\t}\n\t\tlet orderid = this._OuttimeHandlerMap[handler];\n\t\tthis.print(`********订单检测超时回调**********code:${orderid},handler:${handler}`)\n\t\tif (this._OuttimeOrderMap[orderid]) {\n\t\t\tlet order = this._OuttimeOrderMap[orderid][\"order\"];\n\t\t\tlet reportData = this._OuttimeOrderMap[orderid][\"reportData\"];\n\n\t\t\tthis.stopScheduler(handler);\n\t\t\tthis._OuttimeOrderMap[orderid][\"handler\"] = null;\n\t\t\tthis._OuttimeOrderMap[orderid] = null;\n\t\t\tthis._OuttimeHandlerMap[handler] = null;\n\t\t\tthis._FailOrderMap[orderid] = Utils.number_valueOf(this._FailOrderMap[orderid]) + 1;\n\t\t\tthis.print(`Fail:订单检测超时,code:${orderid},handler:${handler},当前失败次数:${this._FailOrderMap[orderid]}`)\n\t\t\tthis.setOrder(orderid, order, reportData);\n\t\t} else {\n\t\t\tthis.print(\"没有订单？停止超时检测\", this._OuttimeOrderMap[orderid]);\n\t\t\tthis.stopScheduler(handler);\n\t\t}\n\n\t}\n\t//订单回调\n\trespForWardOrder(event, isSuccess, respData, reqData) {\n\t\tthis.print(\"reqData\", reqData, \"respData\", respData)\n\n\t\tlet orderid = null;\n\t\tif (isSuccess) {\n\t\t\tif (respData[\"retCode\"]) {\n\t\t\t\torderid = respData[\"retCode\"];\n\t\t\t};\n\t\t} else {\n\t\t\tif (respData[\"extraInfo\"][\"retCode\"]) {\n\t\t\t\torderid = respData[\"extraInfo\"][\"retCode\"];\n\t\t\t};\n\t\t}\n\t\tthis.print(`ByServer:服务端创建订单结果:${isSuccess} code:${orderid}`);\n\t\t//订单上报记录数据\n\t\tlet reportData = null;\n\t\tif (orderid != null && orderid != undefined) {\n\t\t\tif (this._OuttimeOrderMap[orderid]) {\n\t\t\t\t//停止超时检测\n\t\t\t\tlet handler = this._OuttimeOrderMap[orderid][\"handler\"];\n\t\t\t\tthis.stopScheduler(this._OuttimeOrderMap[orderid][\"handler\"]);\n\n\t\t\t\treportData = this._OuttimeOrderMap[orderid][\"reportData\"];\n\t\t\t\tif (isSuccess == false && respData[\"errorType\"] == 2000) {\n\t\t\t\t\tlet tab = {\n\t\t\t\t\t\tid: orderid,\n\t\t\t\t\t\torder: this._OuttimeOrderMap[orderid][\"order\"],\n\t\t\t\t\t\treportData: reportData,\n\t\t\t\t\t};\n\t\t\t\t\tthis._OuttimeOrderMap[orderid] = null;\n\t\t\t\t\tthis._OuttimeHandlerMap[handler] = null;\n\t\t\t\t\tthis._FailOrderMap[orderid] = Utils.number_valueOf(this._FailOrderMap[orderid]) + 1;\n\t\t\t\t\tthis.print(`Fail:检测到提交得到的token记录有误，重新提交 code:${orderid},当前失败次数:${this._FailOrderMap[orderid]}`)\n\n\t\t\t\t\tlet isLogined = GCache.User.isLoginSuccesed();\n\t\t\t\t\tOrderRecode.instance.setOrder(tab.id, tab.order, tab.reportData, isLogined == false);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis._OuttimeOrderMap[orderid] = null;\n\t\t\t\tthis._OuttimeHandlerMap[handler] = null;\n\t\t\t} else {\n\t\t\t\tthis._OuttimeOrderMap[orderid] = null;\n\t\t\t}\n\t\t}\n\t\tconsole.log(\"订单上报记录数据==>\", reportData);\n\t\tif (isSuccess == true) {\n\t\t\tdelete this._FailOrderMap[orderid];\n\n\t\t\tEventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: GameTxt.pay_success });\n\t\t\t//上报订单记录\n\t\t\tif (reportData && respData[\"orderid\"]) {\n\t\t\t\treportData[\"orderID\"] = respData[\"orderid\"];\n\n\t\t\t\tthis.print(`Success:创建订单成功，即将上报订单记录,MID:${GCache.User.getUserMid()},上报数据:`, reportData);\n\t\t\t\tEventManager.dispatch(AppEvent.NET_REQ_REPORT_PAY_ORDER, reportData);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.print(`Fail:订单创建失败,不再重新提交 code:${orderid},ErrorCode:${respData[\"errorType\"]},ErrorTips:${respData[\"errorTips\"]}`)\n\t\t\tlet txt = GameTxt.pay_failed;\n\t\t\tif (!Utils.string_isEmpty(respData[\"errorTips\"])) {\n\t\t\t\ttxt = respData[\"errorTips\"];\n\t\t\t};\n\t\t\tEventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: txt });\n\t\t};\n\t}\n\t//停止执行发送\n\tstopRun() {\n\t\tthis.stopScheduler(this._handlerSendScheduler);\n\t\tthis._handlerSendScheduler = null;\n\t}\n\t//登录状态发生改变变化\n\tloginStateChange(event, state) {\n\t\tif (state == GConstants.UserLoginState.LoginSuccess) {\n\t\t\t// this.print(\"登录成功了，开始订单发送===>订单数:\", OrderRecode.OrderList.length)\n\t\t\tthis.startRun();\n\t\t} else {\n\t\t\t// this.print(\"断开登录了暂停订单发送===>\")\n\t\t\tthis.stopAllScheduler();\n\t\t\tfor (const orderID in this._OuttimeOrderMap) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(this._OuttimeOrderMap, orderID)) {\n\t\t\t\t\tlet oneRecode = this._OuttimeOrderMap[orderID];\n\t\t\t\t\tthis.setOrder(orderID, oneRecode[\"order\"], oneRecode[\"reportData\"], true);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._OuttimeOrderMap = {};\n\t\t\tthis._OuttimeHandlerMap = {};\n\n\t\t}\n\t}\n\t//当前类日志输出\n\tprotected print = function (...args: any[]) {\n\t\tLogger.logPay(5, ...args);\n\t}\n};\n\n//记录请求的SceneID\nconst PayReqSceneiIDRecord = {};\n\n/** 支付代理 */\nexport class PayAgent extends BaseControll {\n\n\tprivate _data = null;\n\t//唯一code\n\tprivate _code = null;\n\t/** 当前商品详情 */\n\tprivate _currowGoodGift = null;\n\t//代理状态：PayAgentState\n\tprivate _agentState = PayAgentState.Check;\n\t//支付回调\n\tprivate _doPayCallback = null;\n\t//代理回调\n\tprivate _delegateCallback: Function = null;\n\t//默认商品分区ID\n\tprivate _zoneId: number = 1;\n\t//生成订单所用的参数\n\tprivate _orderParam = null;\n\t//订单上报所用的参数\n\tprivate _orderReportParam = null;\n\t//实例化\n\tconstructor(param) {\n\t\tsuper(\"PayAgent\");\n\t\tthis._data = param;\n\t\tthis._code = Utils.timeEx();\n\t\tthis._orderParam = null;\n\t\tthis._orderReportParam = null;\n\t\tthis._doPayCallback = Utils.handler(this, this.doPayCallback);\n\n\t\tthis.print(`MID:${GCache.User.getUserMid()},请求了支付,数据为:`, this._data);\n\t\tif (Utils.isNotNull(this._data, this._data[\"scene\"], this._data[\"gid\"])) {\n\t\t\tthis.doCheck();\n\t\t} else {\n\t\t\tthis.dump(this._data, \"错误的支付代理参数\");\n\t\t}\n\n\t};\n\t/**初始化添加事件绑定 */\n\tprotected onInitModuleEvent(): void {\n\t\t//商品信息有更新\n\t\tthis.addModelListener(AppEvent.ACTIVITY_GOODSLIST_UPDATE, this.doCheckAgain)\n\t}\n\t/** 设置支付参数 选择支付 */\n\tpublic setPayParam(param) {\n\n\t};\n\tdoCheck(event = null) {\n\t\tif (Utils.isNotNull(this._data, this._data[\"scene\"], this._data[\"gid\"]) == false) {\n\t\t\tthis.print(\"错误的支付代理参数\");\n\t\t\treturn;\n\t\t}\n\t\t//记录商品详情请求的次数\n\t\tlet oldNum = Utils.number_valueOf(PayReqSceneiIDRecord[this._data[\"scene\"]], 0);\n\t\tlet newNum = oldNum + 1;\n\t\tPayReqSceneiIDRecord[this._data[\"scene\"]] = newNum;\n\n\t\tlet goodInfo = GCache.GoodsData.getGoodsGiftByGoodsID(this._data[\"scene\"]);\n\t\tif (!goodInfo) {\n\t\t\tthis._agentState = PayAgentState.Check;\n\t\t\tif (newNum >= 2) {\n\t\t\t\tEventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: GameTxt.pay_fail_no_goods });\n\t\t\t} else {\n\t\t\t\tEventManager.dispatch(AppEvent.NET_REQ_GOODS_INFO, { scene: this._data[\"scene\"], code: this._code });\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tthis._currowGoodGift = GCache.GoodsData.getOneGoodGift(this._data[\"scene\"], this._data[\"gid\"]);\n\t\tthis._zoneId = Utils.nullToDefault(this._currowGoodGift[\"zoneId\"], 1);\n\t\tthis.doPay();\n\t}\n\tdoCheckAgain(event, scene, param) {\n\t\tif (scene != this._data[\"scene\"]) {\n\t\t\treturn;\n\t\t}\n\t\tif (!param || param[\"code\"] != this._code) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._agentState != PayAgentState.Check) {\n\t\t\t//支付代理不在检查状态\n\t\t\treturn;\n\t\t}\n\t\tthis.doCheck();\n\t}\n\tdoPay() {\n\t\tif (Utils.isNotNull(this._currowGoodGift) == false) {\n\t\t\t//支付失败，商品信息不存在\n\t\t\tthis.doEnd(GameTxt.pay_fail_no_goods);\n\t\t\treturn;\n\t\t}\n\t\tthis._agentState = PayAgentState.Start;\n\n\t\tswitch (this._currowGoodGift[\"currency\"]) {//支付的货币类型\n\t\t\tcase GConstants.GoodMoneyType.rmb:\n\t\t\t\t// if (Platform.isAndroid() == false && Platform.isWindows() == false) {\n\t\t\t\t// \t//支付失败，IOS暂时不支持\n\t\t\t\t// \tthis.doEnd(GameTxt.pay_fail_platform_not_support);\n\t\t\t\t// \treturn;\n\t\t\t\t// }\n\t\t\t\tlet price = Utils.nullToDefault(this._currowGoodGift[\"pamount\"], null);\n\t\t\t\tif (!price) {\n\t\t\t\t\t//支付失败，价格配置错误\n\t\t\t\t\tthis.print(\"支付失败，价格配置错误\");\n\t\t\t\t\tthis.doEnd();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (this.createOrderParam() == false) {\n\t\t\t\t\tthis.print(\"支付失败，订单参数生成有误\");\n\t\t\t\t\tthis.doEnd();\n\t\t\t\t\treturn;\n\t\t\t\t};\n\t\t\t\tthis._agentState = PayAgentState.Waiting;\n\t\t\t\tthis.print(`MID:${GCache.User.getUserMid()},发起一笔支付,商品ID:${this._data[\"scene\"]},GID:${this._data[\"gid\"]},RMB:${price}元,code:${this._code}`);\n\t\t\t\tPlatform.reqSendPay({ //支付\n\t\t\t\t\tnum: price,\n\t\t\t\t\tcallback: this._doPayCallback,\n\t\t\t\t\tcode: this._code,\n\t\t\t\t\tscene: this._data[\"scene\"],\n\t\t\t\t\tgid: this._data[\"gid\"],\n\t\t\t\t\tzoneId: this._zoneId,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase GConstants.GoodMoneyType.diamond:\n\t\t\t\t//支付失败，支付代理暂时不支持钻石支付\n\t\t\t\tthis.print(\"支付失败，支付代理暂时不支持钻石支付\");\n\t\t\t\tthis.doEnd();\n\t\t\t\treturn;\n\t\t\tcase GConstants.GoodMoneyType.gold:\n\t\t\t\t//支付失败，支付代理暂时不支持金条支付\n\t\t\t\tthis.print(\"支付失败，支付代理暂时不支持金条支付\");\n\t\t\t\tthis.doEnd();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\t//支付失败，不支持的支付类型\n\t\t\t\tthis.print(\"支付失败，不支持的支付类型 type = \" + this._currowGoodGift[\"currency\"]);\n\t\t\t\tthis.doEnd(GameTxt.pay_fail_no_goods);\n\t\t\t\treturn;\n\t\t}\n\t}\n\t//判断支付方式是否属于RMB支付\n\tpublic static isRMB(_type): boolean {\n\t\t_type = Utils.number_valueOf(_type);\n\t\tif (_type == GConstants.PayType.FREE\n\t\t\t|| _type == GConstants.PayType.SILVER\n\t\t\t|| _type == GConstants.PayType.TICKET\n\t\t\t|| _type == GConstants.PayType.SHARE\n\t\t\t|| _type == GConstants.PayType.VIDEO) {\n\t\t\t//免费、银币，兑换券，分享，看视频不属于RMB支付\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\t/** 创建订单参数 */\n\tcreateOrderParam() {\n\t\tif (!this._currowGoodGift) {\n\t\t\treturn false;\n\t\t}\n\t\t//测试代码\n\t\t// Platform.PLogInfo.access_token = \"58_eQWNrWIjmP1dYhMv31_k1cxvAopu5o8c4bg6fLpiMb1r5w-OXvE6NVJ89sOrXVdD24PVkADVmaJJP5sf-9WS-eqJ4r8UI-13x-MBmyzcYVpiqOzdq7qhVy3h2i_S9Ox_3frMUOxd5-b8qSAyVVGjACAZZK\";\n\t\t// Platform.PLogInfo.openId = \"owvGE5QcLfmK3jHkkwAMlsUyoJDc\";\n\t\tUtils.dump(\"创建订单参数\", this._currowGoodGift);\n\t\tlet param = {\n\t\t\titem_id: this._currowGoodGift[\"id\"],      //商品Id\n\t\t\tptype: 937,                               //支付渠道\n\t\t\tsceneId: this._data[\"scene\"],             //支付商品分类\n\t\t\tv: Platform.isAndroid() == true ? 2 : 0,  //支付版本：1为IOS(老版本)、2为安卓、6: IOS(新版) 其他为PC客户端\n\t\t\toperation: ClientInfo.PhoneCardType,\n\t\t\tbundleId: ClientInfo.BundleId,\n\t\t\tmobileid: 0,\n\t\t\thall_version: ClientInfo.HallVer,\n\t\t};\n\t\tif (this._currowGoodGift[\"extra\"]) {\n\t\t\tfor (let key in this._currowGoodGift[\"extra\"]) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(this._currowGoodGift[\"extra\"], key)) {\n\t\t\t\t\tlet value = this._currowGoodGift[\"extra\"][key];\n\t\t\t\t\tif (typeof (value) == \"string\" || typeof (value) == \"number\" || typeof (value) == \"boolean\") {\n\t\t\t\t\t\tparam[key] = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tlet other_param = {\n\t\t\tcode: this._code,                     //订单唯一标识\n\t\t\tenv: ClientInfo.WX_PayEnv,           //支付环境（0:正式 1:沙箱）\n\t\t\tofferId: ClientInfo.WX_PayOfferId,   //米大师侧注册的应用ID\n\t\t\tzoneId: this._zoneId,                //分区ID\n\t\t\topenId: Platform.PLogInfo.openId,             //用户openId\n\t\t\taccess_token: Platform.PLogInfo.access_token, //access_token(实时的)\n\t\t\tprice: this._currowGoodGift[\"pamount\"],  //实际支付价格\n\t\t\ttime: Utils.time(),                  //订单生成时间戳\n\t\t}\n\t\tparam[\"otherEx\"] = other_param;\n\t\tthis._orderParam = param;\n\n\t\t//支付方式\n\t\tlet payType = 0;\n\t\tif (this._currowGoodGift[\"pmodes\"] && this._currowGoodGift[\"pmodes\"].length > 0) {\n\t\t\tpayType = this._currowGoodGift[\"pmodes\"][0][\"id\"];\n\t\t}\n\t\t//订单上报的数据结构\n\t\tlet reportData = {\n\t\t\torderID: null,                            //订单ID(创建时补上)\n\t\t\tgameID: Utils.number_valueOf(this._data[\"otherEx\"][\"gameID\"]),\n\t\t\tlevelID: Utils.number_valueOf(this._data[\"otherEx\"][\"levelID\"]),\n\t\t\tpmode: payType,                                  //下单时的支付方式\n\t\t\tcurrency: this._currowGoodGift[\"currency\"],//币种类型，比如F币，人民币\n\t\t\tpamount: this._currowGoodGift[\"pamount\"],  //实际支付价格\n\t\t\tscene: this._currowGoodGift[\"scene\"],       //商品类型\n\t\t\tid: this._currowGoodGift[\"id\"],             //商品ID\n\t\t\tpchips: this._currowGoodGift[\"pchips\"],     //商品数量\n\t\t\tsceneType: this._data[\"sceneType\"]          //场景类型\n\t\t}\n\t\tthis._orderReportParam = reportData;\n\n\t\treturn true;\n\t}\n\n\t/** 平台支付的回调 */\n\tdoPayCallback(respParam) {\n\t\tif (!respParam) {\n\t\t\treturn;\n\t\t}\n\t\tthis.print(`MID:${GCache.User.getUserMid()},商品ID:${respParam[\"req\"][\"scene\"]},GID:${respParam[\"req\"][\"gid\"]},RMB:${respParam[\"req\"][\"num\"]}元,code:${this._code},平台支付结果:${respParam[\"respCode\"] == 0 ? \"成功\" : \"失败\"}`);\n\t\tlet txt = null;\n\t\tif (respParam[\"respCode\"] == GConstants.AppPayResult.UNINE) {\n\t\t\ttxt = GameTxt.pay_fail_platform_not_support;\n\t\t};\n\t\tif (respParam[\"req\"][\"code\"] == this._code) {\n\t\t\tif (respParam[\"respCode\"] == GConstants.AppPayResult.SUCCESS) {\n\t\t\t\tthis.doReqOrder();\n\t\t\t} else {\n\t\t\t\tthis.doEnd(txt);\n\t\t\t}\n\t\t}\n\t};\n\t/** 请求生成订单 */\n\tdoReqOrder() {\n\t\tif (!this._orderParam) {\n\t\t\t//支付失败，不支持的支付类型\n\t\t\tthis.print(\"支付成功，但是创建订单失败，无创建参数\");\n\t\t\tthis.doEnd(GameTxt.pay_fail_platform_error);\n\t\t\treturn;\n\t\t}\n\t\tthis._agentState = PayAgentState.DoOrder;\n\n\t\tOrderRecode.instance.setOrder(this._code, this._orderParam, this._orderReportParam);\n\t}\n\t//主动结束\n\tdoEnd(txt: string = null) {\n\t\tthis._agentState = PayAgentState.End;\n\t\tif (Utils.string_isEmpty(txt) == false) {\n\t\t\tEventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: txt });\n\t\t}\n\t\tthis.release();\n\t}\n\tpublic release(): void {\n\t\tsuper.clear();\n\t}\n\t//当前类日志输出\n\tprotected print = function (...args: any[]) {\n\t\tLogger.logPay(5, ...args);\n\t}\n}\n\n"]}