{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/game/scripts/Players/MyPlayerCard.ts"],"names":["Animation","animation","AnimationClip","instantiate","Node","Vec3","_decorator","GCache","EventManager","BaseComponent","OperationMgr","PlayerMgr","OPCode","GameEvent","CardUtil","NodeCardCtr","drawCardDisRatio","MjSize","ccclass","property","MyPlayerCard","tooltip","type","selectedNode","_drawCardNode","_mjList","myHandCardY","_slotIndex","_drawByte","_playHandCardCb","drawByte","newValue","onInitModuleEvent","stackAnim","indexList","tByte","insertIndex","cb","pos","length","removeHandCard","node","getPosition","add","setPosition","removeDrawCard","addHandCard","startPos","endPos","ac","duration","track","VectorTrack","componentsCount","path","TrackPath","toProperty","x","channels","curve","assignSorted","value","animCom","getComponent","addComponent","removeAll","EventType","FINISHED","on","addTrack","defaultClip","play","pop","startPosDraw","endPosDraw","width","y","z","acDraw","trackDraw","drawX","animDrawCom","removeFromParent","console","log","index","insertNode","nodeCardTemplate","cardValue","setCardByte","active","name","addChild","splice","updateHandPositionAndName","drawCard","off","TOUCH_END","event","playSelectAnim","target","getLastPosition","filter","item","undefined","i","handNode","getInstance","getHandCardByIndex","playDrawCard","toOutCard","playCardFromHandAnim","remove","updateCard","sort","a","b","removeNode","makeSlotAnim","_","mjNode","getHandPosition","drawCardToSlot","posx","posy","posz","easingMethod","getListBytes","bytes","node_byte","byte","push","useByteFindIndexs","indexs","forEach","getNodeIndex","findIndex","theNode","addHandCards","valueList","stackCount","hasDrawCard","handCardCount","playUnselectAnim","trackPos","Desk","turnMe","onSendCard","dumpMyHands","getSendCardIndex","getMajiangValue","req","opCard","opCode","OPE_OUT_CARD","opCards","seatId","userId","dispatch","SEND_PLAYER_OPERATION","cleanMjList","removeAllChildren","resetView"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACSA,MAAAA,S,OAAAA,S;AAAWC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,a,OAAAA,a;AAAeC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,U,OAAAA,U;;AAC9DC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,S,iBAAAA,S;;AAEAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,W,kBAAAA,W;;AACAC,MAAAA,gB,kBAAAA,gB;AAAkBC,MAAAA,M,kBAAAA,M;;;;;;;;;OACrB;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBb,U;AAE9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;8BAGac,Y,WADZF,OAAO,CAAC,cAAD,C,UAWNC,QAAQ,CAAC;AAAEE,QAAAA,OAAO,EAAE,MAAX;AAAmBC,QAAAA,IAAI,EAAElB;AAAzB,OAAD,C,2BAXV,MACagB,YADb;AAAA;AAAA,0CACgD;AAAA;AAAA;AAAA,eACxCG,YADwC,GACZ,IADY;AAAA,eAGrCC,aAHqC,GAGR,IAHQ;AAAA,eAKxCC,OALwC,GAKvB,EALuB;AAAA,eAOvCC,WAPuC,GAOjB,CAPiB;;AAAA;;AAAA,eAa/CC,UAb+C;AAAA,eAcvCC,SAduC;AAAA,eAgB/CC,eAhB+C;AAAA;;AAkBnC,YAARC,QAAQ,GAAW;AACtB,iBAAO,KAAKF,SAAZ;AACA;;AAEW,YAARE,QAAQ,CAACC,QAAD,EAAmB;AAC9B,eAAKH,SAAL,GAAiBG,QAAjB;AACA;AACD;;;AACUC,QAAAA,iBAAiB,GAAG,CAE7B;;AACD;AACAC,QAAAA,SAAS,CAACC,SAAD,EAAsBC,KAAtB,EAAsCC,WAAtC,EAA4DC,EAA5D,EAAqE;AAC7E,cAAIC,GAAG,GAAG,IAAIjC,IAAJ,EAAV;;AACA,cAAG6B,SAAS,CAACK,MAAV,KAAqB,CAAxB,EAA0B;AAChB,iBAAKC,cAAL,CAAoBN,SAApB,EADgB,CAEzB;;AACAI,YAAAA,GAAG,GAAG,KAAKG,IAAL,CAAUC,WAAV,EAAN;AACArC,YAAAA,IAAI,CAACsC,GAAL,CAASL,GAAT,EAAcA,GAAd,EAAmBA,GAAnB;AACA,iBAAKG,IAAL,CAAUG,WAAV,CAAsBN,GAAtB;AACA,WAND,MAMM,IAAIJ,SAAS,CAACK,MAAV,IAAoB,CAAxB,EAA0B;AACtB,iBAAKC,cAAL,CAAoBN,SAApB,EADsB,CAE/B;;AACAI,YAAAA,GAAG,GAAG,KAAKG,IAAL,CAAUC,WAAV,EAAN;AACSrC,YAAAA,IAAI,CAACsC,GAAL,CAASL,GAAT,EAAcA,GAAd,EAAmBA,GAAnB;AACA,iBAAKG,IAAL,CAAUG,WAAV,CAAsBN,GAAtB;AACA;AACT,WAPK,MAOA,IAAIJ,SAAS,CAACK,MAAV,IAAoB,CAApB,IAAyBH,WAAW,KAAG,IAA3C,EAAgD;AAC5CA,YAAAA,WAAW,GAAGA,WAAW,GAAGF,SAAS,CAACK,MAAtC;AACA,iBAAKC,cAAL,CAAoBN,SAApB;AACT,iBAAKW,cAAL;AACS,iBAAKC,WAAL,CAAiBX,KAAjB,EAAwBC,WAAxB;AACAE,YAAAA,GAAG,GAAG,KAAKG,IAAL,CAAUC,WAAV,EAAN;AACArC,YAAAA,IAAI,CAACsC,GAAL,CAASL,GAAT,EAAcA,GAAd,EAAmBA,GAAnB;AACA,iBAAKG,IAAL,CAAUG,WAAV,CAAsBN,GAAtB;AACA;AACT,WAxB4E,CA0B7E;;;AACM,cAAIS,QAAQ,GAAGT,GAAf;AACA,cAAIU,MAAM,GAAG,IAAI3C,IAAJ,EAAb;AACAA,UAAAA,IAAI,CAACsC,GAAL,CAASK,MAAT,EAAiBD,QAAjB,EAA2BA,QAA3B;AAEA,cAAIE,EAAE,GAAG,IAAI/C,aAAJ,EAAT;AACA+C,UAAAA,EAAE,CAACC,QAAH,GAAc,GAAd;AACA,cAAIC,KAAK,GAAG,IAAIlD,SAAS,CAACmD,WAAd,EAAZ;AACAD,UAAAA,KAAK,CAACE,eAAN,GAAwB,CAAxB;AACAF,UAAAA,KAAK,CAACG,IAAN,GAAa,IAAIrD,SAAS,CAACsD,SAAd,GAA0BC,UAA1B,CAAqC,UAArC,CAAb;AACA,cAAI,CAACC,CAAD,IAAMN,KAAK,CAACO,QAAN,EAAV;AAEAD,UAAAA,CAAC,CAACE,KAAF,CAAQC,YAAR,CAAqB,CACjB,CAAC,CAAD,EAAI;AAACC,YAAAA,KAAK,EAAEd,QAAQ,CAACU;AAAjB,WAAJ,CADiB,EAEjB,CAAC,GAAD,EAAM;AAACI,YAAAA,KAAK,EAAEb,MAAM,CAACS;AAAf,WAAN,CAFiB,CAArB;AAKA,cAAIK,OAAJ;;AAEA,cAAI,KAAKrB,IAAL,CAAUsB,YAAV,CAAuB/D,SAAvB,KAAqC,IAAzC,EACA;AACI8D,YAAAA,OAAO,GAAG,KAAKrB,IAAL,CAAUuB,YAAV,CAAuBhE,SAAvB,CAAV;AACH,WAHD,MAKA;AACI8D,YAAAA,OAAO,GAAG,KAAKrB,IAAL,CAAUsB,YAAV,CAAuB/D,SAAvB,CAAV;AACA8D,YAAAA,OAAO,CAACG,SAAR,CAAkBjE,SAAS,CAACkE,SAAV,CAAoBC,QAAtC;AACH;;AAED,cAAG9B,EAAH,EACA;AACIyB,YAAAA,OAAO,CAACM,EAAR,CAAWpE,SAAS,CAACkE,SAAV,CAAoBC,QAA/B,EAAyC9B,EAAzC,EAA6C,IAA7C,EADJ,CAEI;AACH;;AAEDY,UAAAA,EAAE,CAACoB,QAAH,CAAYlB,KAAZ;AACAW,UAAAA,OAAO,CAACQ,WAAR,GAAsBrB,EAAtB;AACAa,UAAAA,OAAO,CAACS,IAAR;AAIA,eAAK/C,aAAL,GAAqB,KAAKC,OAAL,CAAa+C,GAAb,EAArB;;AAEA,cAAIC,YAAY,GAAG,KAAKjD,aAAL,CAAmBkB,WAAnB,EAAnB;;AACA,cAAIgC,UAAU,GAAG,IAAIrE,IAAJ,CAASoE,YAAY,CAAChB,CAAb,GAAiB;AAAA;AAAA,gCAAOkB,KAAjC,EAAwCF,YAAY,CAACG,CAArD,EAAwDH,YAAY,CAACI,CAArE,CAAjB;AAEA,cAAIC,MAAM,GAAG,IAAI5E,aAAJ,EAAb;AACA4E,UAAAA,MAAM,CAAC5B,QAAP,GAAkB,GAAlB;AACA,cAAI6B,SAAS,GAAG,IAAI9E,SAAS,CAACmD,WAAd,EAAhB;AACA2B,UAAAA,SAAS,CAAC1B,eAAV,GAA4B,CAA5B;AACA0B,UAAAA,SAAS,CAACzB,IAAV,GAAiB,IAAIrD,SAAS,CAACsD,SAAd,GAA0BC,UAA1B,CAAqC,UAArC,CAAjB;AACA,cAAI,CAACwB,KAAD,IAAUD,SAAS,CAACrB,QAAV,EAAd;AAEAsB,UAAAA,KAAK,CAACrB,KAAN,CAAYC,YAAZ,CAAyB,CACrB,CAAC,CAAD,EAAI;AAACC,YAAAA,KAAK,EAAEY,YAAY,CAAChB;AAArB,WAAJ,CADqB,EAErB,CAAC,GAAD,EAAM;AAACI,YAAAA,KAAK,EAAEa,UAAU,CAACjB;AAAnB,WAAN,CAFqB,CAAzB;AAKA,cAAIwB,WAAJ;;AAEA,cAAI,KAAKzD,aAAL,CAAmBuC,YAAnB,CAAgC/D,SAAhC,KAA8C,IAAlD,EACA;AACIiF,YAAAA,WAAW,GAAG,KAAKzD,aAAL,CAAmBwC,YAAnB,CAAgChE,SAAhC,CAAd;AACH,WAHD,MAKA;AACIiF,YAAAA,WAAW,GAAG,KAAKzD,aAAL,CAAmBuC,YAAnB,CAAgC/D,SAAhC,CAAd;AACAiF,YAAAA,WAAW,CAAChB,SAAZ,CAAsBjE,SAAS,CAACkE,SAAV,CAAoBC,QAA1C;AACH;;AAED,cAAG9B,EAAH,EACA;AACI4C,YAAAA,WAAW,CAACb,EAAZ,CAAepE,SAAS,CAACkE,SAAV,CAAoBC,QAAnC,EAA6C9B,EAA7C,EAAiD,IAAjD,EADJ,CAEI;AACH;;AAEDyC,UAAAA,MAAM,CAACT,QAAP,CAAgBU,SAAhB;AACAE,UAAAA,WAAW,CAACX,WAAZ,GAA0BQ,MAA1B;AACAG,UAAAA,WAAW,CAACV,IAAZ;AAEN,SAxI8C,CA0I/C;;;AACG1B,QAAAA,cAAc,GAAG;AACb,cAAI,KAAKrB,aAAT,EAAwB;AACpB,iBAAKA,aAAL,CAAmB0D,gBAAnB;;AACA,iBAAK1D,aAAL,GAAqB,IAArB;AACH,WAHD,MAIK;AACD2D,YAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ;AACH;AACJ,SAnJ2C,CAoJ/C;;;AACAtC,QAAAA,WAAW,CAACX,KAAD,EAAgBkD,KAAhB,EAA+B;AAEnC,cAAIA,KAAK,GAAG,KAAK5D,OAAL,CAAac,MAAzB,EAAiC;AAC7B4C,YAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ,EAAkCC,KAAlC;AACA;AACH;;AAED,cAAI,KAAK5D,OAAL,CAAac,MAAb,IAAuB,EAA3B,EAA+B;AAC3B4C,YAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAAgCC,KAAhC;AACA;AACH;;AAEP,cAAIC,UAAU,GAAGnF,WAAW,CAAC,KAAKoF,gBAAN,CAA5B;AACA,cAAIC,SAAS,GAAGrD,KAAhB;AACAmD,UAAAA,UAAU,CAACvB,YAAX;AAAA;AAAA,0CAAqC0B,WAArC,CAAiDD,SAAjD;AACAF,UAAAA,UAAU,CAACI,MAAX,GAAoB,IAApB;AACMJ,UAAAA,UAAU,CAACK,IAAX,GAAkB,YAAYN,KAA9B;AAEA,eAAK5C,IAAL,CAAUmD,QAAV,CAAmBN,UAAnB;;AACN,eAAK7D,OAAL,CAAaoE,MAAb,CAAoBR,KAApB,EAA2B,CAA3B,EAA8BC,UAA9B,EAnByC,CAmBE;;;AAErC,eAAKQ,yBAAL;AACH,SA3K2C,CA6K/C;;;AACGC,QAAAA,QAAQ,CAAC5D,KAAD,EAAgB;AAC1B,eAAKL,QAAL,GAAgBK,KAAhB;AACA,eAAKX,aAAL,GAAqBrB,WAAW,CAAC,KAAKoF,gBAAN,CAAhC;;AACA,eAAK/D,aAAL,CAAmBuC,YAAnB;AAAA;AAAA,0CAA6C0B,WAA7C,CAAyDtD,KAAzD;;AACA,eAAKX,aAAL,CAAmBkE,MAAnB,GAA4B,IAA5B;AACA,eAAKjD,IAAL,CAAUmD,QAAV,CAAmB,KAAKpE,aAAxB;;AACA,eAAKA,aAAL,CAAmBwE,GAAnB,CAAuB5F,IAAI,CAAC8D,SAAL,CAAe+B,SAAtC;;AACA,eAAKzE,aAAL,CAAmB4C,EAAnB,CAAsBhE,IAAI,CAAC8D,SAAL,CAAe+B,SAArC,EAAiDC,KAAD,IAAW;AAC1D,iBAAKC,cAAL,CAAoBD,KAAK,CAACE,MAA1B;AACA,WAFD,EAEG,IAFH;;AAGA,eAAK5E,aAAL,CAAmBoB,WAAnB,CAA+B,KAAKyD,eAAL,KAAyB;AAAA;AAAA,sDAAmB;AAAA;AAAA,gCAAO1B,KAAlF,EAAyF,CAAzF,EAA4F,CAA5F;AACA;;AAEDmB,QAAAA,yBAAyB,GAAE;AACpB,eAAKrE,OAAL,GAAe,KAAKA,OAAL,CAAa6E,MAAb,CAAoBC,IAAI,IAAIA,IAAI,KAAK,IAAT,IAAiBA,IAAI,KAAKC,SAAtD,CAAf;;AACN,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKhF,OAAL,CAAac,MAAjC,EAAyCkE,CAAC,EAA1C,EAA8C;AACpC,gBAAIC,QAAQ,GAAG,KAAKjF,OAAL,CAAagF,CAAb,CAAf;AACAC,YAAAA,QAAQ,CAACf,IAAT,GAAgB,YAAYc,CAA5B;AACAC,YAAAA,QAAQ,CAAC3C,YAAT;AAAA;AAAA,4CAAmC0B,WAAnC,CAA+C;AAAA;AAAA,wCAAUkB,WAAV,GAAwBC,kBAAxB,CAA2CH,CAA3C,CAA/C;AACTC,YAAAA,QAAQ,CAACV,GAAT,CAAa5F,IAAI,CAAC8D,SAAL,CAAe+B,SAA5B;AACAS,YAAAA,QAAQ,CAACtC,EAAT,CAAYhE,IAAI,CAAC8D,SAAL,CAAe+B,SAA3B,EAAuCC,KAAD,IAAW;AAChD,mBAAKC,cAAL,CAAoBD,KAAK,CAACE,MAA1B;AACA,aAFD,EAEG,IAFH;AAGSM,YAAAA,QAAQ,CAAC9D,WAAT,CAAqB;AAAA;AAAA,kCAAO+B,KAAP,GAAe,CAAf,GAAmB;AAAA;AAAA,kCAAOA,KAAP,GAAe8B,CAAvD,EAA0D,CAA1D,EAA6D,CAA7D;AACH;AACP,SAvM8C,CA2M5C;;;AACAI,QAAAA,YAAY,CAAExE,EAAF,EAAW;AACnB,cAAIyE,SAAS,GAAG,KAAKtF,aAArB;AACAsF,UAAAA,SAAS,CAAC5B,gBAAV;AACA,eAAK1D,aAAL,GAAqB,IAArB;AACH;;AACJuF,QAAAA,oBAAoB,CAAC1B,KAAD,EAAe2B,MAAf,EAAgC3E,EAAhC,EAA0C;AAC7D,eAAKV,UAAL,GAAkB0D,KAAlB;AAEM,cAAIyB,SAAS,GAAG,KAAKrF,OAAL,CAAa4D,KAAb,CAAhB;;AACA,cAAG2B,MAAH,EAAU;AACN,iBAAKvF,OAAL,CAAaoE,MAAb,CAAoBR,KAApB,EAA2B,CAA3B;AACH,WAFD,MAEK;AACD,iBAAK5D,OAAL,CAAa4D,KAAb,IAAsB,IAAtB;AACH;;AACPyB,UAAAA,SAAS,CAAC5B,gBAAV;AACA,SA3N8C,CA6N/C;;;AACG1C,QAAAA,cAAc,CAACN,SAAD,EAAsB+E,UAAmB,GAAG,KAA5C,EAAmD;AACnE/E,UAAAA,SAAS,CAACgF,IAAV,CAAe,CAACC,CAAD,EAAIC,CAAJ,KAAUA,CAAC,GAAGD,CAA7B;;AAEA,eAAK,IAAI9B,KAAT,IAAkBnD,SAAlB,EAA6B;AACnB,gBAAImD,KAAK,GAAG,KAAK5D,OAAL,CAAac,MAAzB,EAAiC;AAC7B,kBAAI8E,UAAU,GAAG,KAAK5F,OAAL,CAAaoE,MAAb,CAAoBR,KAApB,EAA2B,CAA3B,CAAjB;;AACAgC,cAAAA,UAAU,CAAC,CAAD,CAAV,CAAcnC,gBAAd;AACH,aAHD,MAIK;AACDC,cAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ,EAAoCC,KAApC;AACA;AACH;AACJ;;AAED,cAAI4B,UAAJ,EACA;AACI,iBAAKnB,yBAAL;AACH;AAEP;;AAEDwB,QAAAA,YAAY,CAACjC,KAAD,EACT;AACI,cAAI,KAAK1D,UAAL,IAAmB,CAAC,CAApB,IAAyB,KAAKF,OAAL,CAAa,KAAKE,UAAlB,KAAiC,IAA9D,EACA;AACIwD,YAAAA,OAAO,CAACC,GAAR,CAAY,wBAAZ,EAAsC,KAAKzD,UAA3C,EAAuD0D,KAAvD;AAEA;AACH;;AAED,cAAI,KAAK1D,UAAL,GAAkB0D,KAAtB,EAA6B;AAC7B;AACL,mBAAK,IAAIoB,CAAC,GAAG,KAAK9E,UAAL,GAAkB,CAA/B,EAAkC8E,CAAC,IAAIpB,KAAvC,EAA8CoB,CAAC,EAA/C,EACS;AACI,oBAAIxD,EAAE,GAAG,IAAI/C,aAAJ,EAAT;AACA+C,gBAAAA,EAAE,CAACC,QAAH,GAAc,GAAd;AACA,oBAAIC,KAAK,GAAG,IAAIlD,SAAS,CAACmD,WAAd,EAAZ;AACAD,gBAAAA,KAAK,CAACE,eAAN,GAAwB,CAAxB;AACAF,gBAAAA,KAAK,CAACG,IAAN,GAAa,IAAIrD,SAAS,CAACsD,SAAd,GAA0BC,UAA1B,CAAqC,UAArC,CAAb;AACA,oBAAI,CAACC,CAAD,EAAI8D,CAAJ,EAAO1C,CAAP,IAAY1B,KAAK,CAACO,QAAN,EAAhB;AACA,oBAAI8D,MAAM,GAAG,KAAK/F,OAAL,CAAagF,CAAb,CAAb;AACA,oBAAI1D,QAAQ,GAAGyE,MAAM,CAAC9E,WAAP,EAAf;AACA,oBAAIM,MAAM,GAAG,KAAKyE,eAAL,CAAqBhB,CAAC,GAAG,CAAzB,CAAb;AAEAhD,gBAAAA,CAAC,CAACE,KAAF,CAAQC,YAAR,CAAqB,CACjB,CAAC,CAAD,EAAI;AAACC,kBAAAA,KAAK,EAAEd,QAAQ,CAACU;AAAjB,iBAAJ,CADiB,EAEjB,CAAC,GAAD,EAAM;AAACI,kBAAAA,KAAK,EAAEb,MAAM,CAACS;AAAf,iBAAN,CAFiB,CAArB;AAKAoB,gBAAAA,CAAC,CAAClB,KAAF,CAAQC,YAAR,CAAqB,CACjB,CAAC,CAAD,EAAI;AAACC,kBAAAA,KAAK,EAAEd,QAAQ,CAAC8B;AAAjB,iBAAJ,CADiB,EAEjB,CAAC,GAAD,EAAM;AAAChB,kBAAAA,KAAK,EAAEb,MAAM,CAAC6B;AAAf,iBAAN,CAFiB,CAArB;AAKA,oBAAIf,OAAO,GAAG0D,MAAM,CAACxD,YAAP,CAAoBhE,SAApB,CAAd;AACAiD,gBAAAA,EAAE,CAACoB,QAAH,CAAYlB,KAAZ;AACAW,gBAAAA,OAAO,CAACQ,WAAR,GAAsBrB,EAAtB;AACAa,gBAAAA,OAAO,CAACS,IAAR;AACH;;AAED,mBAAK,IAAIkC,CAAC,GAAG,KAAK9E,UAAlB,EAA8B8E,CAAC,GAAGpB,KAAlC,EAAyCoB,CAAC,EAA1C,EACA;AACI,qBAAKhF,OAAL,CAAagF,CAAb,IAAkB,KAAKhF,OAAL,CAAagF,CAAC,GAAG,CAAjB,CAAlB,CADJ,CAC0C;AACzC;AACJ,aAlCD,MAmCK,IAAGpB,KAAK,GAAG,KAAK1D,UAAhB,EAA4B;AACjC;AAEL,mBAAK,IAAI8E,CAAC,GAAGpB,KAAb,EAAoBoB,CAAC,GAAG,KAAK9E,UAA7B,EAAyC8E,CAAC,EAA1C,EACS;AACI,oBAAIxD,EAAE,GAAG,IAAI/C,aAAJ,EAAT;AACA+C,gBAAAA,EAAE,CAACC,QAAH,GAAc,GAAd;AACA,oBAAIC,KAAK,GAAG,IAAIlD,SAAS,CAACmD,WAAd,EAAZ;AACAD,gBAAAA,KAAK,CAACE,eAAN,GAAwB,CAAxB;AACAF,gBAAAA,KAAK,CAACG,IAAN,GAAa,IAAIrD,SAAS,CAACsD,SAAd,GAA0BC,UAA1B,CAAqC,UAArC,CAAb;AACA,oBAAI,CAACC,CAAD,EAAI8D,CAAJ,EAAO1C,CAAP,IAAY1B,KAAK,CAACO,QAAN,EAAhB;AACA,oBAAI8D,MAAM,GAAG,KAAK/F,OAAL,CAAagF,CAAb,CAAb;AACA,oBAAI1D,QAAQ,GAAGyE,MAAM,CAAC9E,WAAP,EAAf;AACA,oBAAIM,MAAM,GAAG,KAAKyE,eAAL,CAAqBhB,CAAC,GAAG,CAAzB,CAAb;AAEAhD,gBAAAA,CAAC,CAACE,KAAF,CAAQC,YAAR,CAAqB,CACjB,CAAC,CAAD,EAAI;AAACC,kBAAAA,KAAK,EAAEd,QAAQ,CAACU;AAAjB,iBAAJ,CADiB,EAEjB,CAAC,GAAD,EAAM;AAACI,kBAAAA,KAAK,EAAEb,MAAM,CAACS;AAAf,iBAAN,CAFiB,CAArB;AAKAoB,gBAAAA,CAAC,CAAClB,KAAF,CAAQC,YAAR,CAAqB,CACjB,CAAC,CAAD,EAAI;AAACC,kBAAAA,KAAK,EAAEd,QAAQ,CAAC8B;AAAjB,iBAAJ,CADiB,EAEjB,CAAC,GAAD,EAAM;AAAChB,kBAAAA,KAAK,EAAEb,MAAM,CAAC6B;AAAf,iBAAN,CAFiB,CAArB;AAKA,oBAAIf,OAAO,GAAG0D,MAAM,CAACxD,YAAP,CAAoBhE,SAApB,CAAd;AACAiD,gBAAAA,EAAE,CAACoB,QAAH,CAAYlB,KAAZ;AACAW,gBAAAA,OAAO,CAACQ,WAAR,GAAsBrB,EAAtB;AACAa,gBAAAA,OAAO,CAACS,IAAR;AACH;;AAED,mBAAK,IAAIkC,CAAC,GAAG,KAAK9E,UAAlB,EAA8B8E,CAAC,GAAGpB,KAAlC,EAAyCoB,CAAC,EAA1C,EACA;AACI,qBAAKhF,OAAL,CAAagF,CAAb,IAAkB,KAAKhF,OAAL,CAAagF,CAAC,GAAG,CAAjB,CAAlB,CADJ,CAC0C;AACzC;AACJ;;AACD,eAAKhF,OAAL,CAAa4D,KAAb,IAAsB,IAAtB,CA/EJ,CA+E+B;;AAC3B,eAAK1D,UAAL,GAAkB0D,KAAlB;AACH;;AAGJqC,QAAAA,cAAc,CAACrF,EAAD,EAAU;AACvB,cAAI,KAAKb,aAAL,IAAsB,IAA1B,EACM;AACI2D,YAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AACA;AACH;;AAEP,eAAK3D,OAAL,CAAa,KAAKE,UAAlB,IAAgC,KAAKH,aAArC;AACM,eAAKA,aAAL,GAAqB,IAArB;;AACA,cAAIuB,QAAQ,GAAG,KAAKtB,OAAL,CAAa,KAAKE,UAAlB,EAA8Be,WAA9B,EAAf;;AACA,cAAIM,MAAM,GAAG,KAAKyE,eAAL,CAAqB,KAAK9F,UAA1B,CAAb;AAEA,gBAAMsB,EAAE,GAAG,IAAI/C,aAAJ,EAAX;AAEA+C,UAAAA,EAAE,CAACC,QAAH,GAAc,GAAd;AAEA,gBAAMC,KAAK,GAAG,IAAIlD,SAAS,CAACmD,WAAd,EAAd;AACAD,UAAAA,KAAK,CAACE,eAAN,GAAwB,CAAxB;AACAF,UAAAA,KAAK,CAACG,IAAN,GAAa,IAAIrD,SAAS,CAACsD,SAAd,GAA0BC,UAA1B,CAAqC,UAArC,CAAb;AACA,gBAAM,CAACmE,IAAD,EAAOC,IAAP,EAAaC,IAAb,IAAsB1E,KAAD,CAAiCO,QAAjC,EAA3B;AACAiE,UAAAA,IAAI,CAAChE,KAAL,CAAWC,YAAX,CAAwB,CACpB,CAAC,CAAD,EAAI;AAACkE,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAEd,QAAQ,CAACU;AAAnC,WAAJ,CADoB,EAEpB,CAAC,GAAD,EAAM;AAACqE,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAEd,QAAQ,CAACU;AAAnC,WAAN,CAFoB,EAGpB,CAAC,GAAD,EAAM;AAACqE,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAEb,MAAM,CAACS;AAAjC,WAAN,CAHoB,EAIpB,CAAC,GAAD,EAAM;AAACqE,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAEb,MAAM,CAACS;AAAjC,WAAN,CAJoB,CAAxB;AAMAmE,UAAAA,IAAI,CAACjE,KAAL,CAAWC,YAAX,CAAwB,CACpB,CAAC,CAAD,EAAI;AAACkE,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAEd,QAAQ,CAAC6B;AAAnC,WAAJ,CADoB,EAEpB,CAAC,GAAD,EAAM;AAACkD,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAEd,QAAQ,CAAC6B,CAAT,GAAa;AAAvC,WAAN,CAFoB,EAGpB,CAAC,GAAD,EAAM;AAACkD,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAEd,QAAQ,CAAC6B,CAAT,GAAa;AAAvC,WAAN,CAHoB,EAIpB,CAAC,GAAD,EAAM;AAACkD,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAEb,MAAM,CAAC4B;AAAjC,WAAN,CAJoB,CAAxB;AAMAiD,UAAAA,IAAI,CAAClE,KAAL,CAAWC,YAAX,CAAwB,CACpB,CAAC,CAAD,EAAI;AAACkE,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAEd,QAAQ,CAAC8B;AAAnC,WAAJ,CADoB,EAEpB,CAAC,GAAD,EAAM;AAACiD,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAEd,QAAQ,CAAC8B,CAAT,GAAa;AAAvC,WAAN,CAFoB,EAGpB,CAAC,GAAD,EAAK;AAACiD,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAGd,QAAQ,CAAC8B,CAAT,GAAa;AAAxC,WAAL,CAHoB,EAIpB,CAAC,GAAD,EAAK;AAACiD,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAGb,MAAM,CAAC6B;AAAlC,WAAL,CAJoB,CAAxB;AAOA,cAAIf,OAAJ;;AAEA,cAAI,KAAKrC,OAAL,CAAa,KAAKE,UAAlB,EAA8BoC,YAA9B,CAA2C/D,SAA3C,KAAyD,IAA7D,EACA;AACI8D,YAAAA,OAAO,GAAG,KAAKrC,OAAL,CAAa,KAAKE,UAAlB,EAA8BqC,YAA9B,CAA2ChE,SAA3C,CAAV;AACH,WAHD,MAKA;AACI8D,YAAAA,OAAO,GAAG,KAAKrC,OAAL,CAAa,KAAKE,UAAlB,EAA8BoC,YAA9B,CAA2C/D,SAA3C,CAAV;AACA8D,YAAAA,OAAO,CAACG,SAAR,CAAkBjE,SAAS,CAACkE,SAAV,CAAoBC,QAAtC;AACH;;AAED,cAAG9B,EAAH,EACA;AACIyB,YAAAA,OAAO,CAACM,EAAR,CAAWpE,SAAS,CAACkE,SAAV,CAAoBC,QAA/B,EAAyC9B,EAAzC,EAA6C,IAA7C;AACA,iBAAKR,eAAL,GAAuBQ,EAAvB;AACH;;AAEDY,UAAAA,EAAE,CAACoB,QAAH,CAAYlB,KAAZ;AAEAW,UAAAA,OAAO,CAACQ,WAAR,GAAsBrB,EAAtB;AAEAa,UAAAA,OAAO,CAACS,IAAR;AAEN;;AAGDwD,QAAAA,YAAY,GAAW;AACtB,cAAIC,KAAc,GAAG,EAArB;;AACA,eAAK,IAAIvB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKhF,OAAL,CAAac,MAAjC,EAAyCkE,CAAC,EAA1C,EAA8C;AAC7C,gBAAIwB,SAAiB,GAAG,KAAKxG,OAAL,CAAagF,CAAb,EAAgB1C,YAAhB;AAAA;AAAA,4CAA0CmE,IAAlE;;AACAF,YAAAA,KAAK,CAACG,IAAN,CAAWF,SAAX;AACA;;AACD,iBAAOD,KAAP;AACA;;AAEDI,QAAAA,iBAAiB,CAACJ,KAAD,EAAyB;AACzC,cAAIK,MAAe,GAAG,EAAtB;AAEAL,UAAAA,KAAK,CAACM,OAAN,CAAeJ,IAAD,IAAU;AACvB,iBAAK,IAAIzB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKhF,OAAL,CAAac,MAAjC,EAAyCkE,CAAC,EAA1C,EAA8C;AAC7C,kBAAIwB,SAAiB,GAAG,KAAKxG,OAAL,CAAagF,CAAb,EAAgB1C,YAAhB;AAAA;AAAA,8CAA0CmE,IAAlE;;AACA,kBAAGA,IAAI,KAAKD,SAAZ,EAAsB;AACrBI,gBAAAA,MAAM,CAACF,IAAP,CAAY1B,CAAZ;AACA;AACA;AACD;AACD,WARD;AASA,iBAAO4B,MAAP;AACA;;AAEDE,QAAAA,YAAY,CAAC9F,IAAD,EACT;AACI,iBAAO,KAAKhB,OAAL,CAAa+G,SAAb,CAAuBC,OAAO,IAAIA,OAAO,IAAIhG,IAA7C,EAAmD,IAAnD,CAAP;AACH;;AAEJiG,QAAAA,YAAY,CAACC,SAAD,EAAsBjD,MAAtB,EAAuCkD,UAAvC,EAA4DC,WAAoB,GAAG,KAAnF,EACT;AACF,cAAIC,aAAa,GAAIH,SAAS,CAACpG,MAA/B;;AAEM,cAAIsG,WAAJ,EACA;AACIC,YAAAA,aAAa,GAAGH,SAAS,CAACpG,MAAV,GAAmB,CAAnC;AACH;;AAEP,eAAK,IAAIkE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGqC,aAApB,EAAmCrC,CAAC,EAApC,EACM;AACL,gBAAIe,MAAM,GAAGrH,WAAW,CAAC,KAAKoF,gBAAN,CAAxB;AACA,gBAAIC,SAAS,GAAGmD,SAAS,CAAClC,CAAD,CAAzB;AACAe,YAAAA,MAAM,CAACzD,YAAP;AAAA;AAAA,4CAAiC0B,WAAjC,CAA6CD,SAA7C;AACAgC,YAAAA,MAAM,CAAC9B,MAAP,GAAgB,IAAhB;;AACA,iBAAKjE,OAAL,CAAa0G,IAAb,CAAkBX,MAAlB;;AACA,iBAAK/E,IAAL,CAAUmD,QAAV,CAAmB4B,MAAnB;AACA;;AACD,eAAK1B,yBAAL;;AACA,cAAI+C,WAAJ,EACM;AACI,iBAAK9C,QAAL,CAAc4C,SAAS,CAACG,aAAD,CAAvB;AACA,iBAAKtH,aAAL,CAAmBkE,MAAnB,GAA4BA,MAA5B,CAFJ,CAGI;AACA;AACH;AAEP;;AAED+B,QAAAA,eAAe,CAACpC,KAAD,EAAe;AAC7B,iBAAO,IAAIhF,IAAJ,CAAS;AAAA;AAAA,gCAAOsE,KAAP,GAAe,CAAf,GAAmB;AAAA;AAAA,gCAAOA,KAAP,GAAeU,KAA3C,EAAkD,CAAlD,EAAqD,CAArD,CAAP;AACA;;AAGEgB,QAAAA,eAAe,GAAS;AAC1B,iBAAO;AAAA;AAAA,gCAAO1B,KAAP,GAAe,CAAf,GAAmB;AAAA;AAAA,gCAAOA,KAAP,IAAgB,KAAKlD,OAAL,CAAac,MAAb,GAAsB,CAAtC,CAA1B;AACA;;AAED4D,QAAAA,cAAc,CAAC1D,IAAD,EAAY;AACzB,cAAG,KAAKlB,YAAR,EAAqB;AACpB,iBAAKwH,gBAAL,CAAsB,KAAKxH,YAA3B;;AACA,gBAAG,KAAKA,YAAL,IAAqBkB,IAAxB,EAA6B;AAC5B,mBAAKlB,YAAL,GAAoB,IAApB;AACA;AACA;AACD;;AAED,eAAKA,YAAL,GAAoBkB,IAApB;AAEM,cAAIM,QAAQ,GAAG,KAAKxB,YAAL,CAAkBmB,WAAlB,EAAf;AAEA,gBAAMO,EAAE,GAAG,IAAI/C,aAAJ,EAAX;AAEA+C,UAAAA,EAAE,CAACC,QAAH,GAAc,GAAd;AAEA,gBAAM8F,QAAQ,GAAG,IAAI/I,SAAS,CAACmD,WAAd,EAAjB;AACA4F,UAAAA,QAAQ,CAAC3F,eAAT,GAA2B,CAA3B;AACA2F,UAAAA,QAAQ,CAAC1F,IAAT,GAAgB,IAAIrD,SAAS,CAACsD,SAAd,GAA0BC,UAA1B,CAAqC,UAArC,CAAhB;AACA,gBAAM,CAACC,CAAD,EAAImB,CAAJ,EAAOC,CAAP,IAAamE,QAAD,CAAoCtF,QAApC,EAAlB;AACAD,UAAAA,CAAC,CAACE,KAAF,CAAQC,YAAR,CAAqB,CACjB,CAAC,CAAD,EAAI;AAACkE,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAEd,QAAQ,CAACU;AAAnC,WAAJ,CADiB,EAEjB,CAAC,GAAD,EAAM;AAACqE,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAEd,QAAQ,CAACU;AAAnC,WAAN,CAFiB,CAArB;AAIAmB,UAAAA,CAAC,CAACjB,KAAF,CAAQC,YAAR,CAAqB,CACjB,CAAC,CAAD,EAAI;AAACkE,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAEd,QAAQ,CAAC6B;AAAnC,WAAJ,CADiB,EAEjB,CAAC,GAAD,EAAM;AAACkD,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAEd,QAAQ,CAAC6B,CAAT,GAAa;AAAvC,WAAN,CAFiB,CAArB,EAzBmB,CA6BnB;AACA;AACA;AACA;;AAEA,cAAId,OAAJ;;AAEA,cAAI,KAAKvC,YAAL,CAAkBwC,YAAlB,CAA+B/D,SAA/B,KAA6C,IAAjD,EACA;AACI8D,YAAAA,OAAO,GAAG,KAAKvC,YAAL,CAAkByC,YAAlB,CAA+BhE,SAA/B,CAAV;AACH,WAHD,MAKA;AACI8D,YAAAA,OAAO,GAAG,KAAKvC,YAAL,CAAkBwC,YAAlB,CAA+B/D,SAA/B,CAAV;AACA8D,YAAAA,OAAO,CAACG,SAAR,CAAkBjE,SAAS,CAACkE,SAAV,CAAoBC,QAAtC;AACH;;AAEDlB,UAAAA,EAAE,CAACoB,QAAH,CAAY2E,QAAZ;AAEAlF,UAAAA,OAAO,CAACQ,WAAR,GAAsBrB,EAAtB;AAEAa,UAAAA,OAAO,CAACS,IAAR;AACN;;AACDwE,QAAAA,gBAAgB,CAACtG,IAAD,EAAY;AAC3B,cAAIM,QAAQ,GAAG,KAAKxB,YAAL,CAAkBmB,WAAlB,EAAf;AAEA,gBAAMO,EAAE,GAAG,IAAI/C,aAAJ,EAAX;AAEM+C,UAAAA,EAAE,CAACC,QAAH,GAAc,GAAd;AAEA,gBAAM8F,QAAQ,GAAG,IAAI/I,SAAS,CAACmD,WAAd,EAAjB;AACA4F,UAAAA,QAAQ,CAAC3F,eAAT,GAA2B,CAA3B;AACA2F,UAAAA,QAAQ,CAAC1F,IAAT,GAAgB,IAAIrD,SAAS,CAACsD,SAAd,GAA0BC,UAA1B,CAAqC,UAArC,CAAhB;AACA,gBAAM,CAACC,CAAD,EAAImB,CAAJ,EAAOC,CAAP,IAAamE,QAAD,CAAoCtF,QAApC,EAAlB;AACAD,UAAAA,CAAC,CAACE,KAAF,CAAQC,YAAR,CAAqB,CACjB,CAAC,CAAD,EAAI;AAACkE,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAEd,QAAQ,CAACU;AAAnC,WAAJ,CADiB,EAEjB,CAAC,GAAD,EAAM;AAACqE,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAEd,QAAQ,CAACU;AAAnC,WAAN,CAFiB,CAArB;AAIAmB,UAAAA,CAAC,CAACjB,KAAF,CAAQC,YAAR,CAAqB,CACjB,CAAC,CAAD,EAAI;AAACkE,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAEd,QAAQ,CAAC6B;AAAnC,WAAJ,CADiB,EAEjB,CAAC,GAAD,EAAM;AAACkD,YAAAA,YAAY,EAAG,CAAhB;AAAmBjE,YAAAA,KAAK,EAAEd,QAAQ,CAAC6B,CAAT,GAAa;AAAvC,WAAN,CAFiB,CAArB,EAfqB,CAmBrB;AACA;AACA;AACA;;AAEA,cAAId,OAAJ;;AAEA,cAAIrB,IAAI,CAACsB,YAAL,CAAkB/D,SAAlB,KAAgC,IAApC,EACA;AACI8D,YAAAA,OAAO,GAAGrB,IAAI,CAACuB,YAAL,CAAkBhE,SAAlB,CAAV;AACH,WAHD,MAKA;AACI8D,YAAAA,OAAO,GAAGrB,IAAI,CAACsB,YAAL,CAAkB/D,SAAlB,CAAV;AACA8D,YAAAA,OAAO,CAACG,SAAR,CAAkBjE,SAAS,CAACkE,SAAV,CAAoBC,QAAtC;;AACT,gBAAG;AAAA;AAAA,kCAAO8E,IAAP,CAAYC,MAAf,EAAsB;AACrB,kBAAIhB,IAAW,GAAG,KAAK3G,YAAL,CAAkBwC,YAAlB;AAAA;AAAA,8CAA4CmE,IAA9D;AACA,mBAAKiB,UAAL,CAAgBjB,IAAhB;AACA;AACK;;AAEDjF,UAAAA,EAAE,CAACoB,QAAH,CAAY2E,QAAZ;AAEAlF,UAAAA,OAAO,CAACQ,WAAR,GAAsBrB,EAAtB;AAEAa,UAAAA,OAAO,CAACS,IAAR;AACN,SA9iB8C,CAgjB/C;;;AACA4E,QAAAA,UAAU,CAACjB,IAAD,EAAa;AAChB;AAAA;AAAA,sCAAUvB,WAAV,GAAwByC,WAAxB;AACN,cAAI/D,KAAY,GAAG;AAAA;AAAA,4CAAasB,WAAb,GAA2B0C,gBAA3B,CAA4CnB,IAA5C,CAAnB;AACM/C,UAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAA+BC,KAA/B,EAAqC6C,IAArC,EAA0C;AAAA;AAAA,oCAASoB,eAAT,CAAyBpB,IAAzB,CAA1C;AACA,cAAIqB,GAAwB,GAAG;AAC3BC,YAAAA,MAAM,EAACtB,IADoB;AAEpCuB,YAAAA,MAAM,EAAC;AAAA;AAAA,kCAAOC,YAFsB;AAGpCC,YAAAA,OAAO,EAAC,CAACzB,IAAD,CAH4B;AAIpC0B,YAAAA,MAAM,EAAC;AAAA;AAAA,8CAAajD,WAAb,GAA2BiD,MAJE;AAKpCC,YAAAA,MAAM,EAAC;AAAA;AAAA,8CAAalD,WAAb,GAA2BkD;AALE,WAA/B;AAOA;AAAA;AAAA,4CAAaC,QAAb,CAAsB;AAAA;AAAA,sCAAUC,qBAAhC,EAAuDR,GAAvD;AACN;;AAEMS,QAAAA,WAAW,GAAE;AACnB,eAAKvI,OAAL,GAAe,EAAf;AACA,eAAKgB,IAAL,CAAUwH,iBAAV;AACA,SAlkB8C,CAokB/C;;;AACGC,QAAAA,SAAS,GAAG;AACR,eAAKzH,IAAL,CAAUwH,iBAAV;AACA,eAAKxI,OAAL,GAAe,EAAf;AACA,eAAKD,aAAL,GAAqB,IAArB,CAHQ,CAIR;AACH;;AA1kB2C,O;;;;;iBAWP,I","sourcesContent":["\nimport { Animation, animation, AnimationClip, instantiate, Node, Vec3, _decorator } from 'cc';\nimport { GCache } from '../../../../cache/GCache';\nimport { EventManager } from '../../../../framework/manager/EventManager';\nimport { BaseComponent } from '../../../../framework/vc/BaseComponent';\nimport { OperationMgr } from '../../cache/OperationMgr';\nimport { PlayerMgr } from '../../cache/PlayerMgr';\nimport { OPCode } from '../../common/FXJConfig';\nimport { GameEvent } from '../../common/GameEvent';\nimport { Game } from '../../common/idl/Game';\nimport { CardUtil } from '../../util/CardUtil';\nimport { NodeCardCtr } from '../NodeCardCtr';\nimport { drawCardDisRatio, MjSize } from './CardConfigs';\nconst { ccclass, property } = _decorator;\n\n/**\n * Name = MyPlayer\n * URL = db://assets/package/game/scripts/MyPlayer.ts\n * Time = Fri Aug 11 2023 11:08:16 GMT+0800 (中国标准时间)\n * Author = qwe757964\n *\n * Life: onLoad-->onInitModuleEvent-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n * \n */\n \n@ccclass('MyPlayerCard')\nexport class MyPlayerCard extends BaseComponent {\n\tpublic selectedNode: Node | null = null;\n\t\n    public _drawCardNode: Node | null = null;\n\n\tpublic\t_mjList:Node[] = [];\n\t\n\tprivate myHandCardY: number = 0;\n\n\t// 手牌模板\n\t@property({ tooltip: \"手牌模板\", type: Node })\n\tprivate nodeCardTemplate: Node | null = null;\n\n\t_slotIndex: number;\n\tprivate _drawByte: number;\n\n\t_playHandCardCb: any;\n\n\tget drawByte(): number {\n\t\treturn this._drawByte;\n\t}\n\n\tset drawByte(newValue: number) {\n\t\tthis._drawByte = newValue;\n\t}\n\t/** override 初始化模块事件 */\n\tprotected onInitModuleEvent() {\n\n\t};\n\t//移除对应的索引的牌去构成stack, 刷新整体node的位置\n\tstackAnim(indexList: number[], tByte?: number, insertIndex?: number, cb?:any) {\n\t\tlet pos = new Vec3();\n\t\tif(indexList.length === 2){\n            this.removeHandCard(indexList);\n\t\t\t//碰牌直接移除两张牌, 刷新位置\n\t\t\tpos = this.node.getPosition();\n\t\t\tVec3.add(pos, pos, pos);\n\t\t\tthis.node.setPosition(pos);\n\t\t}else if (indexList.length == 3){\n            this.removeHandCard(indexList);\n\t\t\t//杠牌直接移除三张牌, 刷新位置\n\t\t\tpos = this.node.getPosition();\n            Vec3.add(pos, pos, pos);\n            this.node.setPosition(pos);\n            return\n\t\t}else if (indexList.length == 4 && insertIndex!==null){\n            insertIndex = insertIndex - indexList.length;\n            this.removeHandCard(indexList);\n\t\t\tthis.removeDrawCard();\n            this.addHandCard(tByte, insertIndex);\n            pos = this.node.getPosition();\n            Vec3.add(pos, pos, pos);\n            this.node.setPosition(pos);\n            return\n\t\t}\n        \n\t\t//吃碰时候移除两张,平移一张到抽牌区 \n        let startPos = pos;\n        let endPos = new Vec3();\n        Vec3.add(endPos, startPos, startPos) \n        \n        let ac = new AnimationClip()\n        ac.duration = 0.1\n        let track = new animation.VectorTrack();\n        track.componentsCount = 3;\n        track.path = new animation.TrackPath().toProperty(\"position\")\n        let [x] = track.channels();\n       \n        x.curve.assignSorted([\n            [0, {value: startPos.x}],\n            [0.1, {value: endPos.x}]\n        ])\n\n        let animCom: Animation;\n\n        if (this.node.getComponent(Animation) == null)\n        {\n            animCom = this.node.addComponent(Animation)\n        }\n        else\n        {\n            animCom = this.node.getComponent(Animation)\n            animCom.removeAll(Animation.EventType.FINISHED)\n        } \n\n        if(cb)\n        {\n            animCom.on(Animation.EventType.FINISHED, cb, this)\n            // this._stackCb = cb\n        }\n\n        ac.addTrack(track)\n        animCom.defaultClip = ac\n        animCom.play(); \n        \n\n\n        this._drawCardNode = this._mjList.pop();\n       \n        let startPosDraw = this._drawCardNode.getPosition();\n        let endPosDraw = new Vec3(startPosDraw.x + MjSize.width, startPosDraw.y, startPosDraw.z)\n        \n        let acDraw = new AnimationClip()\n        acDraw.duration = 0.1\n        let trackDraw = new animation.VectorTrack();\n        trackDraw.componentsCount = 3;\n        trackDraw.path = new animation.TrackPath().toProperty(\"position\")\n        let [drawX] = trackDraw.channels();\n       \n        drawX.curve.assignSorted([\n            [0, {value: startPosDraw.x}],\n            [0.1, {value: endPosDraw.x}]\n        ])\n\n        let animDrawCom: Animation;\n\n        if (this._drawCardNode.getComponent(Animation) == null)\n        {\n            animDrawCom = this._drawCardNode.addComponent(Animation)\n        }\n        else\n        {\n            animDrawCom = this._drawCardNode.getComponent(Animation)\n            animDrawCom.removeAll(Animation.EventType.FINISHED)\n        }\n\n        if(cb)\n        {  \n            animDrawCom.on(Animation.EventType.FINISHED, cb, this)\n            // this._stackCb = cb\n        }\n\n        acDraw.addTrack(trackDraw)\n        animDrawCom.defaultClip = acDraw\n        animDrawCom.play(); \n        \n\t}\n\n\t//移除一张手牌, 没有动画时的接口, 未来会使用动画接口出牌\n    removeDrawCard() {\n        if (this._drawCardNode) {\n            this._drawCardNode.removeFromParent();\n            this._drawCardNode = null;\n        }\n        else {\n            console.log(\"当前没有渲染牌,无法移除\")\n        }\n    }\n\t//添加一张牌到手牌的指定位置\n\taddHandCard(tByte: number, index: number) {\n\n        if (index > this._mjList.length) {\n            console.log(\"索引大于当前渲染手牌的数量请检查逻辑\", index)\n            return;\n        }\n\n        if (this._mjList.length >= 13) {\n            console.log(\"当前渲染手牌数量已满--> 13\", index)\n            return;\n        } \n\n\t\tlet insertNode = instantiate(this.nodeCardTemplate)\n\t\tlet cardValue = tByte;\n\t\tinsertNode.getComponent(NodeCardCtr).setCardByte(cardValue);\n\t\tinsertNode.active = true;        \n        insertNode.name = \"MJBlock\" + index\n\n        this.node.addChild(insertNode)\n\t\tthis._mjList.splice(index, 0, insertNode); // 在指定索引处插入对象\n\n        this.updateHandPositionAndName()\n    }\n\n\t//抓一张牌\n    drawCard(tByte: number) {\n\t\tthis.drawByte = tByte;\n\t\tthis._drawCardNode = instantiate(this.nodeCardTemplate)\n\t\tthis._drawCardNode.getComponent(NodeCardCtr).setCardByte(tByte);\n\t\tthis._drawCardNode.active = true;\n\t\tthis.node.addChild(this._drawCardNode);\n\t\tthis._drawCardNode.off(Node.EventType.TOUCH_END);\n\t\tthis._drawCardNode.on(Node.EventType.TOUCH_END, (event) => {\n\t\t\tthis.playSelectAnim(event.target);\n\t\t}, this);\n\t\tthis._drawCardNode.setPosition(this.getLastPosition() + drawCardDisRatio * MjSize.width, 0, 0)\n\t}\n\n\tupdateHandPositionAndName(){\n        this._mjList = this._mjList.filter(item => item !== null && item !== undefined);\n\t\tfor (let i = 0; i < this._mjList.length; i++) {\n            let handNode = this._mjList[i]\n            handNode.name = \"MJBlock\" + i;\n            handNode.getComponent(NodeCardCtr).setCardByte(PlayerMgr.getInstance().getHandCardByIndex(i));\n\t\t\thandNode.off(Node.EventType.TOUCH_END);\n\t\t\thandNode.on(Node.EventType.TOUCH_END, (event) => {\n\t\t\t\tthis.playSelectAnim(event.target);\n\t\t\t}, this);\n            handNode.setPosition(MjSize.width / 2 + MjSize.width * i, 0, 0)\n        }\n\t}\n\n    \n\n    //将抓上来的牌打出去\n    playDrawCard( cb?: any){\n        let toOutCard = this._drawCardNode;\n        toOutCard.removeFromParent();\n        this._drawCardNode = null;        \n    }\n\tplayCardFromHandAnim(index: number,remove?: boolean,cb?: any) {\n\t\tthis._slotIndex = index;\n\n        let toOutCard = this._mjList[index]\n        if(remove){\n            this._mjList.splice(index, 1);\n        }else{\n            this._mjList[index] = null\n        }\n\t\ttoOutCard.removeFromParent();\n\t}\n\t\n\t//从手牌移除指定位置的一张或者多张牌，并且出牌之后，如果抓牌未移除，需要把抓的牌放到手牌中，抓牌为空\n    removeHandCard(indexList: number[], updateCard: boolean = false) {\n\t\tindexList.sort((a, b) => b - a)\n\t\t\n\t\tfor (let index of indexList) { \n            if (index < this._mjList.length) {  \n                let removeNode = this._mjList.splice(index, 1);\n                removeNode[0].removeFromParent();\n            } \n            else {\n                console.log(\"索引大于等于当前渲染手牌的数量请检查逻辑\", index)\n                return;\n            }\n        }   \n\n        if (updateCard)\n        {\n            this.updateHandPositionAndName()\n        }\n\n\t}\n\n\tmakeSlotAnim(index: number)\n    {\n        if (this._slotIndex == -1 || this._mjList[this._slotIndex] != null)\n        {\n            console.log(\"当前没有空的手牌位置,无法空出对应的索引位置\", this._slotIndex, index)\n\n            return;\n        }\n\n        if (this._slotIndex < index) // 2空  4\n        {\n\t\t\tfor (let i = this._slotIndex + 1; i <= index; i++)\n            {\n                let ac = new AnimationClip()\n                ac.duration = 0.2\n                let track = new animation.VectorTrack();\n                track.componentsCount = 3;\n                track.path = new animation.TrackPath().toProperty(\"position\")\n                let [x, _, z] = track.channels();\n                let mjNode = this._mjList[i];\n                let startPos = mjNode.getPosition() ;\n                let endPos = this.getHandPosition(i - 1);\n                \n                x.curve.assignSorted([\n                    [0, {value: startPos.x}],\n                    [0.2, {value: endPos.x}]\n                ])\n\n                z.curve.assignSorted([\n                    [0, {value: startPos.z}],\n                    [0.2, {value: endPos.z}]\n                ])\n\n                let animCom = mjNode.addComponent(Animation)\n                ac.addTrack(track)\n                animCom.defaultClip = ac\n                animCom.play(); \n            }\n\n            for (let i = this._slotIndex; i < index; i++)\n            {\n                this._mjList[i] = this._mjList[i + 1] // 同步平移在列表内的位置\n            }\n        }\n        else if(index < this._slotIndex) // 2  4空\n        {\n\n\t\t\tfor (let i = index; i < this._slotIndex; i++)\n            {\n                let ac = new AnimationClip() \n                ac.duration = 0.2\n                let track = new animation.VectorTrack();\n                track.componentsCount = 3;\n                track.path = new animation.TrackPath().toProperty(\"position\")\n                let [x, _, z] = track.channels();\n                let mjNode = this._mjList[i];\n                let startPos = mjNode.getPosition() ;\n                let endPos = this.getHandPosition(i + 1);\n\n                x.curve.assignSorted([\n                    [0, {value: startPos.x}], \n                    [0.2, {value: endPos.x}]\n                ])\n\n                z.curve.assignSorted([\n                    [0, {value: startPos.z}],\n                    [0.2, {value: endPos.z}]\n                ])\n\n                let animCom = mjNode.addComponent(Animation)\n                ac.addTrack(track)\n                animCom.defaultClip = ac\n                animCom.play(); \n            }\n\n            for (let i = this._slotIndex; i > index; i--)\n            {\n                this._mjList[i] = this._mjList[i - 1] // 同步平移在列表内的位置\n            }\n        }  \n        this._mjList[index] = null //平移后空出来的列表位置\n        this._slotIndex = index\n    }\n\n\t\n\tdrawCardToSlot(cb?: any){\n\t\tif (this._drawCardNode == null)\n        {\n            console.log(\"没有渲染抽牌节点, 抽牌到手牌动画失败\")\n            return;\n        }\n\n\t\tthis._mjList[this._slotIndex] = this._drawCardNode\n        this._drawCardNode = null\n        let startPos = this._mjList[this._slotIndex].getPosition()\n        let endPos = this.getHandPosition(this._slotIndex)\n\n        const ac = new AnimationClip();  \n\n        ac.duration = 0.5\n        \n        const track = new animation.VectorTrack();\n        track.componentsCount = 3;\n        track.path = new animation.TrackPath().toProperty(\"position\")\n        const [posx, posy, posz] = (track as animation.VectorTrack).channels();\n        posx.curve.assignSorted([\n            [0, {easingMethod : 2, value: startPos.x}], \n            [0.1, {easingMethod : 2, value: startPos.x}], \n            [0.4, {easingMethod : 2, value: endPos.x}],\n            [0.5, {easingMethod : 2, value: endPos.x}]\n        ]);\n        posy.curve.assignSorted([\n            [0, {easingMethod : 2, value: startPos.y}], \n            [0.1, {easingMethod : 2, value: startPos.y + 20}], \n            [0.4, {easingMethod : 2, value: startPos.y + 20}], \n            [0.5, {easingMethod : 2, value: endPos.y}]\n        ]);\n        posz.curve.assignSorted([\n            [0, {easingMethod : 2, value: startPos.z}], \n            [0.1, {easingMethod : 2, value: startPos.z - 3.5}], \n            [0.4,{easingMethod : 2, value:  startPos.z - 3.5}],\n            [0.5,{easingMethod : 2, value:  endPos.z}]\n        ]);\n\n        let animCom: Animation;\n\n        if (this._mjList[this._slotIndex].getComponent(Animation) == null)\n        {\n            animCom = this._mjList[this._slotIndex].addComponent(Animation)\n        }\n        else\n        {\n            animCom = this._mjList[this._slotIndex].getComponent(Animation)\n            animCom.removeAll(Animation.EventType.FINISHED)\n        }\n\n        if(cb)\n        {\n            animCom.on(Animation.EventType.FINISHED, cb, this)\n            this._playHandCardCb = cb\n        }\n\n        ac.addTrack(track)\n\n        animCom.defaultClip = ac\n\n        animCom.play()\n\t\t\n\t}\n\n\n\tgetListBytes():number[]{\n\t\tlet bytes:number[] = [];\n\t\tfor (let i = 0; i < this._mjList.length; i++) {\n\t\t\tlet node_byte: number = this._mjList[i].getComponent(NodeCardCtr).byte;\n\t\t\tbytes.push(node_byte);\n\t\t}\n\t\treturn bytes;\n\t}\n\n\tuseByteFindIndexs(bytes:number[]):number[]{\n\t\tlet indexs:number[] = [];\n\n\t\tbytes.forEach((byte) => {\n\t\t\tfor (let i = 0; i < this._mjList.length; i++) {\n\t\t\t\tlet node_byte: number = this._mjList[i].getComponent(NodeCardCtr).byte;\n\t\t\t\tif(byte === node_byte){\n\t\t\t\t\tindexs.push(i);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\treturn indexs;\n\t}\n\n\tgetNodeIndex(node: Node)\n    {\n        return this._mjList.findIndex(theNode => theNode == node, this);\n    }\n\n\taddHandCards(valueList: number[], active: boolean, stackCount?: number, hasDrawCard: boolean = false)\n    {\n\t\tlet handCardCount =  valueList.length;\n        \n        if (hasDrawCard)\n        {\n            handCardCount = valueList.length - 1\n        }\n\n\t\tfor (let i = 0; i < handCardCount; i++)\n        { \n\t\t\tlet mjNode = instantiate(this.nodeCardTemplate)\n\t\t\tlet cardValue = valueList[i]\n\t\t\tmjNode.getComponent(NodeCardCtr).setCardByte(cardValue);\n\t\t\tmjNode.active = true;\n\t\t\tthis._mjList.push(mjNode);\n\t\t\tthis.node.addChild(mjNode);\n\t\t}\n\t\tthis.updateHandPositionAndName();\n\t\tif (hasDrawCard)\n        {\n            this.drawCard(valueList[handCardCount])\n            this._drawCardNode.active = active\n            // let myhands = valueList.slice(0, -1)\n            // PlayerMgr.getInstance().updateMyhands(myhands);\n        }\n\n\t}\n\n\tgetHandPosition(index: number){\n\t\treturn new Vec3(MjSize.width / 2 + MjSize.width * index, 0, 0)\n\t}\n\n\t\n    getLastPosition():number{\n\t\treturn MjSize.width / 2 + MjSize.width * (this._mjList.length - 1);\n\t}\n\n\tplaySelectAnim(node: Node){\n\t\tif(this.selectedNode){\n\t\t\tthis.playUnselectAnim(this.selectedNode);\n\t\t\tif(this.selectedNode == node){\n\t\t\t\tthis.selectedNode = null;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.selectedNode = node\n\n        let startPos = this.selectedNode.getPosition()\n        \n        const ac = new AnimationClip();  \n\n        ac.duration = 0.1\n\n        const trackPos = new animation.VectorTrack();\n        trackPos.componentsCount = 3;\n        trackPos.path = new animation.TrackPath().toProperty(\"position\")\n        const [x, y, z] = (trackPos as animation.VectorTrack).channels();\n        x.curve.assignSorted([\n            [0, {easingMethod : 2, value: startPos.x}], \n            [0.1, {easingMethod : 2, value: startPos.x}]\n        ]);\n        y.curve.assignSorted([\n            [0, {easingMethod : 2, value: startPos.y}], \n            [0.1, {easingMethod : 2, value: startPos.y + 20}]\n        ]);\n        // z.curve.assignSorted([\n        //     [0, {easingMethod : 2, value: startPos.z}], \n        //     [0.1,{easingMethod : 2, value:  startPos.z - 0.8}]\n        // ]);\n\n        let animCom: Animation;\n\n        if (this.selectedNode.getComponent(Animation) == null)\n        {\n            animCom = this.selectedNode.addComponent(Animation)\n        }\n        else\n        {\n            animCom = this.selectedNode.getComponent(Animation)\n            animCom.removeAll(Animation.EventType.FINISHED)\n        }\n\n        ac.addTrack(trackPos)\n\n        animCom.defaultClip = ac\n\n        animCom.play()\n\t}\n\tplayUnselectAnim(node: Node){\n\t\tlet startPos = this.selectedNode.getPosition();\n\n\t\tconst ac = new AnimationClip();  \n\n        ac.duration = 0.1 \n \n        const trackPos = new animation.VectorTrack();\n        trackPos.componentsCount = 3;\n        trackPos.path = new animation.TrackPath().toProperty(\"position\")\n        const [x, y, z] = (trackPos as animation.VectorTrack).channels();\n        x.curve.assignSorted([\n            [0, {easingMethod : 2, value: startPos.x}], \n            [0.1, {easingMethod : 2, value: startPos.x}]\n        ]);\n        y.curve.assignSorted([\n            [0, {easingMethod : 2, value: startPos.y}], \n            [0.1, {easingMethod : 2, value: startPos.y - 20}]\n        ]);\n        // z.curve.assignSorted([ \n        //     [0, {easingMethod : 2, value: startPos.z}], \n        //     [0.1,{easingMethod : 2, value:  startPos.z + 0.8}]\n        // ]); \n\n        let animCom: Animation;\n\n        if (node.getComponent(Animation) == null)\n        {\n            animCom = node.addComponent(Animation)\n        }\n        else\n        {\n            animCom = node.getComponent(Animation)\n            animCom.removeAll(Animation.EventType.FINISHED)\n\t\t\tif(GCache.Desk.turnMe){\n\t\t\t\tlet byte:number = this.selectedNode.getComponent(NodeCardCtr).byte;\n\t\t\t\tthis.onSendCard(byte);\n\t\t\t}\n        }\n\n        ac.addTrack(trackPos)\n\n        animCom.defaultClip = ac\n\n        animCom.play()\n\t}\n\n\t//出牌\n\tonSendCard(byte:number){\n        PlayerMgr.getInstance().dumpMyHands();\n\t\tlet index:number = OperationMgr.getInstance().getSendCardIndex(byte);\n        console.log(\"onSendCard______\",index,byte,CardUtil.getMajiangValue(byte));\n        let req: Game.ISendOperation = {\n            opCard:byte,\n\t\t\topCode:OPCode.OPE_OUT_CARD,\n\t\t\topCards:[byte],\n\t\t\tseatId:OperationMgr.getInstance().seatId,\n\t\t\tuserId:OperationMgr.getInstance().userId\n        }\n        EventManager.dispatch(GameEvent.SEND_PLAYER_OPERATION, req);\n\t}\n\n\tpublic cleanMjList(){\n\t\tthis._mjList = [];\n\t\tthis.node.removeAllChildren();\n\t}\n\n\t//游戏开始或结束，清空手牌区，包括抓牌，保持初始状态\n    resetView() {\n        this.node.removeAllChildren();\n        this._mjList = [];\n        this._drawCardNode = null;\n        // this.initNodePos();\n    }\n}\n\n"]}