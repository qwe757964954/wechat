{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/framework/audio/AudioEffect.ts"],"names":["AudioClip","AudioSource","error","_decorator","resLoader","ccclass","menu","AudioEffect","constructor","_isPause","_isStopPlay","_isStartPlay","_currowVolume","currowPlayEffect","bundle","path","effects","Map","initData","clip","stop","load","bundleName","callback","self","err","data","realLoadAudioClip","call","audioClip","node","isValid","loop","set","volume","startPlay","getCurrowPlayConf","isPlay","state","AudioState","PLAYING","isPause","PAUSED","play","startPause","pause","startStop","setVolume","num","Number","isNaN","release","console","log","key","clear"],"mappings":"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","sourcesContent":["import { AudioClip, AudioSource, error, _decorator } from 'cc';\nimport { resLoader } from '../loader/ResLoader';\nconst { ccclass, menu } = _decorator;\n\n/**\n * 注：用playOneShot播放的音乐效果，在播放期间暂时没办法即时关闭音乐\n */\n\n/** 游戏音效 */\n@ccclass('AudioEffect')\nexport class AudioEffect extends AudioSource {\n    constructor() {\n        super();\n    }\n    /** 是否处于暂停中 */\n    private _isPause: boolean = false;\n    /** 是否停止了播放 */\n    private _isStopPlay: boolean = false;\n    /** 是否播放阶段 */\n    private _isStartPlay: boolean = false;\n    /** 当前音量 */\n    private _currowVolume: number = 1;\n    /** 当前正在播放的记录 */\n    private currowPlayEffect = {\n        bundle: null,\n        path: null\n    };\n\n    /** 所有播放过的记录 */\n    private effects: Map<string, string> = new Map<string, string>();\n\n    initData() {\n        /** 是否处于暂停中 */\n        this._isPause = false;\n        /** 是否停止了播放 */\n        this._isStopPlay = false;\n        /** 是否播放阶段 */\n        this._isStartPlay = false;\n        if (this.clip) {\n            this.stop();\n        }\n        this.clip = null;\n\n        this.currowPlayEffect = { bundle: null, path: null };\n    }\n    public load(bundleName: string = \"resources\", path: string, callback?: Function) {\n        this._isStopPlay = false;\n        this._isStartPlay = true;\n        let self = this;\n\n        resLoader.load(bundleName, path, AudioClip, (err: Error | null, data: AudioClip) => {\n            if (err) {\n                error(err);\n            }\n            self.realLoadAudioClip.call(self, bundleName, path, data, callback);\n        });\n\n    }\n\n    /** 真正的加载包 */\n    private realLoadAudioClip(bundleName, path, audioClip: AudioClip, callback?: Function) {\n        this._isStartPlay = false;\n        if (!this.node || this.node.isValid == false) {\n            this.currowPlayEffect = { bundle: null, path: null };\n            return;\n        }\n        if (this._isStopPlay == true) {\n            return;\n        }\n        this.loop = false;\n        this.clip = audioClip;\n        this.currowPlayEffect = { bundle: bundleName, path: path };\n        this.effects.set(path, bundleName);\n        this.volume = this._currowVolume;\n        this.startPlay();\n\n        if (callback) {\n            callback();\n        }\n    }\n    /** 获取当前正在播放的资源配置(停止播放时清空) */\n    getCurrowPlayConf() {\n        return this.currowPlayEffect;\n    }\n    /** 是否处于播放阶段 */\n    isPlay(): boolean {\n        if (this._isStartPlay) {\n            return true;\n        }\n        return this.state == AudioSource.AudioState.PLAYING;\n    }\n    /** 是否处于暂停阶段 */\n    isPause(): boolean {\n        return this.state == AudioSource.AudioState.PAUSED;\n    }\n\n    /** 播放 */\n    startPlay() {\n        this.play();\n        this._isPause = false;\n    }\n    /** 暂停 */\n    startPause() {\n        this.pause();\n        this._isPause = true;\n    }\n    /** 停止 */\n    startStop() {\n        this.stop();\n        this._isStopPlay = true;\n        this.currowPlayEffect = { bundle: null, path: null };\n    }\n    /** 设置音量 0~1 */\n    setVolume(num: number) {\n        num = Number(num);\n        if (isNaN(num)) {\n            return;\n        }\n        if (num > 1) {\n            num = 1;\n        } else if (num < 0) {\n            num = 0\n        }\n        this._currowVolume = num;\n        if (this.isPlay() || this.isPause()) {\n            this.volume = this._currowVolume;\n        }\n\n    }\n    release() {\n        console.log(\"=============>音效资源释放：\", this.effects)\n        for (let key in this.effects) {\n            resLoader.release(key, this.effects[key]);\n        }\n        this.startStop();\n        this.effects.clear();\n\n\n    }\n}\n"]}