{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/game/module/opInfo/src/OpInfo.ts"],"names":["instantiate","Layout","Node","Prefab","_decorator","EventManager","Utils","BaseComponent","OperationMgr","RoomMgr","GameStatus","OPCode","FXJEvent","FXJRes","FXJSound","GameEvent","Card","Carditem","ccclass","property","OpInfo","tooltip","type","btnCodeMap","Map","btnSkelMap","opTypeArr","_handlerTimeUpdate","getShowBtn","code","opCode","btn","onInitModuleEvent","addModelListener","CLOSE_OPRATION_INFO","closeOpInfo","onLoad","updateCodeMap","set","OPE_PASS","guoLayout","OPE_RIGHT_CHI","chiLayout","OPE_MIDDLE_CHI","OPE_LEFT_CHI","OPE_PENG","pengLayout","OPE_QIANG_PENG","OPE_HU","huLayout","OPE_ZI_MO","zimoLayout","OPE_AN_GANG","gangLayout","OPE_GANG","OPE_BU_GANG","startOperationTime","stopSchedulerOnce","timeOut","getInstance","getTimeOut","OPERATION","addSchedulerOnce","handler","resetView","opClick","opInfo","req","opCard","getPassNumber","opCards","getOprationListNumber","seatId","userId","dispatch","SEND_PLAYER_OPERATION","myOpCode","updateOpration","resp","console","log","opGroups","forEach","layout","node","active","info","push","card","getChildByName","getComponent","setCardByte","getHuNumber","opNode","changeSkin","off","EventType","TOUCH_END","on","SYS_PLAY_EFFECT","GameClick","findOpTypesWithSameNodeAndCode","opcode","skNode","param","resConf","Spine_op","aniName","get","parentNode","trackIndex","isLoop","callStartFunc","SYS_ANI_PLAY","opTypes","opTypesMap","opType","key","name","has","opMap","length","isMoreOpration","group","CardItemPrefab","cardItem","updateCardItemProp","opBtns","updateLayout","cleanLayout","opLayouts","childrens","children","child","removeFromParent","ganghuaLayout"],"mappings":"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","sourcesContent":["import { instantiate, Layout, Node, Prefab, _decorator } from 'cc';\nimport { inf_SpineAniCreate } from '../../../../../framework/InterfaceDefines';\nimport { EventManager } from '../../../../../framework/manager/EventManager';\nimport { Utils } from '../../../../../framework/Utils';\nimport { BaseComponent } from '../../../../../framework/vc/BaseComponent';\nimport { OperationMgr } from '../../../cache/OperationMgr';\nimport { RoomMgr } from '../../../cache/RoomMgr';\nimport { GameStatus, OPCode } from '../../../common/FXJConfig';\nimport { FXJEvent } from '../../../common/FXJEvent';\nimport { FXJRes } from '../../../common/FXJRes';\nimport { FXJSound } from '../../../common/FXJSound';\nimport { GameEvent } from '../../../common/GameEvent';\nimport { Common } from '../../../common/idl/Common';\nimport { Game } from '../../../common/idl/Game';\nimport { Card } from '../../card/src/Card';\nimport { Carditem } from './Carditem';\nconst { ccclass, property } = _decorator;\n\nexport interface OpType {\n    node?: Layout | null;\n    code?: number | null;\n}\n\n@ccclass('OpInfo')\nexport class OpInfo extends BaseComponent {\n    @property(Node)\n    public opBtns: Node | null = null;\n\n    @property(Layout)\n    public guoLayout: Layout | null = null;\n\n    @property(Layout)\n    public huLayout: Layout | null = null;\n\n    @property(Layout)\n    public gangLayout: Layout | null = null;\n\n    @property(Layout)\n    public pengLayout: Layout | null = null;\n\n    @property(Layout)\n    public chiLayout: Layout | null = null;\n\n    @property(Layout)\n    public zimoLayout: Layout | null = null;\n\n    @property(Layout)\n    public ganghuaLayout: Layout | null = null;\n\n    // 手牌节点\n\t@property({ tooltip: \"手牌预制体\", type: Prefab })\n\tprivate CardItemPrefab: Prefab | null = null;\n    //可以显示响应按钮的opCode\n    btnCodeMap = new Map<number, Layout>();\n\n    //可以显示响应按钮的opCode\n    btnSkelMap = new Map<number, string>();\n\n    opTypeArr:OpType[] = [];\n\n    /** 时间更新句柄 */\n\t_handlerTimeUpdate = null;\n\n    protected onInitModuleEvent() {\n        this.addModelListener(GameEvent.CLOSE_OPRATION_INFO, this.closeOpInfo);\n\t\t\n\t};\n\n    onLoad () {\n        this.updateCodeMap();\n\t};\n\n    updateCodeMap(){\n        this.btnCodeMap.set(OPCode.OPE_PASS, this.guoLayout);\n        this.btnCodeMap.set(OPCode.OPE_RIGHT_CHI, this.chiLayout);\n        this.btnCodeMap.set(OPCode.OPE_MIDDLE_CHI, this.chiLayout);\n        this.btnCodeMap.set(OPCode.OPE_LEFT_CHI, this.chiLayout);\n        this.btnCodeMap.set(OPCode.OPE_PENG, this.pengLayout);\n        this.btnCodeMap.set(OPCode.OPE_QIANG_PENG, this.pengLayout);\n        this.btnCodeMap.set(OPCode.OPE_HU, this.huLayout);\n        this.btnCodeMap.set(OPCode.OPE_ZI_MO, this.zimoLayout);\n        this.btnCodeMap.set(OPCode.OPE_AN_GANG, this.gangLayout);\n        this.btnCodeMap.set(OPCode.OPE_GANG, this.gangLayout);\n        this.btnCodeMap.set(OPCode.OPE_BU_GANG, this.gangLayout);\n\n\n        this.btnSkelMap.set(OPCode.OPE_PASS, \"icon_guo\");\n        this.btnSkelMap.set(OPCode.OPE_RIGHT_CHI, \"icon_chi\");\n        this.btnSkelMap.set(OPCode.OPE_MIDDLE_CHI, \"icon_chi\");\n        this.btnSkelMap.set(OPCode.OPE_LEFT_CHI, \"icon_chi\");\n        this.btnSkelMap.set(OPCode.OPE_PENG, \"icon_peng\");\n        this.btnSkelMap.set(OPCode.OPE_QIANG_PENG, \"icon_peng\");\n        this.btnSkelMap.set(OPCode.OPE_HU, \"icon_hu\");\n        this.btnSkelMap.set(OPCode.OPE_ZI_MO, \"icon_zimo\");\n        this.btnSkelMap.set(OPCode.OPE_AN_GANG, \"icon_gang\");\n        this.btnSkelMap.set(OPCode.OPE_GANG, \"icon_gang\");\n        this.btnSkelMap.set(OPCode.OPE_BU_GANG, \"icon_gang\");\n    }\n\n\t/** 开始更新时间 */\n\tstartOperationTime() {\n        this.stopSchedulerOnce(this._handlerTimeUpdate);\n\t\tthis._handlerTimeUpdate = null;\n        let timeOut:number = RoomMgr.getInstance().getTimeOut(GameStatus.OPERATION);\n        this._handlerTimeUpdate = this.addSchedulerOnce(timeOut, Utils.handler(this, this.resetView))\n\t}\n    \n\n    //点击操作,发送操作code  碰/杠/胡/过\n    opClick(opInfo:Common.IOpGroup) {\n        let req: Game.ISendOperation = {\n            opCard:OperationMgr.getInstance().getPassNumber(),\n\t\t\topCode:opInfo.opCode,\n\t\t\topCards:OperationMgr.getInstance().getOprationListNumber(opInfo.opCode,0),\n\t\t\tseatId:OperationMgr.getInstance().seatId,\n\t\t\tuserId:OperationMgr.getInstance().userId\n        } \n        EventManager.dispatch(GameEvent.SEND_PLAYER_OPERATION, req);\n        OperationMgr.getInstance().myOpCode = opInfo.opCode;\n        this.resetView();\n    }\n\n    closeOpInfo(){\n        this.stopSchedulerOnce(this._handlerTimeUpdate);\n\t\tthis._handlerTimeUpdate = null;\n        this.resetView();\n    }\n\n    getShowBtn = function (code: number): Layout {\n        for (let [opCode, btn] of this.btnCodeMap) {\n            if (code == opCode) {\n                return btn;\n            }\n        }\n        return null;\n    }\n\n    \n\n    updateOpration(resp:Game.IOperation){\n        this.resetView();\n        //抓牌\n        // if(resp.opGroups.length === 1){\n        //     return;\n        // }\n        console.log(\"updateOpration______________\",resp.opGroups);\n        this.opTypeArr = [];\n        resp.opGroups.forEach((opInfo:Common.IOpGroup) => {\n            let layout = this.getShowBtn(opInfo.opCode);\n            if (layout) {\n                layout.node.active = true;\n                let info:OpType = {code:opInfo.opCode,node:layout};\n                this.opTypeArr.push(info);\n            }\n            \n            if (layout instanceof Layout) {\n                layout.node.active = true;\n                var card:Node= layout.node.getChildByName(\"Card\")\n                if(card){\n                    card.getComponent(Card).setCardByte(OperationMgr.getInstance().getHuNumber());\n                }\n                let opNode:Node = layout.node.getChildByName(\"sk\");\n                this.changeSkin(opInfo.opCode,opNode);\n                opNode.off(Node.EventType.TOUCH_END);\n                opNode.on(Node.EventType.TOUCH_END, () => {\n                    this.opClick(opInfo);\n                    EventManager.dispatch(FXJEvent.SYS_PLAY_EFFECT, FXJSound.GameClick);\n                }, this);\n            }\n            \n        });\n        this.findOpTypesWithSameNodeAndCode(this.opTypeArr);\n        this.startOperationTime();\n    }\n\n    changeSkin(opcode:number,skNode?:Node){\n        let param: inf_SpineAniCreate = {   \n            resConf: FXJRes.Spine_op,\n            aniName: this.btnSkelMap.get(opcode),\n            parentNode: skNode,\n            trackIndex: 0,\n            isLoop: true, \n            callStartFunc: () => {\n            }\n        }\n        EventManager.dispatch(FXJEvent.SYS_ANI_PLAY, param);\n\t}\n\n    findOpTypesWithSameNodeAndCode(opTypes: OpType[]) {\n        const opTypesMap: Map<string, OpType[]> = new Map();\n    \n        // 遍历 opTypes 数组，将具有相同 node 和 code 的 OpType 放入映射中\n        for (const opType of opTypes) {\n            const key = opType.node.name;\n            if (!opTypesMap.has(key)) {\n                opTypesMap.set(key, []);\n            }\n            opTypesMap.get(key)?.push(opType);\n        }\n        var opMap: Map<string, OpType[]> = new Map();\n        for (const [key, opTypes] of opTypesMap) {\n            if(opTypes.length > 1){\n                opMap.set(key, opTypes);\n            }else{\n                if(OperationMgr.getInstance().isMoreOpration(opTypes[0].code)){\n                    opMap.set(key, opTypes);\n                }\n            }\n        }\n        // 从映射中提取所有具有相同 node 和 code 的 OpType 数组\n        for (const [name, group] of opMap) {\n            let node = instantiate(this.CardItemPrefab);\n            let cardItem:Carditem = node.getComponent(Carditem);\n            cardItem.updateCardItemProp(group);\n        }\n\n        this.opBtns.getComponent(Layout).updateLayout();\n        \n    }\n\n    cleanLayout(){\n        let opLayouts:Layout[] = [this.chiLayout,this.pengLayout,this.gangLayout];\n        opLayouts.forEach(layout => {\n\t\t\tlet childrens = layout.node.children;\n            childrens.forEach(child => {\n                if(child.name !== \"sk\"){\n                    child.removeFromParent();\n                }\n            });\n\t\t});\n    }\n\n    resetView() {\n        this.guoLayout.node.active = false;\n        this.huLayout.node.active = false;\n        this.zimoLayout.node.active = false;\n        this.ganghuaLayout.node.active = false;\n        this.gangLayout.node.active = false;\n        this.pengLayout.node.active = false;\n        this.chiLayout.node.active = false;\n        this.cleanLayout();\n    }\n}"]}