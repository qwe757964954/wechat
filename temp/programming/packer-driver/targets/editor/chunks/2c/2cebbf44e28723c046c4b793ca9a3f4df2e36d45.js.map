{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/activity/scripts/friendPrefabCtr.ts"],"names":["Label","Node","_decorator","GCache","AppEvent","AppSound","GConstants","EventManager","Utils","BaseComponent","Platform","ccclass","property","menu","friendPrefabCtr","tooltip","type","sceneLayer","sceneChoice","_friendList","_maxFriendNum","_cloundUIKey","onLoad","nodeUserItem","active","frdListScene","showView","start","updateShowBtn","updateSceneShow","refreshFrdList","node","isValid","frdListView","btnAddTip","WxAuthSettingFriends","self","User","getCloudStorageSaveList","resParam","setPlatformCloudStorage","data","getCloudStorageParam","postMessage","dispatch","SYS_TOAST_TIP","content","len","sceneBtnLayer","children","length","i","selectDot","getChildByName","selectImg","String","updateFriendItem","item","onClickAddFriend","event","SYS_PLAY_EFFECT","CommClick","reqPlatformFriendInteraction","handler","onClickSearch","console","log","labelSearchInput","string","key","search","onFriendListClick","onFriendMsgClick","onAddFriendClick","onCheckFrdClick","onClickInviteFriend","shopShareMsg","ShareInfo","getShareConfigByType","ShareSceneConf","friend","_shareOptions","title","imageUrl","shareWXFriends","onCloseClick","destroy","onDestroy"],"mappings":"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","sourcesContent":["\nimport { Label, Node, _decorator } from 'cc';\nimport { GCache } from '../../../cache/GCache';\nimport { AppEvent } from '../../../config/AppEvent';\nimport { AppSound } from '../../../config/AppSound';\nimport { GConstants } from '../../../config/GameConstant';\nimport { EventManager } from '../../../framework/manager/EventManager';\nimport { Utils } from '../../../framework/Utils';\nimport { BaseComponent } from '../../../framework/vc/BaseComponent';\nimport { Platform } from '../../../platform/Platform';\nconst { ccclass, property, menu } = _decorator;\n\n/**\n * Name = friendPrefabCtr\n * URL = db://assets/package/hall/scripts/friendPrefabCtr.ts\n * Time = Tue Sep 13 2022 15:55:28 GMT+0800 (中国标准时间)\n * Author = Tomoe\n * 好友列表\n * Life: onLoad-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n */\n\n@ccclass('friendPrefabCtr')\n//方便编辑器识别的菜单项目\n@menu('prefab/activity/friendPrefabCtr')\nexport class friendPrefabCtr extends BaseComponent {\n\n    //界面按钮父节点\n    @property({ tooltip: \"界面按钮父节点\", type: Node })\n    private sceneBtnLayer: Node | null = null;\n\n\n    //搜索框\n    @property({ tooltip: \"搜索框\", type: Label })\n    private labelSearchInput: Label | null = null;\n\n    //好友列表界面\n    @property({ tooltip: \"好友列表界面\", type: Node })\n    private frdListScene: Node | null = null;\n\n    //添加好友提示\n    @property({ tooltip: \"添加好友提示\", type: Node })\n    private btnAddTip: Node | null = null;\n\n\n    //用户好友条-添加父节点\n    @property({ tooltip: \"用户好友条-添加父节点\", type: Node })\n    private frdListView: Node | null = null;\n\n    //用户好友条-克隆\n    @property({ tooltip: \"用户好友条-克隆\", type: Node })\n    private nodeUserItem: Node | null = null;\n\n\n    //界面节点缓存\n    sceneLayer = null;\n\n    //界面选中\n    sceneChoice: number = 0;\n    /** 好友列表信息 */\n    _friendList = [];\n    /** 好友最大数列 */\n    _maxFriendNum = 120;\n    /** 数据域UI界面 */\n    _cloundUIKey = \"friendList\";\n\n    onLoad() {\n        this.nodeUserItem.active = false;\n        this.sceneLayer = {\n            0: this.frdListScene,\n        }\n        this.sceneChoice = 0;\n        this.showView();\n    };\n\n    start() {\n\n    };\n\n\n    showView() {\n        this.updateShowBtn();\n        this.updateSceneShow();\n        this.refreshFrdList();\n    }\n    /** 刷新列表 */\n    refreshFrdList() {\n        if (!this.node || this.node.isValid == false) {\n            return\n        }\n        this.frdListView.active = true;\n        this.btnAddTip.active = Platform.WxAuthSettingFriends != 1;\n        if (Platform.WxAuthSettingFriends == 1) {\n            let self = this;\n            GCache.User.getCloudStorageSaveList((resParam) => {\n                Platform.setPlatformCloudStorage(resParam);\n                let data = {}\n                data[\"UIKey\"] = self._cloundUIKey;\n                data[\"reloadUI\"] = true;\n                data[\"param\"] = GCache.User.getCloudStorageParam();\n                Platform.postMessage(data);\n            })\n\n        } else if (Platform.WxAuthSettingFriends == -1) {\n            EventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: \"tip:已拒绝好友授权\" })\n        }\n    }\n\n    //刷新选中界面按钮\n    updateShowBtn() {\n        let len = this.sceneBtnLayer.children.length;\n        for (let i = 0; i < len; i++) {\n            let node = this.sceneBtnLayer.children[i];\n            let selectDot = node.getChildByName(\"img_dot_selected\")\n            let selectImg = node.getChildByName(\"img_selected\")\n            if (String(this.sceneChoice) == String(i)) {\n                selectDot.active = true;\n                selectImg.active = true;\n            } else {\n                selectDot.active = false;\n                selectImg.active = false;\n            }\n        }\n    }\n\n    //刷新选中界面\n    updateSceneShow() {\n        for (let i in this.sceneLayer) {\n            let node = this.sceneLayer[i];\n            if (String(this.sceneChoice) == String(i)) {\n                node.active = true;\n            } else {\n                node.active = false;\n            }\n        }\n    }\n\n    /** 更新单条朋友数据 */\n    updateFriendItem(item: Node, data) {\n        if (!item || !data) {\n            return\n        }\n        //更新数据\n        item.active = true;\n    }\n    /** 点击去加好友 */\n    onClickAddFriend(event = null) {\n        EventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n        Platform.reqPlatformFriendInteraction(Utils.handler(this, this.refreshFrdList));\n    }\n    /** 点击搜索 */\n    onClickSearch(event = null) {\n        EventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n\n        this.btnAddTip.active = Platform.WxAuthSettingFriends != 1;\n        console.log(\"搜索内容：\", this.labelSearchInput.string)\n        if (Platform.WxAuthSettingFriends == 1) {\n            let data = {}\n\t\t\tdata[\"UIKey\"] = this._cloundUIKey;\n\t\t\tdata[\"findByKey\"] = true;\n\t\t\tdata[\"param\"] = { key: \"nickname\", search: this.labelSearchInput.string };\n\t\t\tPlatform.postMessage(data);\n        }\n    }\n    //点击好友列表\n    onFriendListClick(event: Event) {\n        EventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n        this.sceneChoice = 0;\n        this.showView();\n    }\n\n\n    //点击好友消息\n    onFriendMsgClick(event: Event) {\n        EventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n        this.sceneChoice = 1;\n        this.showView();\n    }\n\n    //点击添加好友\n    onAddFriendClick(event: Event) {\n        EventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n        this.sceneChoice = 2;\n        this.showView();\n    }\n\n    //点击查找好友\n    onCheckFrdClick(event: Event) {\n        EventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n    }\n    //点击邀请好友\n    onClickInviteFriend(event: Event) {\n        EventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n        let shopShareMsg = GCache.ShareInfo.getShareConfigByType(GConstants.ShareSceneConf.friend)\n        let _shareOptions = {\n            title: shopShareMsg[0]['title'],\n            imageUrl: shopShareMsg[0]['img']\n        }\n        Platform.shareWXFriends(_shareOptions);\n    }\n\n    //点击关闭界面\n    onCloseClick(event: Event) {\n        EventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n        this.node.destroy();\n    }\n\n    //销毁\n    onDestroy() {\n        let data = {}\n        data[\"UIKey\"] = this._cloundUIKey;\n        data[\"close\"] = true;\n        Platform.postMessage(data);\n    };\n\n}\n\n"]}