{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/framework/manager/PkgLoaderManager.ts"],"names":["PkgLoaderManager","AudioClip","error","Prefab","AppEvent","pbkiller","resLoader","Utils","BaseControll","AudioManager","EventManager","SpineAniManager","getInstance","_instance","constructor","name","_alreadyLoad","_currowLoad","onInitModuleEvent","addModelListener","SYS_PACKAGE_LOAD_TASK_ADD","addTask","SYS_PACKAGE_LOAD_TASK_CANCLE","cancleTask","init","clear","event","param","taskID","endCallFunc","task","taskList","taskNum","progress","startCallFunc","updateCallFunc","_startLoad","print","dispatch","SYS_PACKAGE_LOAD_TASK_CANCLE_SURE","self","taskProgress","callback","pPath","taskTab","allCountProgress","countAll","oneProgess","isRealLoad","oneLoad","protobuf","__addPreLoadPB","package","length","i","__addBundleLoad","prefab","path","__addOneLoad","bundle","audio","__addPreLoadAudio","spine","__addPreLoadSpine","updateCallback","number_valueOf","currowProgress","onComplete","err","data","loadBundle","type","onProgress","finished","total","item","load","tag","preLoadAudioDir","preLoadSkinAniDir","preload","SYS_UPDATE_PROTOBUF"],"mappings":"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","sourcesContent":["/**\n * Name = PkgLoaderManager\n * URL = db://assets/framework/manager/PkgLoaderManager.ts\n * Time = Thu Feb 02 2023 17:52:47 GMT+0800 (中国标准时间)\n * Author = xueya\n * 分包加载控制器\n */\n\nimport { AudioClip, error, Prefab } from \"cc\";\nimport { AppEvent } from \"../../config/AppEvent\";\nimport { pbkiller } from \"../crypto/pbkiller\";\nimport { inf_PkgLoaderTaskAdd, inf_PkgLoaderTaskList } from \"../InterfaceDefines\";\nimport { CompleteCallback, ProgressCallback, resLoader } from \"../loader/ResLoader\";\nimport { Utils } from \"../Utils\";\nimport { BaseControll } from \"../vc/BaseController\";\nimport { AudioManager } from \"./AudioManager\";\nimport { EventManager } from \"./EventManager\";\nimport { SpineAniManager } from \"./SpineAniManager\";\n\n\n/** 正在运行的任务 */\ninterface inf_PkgLoaderTask {\n\t/** 任务ID */\n\ttaskID: any,\n\t/** 任务队列 */\n\ttaskList: inf_PkgLoaderTaskList,\n\t/** 任务数量 */\n\ttaskNum: number,\n\t/** 当前加载进度 0~100 */\n\tprogress: number,\n\t/** 开始的回调 */\n\tstartCallFunc?: Function,\n\t/** 更新的回调 */\n\tupdateCallFunc?: Function,\n\t/** 完成的回调*/\n\tendCallFunc?: Function\n}\n\n\nexport class PkgLoaderManager extends BaseControll {\n\tprivate static _instance = null;\n\tpublic static getInstance(): PkgLoaderManager {\n\t\tif (!this._instance || this._instance == null) {\n\t\t\tthis._instance = new PkgLoaderManager(\"PkgLoaderManager\");\n\t\t}\n\t\treturn this._instance;\n\t}\n\t//实例化\n\tconstructor(name: string) {\n\t\tsuper(\"PkgLoaderManager\")\n\t};\n\t/** 模块事件 */\n\tprotected onInitModuleEvent() {\n\t\t/** 添加一个分包加载任务 */\n\t\tthis.addModelListener(AppEvent.SYS_PACKAGE_LOAD_TASK_ADD, this.addTask);\n\t\t/** 分包加载任务取消 */\n\t\tthis.addModelListener(AppEvent.SYS_PACKAGE_LOAD_TASK_CANCLE, this.cancleTask);\n\t}\n\tpublic static init(): PkgLoaderManager {\n\t\tif (this._instance) {\n\t\t\tthis._instance.clear();\n\t\t}\n\t\tthis._instance = null\n\t\tPkgLoaderManager.getInstance();\n\t\treturn\n\t}\n\t/** 已经加载的任务 */\n\tprivate _alreadyLoad = {};\n\t/** 当前正在加载的任务 */\n\tprivate _currowLoad: { [taskID: number]: inf_PkgLoaderTask } = {};\n\n\t/**\n\t * 添加包加载任务\n\t * @param param 详见inf_PkgLoaderTaskAdd\n\t * @returns \n\t */\n\taddTask(event, param: inf_PkgLoaderTaskAdd) {\n\t\tif (!param || param.taskID == null) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._alreadyLoad[param.taskID] == true) {\n\t\t\tif (param.endCallFunc) {\n\t\t\t\tparam.endCallFunc(param.taskID);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif (this._currowLoad[param.taskID] != null) {\n\t\t\treturn;\n\t\t}\n\t\tlet task: inf_PkgLoaderTask = {\n\t\t\ttaskID: param.taskID,\n\t\t\ttaskList: param.taskList,\n\t\t\ttaskNum: 0,\n\t\t\tprogress: 0,\n\t\t\tstartCallFunc: param.startCallFunc,\n\t\t\tupdateCallFunc: param.updateCallFunc,\n\t\t\tendCallFunc: param.endCallFunc\n\t\t}\n\t\tthis._currowLoad[param.taskID] = task;\n\n\t\tthis._startLoad(param.taskID);\n\n\t}\n\t/** 取消一个任务 */\n\tcancleTask(event, taskID) {\n\t\tif (taskID != null && this._currowLoad[taskID] != null) {\n\t\t\tthis._currowLoad[taskID] = null;\n\t\t\tthis.print(`>>>取消加载任务:${taskID}成功！！！`)\n\t\t\tEventManager.dispatch(AppEvent.SYS_PACKAGE_LOAD_TASK_CANCLE_SURE, taskID);\n\t\t}\n\t}\n\t/** 开始加载 */\n\tprivate _startLoad(taskID) {\n\t\tif (!this._currowLoad[taskID]) {\n\t\t\treturn;\n\t\t}\n\t\tlet self = this;\n\t\tlet taskProgress = {};\n\n\t\tlet callback = function (pPath, progress) {\n\t\t\tif (!self._currowLoad[taskID]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (progress == -1) {\n\t\t\t\terror(\"加载任务出错 包路径：\" + pPath)\n\t\t\t\treturn\n\t\t\t}\n\t\t\ttaskProgress[pPath] = progress;\n\n\t\t\tlet taskTab = self._currowLoad[taskID];\n\t\t\tlet allCountProgress = (100 * taskTab.taskNum);\n\t\t\tlet countAll = 0;\n\t\t\tfor (let pPath in taskProgress) {\n\t\t\t\tlet oneProgess = taskProgress[pPath];\n\t\t\t\tcountAll = countAll + oneProgess;\n\t\t\t}\n\t\t\tself._currowLoad[taskID].progress = 100 * countAll / allCountProgress;\n\t\t\t// console.log(\"输出总进度:\", self._currowLoad[taskID].progress);\n\n\t\t\tif (self._currowLoad[taskID].updateCallFunc) {\n\t\t\t\tself._currowLoad[taskID].updateCallFunc(taskID, self._currowLoad[taskID].progress);\n\t\t\t}\n\t\t\tif (self._currowLoad[taskID].progress == 100) {//加载完成\n\t\t\t\tself._alreadyLoad[taskID] = true;\n\t\t\t\tif (self._currowLoad[taskID].endCallFunc) {\n\t\t\t\t\tself._currowLoad[taskID].endCallFunc(taskID);\n\t\t\t\t}\n\t\t\t\tself._currowLoad[taskID] = null;\n\t\t\t}\n\t\t}\n\t\tif (this._currowLoad[taskID].taskList) {\n\t\t\tif (this._currowLoad[taskID].startCallFunc) {\n\t\t\t\tthis._currowLoad[taskID].startCallFunc(taskID);\n\t\t\t}\n\t\t\tlet isRealLoad = false;\n\t\t\tlet oneLoad = null;\n\t\t\t//加载PB文件\n\t\t\tif (this._currowLoad[taskID].taskList.protobuf == true) {\n\t\t\t\tisRealLoad = true;\n\t\t\t\tthis.__addPreLoadPB(this._currowLoad[taskID], callback);\n\t\t\t}\n\t\t\t//加载bundle\n\t\t\tif (this._currowLoad[taskID].taskList.package && this._currowLoad[taskID].taskList.package.length > 0) {\n\t\t\t\tfor (let i = 0; i < this._currowLoad[taskID].taskList.package.length; i++) {\n\t\t\t\t\toneLoad = this._currowLoad[taskID].taskList.package[i];\n\t\t\t\t\tif (oneLoad != null && oneLoad != \"\") {\n\t\t\t\t\t\tisRealLoad = true;\n\t\t\t\t\t\tthis.__addBundleLoad(this._currowLoad[taskID], oneLoad, callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t//加载预制体\n\t\t\tif (this._currowLoad[taskID].taskList.prefab && this._currowLoad[taskID].taskList.prefab.length > 0) {\n\t\t\t\tfor (let i = 0; i < this._currowLoad[taskID].taskList.prefab.length; i++) {\n\t\t\t\t\toneLoad = this._currowLoad[taskID].taskList.prefab[i];\n\t\t\t\t\tif (oneLoad && oneLoad.path != null) {\n\t\t\t\t\t\tisRealLoad = true;\n\t\t\t\t\t\tthis.__addOneLoad(this._currowLoad[taskID], oneLoad.bundle, oneLoad.path, Prefab, callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t//加载音乐文件\n\t\t\tif (this._currowLoad[taskID].taskList.audio && this._currowLoad[taskID].taskList.audio.length > 0) {\n\t\t\t\tfor (let i = 0; i < this._currowLoad[taskID].taskList.audio.length; i++) {\n\t\t\t\t\toneLoad = this._currowLoad[taskID].taskList.audio[i];\n\t\t\t\t\tif (oneLoad) {\n\t\t\t\t\t\tif ((oneLoad.path == null || oneLoad.path == \"\") && oneLoad.bundle != null) {//加载音乐包\n\t\t\t\t\t\t\tisRealLoad = true;\n\t\t\t\t\t\t\tthis.__addPreLoadAudio(this._currowLoad[taskID], oneLoad.bundle, \"\", callback);\n\t\t\t\t\t\t} else if (oneLoad.path != null && oneLoad.path != \"\") {//加载单个音乐文件\n\t\t\t\t\t\t\tisRealLoad = true;\n\t\t\t\t\t\t\tthis.__addOneLoad(this._currowLoad[taskID], oneLoad.bundle, oneLoad.path, AudioClip, callback);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t//加载spine动画\n\t\t\tif (this._currowLoad[taskID].taskList.spine && this._currowLoad[taskID].taskList.spine.length > 0) {\n\t\t\t\tfor (let i = 0; i < this._currowLoad[taskID].taskList.spine.length; i++) {\n\t\t\t\t\toneLoad = this._currowLoad[taskID].taskList.spine[i];\n\t\t\t\t\tif (oneLoad && oneLoad.path != null && oneLoad.bundle != null) {\n\t\t\t\t\t\tisRealLoad = true;\n\t\t\t\t\t\tthis.__addPreLoadSpine(this._currowLoad[taskID], oneLoad.bundle, oneLoad.path, callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (isRealLoad == true) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis._alreadyLoad[taskID] = true;\n\t\tif (this._currowLoad[taskID].endCallFunc) {\n\t\t\tthis._currowLoad[taskID].endCallFunc(taskID);\n\t\t}\n\t}\n\t/** 添加一个包加载 */\n\tprivate __addBundleLoad(task: inf_PkgLoaderTask, bundle, updateCallback?: Function) {\n\t\ttask.taskNum = Utils.number_valueOf(task.taskNum) + 1;\n\n\t\tlet currowProgress = -1;\n\n\t\tlet onComplete: CompleteCallback = (err: Error | null, data) => {\n\t\t\tif (err) {\n\t\t\t\tcurrowProgress = -1;\n\t\t\t} else {\n\t\t\t\tcurrowProgress = 100;\n\t\t\t}\n\t\t\tif (updateCallback) {\n\t\t\t\tupdateCallback(bundle, currowProgress);\n\t\t\t}\n\t\t}\n\t\tresLoader.loadBundle(bundle, onComplete);\n\t}\n\n\t/** 添加一个加载 */\n\tprivate __addOneLoad(task: inf_PkgLoaderTask, bundle, path, type, updateCallback?: Function) {\n\t\ttask.taskNum = Utils.number_valueOf(task.taskNum) + 1;\n\n\t\tlet self = this;\n\t\tlet currowProgress = -1;\n\t\tlet onProgress: ProgressCallback = (finished: number, total: number, item) => {\n\t\t\t// 计算进度\n\t\t\tlet progress = (finished / total) * 100;\n\t\t\tcurrowProgress = progress;\n\t\t\tif (currowProgress < 100 && updateCallback) {\n\t\t\t\tupdateCallback(path, currowProgress);\n\t\t\t}\n\t\t}\n\t\tlet onComplete: CompleteCallback = (err: Error | null, data) => {\n\t\t\tif (err) {\n\t\t\t\tcurrowProgress = -1;\n\t\t\t}\n\t\t\tif (updateCallback) {\n\t\t\t\tupdateCallback(path, currowProgress);\n\t\t\t}\n\t\t}\n\t\tresLoader.load(bundle, path, type, onProgress, onComplete);\n\t}\n\n\t/** 添加音效预加载目录 */\n\tprivate __addPreLoadAudio(task: inf_PkgLoaderTask, bundle, path, updateCallback?: Function) {\n\t\ttask.taskNum = Utils.number_valueOf(task.taskNum) + 1;\n\n\t\tlet self = this;\n\t\tlet currowProgress = -1;\n\t\tlet tag = bundle + \"|\" + path;\n\t\tlet onProgress: ProgressCallback = (finished: number, total: number, item) => {\n\t\t\t// 计算进度\n\t\t\tlet progress = (finished / total) * 100;\n\t\t\tcurrowProgress = progress;\n\t\t\tif (currowProgress < 100 && updateCallback) {\n\t\t\t\tupdateCallback(tag, currowProgress);\n\t\t\t}\n\t\t}\n\t\tlet onComplete: CompleteCallback = (err: Error | null, data) => {\n\t\t\tif (err) {\n\t\t\t\tcurrowProgress = -1;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tself.print(\"音效预加载目录完成\", bundle, path);\n\t\t\tif (updateCallback) {\n\t\t\t\tupdateCallback(tag, currowProgress);\n\t\t\t}\n\t\t}\n\t\tAudioManager.getInstance().preLoadAudioDir(bundle, path, onProgress, onComplete)\n\t}\n\n\t/** 添加Spine预加载目录 */\n\tprivate __addPreLoadSpine(task: inf_PkgLoaderTask, bundle, path, updateCallback?: Function) {\n\t\ttask.taskNum = Utils.number_valueOf(task.taskNum) + 1;\n\n\t\tlet self = this;\n\t\tlet currowProgress = -1;\n\t\tlet tag = bundle + \"|\" + path;\n\t\tlet onProgress: ProgressCallback = (finished: number, total: number, item) => {\n\t\t\t// 计算进度\n\t\t\tlet progress = (finished / total) * 100;\n\t\t\tcurrowProgress = progress;\n\t\t\tif (currowProgress < 100 && updateCallback) {\n\t\t\t\tupdateCallback(tag, currowProgress);\n\t\t\t}\n\t\t}\n\t\tlet onComplete: CompleteCallback = (err: Error | null, data) => {\n\t\t\tif (err) {\n\t\t\t\tself.print(\"Error:Spine加载出错\", err, data);\n\t\t\t\tcurrowProgress = -1;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tself.print(\"Spine预加载目录完成\", bundle, path);\n\t\t\tif (updateCallback) {\n\t\t\t\tupdateCallback(tag, currowProgress);\n\t\t\t}\n\t\t}\n\t\tSpineAniManager.getInstance().preLoadSkinAniDir(bundle, path, onProgress, onComplete)\n\t}\n\n\t/** 添加PB预加载目录 */\n\tprivate __addPreLoadPB(task: inf_PkgLoaderTask, updateCallback?: Function) {\n\t\ttask.taskNum = Utils.number_valueOf(task.taskNum) + 1;\n\n\t\tlet self = this;\n\t\tlet currowProgress = -1;\n\t\tlet tag = \"pbkiller\";\n\t\tlet onProgress: ProgressCallback = (finished: number, total: number, item) => {\n\t\t\t// 计算进度\n\t\t\tlet progress = (finished / total) * 100;\n\t\t\tcurrowProgress = progress;\n\t\t\tif (currowProgress < 100 && updateCallback) {\n\t\t\t\tupdateCallback(tag, currowProgress);\n\t\t\t}\n\t\t}\n\t\tlet onComplete: CompleteCallback = (err: Error | null, data) => {\n\t\t\tif (err) {\n\t\t\t\tcurrowProgress = -1;\n\t\t\t\tpbkiller.preload(onProgress, onComplete);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tself.print(\"PB文件目录遍历完成 开始加载\");\n\t\t\t//初始化Pb加载\n\t\t\tEventManager.dispatch(AppEvent.SYS_UPDATE_PROTOBUF);\n\t\t\tif (updateCallback) {\n\t\t\t\tupdateCallback(tag, currowProgress);\n\t\t\t}\n\t\t}\n\t\tpbkiller.preload(onProgress, onComplete);\n\t}\n\n\n\n}\n\n"]}