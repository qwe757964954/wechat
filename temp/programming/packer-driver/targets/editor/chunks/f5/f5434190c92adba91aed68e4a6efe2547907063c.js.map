{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/game/scripts/Players/MyPlayerCard.ts"],"names":["animation","Animation","AnimationClip","instantiate","Node","Tween","Vec3","_decorator","GCache","EventManager","Utils","BaseComponent","OperationMgr","OperationResultMgr","PlayerMgr","OPCode","FXJEvent","FXJSound","GameEvent","CardUtil","NodeCardCtr","drawCardDisRatio","MjSize","ccclass","property","MyPlayerCard","tooltip","type","selectedNode","_drawCardNode","_mjList","myHandCardY","_slotIndex","_drawByte","_playHandCardCb","_isTouched","_touchNode","moveDistance","thresholdDistance","startPosition","touchNodePos","drawByte","newValue","onInitModuleEvent","onLoad","node","on","EventType","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","TOUCH_CANCEL","onTouchCancel","stackAnim","indexList","tByte","insertIndex","cb","pos","length","removeHandCard","getPosition","setPosition","removeDrawCard","addHandCard","pop","name","getInstance","getLastMyhands","startPosDraw","endPosDraw","x","width","y","z","acDraw","duration","trackDraw","VectorTrack","componentsCount","path","TrackPath","toProperty","drawX","channels","curve","assignSorted","value","animDrawCom","getComponent","addComponent","removeAll","FINISHED","addTrack","defaultClip","play","removeFromParent","console","log","index","insertNode","nodeCardTemplate","cardValue","setCardByte","active","addChild","splice","updateHandPositionAndName","drawCard","hiden","cardAddTouchEvent","getLastPosition","setRotationFromEuler","showDrawCard","rotaionEuler","eulerAngles","point","tweenTargetVec3","tw","by","onUpdate","target","ratio","rotate3DAroundByPositionRotaion","start","filter","item","undefined","i","handNode","getHandCardByIndex","playAnimOfShow","showdownDrawCard","showdownCard","off","event","cancelOpcardTouch","opcard","inList","byte","getMajiangValue","setBlack","includesMyhands","opCard","updateOpcardTouch","location","getLocation","getDelta","add","endPos","subtract","playSelectAnim","posx","getSelectNodePosx","playDrawCard","toOutCard","playCardFromHandAnim","rmDraw","isNotNull","updateCard","sort","a","b","removeNode","makeSlotAnim","ac","track","_","mjNode","startPos","getHandPosition","animCom","drawCardToSlot","posy","posz","easingMethod","getListBytes","bytes","node_byte","push","useByteFindIndexs","indexs","forEach","getNodeIndex","findIndex","theNode","addHandCards","valueList","stackCount","hasDrawCard","handCardCount","getHandPositionX","includes","parseInt","replace","playUnselectAnim","Desk","turnMe","onSendCard","trackPos","dispatch","SYS_PLAY_EFFECT","GameTiPai","getSendCardIndex","req","opCode","OPE_OUT_CARD","opCards","seatId","userId","SEND_PLAYER_OPERATION","resetView","removeAllChildren"],"mappings":"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","sourcesContent":["\nimport { animation, Animation, AnimationClip, EventTouch, instantiate, Node, Tween, Vec3, _decorator } from 'cc';\nimport { GCache } from '../../../../cache/GCache';\nimport { EventManager } from '../../../../framework/manager/EventManager';\nimport { Utils } from '../../../../framework/Utils';\nimport { BaseComponent } from '../../../../framework/vc/BaseComponent';\nimport { OperationMgr } from '../../cache/OperationMgr';\nimport { OperationResultMgr } from '../../cache/OperationResultMgr';\nimport { PlayerMgr } from '../../cache/PlayerMgr';\nimport { OPCode } from '../../common/FXJConfig';\nimport { FXJEvent } from '../../common/FXJEvent';\nimport { FXJSound } from '../../common/FXJSound';\nimport { GameEvent } from '../../common/GameEvent';\nimport { Game } from '../../common/idl/Game';\nimport { CardUtil } from '../../util/CardUtil';\nimport { NodeCardCtr } from '../NodeCardCtr';\nimport { drawCardDisRatio, MjSize } from './CardConfigs';\nconst { ccclass, property } = _decorator;\n\n/**\n * Name = MyPlayer\n * URL = db://assets/package/game/scripts/MyPlayer.ts\n * Time = Fri Aug 11 2023 11:08:16 GMT+0800 (中国标准时间)\n * Author = qwe757964\n *\n * Life: onLoad-->onInitModuleEvent-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n * \n */\n \n@ccclass('MyPlayerCard')\nexport class MyPlayerCard extends BaseComponent {\n\tpublic selectedNode: Node | null = null;\n\t\n    public _drawCardNode: Node | null = null;\n\n\tpublic\t_mjList:Node[] = [];\n\t\n\tprivate myHandCardY: number = 0;\n\n\t// 手牌模板\n\t@property({ tooltip: \"手牌模板\", type: Node })\n\tprivate nodeCardTemplate: Node | null = null;\n\n\t_slotIndex: number;\n\tprivate _drawByte: number;\n\n\t_playHandCardCb: any;\n\n    private _isTouched: boolean;\n\n    public _touchNode: Node | null = null;\n\n    private moveDistance: number = 0; // 阈值距离，用于判断是否出牌\n    private thresholdDistance: number = 0.5; // 阈值距离，用于判断是否出牌\n    private startPosition = new Vec3(); // 初始点击位置\n    private touchNodePos = new Vec3();\n\tget drawByte(): number {\n\t\treturn this._drawByte;\n\t}\n\n\tset drawByte(newValue: number) {\n\t\tthis._drawByte = newValue;\n\t}\n\t/** override 初始化模块事件 */\n\tprotected onInitModuleEvent() {\n\n\t};\n    onLoad() {\n        this.node.on(Node.EventType.TOUCH_START, this.onTouchStart, this);\n        this.node.on(Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.node.on(Node.EventType.TOUCH_END, this.onTouchEnd, this);\n        this.node.on(Node.EventType.TOUCH_CANCEL, this.onTouchCancel, this);\n    }\n   \n\t//移除对应的索引的牌去构成stack, 刷新整体node的位置\n\tstackAnim(indexList: number[], tByte?: number, insertIndex?: number, cb?:any) {\n\t\tlet pos = new Vec3();\n\t\tif(indexList.length === 2){\n            this.removeHandCard(indexList,true);\n\t\t\t//碰牌直接移除两张牌, 刷新位置\n\t\t\tpos = this.node.getPosition();\n\t\t\t// Vec3.add(pos, new Vec3(0, 0, 0), new Vec3(0, 0, 0));\n\t\t\tthis.node.setPosition(pos);\n\t\t}else if (indexList.length == 3){\n            this.removeHandCard(indexList,true);\n\t\t\t//杠牌直接移除三张牌, 刷新位置\n\t\t\tpos = this.node.getPosition();\n            // Vec3.add(pos, new Vec3(0, 0, 0), new Vec3(0, 0, 0));\n            this.node.setPosition(pos);\n            return\n\t\t}else if (indexList.length == 4 && insertIndex!==null){\n            insertIndex = insertIndex - indexList.length;\n            this.removeHandCard(indexList);\n\t\t\tthis.removeDrawCard();\n            this.addHandCard(tByte, insertIndex);\n            pos = this.node.getPosition();\n            // Vec3.add(pos, new Vec3(0, 0, 0), new Vec3(0, 0, 0));\n            this.node.setPosition(pos);\n            return\n\t\t}\n        /*\n\t\t//吃碰时候移除两张,平移一张到抽牌区 \n        let startPos = pos;\n        let endPos = new Vec3();\n        Vec3.add(endPos, startPos, startPos) \n        \n        let ac = new AnimationClip()\n        ac.duration = 0.1\n        let track = new animation.VectorTrack();\n        track.componentsCount = 3;\n        track.path = new animation.TrackPath().toProperty(\"position\")\n        let [x] = track.channels();\n       \n        x.curve.assignSorted([\n            [0, {value: startPos.x}],\n            [0.1, {value: endPos.x}]\n        ])\n\n        let animCom: Animation;\n\n        if (this.node.getComponent(Animation) == null)\n        {\n            animCom = this.node.addComponent(Animation)\n        }\n        else\n        {\n            animCom = this.node.getComponent(Animation)\n            animCom.removeAll(Animation.EventType.FINISHED)\n        } \n\n        if(cb)\n        {\n            animCom.on(Animation.EventType.FINISHED, cb, this)\n            // this._stackCb = cb\n        }\n\n        ac.addTrack(track)\n        animCom.defaultClip = ac\n        animCom.play(); \n        */\n\n        \n        this._drawCardNode = this._mjList.pop();\n        this._drawCardNode .name = \"drawCardNode\";\n        this.drawByte =  PlayerMgr.getInstance().getLastMyhands();\n        \n        let startPosDraw = this._drawCardNode.getPosition();\n        let endPosDraw = new Vec3(startPosDraw.x + MjSize.width, startPosDraw.y, startPosDraw.z)\n        this._drawCardNode.setPosition(endPosDraw);\n        \n        let acDraw = new AnimationClip()\n        acDraw.duration = 0.1\n        let trackDraw = new animation.VectorTrack();\n        trackDraw.componentsCount = 3;\n        trackDraw.path = new animation.TrackPath().toProperty(\"position\")\n        let [drawX] = trackDraw.channels();\n       \n        drawX.curve.assignSorted([\n            [0, {value: startPosDraw.x}],\n            [0.1, {value: endPosDraw.x}]\n        ])\n        \n        let animDrawCom: Animation;\n\n        if (this._drawCardNode.getComponent(Animation) == null)\n        {\n            animDrawCom = this._drawCardNode.addComponent(Animation)\n        }\n        else\n        {\n            animDrawCom = this._drawCardNode.getComponent(Animation)\n            animDrawCom.removeAll(Animation.EventType.FINISHED)\n        }\n\n        if(cb)\n        {  \n            animDrawCom.on(Animation.EventType.FINISHED, cb, this)\n            // this._stackCb = cb\n        }\n\n        acDraw.addTrack(trackDraw)\n        animDrawCom.defaultClip = acDraw\n        animDrawCom.play(); \n        \n\t}\n\n\t//移除一张手牌, 没有动画时的接口, 未来会使用动画接口出牌\n    removeDrawCard() {\n        if (this._drawCardNode) {\n            this._drawCardNode.removeFromParent();\n            this._drawCardNode = null;\n        }\n        else {\n            console.log(\"当前没有渲染牌,无法移除\")\n        }\n    }\n\t//添加一张牌到手牌的指定位置\n\taddHandCard(tByte: number, index: number) {\n\n        if (index > this._mjList.length) {\n            console.log(\"索引大于当前渲染手牌的数量请检查逻辑\", index)\n            return;\n        }\n\n        if (this._mjList.length >= 13) {\n            console.log(\"当前渲染手牌数量已满--> 13\", index)\n            return;\n        } \n\n\t\tlet insertNode = instantiate(this.nodeCardTemplate)\n\t\tlet cardValue = tByte;\n\t\tinsertNode.getComponent(NodeCardCtr).setCardByte(cardValue);\n\t\tinsertNode.active = true;        \n        insertNode.name = \"MJBlock\" + index\n\n        this.node.addChild(insertNode)\n\t\tthis._mjList.splice(index, 0, insertNode); // 在指定索引处插入对象\n\n        this.updateHandPositionAndName()\n    }\n\n\t//抓一张牌\n    drawCard(tByte: number,hiden?:boolean) {\n\t\tthis.drawByte = tByte;\n\t\tthis._drawCardNode = instantiate(this.nodeCardTemplate)\n\t\tthis._drawCardNode.getComponent(NodeCardCtr).setCardByte(tByte);\n\t\tthis._drawCardNode.active = true;\n\t\tthis.node.addChild(this._drawCardNode);\n        this.cardAddTouchEvent(this._drawCardNode);\n\t\tthis._drawCardNode.setPosition(this.getLastPosition() + drawCardDisRatio * MjSize.width, 0, 0)\n        if(hiden){\n            this._drawCardNode.setRotationFromEuler(90, 0, 0);\n        }\n\t}\n\n    showDrawCard(){\n        let duration = 0.3;\n        let rotaionEuler = new Vec3(this._drawCardNode.eulerAngles);\n        let pos = new Vec3(this._drawCardNode.getPosition());\n        let point = new Vec3(pos.x, 0,\n            0);\n        let tweenTargetVec3 = new Vec3(0, 0, 0);\n        let tw = new Tween(tweenTargetVec3)\n            .by(duration, new Vec3(0, 0, 0), {\n                onUpdate: (target: Vec3, ratio: number) => {\n                    Utils.rotate3DAroundByPositionRotaion(this._drawCardNode, pos, rotaionEuler, point, target, true)\n                }\n            })\n            .by(duration, new Vec3(-90, 0, 0), {\n                onUpdate: (target: Vec3, ratio: number) => {\n                    Utils.rotate3DAroundByPositionRotaion(this._drawCardNode, pos, rotaionEuler, point, target, true)\n                }\n            })\n            .start();\n    }\n\n\tupdateHandPositionAndName(hiden?:boolean){\n        this._mjList = this._mjList.filter(item => item !== null && item !== undefined);\n\t\tfor (let i = 0; i < this._mjList.length; i++) {\n            let handNode = this._mjList[i]\n            handNode.name = \"MJBlock\" + i;\n            handNode.getComponent(NodeCardCtr).setCardByte(PlayerMgr.getInstance().getHandCardByIndex(i));\n            this.cardAddTouchEvent(handNode);\n            handNode.setPosition(MjSize.width / 2 + MjSize.width * i, 0, 0);\n            if(hiden){\n                handNode.setRotationFromEuler(90, 0, 0);\n            }\n        }\n\t}\n    \n    playAnimOfShow() {\n        let duration = 0.3;\n        for (let i = 0; i < this._mjList.length; i++) {\n            let rotaionEuler = new Vec3(this._mjList[i].eulerAngles);\n            let pos = new Vec3(this._mjList[i].getPosition());\n            let point = new Vec3(pos.x, 0,\n                0);\n\n            let tweenTargetVec3 = new Vec3(0, 0, 0);\n            let tw = new Tween(tweenTargetVec3)\n                .by(duration, new Vec3(0, 0, 0), {\n                    onUpdate: (target: Vec3, ratio: number) => {\n                        Utils.rotate3DAroundByPositionRotaion(this._mjList[i], pos, rotaionEuler, point, target, true)\n                    }\n                })\n                .by(duration, new Vec3(-90, 0, 0), {\n                    onUpdate: (target: Vec3, ratio: number) => {\n                        Utils.rotate3DAroundByPositionRotaion(this._mjList[i], pos, rotaionEuler, point, target, true)\n                    }\n                })\n                .start();\n        }\n        if(this._drawCardNode){\n            this.showDrawCard();\n        }\n    }\n    showdownDrawCard(){\n        let duration = 0.3;\n        let rotaionEuler = new Vec3(this._drawCardNode.eulerAngles);\n        let pos = new Vec3(this._drawCardNode.getPosition());\n        let point = new Vec3(pos.x, 0,\n            0);\n        let tweenTargetVec3 = new Vec3(0, 0, 0);\n        let tw = new Tween(tweenTargetVec3)\n            .by(duration, new Vec3(-90, 0, 0), {\n                onUpdate: (target: Vec3, ratio: number) => {\n                    Utils.rotate3DAroundByPositionRotaion(this._drawCardNode, pos, rotaionEuler, point, target, true)\n                }\n            })\n            .start();\n    }\n\n    showdownCard() {\n        let duration = 0.3;\n        for (let i = 0; i < this._mjList.length; i++) {\n            let rotaionEuler = new Vec3(this._mjList[i].eulerAngles);\n            let pos = new Vec3(this._mjList[i].getPosition());\n            let point = new Vec3(pos.x, 0,\n                0);\n            let tweenTargetVec3 = new Vec3(0, 0, 0);\n            let tw = new Tween(tweenTargetVec3)\n                .by(duration, new Vec3(-90, 0, 0), {\n                    onUpdate: (target: Vec3, ratio: number) => {\n                        Utils.rotate3DAroundByPositionRotaion(this._mjList[i], pos, rotaionEuler, point, target, true)\n                    }\n                })\n                .start();\n        }\n        if(this._drawCardNode){\n            this.showdownDrawCard();\n        }\n    }\n\n    cardAddTouchEvent(handNode?:Node){\n        // handNode.off(Node.EventType.TOUCH_END);\n        handNode.off(Node.EventType.TOUCH_START);\n        handNode.on(Node.EventType.TOUCH_START, (event) => {\n            this._touchNode = event.target\n            this.touchNodePos = this._touchNode.getPosition();\n        }, this);\n        // handNode.on(Node.EventType.TOUCH_END, (event) => {\n            // this.playSelectAnim(event.target);\n        // }, this);\n    }\n\n    cancelOpcardTouch(opcard?:number){\n        this._mjList = this._mjList.filter(item => item !== null && item !== undefined);\n        let inList = false;\n\t\tfor (let i = 0; i < this._mjList.length; i++) {\n            let handNode = this._mjList[i]\n            let byte:number = handNode.getComponent(NodeCardCtr).byte;\n            if(CardUtil.getMajiangValue(byte) === CardUtil.getMajiangValue(opcard)){\n                handNode.off(Node.EventType.TOUCH_START);\n                handNode.getComponent(NodeCardCtr).setBlack(true);\n                inList = true;\n                break;\n            }\n        }\n        if(!inList && PlayerMgr.getInstance().includesMyhands(OperationResultMgr.getInstance().opCard)){\n            this._drawCardNode.off(Node.EventType.TOUCH_START);\n            this._drawCardNode.getComponent(NodeCardCtr).setBlack(true);\n        }\n         \n    }\n    updateOpcardTouch(){\n        this._mjList = this._mjList.filter(item => item !== null && item !== undefined);\n\t\tfor (let i = 0; i < this._mjList.length; i++) {\n            let handNode = this._mjList[i];\n            this.cardAddTouchEvent(handNode);\n            handNode.getComponent(NodeCardCtr).setBlack(false);\n        }  \n    }\n    \n    onTouchStart(event: EventTouch) {\n        this._isTouched = true;\n        if(this._touchNode === null){\n            return;\n        }\n        let location = event.getLocation();\n        this.startPosition = new Vec3(location.x,location.y,0)\n    }\n\n    onTouchMove(event: EventTouch) {\n        this._isTouched = true;\n        if(this._touchNode === null){\n            return;\n        }\n        let pos = this._touchNode.getPosition();\n        let location = event.getDelta();\n        Vec3.add(pos,pos,new Vec3(location.x,location.y,0));\n        this._touchNode.setPosition(pos);\n        let endPos = this._touchNode.getPosition();\n        this.moveDistance = endPos.subtract(this.touchNodePos).length();\n    }\n    onTouchEnd(event: EventTouch) {\n        if(this._touchNode === null){\n            return;\n        }\n        // if (this.moveDistance  > this.thresholdDistance && GCache.Desk.turnMe) {\n            // 出牌\n            // let byte:number = this._touchNode.getComponent(NodeCardCtr).byte;\n            // this.onSendCard(byte);\n            \n        // } else {\n            // 放回原处\n            // if(this._touchNode){\n            //     let posx = this.getSelectNodePosx(this._touchNode);\n            //     this._touchNode.setPosition(posx,0,0);\n            // }\n        // }\n        this.playSelectAnim(this._touchNode);\n        this._touchNode = null;\n        this._isTouched = false;\n        this.moveDistance = 0;\n    }\n\n    onTouchCancel(event: EventTouch) {\n        if(this._touchNode === null){\n            return;\n            \n        }\n        let posx = this.getSelectNodePosx(this._touchNode);\n        this._touchNode.setPosition(posx,0,0);\n        this._touchNode = null;\n        this._isTouched = false;\n        this.moveDistance = 0;\n    }\n\n    //将抓上来的牌打出去\n    playDrawCard( cb?: any){\n        let toOutCard = this._drawCardNode;\n        toOutCard.removeFromParent();\n        this._drawCardNode = null;        \n    }\n\tplayCardFromHandAnim(index: number,rmDraw?:boolean,cb?: any):boolean {\n\t\tthis._slotIndex = index;\n\n        let toOutCard = this._mjList[index]\n        if (Utils.isNotNull(toOutCard) && rmDraw === false){\n            this._mjList[index] = null\n            toOutCard.removeFromParent();\n            return true;\n        }else if(Utils.isNotNull(this._drawCardNode) || rmDraw === true){\n            this._drawCardNode.removeFromParent();\n            this._drawCardNode = null;   \n            return false;\n        }\n\t}\n\t\n\t//从手牌移除指定位置的一张或者多张牌，并且出牌之后，如果抓牌未移除，需要把抓的牌放到手牌中，抓牌为空\n    removeHandCard(indexList: number[], updateCard: boolean = false) {\n\t\tindexList.sort((a, b) => b - a)\n\t\t\n\t\tfor (let index of indexList) { \n            if (index < this._mjList.length) {  \n                let removeNode = this._mjList.splice(index, 1);\n                removeNode[0].removeFromParent();\n            } \n            else {\n                console.log(\"索引大于等于当前渲染手牌的数量请检查逻辑\", index)\n                return;\n            }\n        }   \n        if (updateCard)\n        {\n            this.updateHandPositionAndName()\n        }\n\n\t}\n\n\tmakeSlotAnim(index: number)\n    {\n        if (this._slotIndex == -1 || this._mjList[this._slotIndex] != null)\n        {\n            console.log(\"当前没有空的手牌位置,无法空出对应的索引位置\", this._slotIndex, index)\n\n            return;\n        }\n\n        if (this._slotIndex < index) // 2空  4\n        {\n\t\t\tfor (let i = this._slotIndex + 1; i <= index; i++)\n            {\n                let ac = new AnimationClip()\n                ac.duration = 0.2\n                let track = new animation.VectorTrack();\n                track.componentsCount = 3;\n                track.path = new animation.TrackPath().toProperty(\"position\")\n                let [x, _, z] = track.channels();\n                let mjNode = this._mjList[i];\n                let startPos = mjNode.getPosition() ;\n                let endPos = this.getHandPosition(i - 1);\n                \n                x.curve.assignSorted([\n                    [0, {value: startPos.x}],\n                    [0.2, {value: endPos.x}]\n                ])\n\n                z.curve.assignSorted([\n                    [0, {value: startPos.z}],\n                    [0.2, {value: endPos.z}]\n                ])\n\n                let animCom = mjNode.addComponent(Animation)\n                ac.addTrack(track)\n                animCom.defaultClip = ac\n                animCom.play(); \n            }\n\n            for (let i = this._slotIndex; i < index; i++)\n            {\n                this._mjList[i] = this._mjList[i + 1] // 同步平移在列表内的位置\n            }\n        }\n        else if(index < this._slotIndex) // 2  4空\n        {\n\n\t\t\tfor (let i = index; i < this._slotIndex; i++)\n            {\n                let ac = new AnimationClip() \n                ac.duration = 0.2\n                let track = new animation.VectorTrack();\n                track.componentsCount = 3;\n                track.path = new animation.TrackPath().toProperty(\"position\")\n                let [x, _, z] = track.channels();\n                let mjNode = this._mjList[i];\n                let startPos = mjNode.getPosition() ;\n                let endPos = this.getHandPosition(i + 1);\n\n                x.curve.assignSorted([\n                    [0, {value: startPos.x}], \n                    [0.2, {value: endPos.x}]\n                ])\n\n                z.curve.assignSorted([\n                    [0, {value: startPos.z}],\n                    [0.2, {value: endPos.z}]\n                ])\n\n                let animCom = mjNode.addComponent(Animation)\n                ac.addTrack(track)\n                animCom.defaultClip = ac\n                animCom.play(); \n            }\n\n            for (let i = this._slotIndex; i > index; i--)\n            {\n                this._mjList[i] = this._mjList[i - 1] // 同步平移在列表内的位置\n            }\n        }  \n        this._mjList[index] = null //平移后空出来的列表位置\n        this._slotIndex = index\n    }\n\n\t\n\tdrawCardToSlot(cb?: any){\n\t\tif (this._drawCardNode == null)\n        {\n            console.log(\"没有渲染抽牌节点, 抽牌到手牌动画失败\")\n            return;\n        }\n\n\t\tthis._mjList[this._slotIndex] = this._drawCardNode\n        this._drawCardNode = null\n        let startPos = this._mjList[this._slotIndex].getPosition()\n        let endPos = this.getHandPosition(this._slotIndex)\n\n        const ac = new AnimationClip();  \n\n        ac.duration = 0.5\n        \n        const track = new animation.VectorTrack();\n        track.componentsCount = 3;\n        track.path = new animation.TrackPath().toProperty(\"position\")\n        const [posx, posy, posz] = (track as animation.VectorTrack).channels();\n        posx.curve.assignSorted([\n            [0, {easingMethod : 2, value: startPos.x}], \n            [0.1, {easingMethod : 2, value: startPos.x}], \n            [0.4, {easingMethod : 2, value: endPos.x}],\n            [0.5, {easingMethod : 2, value: endPos.x}]\n        ]);\n        posy.curve.assignSorted([\n            [0, {easingMethod : 2, value: startPos.y}], \n            [0.1, {easingMethod : 2, value: startPos.y + 20}], \n            [0.4, {easingMethod : 2, value: startPos.y + 20}], \n            [0.5, {easingMethod : 2, value: endPos.y}]\n        ]);\n        posz.curve.assignSorted([\n            [0, {easingMethod : 2, value: startPos.z}], \n            [0.1, {easingMethod : 2, value: startPos.z - 3.5}], \n            [0.4,{easingMethod : 2, value:  startPos.z - 3.5}],\n            [0.5,{easingMethod : 2, value:  endPos.z}]\n        ]);\n\n        let animCom: Animation;\n\n        if (this._mjList[this._slotIndex].getComponent(Animation) == null)\n        {\n            animCom = this._mjList[this._slotIndex].addComponent(Animation)\n        }\n        else\n        {\n            animCom = this._mjList[this._slotIndex].getComponent(Animation)\n            animCom.removeAll(Animation.EventType.FINISHED)\n        }\n\n        if(cb)\n        {\n            animCom.on(Animation.EventType.FINISHED, cb, this)\n            this._playHandCardCb = cb\n        }\n\n        ac.addTrack(track)\n\n        animCom.defaultClip = ac\n\n        animCom.play()\n\t\t\n\t}\n\n\n\tgetListBytes():number[]{\n\t\tlet bytes:number[] = [];\n\t\tfor (let i = 0; i < this._mjList.length; i++) {\n\t\t\tlet node_byte: number = this._mjList[i].getComponent(NodeCardCtr).byte;\n\t\t\tbytes.push(node_byte);\n\t\t}\n\t\treturn bytes;\n\t}\n\n\tuseByteFindIndexs(bytes:number[]):number[]{\n\t\tlet indexs:number[] = [];\n\n\t\tbytes.forEach((byte) => {\n\t\t\tfor (let i = 0; i < this._mjList.length; i++) {\n\t\t\t\tlet node_byte: number = this._mjList[i].getComponent(NodeCardCtr).byte;\n\t\t\t\tif(byte === node_byte){\n\t\t\t\t\tindexs.push(i);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\treturn indexs;\n\t}\n\n\tgetNodeIndex(node: Node)\n    {\n        return this._mjList.findIndex(theNode => theNode == node, this);\n    }\n\n\taddHandCards(valueList: number[], active: boolean, stackCount?: number, hasDrawCard: boolean = false)\n    {\n\t\tlet handCardCount =  valueList.length;\n        \n        if (hasDrawCard)\n        {\n            handCardCount = valueList.length - 1\n        }\n\n\t\tfor (let i = 0; i < handCardCount; i++)\n        { \n\t\t\tlet mjNode = instantiate(this.nodeCardTemplate)\n\t\t\tlet cardValue = valueList[i]\n\t\t\tmjNode.getComponent(NodeCardCtr).setCardByte(cardValue);\n\t\t\tmjNode.active = true;\n\t\t\tthis._mjList.push(mjNode);\n\t\t\tthis.node.addChild(mjNode);\n\t\t}\n\t\tthis.updateHandPositionAndName(true);\n\t\tif (hasDrawCard)\n        {\n            this.drawCard(valueList[handCardCount],true)\n            this._drawCardNode.active = active\n        }\n\n\t}\n\n\tgetHandPosition(index: number){\n\t\treturn new Vec3(MjSize.width / 2 + MjSize.width * index, 0, 0)\n\t}\n\n    getHandPositionX(index: number){\n\t\treturn MjSize.width / 2 + MjSize.width * index\n\t}\n\t\n    getLastPosition():number{\n\t\treturn MjSize.width / 2 + MjSize.width * (this._mjList.length - 1);\n\t}\n\n    getSelectNodePosx(node: Node):number{\n        let posx = 0;\n        if(node.name && node.name.includes(\"MJBlock\")){\n            posx = this.getHandPositionX(parseInt(node.name.replace(\"MJBlock\", \"\")));\n        }else{\n            posx =  this.getLastPosition() + drawCardDisRatio * MjSize.width;\n            // posx =  this._drawCardNode.getPosition().x\n        }\n        return posx;\n    }\n\n\tplaySelectAnim(node: Node){\n\t\tif(this.selectedNode){\n\t\t\tthis.playUnselectAnim(this.selectedNode);\n\t\t\tif(this.selectedNode == node){\n                if(GCache.Desk.turnMe){\n                    let byte:number = this.selectedNode.getComponent(NodeCardCtr).byte;\n                    this.onSendCard(byte);\n                }\n\t\t\t\tthis.selectedNode = null;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.selectedNode = node\n        console.log(this.selectedNode,node)\n        let posx = this.getSelectNodePosx(this.selectedNode);\n        \n        const ac = new AnimationClip();  \n\n        ac.duration = 0.1\n\n        const trackPos = new animation.VectorTrack();\n        trackPos.componentsCount = 3;\n        trackPos.path = new animation.TrackPath().toProperty(\"position\")\n        const [x, y, z] = (trackPos as animation.VectorTrack).channels();\n        x.curve.assignSorted([\n            [0, {easingMethod : 2, value: posx}], \n            [0.1, {easingMethod : 2, value: posx}]\n        ]);\n        y.curve.assignSorted([\n            [0, {easingMethod : 2, value: 0}], \n            [0.1, {easingMethod : 2, value: 20}]\n        ]);\n        // z.curve.assignSorted([\n        //     [0, {easingMethod : 2, value: startPos.z}], \n        //     [0.1,{easingMethod : 2, value:  startPos.z - 0.8}]\n        // ]);\n\n        let animCom: Animation;\n\n        if (this.selectedNode.getComponent(Animation) == null)\n        {\n            animCom = this.selectedNode.addComponent(Animation)\n        }\n        else\n        {\n            animCom = this.selectedNode.getComponent(Animation)\n            animCom.removeAll(Animation.EventType.FINISHED)\n            \n            \n        }\n        EventManager.dispatch(FXJEvent.SYS_PLAY_EFFECT, FXJSound.GameTiPai);\n        ac.addTrack(trackPos)\n\n        animCom.defaultClip = ac\n\n        animCom.play()\n\t}\n\tplayUnselectAnim(node: Node){\n        let startPos = this.selectedNode.getPosition()\n\t\tconst ac = new AnimationClip();  \n\n        ac.duration = 0.1 \n        let posx = this.getSelectNodePosx(this.selectedNode);\n        const trackPos = new animation.VectorTrack();\n        trackPos.componentsCount = 3;\n        trackPos.path = new animation.TrackPath().toProperty(\"position\")\n        const [x, y, z] = (trackPos as animation.VectorTrack).channels();\n        x.curve.assignSorted([\n            [0, {easingMethod : 2, value: posx}], \n            [0.1, {easingMethod : 2, value: posx}]\n        ]);\n        y.curve.assignSorted([\n            [0, {easingMethod : 2, value: 20}], \n            [0.1, {easingMethod : 2, value: 0}]\n        ]);\n        // z.curve.assignSorted([ \n        //     [0, {easingMethod : 2, value: startPos.z}], \n        //     [0.1,{easingMethod : 2, value:  startPos.z + 0.8}]\n        // ]); \n\n        let animCom: Animation;\n\n        if (node.getComponent(Animation) == null)\n        {\n            animCom = node.addComponent(Animation)\n        }\n        else\n        {\n            animCom = node.getComponent(Animation)\n            animCom.removeAll(Animation.EventType.FINISHED)\n        }\n\n        ac.addTrack(trackPos)\n\n        animCom.defaultClip = ac\n\n        animCom.play()\n\t}\n\n\t//出牌\n\tonSendCard(byte:number){\n\t\tlet index:number = OperationMgr.getInstance().getSendCardIndex(byte);\n        let req: Game.ISendOperation = {\n            opCard:byte,\n\t\t\topCode:OPCode.OPE_OUT_CARD,\n\t\t\topCards:[byte],\n\t\t\tseatId:OperationMgr.getInstance().seatId,\n\t\t\tuserId:OperationMgr.getInstance().userId\n            \n        }\n        EventManager.dispatch(GameEvent.SEND_PLAYER_OPERATION, req);\n\t}\n\n\t//游戏开始或结束，清空手牌区，包括抓牌，保持初始状态\n    resetView() {\n        this.node.removeAllChildren();\n        this._mjList = [];\n        this._drawCardNode = null;\n        // this.initNodePos();\n    }\n}\n\n"]}