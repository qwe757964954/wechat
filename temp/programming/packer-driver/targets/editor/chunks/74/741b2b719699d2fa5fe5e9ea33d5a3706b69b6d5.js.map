{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/cache/PropsConf.ts"],"names":["PropsConf","StoreKey","LocalStorage","Utils","Encrypt","HttpRequest","BaseCache","constructor","superClass","__User","_PropsUrlConf","_BaseProps","_UnionProps","setPropsBaseUrlConf","conf","console","log","getPropsBaseUrlConf","downloadAndSavePropsConf","url","key","keyArr","PROPS_BASE_CONF","PROPS_UNION_CONF","flag","indexOf","string_isEmpty","http","self","complete","response","jsonStr","get","oldTime","oldConf","JsonDecode","number_valueOf","GoodsBase","timestamp","obj","table_isEmpty","set","error","getIconPre","getPropsConfTime","time","getBaseProps","str","getUnionProps","getPropsInfoById","id","baseProps","baseConf","Object","prototype","hasOwnProperty","call","info","iconpre","pre","unionProps","unionConf"],"mappings":";;;8FAQaA,S;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AARJC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,K,iBAAAA,K;;AACAC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,S,iBAAAA,S;;;;;;;2BAGIN,S,GAAN,MAAMA,SAAN;AAAA;AAAA,kCAAkC;AAErC;;AAGA;;AAGA;;AAGA;AAGH;AACAO,QAAAA,WAAW,CAACC,UAAD,EAAa;AACvB,gBAAM,WAAN;AADuB,eAZbC,MAYa,GAZE,IAYF;AAAA,eATbC,aASa,GATG,EASH;AAAA,eANbC,UAMa,GANA,EAMA;AAAA,eAHbC,WAGa,GAHC,EAGD;AAEvB,eAAKH,MAAL,GAAcD,UAAd;AACG;;AAED;AACJ;AACA;AACA;AACCK,QAAAA,mBAAmB,CAACC,IAAD,EAAO;AACzBC,UAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAoBF,IAApB;AACA,eAAKJ,aAAL,GAAqBI,IAArB;AACA;AAED;AACD;AACA;AACA;;;AACCG,QAAAA,mBAAmB,GAAG;AACrB,iBAAO,KAAKP,aAAZ;AACA;AAED;AACD;AACA;AACA;AACA;AACA;;;AACIQ,QAAAA,wBAAwB,CAACC,GAAD,EAAcC,GAAd,EAA2B;AACrDL,UAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAwBI,GAAxB;AACA,cAAIC,MAAM,GAAC,CAAC;AAAA;AAAA,oCAASC,eAAV,EAA0B;AAAA;AAAA,oCAASC,gBAAnC,CAAX;AACA,cAAIC,IAAI,GAACH,MAAM,CAACI,OAAP,CAAeL,GAAf,CAAT;;AACA,cAAII,IAAI,IAAE,CAAC,CAAP,IAAY;AAAA;AAAA,8BAAME,cAAN,CAAqBN,GAArB,CAAhB,EAA2C;AAC1C;AACM;;AACD,cAAIO,IAAI,GAAG;AAAA;AAAA,2CAAX;AACA,cAAIC,IAAI,GAAG,IAAX;;AACN,cAAIC,QAAQ,GAAG,UAAUC,QAAV,EAAoB;AAClCf,YAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ,EAAgCI,GAAhC;;AACA,gBAAIU,QAAJ,EAAc;AACb,kBAAIC,OAAO,GAAG;AAAA;AAAA,gDAAaC,GAAb,CAAiBZ,GAAjB,EAAsB,EAAtB,CAAd;AACA,kBAAIa,OAAO,GAAG,CAAd;;AACA,kBAAI,CAAC;AAAA;AAAA,kCAAMP,cAAN,CAAqBK,OAArB,CAAL,EAAoC;AACnC,oBAAIG,OAAO,GAAG;AAAA;AAAA,wCAAQC,UAAR,CAAmBJ,OAAnB,CAAd;AACAE,gBAAAA,OAAO,GAAG;AAAA;AAAA,oCAAMG,cAAN,CAAqBF,OAAO,CAACG,SAAR,CAAkBC,SAAvC,EAAkD,CAAlD,CAAV;AACA;;AACD,kBAAIC,GAAG,GAAG;AAAA;AAAA,sCAAQJ,UAAR,CAAmBL,QAAnB,CAAV;;AACA,kBAAI;AAAA;AAAA,kCAAMU,aAAN,CAAoBD,GAApB,CAAJ,EAA8B;AAC7B;AACA;;AACD,kBAAID,SAAS,GAAG;AAAA;AAAA,kCAAMF,cAAN,CAAqBG,GAAG,CAACF,SAAJ,CAAcC,SAAnC,EAA8C,CAA9C,CAAhB;;AACY,kBAAIA,SAAS,GAAG,CAAZ,IAAiBA,SAAS,GAAGL,OAAjC,EAA0C;AACtC;AAAA;AAAA,kDAAaQ,GAAb,CAAiBrB,GAAjB,EAAsBU,QAAtB;;AACA,oBAAIV,GAAG,IAAI;AAAA;AAAA,0CAASE,eAApB,EAAqC;AACjCM,kBAAAA,IAAI,CAACjB,UAAL,GAAkB4B,GAAlB;AACH,iBAFD,MAEO,IAAInB,GAAG,IAAI;AAAA;AAAA,0CAASG,gBAApB,EAAsC;AACzCK,kBAAAA,IAAI,CAAChB,WAAL,GAAmB2B,GAAnB;AACH;AAChB;AACD;AACK,WAvBP;;AAwBM,cAAIG,KAAK,GAAG,UAASZ,QAAT,EAAkB;AACnCf,YAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8Bc,QAA9B,EAAuCV,GAAvC;AACM,WAFD;;AAGNO,UAAAA,IAAI,CAACK,GAAL,CAASb,GAAT,EAAcU,QAAd,EAAwBa,KAAxB;AACA;AAED;AACD;AACA;AACA;;;AACCC,QAAAA,UAAU,GAAG;AACZ,cAAIxB,GAAG,GAAG,KAAKT,aAAL,CAAmB,UAAnB,CAAV;AACA,iBAAOS,GAAP;AACA;AAED;AACD;AACA;AACA;;;AACCyB,QAAAA,gBAAgB,CAACxB,GAAD,EAAc;AAC7BL,UAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACA,cAAIK,MAAM,GAAC,CAAC;AAAA;AAAA,oCAASC,eAAV,EAA0B;AAAA;AAAA,oCAASC,gBAAnC,CAAX;AACA,cAAIC,IAAI,GAAGH,MAAM,CAACI,OAAP,CAAeL,GAAf,CAAX;AACA,cAAIyB,IAAI,GAAG,CAAX;;AACA,cAAIrB,IAAI,IAAE,CAAC,CAAX,EAAc;AACb,gBAAIO,OAAO,GAAG;AAAA;AAAA,8CAAaC,GAAb,CAAiBZ,GAAjB,EAAsB,EAAtB,CAAd;AACA,gBAAIN,IAAI,GAAG;AAAA;AAAA,oCAAQqB,UAAR,CAAmBJ,OAAnB,CAAX;;AACA,gBAAI,CAAC;AAAA;AAAA,gCAAMS,aAAN,CAAoB1B,IAApB,CAAL,EAAgC;AAC/B+B,cAAAA,IAAI,GAAG;AAAA;AAAA,kCAAMT,cAAN,CAAqBtB,IAAI,CAACuB,SAAL,CAAeC,SAApC,EAA+C,CAA/C,CAAP;AACA;AACD;;AACD,iBAAOO,IAAP;AACA;AAGD;AACD;AACA;AACA;;;AACIC,QAAAA,YAAY,GAAG;AACX,cAAK;AAAA;AAAA,8BAAMN,aAAN,CAAoB,KAAK7B,UAAzB,CAAL,EAA2C;AACvCI,YAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ;AACA,gBAAI+B,GAAG,GAAG;AAAA;AAAA,8CAAaf,GAAb,CAAiB;AAAA;AAAA,sCAASV,eAA1B,CAAV;AACA,gBAAIiB,GAAG,GAAG;AAAA;AAAA,oCAAQJ,UAAR,CAAmBY,GAAnB,CAAV;AACA,iBAAKpC,UAAL,GAAgB4B,GAAhB;AACH;;AACD,iBAAO,KAAK5B,UAAZ;AAEN;AAEE;AACJ;AACA;AACA;;;AACIqC,QAAAA,aAAa,GAAG;AACZ,cAAI;AAAA;AAAA,8BAAMR,aAAN,CAAoB,KAAK5B,WAAzB,CAAJ,EAA2C;AACvC,gBAAImC,GAAG,GAAG;AAAA;AAAA,8CAAaf,GAAb,CAAiB;AAAA;AAAA,sCAAST,gBAA1B,CAAV;AACA,gBAAIgB,GAAG,GAAG;AAAA;AAAA,oCAAQJ,UAAR,CAAmBY,GAAnB,CAAV;AACA,iBAAKnC,WAAL,GAAmB2B,GAAnB;AACH;;AACD,iBAAO,KAAK3B,WAAZ;AACH;AAID;AACJ;AACA;AACA;AACA;;;AACCqC,QAAAA,gBAAgB,CAACC,EAAD,EAAK;AACpB;AACAA,UAAAA,EAAE,GAAG;AAAA;AAAA,8BAAMd,cAAN,CAAqBc,EAArB,CAAL;AACM,cAAIC,SAAS,GAAG,KAAKL,YAAL,EAAhB;AACA,cAAIM,QAAQ,GAAGD,SAAS,CAAC,WAAD,CAAT,CAAuB,MAAvB,CAAf;;AACN,cAAIE,MAAM,CAACC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCJ,QAArC,EAA8CF,EAA9C,CAAJ,EAAuD;AACtD,gBAAIO,IAAI,GAAGL,QAAQ,CAACF,EAAD,CAAnB;AACA,gBAAIQ,OAAO,GAAG,KAAKf,UAAL,EAAd;AACA,gBAAIgB,GAAG,GAAGT,EAAE,GAAG,EAAf;AACA,gBAAI/B,GAAG,GAAGuC,OAAO,GAAGC,GAAV,GAAgB,GAAhB,GAAsBT,EAAtB,GAA2B,SAA3B,GAAuCO,IAAI,CAACnB,SAAtD;AACAmB,YAAAA,IAAI,CAACtC,GAAL,GAASA,GAAT;AACA,mBAAOsC,IAAP;AACA;;AACK,cAAIG,UAAU,GAAG,KAAKZ,aAAL,EAAjB;AACA,cAAIa,SAAS,GAAGD,UAAU,CAAC,WAAD,CAAV,CAAwB,MAAxB,CAAhB;;AACN,cAAIP,MAAM,CAACC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCK,SAArC,EAA+CX,EAA/C,CAAJ,EAAwD;AACvD,gBAAIO,IAAI,GAAGL,QAAQ,CAACF,EAAD,CAAnB;AACA,gBAAIQ,OAAO,GAAG,KAAKf,UAAL,EAAd;AACA,gBAAIgB,GAAG,GAAGT,EAAE,GAAG,EAAf;AACA,gBAAI/B,GAAG,GAAGuC,OAAO,GAAGC,GAAV,GAAgB,GAAhB,GAAsBT,EAAtB,GAA2B,KAA3B,GAAmCO,IAAI,CAACnB,SAAlD;AACAmB,YAAAA,IAAI,CAACtC,GAAL,GAASA,GAAT;AACA,mBAAOsC,IAAP;AACA;;AACD,iBAAO,EAAP;AACG;;AA1KoC,O","sourcesContent":["import { StoreKey } from \"../config/GameConstant\";\nimport { LocalStorage } from \"../framework/LocalStorage\";\nimport { Utils } from \"../framework/Utils\";\nimport { Encrypt } from \"../framework/crypto/Encrypto\";\nimport { HttpRequest } from \"../framework/network/HttpRequest\";\nimport { BaseCache } from \"../framework/vc/BaseCache\";\nimport { User } from \"./User\";\n\nexport class PropsConf extends BaseCache {\n    \n    /** 用户类 */\n    private __User: User = null;\n    \n    /** 物品图片相关配置 */\n    private _PropsUrlConf = {};\n    \n    /** 基本道具配置 */\n    private _BaseProps = {};\n    \n    /** 额外道具配置 */\n    private _UnionProps = {};\n\t\n\t//实例化\n\tconstructor(superClass) {\n\t\tsuper(\"PropsConf\");\n\t\tthis.__User = superClass;\n    };\n\n    /**\n\t * 设置图片相关配置\n\t * @param conf \n\t */\n\tsetPropsBaseUrlConf(conf) {\t\t\n\t\tconsole.log(\"打印相关:\",conf)\n\t\tthis._PropsUrlConf = conf;\n\t}\n    \n\t/**\n\t * 获取图片相关配置\n\t * @returns \n\t */\n\tgetPropsBaseUrlConf() {\n\t\treturn this._PropsUrlConf;\n\t}\n\t\n\t/**\n\t * 下载配置并保存到本地\n\t * @param url \n\t * @param key \n\t * @returns \n\t */\n    downloadAndSavePropsConf(url: string, key: string) {\n\t\tconsole.log(\"测试加载图片配置:\",key)\t\n\t\tlet keyArr=[StoreKey.PROPS_BASE_CONF,StoreKey.PROPS_UNION_CONF]\n\t\tlet flag=keyArr.indexOf(key)\n\t\tif (flag==-1 || Utils.string_isEmpty(key)) {\n\t\t\treturn;\n        }\n        let http = new HttpRequest();\n        let self = this;\n\t\tlet complete = function (response) {\n\t\t\tconsole.log(\"http get complete\",key)\n\t\t\tif (response) {\n\t\t\t\tlet jsonStr = LocalStorage.get(key, '');\n\t\t\t\tlet oldTime = 0;\n\t\t\t\tif (!Utils.string_isEmpty(jsonStr)) {\n\t\t\t\t\tlet oldConf = Encrypt.JsonDecode(jsonStr)\n\t\t\t\t\toldTime = Utils.number_valueOf(oldConf.GoodsBase.timestamp, 0)\n\t\t\t\t} \n\t\t\t\tlet obj = Encrypt.JsonDecode(response);\n\t\t\t\tif (Utils.table_isEmpty(obj)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet timestamp = Utils.number_valueOf(obj.GoodsBase.timestamp, 0);\n                if (timestamp > 0 && timestamp > oldTime) {\n                    LocalStorage.set(key, response);\n                    if (key == StoreKey.PROPS_BASE_CONF) {\n                        self._BaseProps = obj;\n                    } else if (key == StoreKey.PROPS_UNION_CONF) {\n                        self._UnionProps = obj;\n                    }\n\t\t\t\t}\n\t\t\t}\n        }\n        let error = function(response){\n\t\t\tconsole.log(\"http get error\", response,key);\n        }\t\n\t\thttp.get(url, complete, error);\n\t}\n\n\t/**\n     * 获取图片域名\n     * @returns \n     */\n\tgetIconPre() {\n\t\tlet url = this._PropsUrlConf[\"icon_pre\"];\n\t\treturn url;\n\t}\n\n\t/**\n\t * 获取最近拉取的时间戳\n\t * @returns \n\t */\n\tgetPropsConfTime(key: string) {\n\t\tconsole.log(\"测试加载图片配置时间\")\t\n\t\tlet keyArr=[StoreKey.PROPS_BASE_CONF,StoreKey.PROPS_UNION_CONF]\n\t\tlet flag = keyArr.indexOf(key)\n\t\tlet time = 0;\t\n\t\tif (flag!=-1) {\n\t\t\tlet jsonStr = LocalStorage.get(key, '')\n\t\t\tlet conf = Encrypt.JsonDecode(jsonStr)\n\t\t\tif (!Utils.table_isEmpty(conf)) {\n\t\t\t\ttime = Utils.number_valueOf(conf.GoodsBase.timestamp, 0)\n\t\t\t}\t\t\n\t\t}\n\t\treturn time;\n\t}\n\n    \n\t/**\n     * 获取基本道具配置\n     * @returns \n     */\n    getBaseProps() {\n        if ( Utils.table_isEmpty(this._BaseProps)) {\n            console.log(\"走缓存\")\n            let str = LocalStorage.get(StoreKey.PROPS_BASE_CONF);\n            let obj = Encrypt.JsonDecode(str);\n            this._BaseProps=obj\n        }\n        return this._BaseProps;\n\t\t\n\t}\n\n    /**\n     * 获取额外道具配置\n     * @returns \n     */\n    getUnionProps() {\n        if (Utils.table_isEmpty(this._UnionProps)) {\n            let str = LocalStorage.get(StoreKey.PROPS_UNION_CONF);\n            let obj = Encrypt.JsonDecode(str);\n            this._UnionProps = obj;\n        }\n        return this._UnionProps;\n    }\n    \n\t\n\t\n    /**\n     * 获取道具信息\n     * @param id 道具ID\n     * @returns \n     */\n\tgetPropsInfoById(id) {\n\t\t//https://dfqppic.266.com/dfqp/images/goods/dev/0/0.png\n\t\tid = Utils.number_valueOf(id)\n        let baseProps = this.getBaseProps();\n        let baseConf = baseProps['GoodsBase']['list'];\n\t\tif (Object.prototype.hasOwnProperty.call(baseConf,id)) {\n\t\t\tlet info = baseConf[id];\n\t\t\tlet iconpre = this.getIconPre();\n\t\t\tlet pre = id % 10\n\t\t\tlet url = iconpre + pre + '/' + id + '.png?v=' + info.timestamp\n\t\t\tinfo.url=url\n\t\t\treturn info;\n\t\t}\n        let unionProps = this.getUnionProps();\n        let unionConf = unionProps['GoodsBase']['list'];\n\t\tif (Object.prototype.hasOwnProperty.call(unionConf,id)) {\n\t\t\tlet info = baseConf[id];\n\t\t\tlet iconpre = this.getIconPre();\n\t\t\tlet pre = id % 10\n\t\t\tlet url = iconpre + pre + '/' + id + '?v=' + info.timestamp\n\t\t\tinfo.url=url\n\t\t\treturn info;\n\t\t}\n\t\treturn {}\n    }\n    \n    \n}"]}