{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/framework/gui/scrollview/SuperScrollView.ts"],"names":["EventHandler","EventTouch","Node","PageView","ScrollView","Vec2","Vec3","_decorator","SuperLayout","ccclass","property","menu","quintEaseOut","time","EPSILON","OUT_OF_BOUNDARY_BREAKING_FACTOR","_tempVec2","ScrollViewDirection","SuperScrollView","tooltip","displayName","visible","pullRefresh","type","direction","NONE","prevLocation","location","_touchBeganPosition","_touchEndPosition","isMoveHeader","isMoveFooter","isLockHeader","isLockFooter","headerProgress","footerProgress","isCustomScroll","canTouchMove","isCallSoonFinish","autoScrolling","value","_autoScrolling","onLoad","layout","autoCenter","brake","onEnable","node","on","EventType","SCROLL_ENG_WITH_THRESHOLD","dispatchPageTurningEvent","onDisable","off","_layout","content","getComponent","curPageIdx","getPages","Array","itemTotal","_getContentTopBoundary","_content","offset","isOfTopBoundary","_topBoundary","_getContentBottomBoundary","isOfButtomBoundary","_bottomBoundary","_getContentLeftBoundary","isOfLeftBoundary","_leftBoundary","_getContentRightBoundary","isOfRightBoundary","_rightBoundary","_onTouchBegan","event","captureListeners","isPageView","touch","getUILocation","set","x","y","isTransmitEvent","transmitEvent","TOUCH_START","_onTouchMoved","start","getStartLocation","curre","getLocation","xOffset","Math","abs","yOffset","HORIZONTAL","VERTICAL","canTransmit","vertical","horizontal","TOUCH_MOVE","getPreviousLocation","outOfBoundary","_getHowMuchOutOfBoundary","headerOutOffset","headerMultiple","emitEvents","headerEvents","action","progress","stage","footerEvents","footerOutOffset","footerMultiple","clearProgress","_onTouchEnded","TOUCH_END","_onTouchCancelled","TOUCH_CANCEL","scrollToAny","moveDelta","timeInSecond","attenuated","_startAutoScroll","_moveContent","release","startAutoScroll","_outOfBoundaryAmountDirty","deltaMove","flag","touchMoveVelocity","_calculateTouchMoveVelocity","isQuicklyScrollable","soonFinish","_updateScrollBar","_autoScrollBraking","max","pageEvents","PAGE_TURNING","emit","console","log","_handleReleaseLogic","_autoScrollToPage","_scrolling","_dispatchEvent","SCROLL_ENDED","bounceBackStarted","_startBounceBackIfNeeded","bounceBackAmount","_clampDelta","horizontalAxisDirection","HorizontalAxisDirection","LEFT_TO_RIGHT","verticalAxisDirection","VerticalAxisDirection","TOP_TO_BOTTOM","indicator","_changedState","moveOffset","subtract","index","nextIndex","getDragDirection","pageTurningSpeed","footerLoop","headerLoop","count","isScrollable","scrollToPage","savePageIndex","idx","scrollToIndex","autoPageTurningThreshold","groupItemTotal","viewTrans","view","width","scrollThreshold","height","eventType","e","getTouches","bubbles","target","parent","dispatchEvent","_processAutoScrolling","dt","isAutoScrollBrake","_isNecessaryAutoScrollBrake","brakingFactor","_autoScrollAccumulatedTime","percentage","min","_autoScrollTotalTime","_autoScrollAttenuate","clonedAutoScrollTargetDelta","_autoScrollTargetDelta","clone","multiplyScalar","clonedAutoScrollStartPosition","_autoScrollStartPosition","add","reachedEnd","fireEvent","getScrollEndedEventTiming","_isScrollEndedWithThresholdEventFired","elastic","brakeOffsetPosition","_autoScrollBrakingStartPosition","getContentPosition","equals","ZERO","_isBouncing"],"mappings":"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","sourcesContent":["\nimport { EventHandler, EventTouch, Node, PageView, ScrollView, Vec2, Vec3, _decorator } from 'cc';\nimport { SuperLayout } from './SuperLayout';\nconst { ccclass, property, menu } = _decorator;\n\n\nconst quintEaseOut = (time: number) => {\n    time -= 1;\n    return (time * time * time * time * time + 1)\n};\nconst EPSILON = 1e-4\nconst OUT_OF_BOUNDARY_BREAKING_FACTOR = 0.015\nconst _tempVec2 = new Vec2()\nexport enum ScrollViewDirection {\n    HORIZONTAL,\n    VERTICAL,\n    NONE,\n}\n\n/**\n * Name = SuperScrollView\n * URL = db://assets/framework/gui/scrollview/SuperScrollView.ts\n * Time = Mon Feb 27 2023 09:54:35 GMT+0800 (中国标准时间)\n * Author = xueya\n *\n * Life: onLoad-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n */\n\n@ccclass('SuperScrollView')\n//方便编辑器识别的菜单项目\n@menu('gui/scrollview/SuperScrollView')\nexport class SuperScrollView extends ScrollView {\n    private direction: ScrollViewDirection = ScrollViewDirection.NONE\n    private _layout!: SuperLayout\n    @property({\n        tooltip: \"注意！向上传递事件只会发送当前滑动相反方向,如果开启horizontal则会发送vertical事件。如果开启vertical则会发送horizontal事件。同时开启horizontal和vertical 不会发送任何事件\"\n    }) isTransmitEvent: boolean = false\n    @property pullRefresh: boolean = false\n    @property({\n        displayName: \"顶部偏移量\",\n        tooltip: \"下拉时超过此偏移会发送下拉事件\",\n        visible: function () { return (this as any).pullRefresh }\n    }) headerOutOffset: number = 200\n    @property({\n        displayName: \"满足触发Header的倍数\",\n        visible: function () { return (this as any).pullRefresh }\n    }) headerMultiple: number = 2\n    @property({\n        displayName: \"底部偏移量\",\n        tooltip: \"上拉时超过此偏移会发送上拉事件\",\n        visible: function () { return (this as any).pullRefresh }\n    }) footerOutOffset: number = 200\n    @property({\n        displayName: \"满足触发Footer的倍数\",\n        visible: function () { return (this as any).pullRefresh }\n    }) footerMultiple: number = 2\n    @property({\n        type: EventHandler,\n        visible: function () { return (this as any).pullRefresh }\n    }) headerEvents: EventHandler[] = []\n    @property({\n        type: EventHandler,\n        visible: function () { return (this as any).pullRefresh }\n    }) footerEvents: EventHandler[] = []\n    prevLocation: Vec2 = new Vec2()\n    location: Vec2 = new Vec2()\n    set autoScrolling(value: boolean) { this._autoScrolling = value }\n    private _touchBeganPosition = new Vec2()\n    private _touchEndPosition = new Vec2()\n    private isMoveHeader: boolean = false\n    private isMoveFooter: boolean = false\n    private isLockHeader: boolean = false\n    private isLockFooter: boolean = false\n    private headerProgress: number = 0\n    private footerProgress: number = 0\n    private isCustomScroll: boolean = false\n    canTouchMove: boolean = true\n    onLoad() {\n        if (this.layout.autoCenter) {\n            this.brake = 0.7\n        }\n    }\n    public onEnable() {\n        super.onEnable()\n        this.node.on(PageView.EventType.SCROLL_ENG_WITH_THRESHOLD, this.dispatchPageTurningEvent, this)\n    }\n    public onDisable() {\n        super.onDisable()\n        this.node.off(PageView.EventType.SCROLL_ENG_WITH_THRESHOLD, this.dispatchPageTurningEvent, this)\n    }\n    get layout() {\n        if (!this._layout) { this._layout = this.content?.getComponent(SuperLayout)! }\n        return this._layout\n    }\n    private isCallSoonFinish: boolean = false\n    get curPageIdx() {\n        return this.layout[\"_currPageIndex\"]\n    }\n    getPages() {\n        return new Array(this.layout.itemTotal)\n    }\n    protected _getContentTopBoundary() {\n        if (!this._content) {\n            return -1\n        }\n        let offset = this.layout.isOfTopBoundary == 0 ? this._topBoundary : this.layout.isOfTopBoundary\n        return offset\n    }\n    protected _getContentBottomBoundary() {\n        if (!this._content) {\n            return -1\n        }\n        let offset = this.layout.isOfButtomBoundary == 0 ? this._bottomBoundary : this.layout.isOfButtomBoundary\n        return offset\n    }\n    protected _getContentLeftBoundary() {\n        if (!this._content) {\n            return -1\n        }\n        let offset = this.layout.isOfLeftBoundary == 0 ? this._leftBoundary : this.layout.isOfLeftBoundary\n        return offset\n    }\n    protected _getContentRightBoundary() {\n        if (!this._content) {\n            return -1\n        }\n        let offset = this.layout.isOfRightBoundary == 0 ? this._rightBoundary : this.layout.isOfRightBoundary\n        return offset\n    }\n    protected _onTouchBegan(event: EventTouch, captureListeners?: Node[]) {\n        this.isCallSoonFinish = false\n        this.isCustomScroll = false\n        this.layout[\"onTouchBegin\"]()\n        if (!this.canTouchMove) return\n        this.direction = ScrollViewDirection.NONE\n        if (this.layout.isPageView) {\n            event.touch!.getUILocation(_tempVec2)\n            Vec2.set(this._touchBeganPosition, _tempVec2.x, _tempVec2.y)\n        }\n        super._onTouchBegan(event, captureListeners)\n        if (this.isTransmitEvent) {\n            this.transmitEvent(event, Node.EventType.TOUCH_START)\n        }\n    }\n    protected _onTouchMoved(event: EventTouch, captureListeners: any) {\n        this.isCallSoonFinish = false\n        this.isCustomScroll = false\n        if (!this.canTouchMove) return\n        if (this.isTransmitEvent) {\n            if (this.direction == ScrollViewDirection.NONE) {\n                var start = event.getStartLocation()\n                var curre = event.getLocation()\n                var xOffset = Math.abs(start.x - curre.x)\n                var yOffset = Math.abs(start.y - curre.y)\n                if (xOffset > yOffset) {\n                    // 本ScrollView滑动方向过程中达到一定偏移量是也可以向上发送事件\n                    // if (this.vertical) {\n                    //     if (xOffset - yOffset > 50) {\n                    //         this.direction = UIScrollViewDirection.HORIZONTAL\n                    //     }\n                    // }\n                    this.direction = ScrollViewDirection.HORIZONTAL\n\n                } else if (yOffset > xOffset) {\n                    // 本ScrollView滑动方向过程中达到一定偏移量是也可以向上发送事件\n                    // if (this.horizontal) {\n                    //     if (yOffset - xOffset > 50) {\n                    //         this.direction = UIScrollViewDirection.VERTICAL\n                    //     }\n                    // }\n                    this.direction = ScrollViewDirection.VERTICAL\n                }\n            }\n            var canTransmit = (this.vertical && this.direction === ScrollViewDirection.HORIZONTAL) || this.horizontal && this.direction == ScrollViewDirection.VERTICAL\n            if (canTransmit) {\n                this.transmitEvent(event, Node.EventType.TOUCH_MOVE)\n                return\n            }\n        }\n        this.prevLocation = event.touch?.getPreviousLocation()!\n        this.location = event.touch?.getLocation()!\n        super._onTouchMoved(event, captureListeners)\n        if (this.pullRefresh) {\n            let outOfBoundary = this._getHowMuchOutOfBoundary()\n            let offset = this.vertical ? outOfBoundary.y : -outOfBoundary.x\n            if (offset > 0 && !this.isLockHeader && !this.isLockFooter) {\n                this.headerProgress = offset < EPSILON ? 0 : offset / this.headerOutOffset\n                this.isMoveHeader = this.headerProgress >= this.headerMultiple\n                EventHandler.emitEvents(this.headerEvents, this, { action: false, progress: this.headerProgress, stage: this.isMoveHeader ? \"wait\" : \"touch\" })\n                EventHandler.emitEvents(this.footerEvents, this, { action: false, progress: 0, stage: \"release\" })\n            } else if (offset < 0 && !this.isLockHeader && !this.isLockFooter) {\n                this.footerProgress = -offset < EPSILON ? 0 : -offset / this.footerOutOffset\n                this.isMoveFooter = this.footerProgress >= this.footerMultiple\n                EventHandler.emitEvents(this.footerEvents, this, { action: false, progress: this.footerProgress, stage: this.isMoveFooter ? \"wait\" : \"touch\" })\n                EventHandler.emitEvents(this.headerEvents, this, { action: false, progress: 0, stage: \"release\" })\n            } else if (offset == 0 && !this.isLockHeader && !this.isLockFooter) {\n                this.clearProgress()\n            }\n        }\n    }\n\n    protected _onTouchEnded(event: EventTouch, captureListeners: any) {\n        this.isCallSoonFinish = false\n        this.isCustomScroll = false\n        if (!this.canTouchMove) return\n        if (this.layout.isPageView) {\n            event.touch!.getUILocation(_tempVec2)\n            Vec2.set(this._touchEndPosition, _tempVec2.x, _tempVec2.y)\n        }\n        super._onTouchEnded(event, captureListeners)\n        if (this.isTransmitEvent) {\n            this.transmitEvent(event, Node.EventType.TOUCH_END)\n        }\n    }\n    protected _onTouchCancelled(event: EventTouch, captureListeners: any) {\n        this.isCallSoonFinish = false\n        this.isCustomScroll = false\n        if (!this.canTouchMove) return\n        if (this.layout.isPageView) {\n            event.touch!.getUILocation(_tempVec2)\n            Vec2.set(this._touchEndPosition, _tempVec2.x, _tempVec2.y)\n        }\n        if (this.isTransmitEvent) {\n            this.transmitEvent(event, Node.EventType.TOUCH_CANCEL)\n        }\n        super._onTouchCancelled(event, captureListeners)\n    }\n    scrollToAny(moveDelta: Vec3, timeInSecond?: number, attenuated: boolean = true) {\n        this.isCustomScroll = true\n        if (timeInSecond) {\n            this._startAutoScroll(moveDelta, timeInSecond, attenuated, true)\n        } else {\n            this._moveContent(moveDelta)\n        }\n    }\n    release() {\n        this.isMoveHeader = false\n        this.isMoveFooter = false\n        if (this.isLockHeader || this.isLockFooter) {\n            this.vertical && this.isLockHeader && (this._topBoundary += this.headerOutOffset)\n            this.vertical && this.isLockFooter && (this._bottomBoundary -= this.footerOutOffset)\n            this.horizontal && this.isLockHeader && (this._leftBoundary -= this.headerOutOffset)\n            this.horizontal && this.isLockFooter && (this._rightBoundary += this.footerOutOffset)\n            this.clearProgress()\n            this.layout[\"onPositionChanged\"]()\n            this.isLockHeader = false\n            this.isLockFooter = false\n            this.startAutoScroll()\n        }\n    }\n    startAutoScroll() {\n        this._autoScrolling = true\n        this._outOfBoundaryAmountDirty = true\n    }\n    protected _startAutoScroll(deltaMove: any, timeInSecond: any, attenuated: any, flag: boolean = false) {\n        if (this.pullRefresh) {  // 如果没有刷新/加载的监听者 则不计算 \n            if (this.isMoveHeader && !this.isLockHeader) {\n                if (this.vertical) {\n                    this._topBoundary -= this.headerOutOffset\n                    deltaMove.y -= this.headerOutOffset\n                }\n                if (this.horizontal) {\n                    this._leftBoundary += this.headerOutOffset\n                    deltaMove.x += this.headerOutOffset\n                }\n                this.isLockHeader = true\n                EventHandler.emitEvents(this.headerEvents, this, { action: true, progress: this.headerProgress, stage: 'lock' })\n            } else if (this.isMoveFooter && !this.isLockFooter) {\n                if (this.vertical) {\n                    this._bottomBoundary += this.footerOutOffset\n                    deltaMove.y += this.footerOutOffset\n                }\n                if (this.horizontal) {\n                    this._rightBoundary -= this.footerOutOffset\n                    deltaMove.x -= this.footerOutOffset\n                }\n                this.isLockFooter = true\n                EventHandler.emitEvents(this.footerEvents, this, { action: true, progress: this.footerProgress, stage: 'lock' })\n            }\n        }\n        super._startAutoScroll(deltaMove, timeInSecond, attenuated)\n        if (!flag && this.layout.autoCenter) {\n            const touchMoveVelocity = this._calculateTouchMoveVelocity()\n            if (!this.isQuicklyScrollable(touchMoveVelocity)) {\n                this.soonFinish()\n            }\n        }\n    }\n    protected _updateScrollBar(outOfBoundary: any) {\n        super._updateScrollBar(new Vec2(outOfBoundary.x, outOfBoundary.y))\n        if (this._autoScrollBraking) return // 自动回弹时不计算 （非手动）\n        if (!this._autoScrolling) return // 非自动滚动时不计算 \n        if (!this.pullRefresh) return\n        let offset = this.vertical ? outOfBoundary.y : -outOfBoundary.x\n        if (offset > 0) { // 下滑\n            let progress = offset < EPSILON ? 0 : offset / this.headerOutOffset //根据参数 headerOutOffset 计算当前下滑的办百分比\n            if (this.isLockHeader) {\n                this.headerProgress = this.headerProgress == 1 ? this.headerProgress : Math.max(progress, 1)\n                EventHandler.emitEvents(this.headerEvents, this, { action: false, progress: this.headerProgress, stage: \"lock\" })\n            } else {\n                this.headerProgress = progress < this.headerProgress ? progress : this.headerProgress\n                EventHandler.emitEvents(this.headerEvents, this, { action: false, progress: this.headerProgress, stage: \"release\" })\n            }\n        } else if (offset < 0) {\n            let progress = -offset < EPSILON ? 0 : -offset / this.footerOutOffset  //根据参数 footerOutOffset 计算当前下滑的办百分比\n            if (this.isLockFooter) {\n                this.footerProgress = this.footerProgress == 1 ? this.footerProgress : Math.max(progress, 1)\n                EventHandler.emitEvents(this.footerEvents, this, { action: false, progress: this.footerProgress, stage: \"lock\" })\n            } else {\n                this.footerProgress = progress < this.footerProgress ? progress : this.footerProgress\n                EventHandler.emitEvents(this.footerEvents, this, { action: false, progress: this.footerProgress, stage: \"release\" })\n            }\n        } else if (offset == 0) {\n            // 正常滑动时 如果没有锁定头和尾时 释放所有进度\n            if (!this.isLockHeader && !this.isLockFooter) {\n                this.clearProgress()\n            }\n        }\n    }\n    private clearProgress() {\n        EventHandler.emitEvents(this.headerEvents, this, { action: false, progress: 0, stage: \"release\" })\n        EventHandler.emitEvents(this.footerEvents, this, { action: false, progress: 0, stage: \"release\" })\n    }\n    private dispatchPageTurningEvent() {\n        if (this.layout[\"_lastPageIndex\"] === this.layout[\"_currPageIndex\"]) return\n        this.layout[\"_lastPageIndex\"] = this.layout[\"_currPageIndex\"]\n        EventHandler.emitEvents(this.layout.pageEvents, this, PageView.EventType.PAGE_TURNING)\n        this.node.emit(PageView.EventType.PAGE_TURNING, this)\n        console.log(\"滚动结束====>\")\n    }\n\n    protected _handleReleaseLogic(touch: any) {\n        if (this.layout.isPageView) {\n            this._autoScrollToPage();\n            if (this._scrolling) {\n                this._scrolling = false;\n                if (!this._autoScrolling) {\n                    this._dispatchEvent(ScrollView.EventType.SCROLL_ENDED);\n                }\n            }\n        } else {\n            super._handleReleaseLogic(touch)\n        }\n\n    }\n    protected _autoScrollToPage() {\n        const bounceBackStarted = this._startBounceBackIfNeeded();\n        if (bounceBackStarted) {\n            const bounceBackAmount = this._getHowMuchOutOfBoundary()\n            this._clampDelta(bounceBackAmount)\n            if (bounceBackAmount.x > 0 || bounceBackAmount.y < 0) {\n                if (this.layout.horizontal) {\n                    if (this.layout.horizontalAxisDirection == SuperLayout.HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                        this.layout[\"_currPageIndex\"] = this.layout.itemTotal === 0 ? 0 : this.layout.itemTotal - 1\n                    } else {\n                        this.layout[\"_currPageIndex\"] = 0\n                    }\n                } else {\n                    if (this.layout.verticalAxisDirection == SuperLayout.VerticalAxisDirection.TOP_TO_BOTTOM) {\n                        this.layout[\"_currPageIndex\"] = this.layout.itemTotal === 0 ? 0 : this.layout.itemTotal - 1\n                    } else {\n                        this.layout[\"_currPageIndex\"] = 0\n                    }\n                }\n            }\n            if (bounceBackAmount.x < 0 || bounceBackAmount.y > 0) {\n                if (this.layout.horizontal) {\n                    if (this.layout.horizontalAxisDirection == SuperLayout.HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                        this.layout[\"_currPageIndex\"] = 0\n                    } else {\n                        this.layout[\"_currPageIndex\"] = this.layout.itemTotal === 0 ? 0 : this.layout.itemTotal - 1\n                    }\n                } else {\n                    if (this.layout.verticalAxisDirection == SuperLayout.VerticalAxisDirection.TOP_TO_BOTTOM) {\n                        this.layout[\"_currPageIndex\"] = 0\n                    } else {\n                        this.layout[\"_currPageIndex\"] = this.layout.itemTotal === 0 ? 0 : this.layout.itemTotal - 1\n                    }\n                }\n            }\n            if (this.layout.indicator) {\n                this.layout.indicator._changedState()\n            }\n        } else {\n            const moveOffset = new Vec2()\n            Vec2.subtract(moveOffset, this._touchBeganPosition, this._touchEndPosition)\n            const index = this.layout[\"_currPageIndex\"]\n            var nextIndex = index + this.getDragDirection(moveOffset)\n            var timeInSecond = this.layout.pageTurningSpeed * Math.abs(index - nextIndex)\n            if (this.layout.footerLoop) {\n                if (nextIndex >= this.layout.itemTotal) {\n                    nextIndex = 0\n                }\n            }\n            if (this.layout.headerLoop) {\n                if (nextIndex < 0) {\n                    nextIndex = this.layout.itemTotal - 1\n                }\n            }\n            const count = this.layout.itemTotal\n            if (nextIndex < count) {\n                if (this.isScrollable(moveOffset, index, nextIndex)) {\n                    this.scrollToPage(nextIndex, timeInSecond)\n                    return;\n                } else {\n                    const touchMoveVelocity = this._calculateTouchMoveVelocity()\n                    if (this.isQuicklyScrollable(touchMoveVelocity)) {\n                        this.scrollToPage(nextIndex, timeInSecond)\n                        return;\n                    }\n                }\n            }\n            this.scrollToPage(index, timeInSecond)\n        }\n    }\n    savePageIndex(idx: number) {\n        if (idx < 0 || idx >= this.layout.itemTotal) {\n            return false\n        }\n        this.layout[\"_currPageIndex\"] = idx\n        if (this.layout.indicator) {\n            this.layout.indicator._changedState()\n        }\n        return true\n    }\n    protected scrollToPage(idx: number, timeInSecond = 0.3) {\n        if (idx < 0 || idx >= this.layout.itemTotal) {\n            return\n        }\n        if (this.savePageIndex(idx)) {\n            this.layout.scrollToIndex(idx, timeInSecond)\n        }\n    }\n    // 快速滑动\n    protected isQuicklyScrollable(touchMoveVelocity: Vec3) {\n        if (this.horizontal) {\n            if (Math.abs(touchMoveVelocity.x) > this.layout.autoPageTurningThreshold) {\n                return true;\n            }\n        } else if (this.vertical) {\n            if (Math.abs(touchMoveVelocity.y) > this.layout.autoPageTurningThreshold) {\n                return true;\n            }\n        }\n        return false;\n    }\n    protected getDragDirection(moveOffset: Vec2) {\n        if (this.horizontal) {\n            if (moveOffset.x === 0) {\n                return 0;\n            }\n            if (this.layout.horizontalAxisDirection == SuperLayout.HorizontalAxisDirection.LEFT_TO_RIGHT) {\n                return (moveOffset.x > 0 ? this.layout.groupItemTotal : -this.layout.groupItemTotal);\n            } else {\n                return (moveOffset.x < 0 ? this.layout.groupItemTotal : -this.layout.groupItemTotal);\n            }\n        } else {\n            // 由于滚动 Y 轴的原点在在右上角所以应该是小于 0\n            if (moveOffset.y === 0) {\n                return 0;\n            }\n            if (this.layout.verticalAxisDirection == SuperLayout.VerticalAxisDirection.TOP_TO_BOTTOM) {\n                return (moveOffset.y < 0 ? this.layout.groupItemTotal : -this.layout.groupItemTotal);\n            } else {\n                return (moveOffset.y > 0 ? this.layout.groupItemTotal : -this.layout.groupItemTotal);\n            }\n        }\n    }\n    // 是否超过自动滚动临界值\n    protected isScrollable(offset: Vec2, index: number, nextIndex: number) {\n        const viewTrans = this.view\n        if (!viewTrans) {\n            return false\n        }\n        if (this.horizontal) {\n            return Math.abs(offset.x) >= viewTrans.width * this.layout.scrollThreshold\n        } else if (this.vertical) {\n            return Math.abs(offset.y) >= viewTrans.height * this.layout.scrollThreshold\n        }\n        return false;\n    }\n    protected transmitEvent(event: EventTouch, eventType: string) {\n        var e = new EventTouch(event.getTouches(), event.bubbles, eventType);\n        e.type = eventType;\n        e.touch = event.touch\n        let target: any = event.target!\n        target.parent.dispatchEvent(e)\n    }\n    private soonFinish() {\n        this.isCallSoonFinish = true\n        this.layout[\"soonFinish\"]()\n    }\n    /**\n     * 重写此方法 实际上没有任何改动 只是修改了OUT_OF_BOUNDARY_BREAKING_FACTOR 从0.05 改成0.015\n     * 吐槽一下 变量 OUT_OF_BOUNDARY_BREAKING_FACTOR 定义方式\n     */\n    protected _processAutoScrolling(dt: number) {\n        const isAutoScrollBrake = this._isNecessaryAutoScrollBrake();\n\n        const brakingFactor = isAutoScrollBrake ? OUT_OF_BOUNDARY_BREAKING_FACTOR : 1;\n        this._autoScrollAccumulatedTime += dt * (1 / brakingFactor);\n        let percentage = Math.min(1, this._autoScrollAccumulatedTime / this._autoScrollTotalTime);\n        if (this._autoScrollAttenuate) {\n            percentage = quintEaseOut(percentage);\n        }\n        const clonedAutoScrollTargetDelta = this._autoScrollTargetDelta.clone();\n        clonedAutoScrollTargetDelta.multiplyScalar(percentage);\n        const clonedAutoScrollStartPosition = this._autoScrollStartPosition.clone();\n        clonedAutoScrollStartPosition.add(clonedAutoScrollTargetDelta);\n        let reachedEnd = Math.abs(percentage - 1) <= EPSILON;\n\n        const fireEvent = Math.abs(percentage - 1) <= this.getScrollEndedEventTiming();\n        if (fireEvent && !this._isScrollEndedWithThresholdEventFired) {\n            this._dispatchEvent(ScrollView.EventType.SCROLL_ENG_WITH_THRESHOLD);\n            this._isScrollEndedWithThresholdEventFired = true;\n        }\n\n        if (this.elastic) {\n            const brakeOffsetPosition = clonedAutoScrollStartPosition.clone();\n            brakeOffsetPosition.subtract(this._autoScrollBrakingStartPosition);\n            if (isAutoScrollBrake) {\n                brakeOffsetPosition.multiplyScalar(brakingFactor);\n            }\n            clonedAutoScrollStartPosition.set(this._autoScrollBrakingStartPosition);\n            clonedAutoScrollStartPosition.add(brakeOffsetPosition);\n        } else {\n            const moveDelta = clonedAutoScrollStartPosition.clone();\n            moveDelta.subtract(this.getContentPosition());\n            const outOfBoundary = this._getHowMuchOutOfBoundary(moveDelta);\n            if (!outOfBoundary.equals(Vec3.ZERO, EPSILON)) {\n                clonedAutoScrollStartPosition.add(outOfBoundary);\n                reachedEnd = true;\n            }\n        }\n\n        if (reachedEnd) {\n            this._autoScrolling = false;\n        }\n\n        if (this.layout.autoCenter && !this.isCallSoonFinish && !this.isCustomScroll) {\n            if (this._autoScrollTotalTime < 2 || percentage >= 0.8) {\n                this.soonFinish()\n            }\n        }\n        const deltaMove = clonedAutoScrollStartPosition.clone();\n        deltaMove.subtract(this.getContentPosition());\n        this._clampDelta(deltaMove);\n        this._moveContent(deltaMove, reachedEnd);\n        // this._dispatchEvent(ScrollView.EventType.SCROLLING);\n\n        if (!this._autoScrolling) {\n            this._isBouncing = false;\n            this._scrolling = false;\n            this._dispatchEvent(ScrollView.EventType.SCROLL_ENDED);\n        }\n    }\n}\n\n"]}