{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/scenes/run/runSceneCtr.ts"],"names":["Camera","DirectionalLight","Node","Prefab","SphereLight","Sprite","UITransform","Vec3","_decorator","director","renderer","GCache","AppEvent","ClientInfo","GConstants","GameRes","GameResPreLoad","UIConfigData","Utils","LayerManager","EventManager","BaseComponent","ccclass","property","menu","runSceneCtr","tooltip","type","_handlerLoadPackage","onInitModuleEvent","addModelListener","SYS_PACKAGE_LOAD","packageLoad","VIEW_UI_3D_ADD","view3DAdd","VIEW_UI_3D_REMOVE","view3DRemove","VIEW_UI_3D_GET_CAMERA","view3DGetCamera","VIEW_GET_LIGHT_DATA","viewGetLightData","VIEW_SET_LIGHT_DATA","viewSetLightData","onLoad","initCamera3D","regTouchEvent","dispatch","SYS_APP_LIFE","AppRunLife","RunScence","initUIConfig","reload","gui","loading","active","reloadDebugView","LOGIN_GOTO_SHOW","state","start","screen","width","height","camera3D","node","setPosition","setRotationFromEuler","fovAxis","scene","CameraFOVAxis","HORIZONTAL","fov","VERTICAL","debugNode","removeAllChildren","DEBUG","self","param","bundle","Prefab_DebugWindow","path","resType","callFunc","key","isValid","addChild","SYS_RELOADD_LOCAL","event","taskID","callbackFunc","startCallFunc","handler","onStartCallback","updateCallFunc","onUpdateLoadingCallback","endCallFunc","_taskID","PkgLoaderTaskList","Login","firstRunLoadSuccess","stopScheduler","addScheduler","taskList","SYS_PACKAGE_LOAD_TASK_ADD","SYS_PACKAGE_LOAD_SHOW","progress","aniClick","on","EventType","TOUCH_START","onTouchtStart","touchUIPos","touch","getUILocation","outPos","getComponent","convertToNodeSpaceAR","x","y","roleAni","parentNode","resConf","Spine_ClickAni","aniName","trackIndex","isLoop","toPos","SYS_ANI_PLAY","print","isNotNull","root3D","eventNotify","data","camera2D","ambientLum","getScene","globals","ambient","skyIllum","sphereLum","sphereLight","luminousFlux","directionalLum","directionalLight","illuminance","VIEW_GET_LIGHT_DATA_RESP","isNull","onDestroy","off"],"mappings":"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","sourcesContent":["\nimport { Camera, DirectionalLight, EventTouch, Node, Prefab, SphereLight, Sprite, UITransform, Vec3, _decorator, director, renderer } from 'cc';\nimport { GCache } from '../../cache/GCache';\nimport { AppEvent } from '../../config/AppEvent';\nimport { ClientInfo } from '../../config/GameConfig';\nimport { GConstants } from '../../config/GameConstant';\nimport { GameRes, GameResPreLoad } from '../../config/GameRes';\nimport { UIConfigData } from '../../config/UIConfig';\nimport { inf_PkgLoaderTaskAdd, inf_ResLoader, inf_SpineAniCreate } from '../../framework/InterfaceDefines';\nimport { Utils } from '../../framework/Utils';\nimport { LayerManager } from '../../framework/layer/LayerManager';\nimport { EventManager } from '../../framework/manager/EventManager';\nimport { BaseComponent } from '../../framework/vc/BaseComponent';\nconst { ccclass, property, menu } = _decorator;\n\n\n\n/**\n * Name = runSceneCtr\n * URL = db://assets/scenes/run/runSceneCtr.ts\n * Time = Tue Apr 26 2022 17:01:25 GMT+0800 (中国标准时间)\n * Author = xueya\n *\n * Life: onLoad-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n */\n\n@ccclass('runSceneCtr')\n\n//方便编辑器识别的菜单项目\n@menu('scenes/runSceneCtr')\n\nexport class runSceneCtr extends BaseComponent {\n\t//游戏根节点\n\t@property({ tooltip: \"UI底图\", type: Sprite })\n\tbg: Sprite = null!;\n\n\t// //动画根节点\n\t// @property({ tooltip: \"动画根节点\", type: sp.Skeleton })\n\t// bgSkel: sp.Skeleton = null!;\n\n\t//游戏根节点\n\t@property({ tooltip: \"UI根节点\", type: Node })\n\tgui: Node = null!;\n\n    //摄像头节点\n\t@property({ tooltip: \"摄像头节点\", type: Camera })\n\tcamera2D: Camera = null!;\n\n\t//3D根节点\n\t@property({ tooltip: \"UI根节点\", type: Node })\n\troot3D: Node = null!;\n\n\t//3D摄像头\n\t@property({ tooltip: \"3D摄像头节点\", type: Camera })\n\tcamera3D: Camera = null!;\n\n    //球面光\n\t@property({ tooltip: \"球面光\", type: SphereLight })\n\tsphereLight: SphereLight = null!;\n\n    //平行光\n\t@property({ tooltip: \"平行光\", type: DirectionalLight })\n\tdirectionalLight: DirectionalLight = null!;\n\n\t//游戏debug节点\n\t@property({ tooltip: \"游戏debug节点\", type: Node })\n\tdebugNode: Node = null!;\n\t//加载节点\n\t@property({ tooltip: \"加载节点\", type: Node })\n\tloading: Node = null!;\n\n\t//点击最上层\n\t@property({ tooltip: \"点击最上层\", type: Node })\n\taniClick: Node = null!;\n\t/** 分包加载延迟句柄 */\n\tprivate _handlerLoadPackage = null;\n\n\tprotected onInitModuleEvent() {\n\t\t//分包加载任务\n\t\tthis.addModelListener(AppEvent.SYS_PACKAGE_LOAD, this.packageLoad);\n\t\t// //生命周期变化\n\t\t// this.addModelListener(AppEvent.SYS_APP_LIFE, this.appChangeLife)\n\n\t\tthis.addModelListener(AppEvent.VIEW_UI_3D_ADD, this.view3DAdd);\n\t\tthis.addModelListener(AppEvent.VIEW_UI_3D_REMOVE, this.view3DRemove);\n        this.addModelListener(AppEvent.VIEW_UI_3D_GET_CAMERA, this.view3DGetCamera);\n\n        this.addModelListener(AppEvent.VIEW_GET_LIGHT_DATA, this.viewGetLightData);\n        this.addModelListener(AppEvent.VIEW_SET_LIGHT_DATA, this.viewSetLightData);\n\t}\n\n\tonLoad() {\n\t\tthis.initCamera3D()\n\t\t// this.bgSkel.enabled = true;\n\t\tthis.regTouchEvent();\n\t\t//通知:sys周期变化\n\t\tEventManager.dispatch(AppEvent.SYS_APP_LIFE, GConstants.AppRunLife.RunScence);\n\t\tLayerManager.initUIConfig(UIConfigData)\n\t\tLayerManager.reload(this.gui)\n\t\tthis.loading.active = true;\n\t\tthis.reloadDebugView();\n\t\t//加载进入登录\n\t\tEventManager.dispatch(AppEvent.LOGIN_GOTO_SHOW, { state: \"first_login\" });\n\t};\n\n\tstart() {\n\n\t};\n\n\tinitCamera3D() {\n        if (screen.width / screen.height < 1280 / 720) {\n\t\t\tthis.camera3D.node.setPosition(0, 138.7, 111.6);\n\t\t\tthis.camera3D.node.setRotationFromEuler(-53, 0, 0);\n            this.camera3D.fovAxis = renderer.scene.CameraFOVAxis.HORIZONTAL;\n            this.camera3D.fov = 45;\n\t\t} else {\n\t\t\tthis.camera3D.node.setPosition(0, 106.4, 105.0);\n\t\t\tthis.camera3D.node.setRotationFromEuler(-48.3, 0, 0);\n            this.camera3D.fovAxis = renderer.scene.CameraFOVAxis.VERTICAL;\n            this.camera3D.fov = 28.2;\n\t\t}\n\t}\n\t/** 加载debug界面 */\n\treloadDebugView() {\n\t\tthis.debugNode.removeAllChildren();\n\t\tif (ClientInfo.DEBUG) {\n\t\t\tlet self = this;\n\t\t\tlet param: inf_ResLoader = {\n\t\t\t\tbundle: GameRes.Prefab_DebugWindow.bundle,\n\t\t\t\tpath: GameRes.Prefab_DebugWindow.path,\n\t\t\t\tresType: Prefab,\n\t\t\t\tcallFunc: (debugNode, key) => {\n\t\t\t\t\tif (debugNode && self.debugNode && self.debugNode.isValid == true) {\n\t\t\t\t\t\tself.debugNode.addChild(debugNode);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tEventManager.dispatch(AppEvent.SYS_RELOADD_LOCAL, param);\n\t\t}\n\t}\n\t/** 分包加载 */\n\tpackageLoad(event, taskID, callbackFunc: Function) {\n\t\tthis.loading.active = false;\n\t\tlet self = this;\n\t\tlet startCallFunc = Utils.handler(this, this.onStartCallback);\n\t\tlet updateCallFunc = Utils.handler(this, this.onUpdateLoadingCallback);\n\t\tlet endCallFunc = function (_taskID) {\n\t\t\tif (_taskID == GConstants.PkgLoaderTaskList.Login) {\n\t\t\t\tGCache.firstRunLoadSuccess = true;\n\t\t\t}\n\t\t\tself.stopScheduler(self._handlerLoadPackage);\n\t\t\tself._handlerLoadPackage = self.addScheduler(1, () => {\n\t\t\t\tself.stopScheduler(self._handlerLoadPackage);\n\t\t\t\tif (self.loading && self.loading.isValid == true) {\n\t\t\t\t\tself.loading.active = false;\n\t\t\t\t}\n\t\t\t\tif (callbackFunc) {\n\t\t\t\t\tcallbackFunc();\n\t\t\t\t}\n\t\t\t})\n\t\t};\n\t\tlet param: inf_PkgLoaderTaskAdd = {\n\t\t\ttaskID: taskID,\n\t\t\ttaskList: GameResPreLoad[taskID],\n\t\t\tstartCallFunc: startCallFunc,\n\t\t\tupdateCallFunc: updateCallFunc,\n\t\t\tendCallFunc: endCallFunc,\n\t\t}\n\t\tEventManager.dispatch(AppEvent.SYS_PACKAGE_LOAD_TASK_ADD, param)\n\t}\n\t// /** 生命周期变化 */\n\t// appChangeLife(event, life) {\n\t// \tif (life == GConstants.AppRunLife.Hall_Opened || life == GConstants.AppRunLife.Game_Opened) {\n\t// \t\tif (this.bgSkel.enabled == false) {\n\t// \t\t\treturn;\n\t// \t\t}\n\t// \t\tthis.bgSkel.enabled = false;\n\n\t// \t} else {\n\t// \t\tif (this.bgSkel.enabled == true) {\n\t// \t\t\treturn;\n\t// \t\t}\n\t// \t\tthis.bgSkel.enabled = true;\n\t// \t}\n\t// }\n\tonStartCallback(taskID) {\n\t\tif (!this.node || this.node.isValid == false) {\n\t\t\treturn;\n\t\t}\n\t\tEventManager.dispatch(AppEvent.SYS_PACKAGE_LOAD_SHOW, 0, taskID);\n\t\tthis.loading.active = true;\n\t}\n\tonUpdateLoadingCallback(taskID, progress) {\n\t\tif (!this.node || this.node.isValid == false) {\n\t\t\treturn;\n\t\t}\n\t\tEventManager.dispatch(AppEvent.SYS_PACKAGE_LOAD_SHOW, progress, taskID);\n\t}\n\n\t/** 注册定义事件 */\n\tpublic regTouchEvent() {\n\t\tif (!this.node) {\n\t\t\treturn;\n\t\t}\n\t\tthis.aniClick.on(Node.EventType.TOUCH_START, this.onTouchtStart, this, true);\n\t}\n\n\t/** 点击效果 */\n\tonTouchtStart(event: EventTouch) {\n\t\tlet touchUIPos = event.touch.getUILocation();\n\t\tlet outPos = new Vec3();\n\t\tthis.aniClick.getComponent(UITransform).convertToNodeSpaceAR(new Vec3(touchUIPos.x, touchUIPos.y, 0), outPos)\n\n\t\tlet roleAni: inf_SpineAniCreate = {\n\t\t\tparentNode: this.aniClick,\n\t\t\tresConf: GameRes.Spine_ClickAni,\n\t\t\taniName: \"dianji_ani\",\n\t\t\ttrackIndex: 0,\n\t\t\tisLoop: false,\n\t\t\ttoPos: outPos,\n\t\t}\n\t\tEventManager.dispatch(AppEvent.SYS_ANI_PLAY, roleAni);\n\t}\n\n\t/** 添加3D界面 */\n\tprivate view3DAdd(event: string, node: Node) {\n\t\tthis.print(\"view3DAdd\")\n\t\tif (Utils.isNotNull(node)) {\n\t\t\tthis.root3D.addChild(node);\n\t\t}\n\t}\n\n\t/** 移除3D界面 */\n\tprivate view3DRemove(event: string) {\n\t\tthis.print(\"view3DRemove\")\n\t\tthis.root3D.removeAllChildren();\n\t}\n\n    /** 获取3D摄像头 */\n\tprivate view3DGetCamera(event: string, eventNotify: string, data: any) {\n\t\tthis.print(\"view3DGetCamera\")\n        EventManager.dispatch(eventNotify, data, this.camera3D, this.camera2D);\n\t}\n\n    /** 获取光照数据 */\n    private viewGetLightData(event: string) {\n        let data = {\n            ambientLum: director.getScene().globals.ambient.skyIllum,\n            // spherePosition: this.sphereLight.node.position,\n            // sphereRotation: this.sphereLight.node.eulerAngles,\n            sphereLum: this.sphereLight.luminousFlux,\n            // directionalPosition: this.directionalLight.node.position,\n            // directionalRotation: this.directionalLight.node.eulerAngles,\n            directionalLum: this.directionalLight.illuminance,\n        }\n        this.print(\"viewGetLightData\", data)\n        EventManager.dispatch(AppEvent.VIEW_GET_LIGHT_DATA_RESP, data);\n    }\n\n    /** 设置光照数据 */\n    private viewSetLightData(event: string, data: any) {\n        this.print(\"viewSetLightData\", data)\n        if (Utils.isNull(data)) {\n            return;\n        }\n\n        if (Utils.isNotNull(data.ambientLum)) {\n            director.getScene().globals.ambient.skyIllum = data.ambientLum;\n        }\n\n        // if (Utils.isNotNull(data.spherePosition)) {\n        //     this.sphereLight.node.setPosition(data.spherePosition);\n        // }\n\n        // if (Utils.isNotNull(data.sphereRotation)) {\n        //     this.sphereLight.node.setRotationFromEuler(data.sphereRotation);\n        // }\n\n        if (Utils.isNotNull(data.sphereLum)) {\n            this.sphereLight.luminousFlux = data.sphereLum;\n        }\n\n        // if (Utils.isNotNull(data.directionalPosition)) {\n        //     this.directionalLight.node.setPosition(data.directionalPosition);\n        // }\n\n        // if (Utils.isNotNull(data.directionalRotation)) {\n        //     this.directionalLight.node.setRotationFromEuler(data.directionalRotation);\n        // }\n\n        if (Utils.isNotNull(data.directionalLum)) {\n            this.directionalLight.illuminance = data.directionalLum;\n        }\n    }\n\n\t//销毁\n\tonDestroy() {\n\t\tif (this.aniClick) {\n\t\t\tthis.aniClick.off(Node.EventType.TOUCH_START, this.onTouchtStart, this, true);\n\t\t}\n\t};\n\n}\n\n"]}