{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/proj/servers/UserServer.ts"],"names":["UserServers","GCache","AppEvent","ClientInfo","EventManager","Utils","BaseControll","GlobalCMD","getInstance","_instance","init","clear","onInitModuleEvent","addModelListener","NET_CMD_REQ_USER_BACKPACK","reqUserBagPack","NET_CMD_RESP_USER_BACKPACK","respUserBagPack","NET_RECEIVE_PHP_SERVER_USER_VIP_INFO","receiveServerUserVipInfo","event","console","log","param","action","page","pagenum","hall_version","HallVer","timestamp","time","appid","PlatFormAppID","mid","User","getUserMid","ssid","getDataUser","sendMsg","cmd","PHP_PACKAGE_BAGLIST","body","dispatch","NET_SEND_MSG","isSuccess","respData","reqData","table_verify","BackPack","updateBagData","box"],"mappings":"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","sourcesContent":["/**\n * Name = UserServers\n * URL = db://assets/proj/servers/UserServers.ts\n * Time = Wed 2023 07.19 19:31:18 GMT+0800 (中国标准时间)\n * Author = xueya\n * 用户背包相关服务\n */\n\nimport { GCache } from \"../../cache/GCache\";\nimport { AppEvent } from \"../../config/AppEvent\";\nimport { ClientInfo } from \"../../config/GameConfig\";\nimport { EventManager } from \"../../framework/manager/EventManager\";\nimport { Utils } from \"../../framework/Utils\";\nimport { BaseControll } from \"../../framework/vc/BaseController\";\nimport { GlobalCMD } from \"../gnet/GlobalCMD\";\n\nexport class UserServers extends BaseControll {\n  private static _instance = null;\n  public static getInstance(): UserServers {\n    if (!this._instance || this._instance == null) {\n      this._instance = new UserServers(\"UserServers\");\n    }\n    return this._instance;\n  }\n  public static init(): UserServers {\n    if (this._instance) {\n      this._instance.clear()\n    }\n    this._instance = null\n    UserServers.getInstance()\n    return\n  }\n  protected onInitModuleEvent(): void {\n    //请求拉取用户背包数据\n    this.addModelListener(AppEvent.NET_CMD_REQ_USER_BACKPACK, this.reqUserBagPack)\n    //请求拉取用户背包数据返回\n    this.addModelListener(AppEvent.NET_CMD_RESP_USER_BACKPACK, this.respUserBagPack)\n    //推送消息\n    this.addModelListener(AppEvent.NET_RECEIVE_PHP_SERVER_USER_VIP_INFO, this.receiveServerUserVipInfo)\n  }\n  /** 请求拉取用户背包数据 */\n  reqUserBagPack(event = null) {\n    console.log('背包数据请求')\n    let param = {\n      action: \"bag.boxlist\",\n      page: 1,\n      pagenum: 1000,// 无实际背包页面只拉取一页查询页设置条数为1000\n      hall_version: ClientInfo.HallVer,\n      timestamp: Utils.time(),\n      appid: ClientInfo.PlatFormAppID,\n      mid: GCache.User.getUserMid(),\n      ssid: GCache.User.getDataUser(\"ssid\", \"\"),\n    }\n    let sendMsg = {\n      cmd: GlobalCMD.PHP_PACKAGE_BAGLIST,\n      body: param,\n    }\n    EventManager.dispatch(AppEvent.NET_SEND_MSG, sendMsg);\n  }\n  /** 请求拉取用户背包数据返回 */\n  respUserBagPack(event, isSuccess, respData, reqData) {\n    console.log('背包道具数据的返回', isSuccess, respData)\n    reqData = Utils.table_verify(reqData);\n    reqData[\"code\"] = Utils.table_verify(reqData[\"code\"]);\n    if (respData) {\n      GCache.BackPack.updateBagData(respData.box);//赋值最新的背包数据\n    }\n  }\n  //广播:server返回用户VIP详细信息\n  receiveServerUserVipInfo(event, isSuccess, respData, reqData) {\n    console.log('广播:server返回用户VIP详细信息的返回', isSuccess, respData)\n    if (!isSuccess) {\n      return\n    }\n    //通知更新背包道具 \n    EventManager.dispatch(AppEvent.NET_CMD_REQ_USER_BACKPACK);\n\n  }\n}"]}