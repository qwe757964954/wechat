{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/game/module/settle/src/settle.ts"],"names":["Color","instantiate","Label","Layout","Node","Prefab","ScrollView","Sprite","SpriteAtlas","Vec3","_decorator","resLoader","EventManager","Utils","BaseComponent","PlayerMgr","SettleMgr","FXJEvent","FXJRes","FXJUIID","GameEvent","Card","BottomItem","FanItem","List","ccclass","property","TitleColor","Gender","VictoryStatus","settle","titleMap","Map","_moneyResKey","_huResKey","onInitModuleEvent","onLoad","set","fanExtendInfos","getInstance","filterFanExtendInfo","moneyScroll","numItems","length","opponentInfos","getOpponentTotalInfo","bottomScroll","updateSettleInfo","onListBottomHRender","item","idx","info","scriptPlayer","getComponent","updateItemProps","onListMoneyVRender","fanExtendInfo","myInfo","getMyTotalInfo","fanData","getMaxWinType","tittle_str","string","settleType","get","fanName","colorStr","bWin","Win","Fail","normalColor","color","bgStr","leftStr","titleStr","forward","moneyAtlas","Prefab_Settle_Win","Prefab_Settle_Fail","huAtlas","Prefab_Settle_Hu_Win","Prefab_Settle_Hu_Fail","frameBg","string_format","Prefab_Settle_Image","plistKey","frameLeft","frameTitle","updatePlayerStatus","load","bundle","path","err","atlas","bgAtlas","getSpriteFrame","bg","spriteFrame","leftAtlas","left_bg","titleAtlas","title_bg","moneyStr","winMoney","numList","String","split","numKeyList","i","push","createNumSprImg","moneyLayout","updateMyselfCards","updateWinCards","gameUserInfo","JSON","parse","strUserInfo","playerAtlas","sex","Prefab_Settle_Xiaobo","Prefab_Settle_Xiaoya","playerName","Male","Female","playerStatus","playerFrame","playerSprite","array","getMyhands","cardValue","node","card_Prefab","setCardByte","setCardSize","setCardAngle","card_layout","addChild","asyncForLoop","winPlayer","getWinPlayerInfo","Promise","resolve","handCards","filter","huCard","hu_node","hutag","huTag","active","setPosition","onCreateNextGame","dispatch","GAME_CLOSE_POPUP","GameSettlePrefab","NEXT_GAME_OPERATION","onCloseGame","parent","plist","keyList","dianPosY","removeAllChildren","getPreLoaderRes","forEach","key","index","sprNode","create_2DSprite","position","x","z"],"mappings":"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","sourcesContent":["\n\nimport { Color, instantiate, Label, Layout, Node, Prefab, ScrollView, Sprite, SpriteAtlas, Vec3, _decorator } from 'cc';\nimport { resLoader } from '../../../../../framework/loader/ResLoader';\nimport { EventManager } from '../../../../../framework/manager/EventManager';\nimport { Utils } from '../../../../../framework/Utils';\nimport { BaseComponent } from '../../../../../framework/vc/BaseComponent';\nimport { PlayerMgr } from '../../../cache/PlayerMgr';\nimport { SettleMgr } from '../../../cache/SettleMgr';\nimport { FXJEvent } from '../../../common/FXJEvent';\nimport { FXJRes, FXJUIID } from '../../../common/FXJRes';\nimport { GameEvent } from '../../../common/GameEvent';\nimport { Common } from '../../../common/idl/Common';\nimport { Game } from '../../../common/idl/Game';\nimport { Card } from '../../card/src/Card';\nimport { BottomItem } from './BottomItem';\nimport { FanItem } from './FanItem';\nimport List from './list/List';\nconst { ccclass, property } = _decorator;\n/**\n * Name = settle\n * URL = db://assets/package/game/module/settle/src/settle.ts\n * Time = Wed Aug 02 2023 10:58:00 GMT+0800 (中国标准时间)\n * Author = qwe757964\n *\n * Life: onLoad-->onInitModuleEvent-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n * \n */\n \nexport enum TitleColor {\n\tWin = \"#D23A00\",\n\tFail = \"#667AD2\"\n}\n\nexport enum Gender {\n\tMale = \"xiaobo\",\n\tFemale = \"xiaoya\",\n}\n\nexport enum VictoryStatus {\n\tWin = \"win\",\n\tFail = \"fail\",\n}\n\n@ccclass('settle')\nexport class settle extends BaseComponent {\n\t@property(Sprite)\n    public bg: Sprite | null = null;\n\t\n\t@property(Sprite)\n    public left_bg: Sprite | null = null;\n\n\t@property(Sprite)\n    public title: Sprite | null = null;\n\n\t@property(Sprite)\n    public title_bg: Sprite | null = null;\n\n\t@property(Sprite)\n    public playerSprite: Sprite | null = null;\n\n\n\t@property(ScrollView)\n    public scrollView: ScrollView | null = null;\n\n\t@property(Node)\n    public huLayout: Node | null = null;\n\n\t@property(Node)\n    public moneyLayout: Node | null = null;\n\n\t@property(Label)\n    public tittle_str: Label | null = null;\n\n\t@property(Layout)\n    public card_layout: Layout | null = null;\n\n\t@property(Prefab)\n    public card_Prefab: Prefab | null = null;\n\n\t@property(Node)\n    public huTag: Node | null = null;\n\n\t//水平列表\n    @property(List)\n    bottomScroll: List = null;\n\t\n\t//垂直列表\n    @property(List)\n    moneyScroll: List = null;\n\n\t//code 对应的图集\n    titleMap = new Map<string, string>();\n\n\tprivate _moneyResKey = { \"+\": \"+\",\"-\": \"-\",\".\": \".\", \"万\": \"wan\", \"亿\": \"yi\", \"0\": \"0\", \"1\": \"1\", \"2\": \"2\", \"3\": \"3\", \"4\": \"4\", \"5\": \"5\", \"6\": \"6\", \"7\": \"7\", \"8\": \"8\", \"9\": \"9\", };\n\tprivate _huResKey = { \"共胡\": \"gonghu\", \"次\": \"ci\", \"0\": \"0\", \"1\": \"1\", \"2\": \"2\", \"3\": \"3\", \"4\": \"4\", \"5\": \"5\", \"6\": \"6\", \"7\": \"7\", \"8\": \"8\", \"9\": \"9\", };\n\n\t/** override 初始化模块事件 */\n\tprotected onInitModuleEvent() {\n\t\t\n\t};\n\t\n\tonLoad () {\n\t\tthis.titleMap.set(\"common_hu\", \"平胡\");\n\t\tthis.titleMap.set(\"zi_mo\", \"自摸\");\n\t\tthis.titleMap.set(\"huang_zhuang\", \"黄庄\");\n\t\tlet fanExtendInfos:Game.ISettleFanExtendInfo[] = SettleMgr.getInstance().filterFanExtendInfo();\n\t\tthis.moneyScroll.numItems = fanExtendInfos.length;\n\t\tlet opponentInfos:Game.ITotalInfo[] = SettleMgr.getInstance().getOpponentTotalInfo();\n\t\tthis.bottomScroll.numItems = opponentInfos.length;\n\t\tthis.updateSettleInfo();\n\t};\n\n\tonListBottomHRender(item: Node, idx: number){\n\t\tlet opponentInfos:Game.ITotalInfo[] = SettleMgr.getInstance().getOpponentTotalInfo();\n\t\tlet info:Game.ITotalInfo = opponentInfos[idx];\n\t\tvar scriptPlayer:BottomItem = item.getComponent(BottomItem);\n\t\tscriptPlayer.updateItemProps(info);\n\t}\n\n\tonListMoneyVRender(item: Node, idx: number){\n\t\tlet fanExtendInfos:Game.ISettleFanExtendInfo[] = SettleMgr.getInstance().filterFanExtendInfo();\n\t\tlet fanExtendInfo:Game.ISettleFanExtendInfo = fanExtendInfos[idx];\n\t\tvar scriptPlayer:FanItem = item.getComponent(FanItem);\n\t\tscriptPlayer.updateItemProps(idx,fanExtendInfo);\n\t}\n\n\tupdateSettleInfo(){\n\t\tlet myInfo:Game.ITotalInfo = SettleMgr.getInstance().getMyTotalInfo();\n\t\tlet fanData:Game.IFanInfo = SettleMgr.getInstance().getMaxWinType();\n\t\tthis.tittle_str.string = SettleMgr.getInstance().settleType === \"huang_zhuang\" ? this.titleMap.get(SettleMgr.getInstance().settleType):fanData.fanName;\n\t\tlet colorStr:string = myInfo.bWin !== -1 ? TitleColor.Win:TitleColor.Fail;\n\t\tlet normalColor = new Color(colorStr);\n\t\tthis.tittle_str.color = normalColor;\n\t\t\n\t\tlet bgStr:string = myInfo.bWin !== -1 ? \"win_bg\":\"failure_bg\";\n\t\tlet leftStr:string = myInfo.bWin !== -1 ? \"settle_win\":\"settle_failure\";\n\t\tlet titleStr:string = myInfo.bWin !== -1 ? \"win_title_bg\":\"fail_title_bg\";\n\t\tlet forward:string = myInfo.bWin !== -1 ? \"+\":\"\";\n\t\tlet moneyAtlas = myInfo.bWin !== -1 ? FXJRes.Prefab_Settle_Win:FXJRes.Prefab_Settle_Fail;\n\t\tlet huAtlas = myInfo.bWin !== -1 ? FXJRes.Prefab_Settle_Hu_Win:FXJRes.Prefab_Settle_Hu_Fail;\n\t\tlet frameBg = Utils.string_format(FXJRes.Prefab_Settle_Image.plistKey, bgStr)\n\t\tlet frameLeft =   Utils.string_format(FXJRes.Prefab_Settle_Image.plistKey, leftStr)\n\t\tlet frameTitle =   Utils.string_format(FXJRes.Prefab_Settle_Image.plistKey, titleStr)\n\n\t\tthis.updatePlayerStatus();\n\n\t\tresLoader.load(FXJRes.Prefab_Settle_Image.bundle, FXJRes.Prefab_Settle_Image.path, SpriteAtlas, (err: Error | null, atlas) => {\n\t\t\tif (err) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tlet bgAtlas = atlas.getSpriteFrame(frameBg);\n\t\t\tif (bgAtlas) {\n\t\t\t\tthis.bg.spriteFrame = bgAtlas;\n\t\t\t}\n\t\t\tlet leftAtlas = atlas.getSpriteFrame(frameLeft);\n\t\t\tif (leftAtlas) {\n\t\t\t\tthis.left_bg.spriteFrame = leftAtlas;\n\t\t\t}\n\t\t\tlet titleAtlas = atlas.getSpriteFrame(frameTitle);\n\t\t\tif (titleAtlas) {\n\t\t\t\tthis.title_bg.spriteFrame = titleAtlas;\n\t\t\t}\n\t\t});\n\t\tlet moneyStr:string = `${forward}${myInfo.winMoney}`;\n\t\tlet numList = String(moneyStr).split(\"\");\n\t\tlet numKeyList = [];\n\t\tfor (let i = 0; i < numList.length; i++) {\n\t\t\tnumKeyList.push(this._moneyResKey[numList[i]])\n\t\t}\n\t\tthis.createNumSprImg(this.moneyLayout, moneyAtlas, numKeyList, 0);\n\n\t\t// let fanStr:string = `${myInfo.totalFanStr}次`;\n\n\t\t// let fanList = String(fanStr).split(\"\");\n\t\t// if (fanList.length > 0) {\n\t\t// \tfanList.unshift(\"共胡\");\n\t\t// }\n\t\t// let fanKeyList = [];\n\t\t// for (let i = 0; i < fanList.length; i++) {\n\t\t// \tfanKeyList.push(this._huResKey[fanList[i]])\n\t\t// }\n\t\t// this.createNumSprImg(this.huLayout, huAtlas, fanKeyList, 0);\n\t\tif(SettleMgr.getInstance().settleType === \"huang_zhuang\"){\n\t\t\tthis.updateMyselfCards();\n\t\t}else{\n\t\t\tthis.updateWinCards();\n\t\t}\n\t\t\n\t}\n\t\n\tupdatePlayerStatus(){\n\t\tlet myInfo:Game.ITotalInfo = SettleMgr.getInstance().getMyTotalInfo();\n\t\tlet gameUserInfo:Common.GameUserInfo = JSON.parse(myInfo.strUserInfo);\n\t\tlet playerAtlas = gameUserInfo.sex !== 2 ? FXJRes.Prefab_Settle_Xiaobo:FXJRes.Prefab_Settle_Xiaoya;\n\t\tlet playerName = gameUserInfo.sex !== 2 ? Gender.Male:Gender.Female;\n\t\tlet playerStatus = myInfo.bWin !== -1 ? VictoryStatus.Win:VictoryStatus.Fail;\n\t\tlet playerFrame = `${playerName}_${playerStatus}`;\n\t\tresLoader.load(playerAtlas.bundle, playerAtlas.path, SpriteAtlas, (err: Error | null, atlas) => {\n\t\t\tif (err) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tlet bgAtlas = atlas.getSpriteFrame(playerFrame);\n\t\t\tif (bgAtlas) {\n\t\t\t\tthis.playerSprite.spriteFrame = bgAtlas;\n\t\t\t}\n\t\t});\n\t}\n\n\tupdateMyselfCards(){\n\t\tlet array = PlayerMgr.getInstance().getMyhands();\n\t\tfor (let i = 0; i < array.length; i++) {\n\t\t\tlet cardValue:number = array[i];\n\t\t\tlet node = instantiate(this.card_Prefab);\n\t\t\tnode.getComponent(Card).setCardByte(cardValue);\n\t\t\tnode.getComponent(Card).setCardSize(50,70);\n\t\t\tnode.getComponent(Card).setCardAngle(90,0,0);\n\t\t\tthis.card_layout.node.addChild(node);\n\t\t}\n\t}\n\n\t// 封装带有异步操作的for循环\n\tasyncForLoop(): Promise<void> {\n\t\tlet winPlayer:Common.IPlayerInfo = SettleMgr.getInstance().getWinPlayerInfo();\n\t\treturn new Promise((resolve) => {\n\t\t\tlet array = winPlayer.handCards.filter(item => item !== winPlayer.huCard); // 移除值为3的元素\n\t\t\tfor (let i = 0; i < array.length; i++) {\n\t\t\t\tlet cardValue:number = winPlayer.handCards[i];\n\t\t\t\tlet node = instantiate(this.card_Prefab);\n\t\t\t\tnode.getComponent(Card).setCardByte(cardValue);\n\t\t\t\tnode.getComponent(Card).setCardSize(50,70);\n\t\t\t\tnode.getComponent(Card).setCardAngle(90,0,0);\n\t\t\t\tthis.card_layout.node.addChild(node);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n \t}\n\t\n\tasync updateWinCards(){\n\t\tlet winPlayer:Common.IPlayerInfo = SettleMgr.getInstance().getWinPlayerInfo();\n\t\tif(winPlayer === null){\n\t\t\treturn;\n\t\t}\n\t\tawait this.asyncForLoop(); // 等待for循环执行完毕\n\t\tlet hu_node = instantiate(this.card_Prefab);\n\t\thu_node.getComponent(Card).setCardByte(winPlayer.huCard);\n\t\thu_node.getComponent(Card).setCardSize(50,70);\n\t\thu_node.getComponent(Card).setCardAngle(90,0,0);\n\t\tthis.card_layout.node.addChild(hu_node);\n\t\tlet hutag = instantiate(this.huTag);\n\t\thutag.active = true;\n\t\thu_node.addChild(hutag);\n\t\thutag.setPosition(-10.006,17.419);\n\t}\n\n\tonCreateNextGame(){\n\t\tEventManager.dispatch(FXJEvent.GAME_CLOSE_POPUP,FXJUIID.GameSettlePrefab);\n\t\tEventManager.dispatch(GameEvent.NEXT_GAME_OPERATION);\n\t}\n\n\tonCloseGame(){\n\t\tEventManager.dispatch(FXJEvent.GAME_CLOSE_POPUP,FXJUIID.GameSettlePrefab);\n\t}\n\n\t/** 创建数字图片集合 */\n\tcreateNumSprImg(parent: Node, plist: { bundle: string, path: string }, keyList: Array<string>, dianPosY: number = 0) {\n\t\tparent.removeAllChildren();\n\t\tif (!keyList || keyList.length == 0) {\n\t\t\treturn;\n\t\t}\n\t\tthis.getPreLoaderRes(plist.bundle, plist.path, SpriteAtlas, (atlas) => {\n\t\t\tkeyList.forEach((key, index) => {\n\t\t\t\tlet spriteFrame = atlas.getSpriteFrame(key)\n\t\t\t\tif (spriteFrame) {\n\t\t\t\t\tlet sprNode = Utils.create_2DSprite(spriteFrame, key);\n\t\t\t\t\tparent.addChild(sprNode);\n\t\t\t\t\t// if ((key == \".\" || key == \"coin_dian\") && dianPosY != null) {\n\t\t\t\t\t\tsprNode.setPosition(new Vec3(sprNode.position.x, dianPosY, sprNode.position.z));\n\t\t\t\t\t// }\n\t\t\t\t}\n\n\t\t\t})\n\t\t});\n\t\tparent.active = true;\n\t}\n\n}\n\n"]}