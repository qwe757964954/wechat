{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/game/scripts/NodeHandCardCtr.ts"],"names":["Node","Tween","Vec3","_decorator","instantiate","tween","Utils","EventManager","BaseComponent","RoomMgr","OPCode","FXJEvent","FXJSound","GameViewConfig","NodeCardCtr","ccclass","property","NodeHandCardCtr","tooltip","type","_hostDir","_numList","_seatList","_seatListTarget","_cardStart","_spaceLast","_cardStatus","HandCardStatus","Idle","onInitModuleEvent","onLoad","initData","initView","start","Array","num","width","CardConfig","Width","spaceLast","dir","nodeSeat","setRotationFromEuler","node","addChild","i","leftToRight","card","nodeCard","setPosition","GroundToHandCard","CenterToHandCard","push","resetView","getInstance","mySeatId","length","targets","stopAllByTarget","cards","active","pos","getPosition","x","onGameStart","OnChangedSeat","hostDir","onDealCard","data","dealCard","cardsCount","playAnimOfSort","countList","isNull","console","log","adjustPosition","turnToMe","cardNum","t1","t2","playAnimOfSortByDir","Sort","delay","call","dispatch","SYS_PLAY_EFFECT","GameAdjust","rotaionEuler","eulerAngles","point","z","Thickness","GroundToCard","tweenTargetVec3","tw","by","onUpdate","target","ratio","rotate3DAroundByPositionRotaion","onTakeCard","seatId","takeCard","onOutCard","outCardAny","count","luckyNum","Math","floor","random","simpleOutCardAny","normalOutCardAny","a","b","min","removeNodeList","splice","forEach","value","index","array","to","position","y","onPengGang","opCode","OPE_PENG","OPE_QIANG_PENG","OPE_AN_GANG","OPE_GANG","OPE_BU_GANG","onHu","cardSeatId","onGameOver","handCards","nodes","j","getComponent","setCardByte","playAnimOfShow","duration","Show","Over","onReconnect","playerList","onDestroy"],"mappings":"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","sourcesContent":["\nimport { Node, Tween, Vec3, _decorator, instantiate, tween } from 'cc';\nimport { Utils } from '../../../framework/Utils';\nimport { EventManager } from '../../../framework/manager/EventManager';\nimport { BaseComponent } from '../../../framework/vc/BaseComponent';\nimport { RoomMgr } from '../cache/RoomMgr';\nimport { OPCode } from '../common/FXJConfig';\nimport { FXJEvent } from '../common/FXJEvent';\nimport { FXJSound } from '../common/FXJSound';\nimport { GameViewConfig } from '../common/GameViewConfig';\nimport { Game } from '../common/idl/Game';\nimport { NodeCardCtr } from './NodeCardCtr';\nconst { ccclass, property } = _decorator;\n\n/**\n * Name = NodeHandCardCtr\n * URL = db://assets/package/game/scripts/NodeHandCardCtr.ts\n * Time = Mon Aug 14 2023 12:07:20 GMT+0800 (中国标准时间)\n * Author = harvyson\n *\n * Life: onLoad-->onInitModuleEvent-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n * \n */\n\n@ccclass('NodeHandCardCtr')\nexport class NodeHandCardCtr extends BaseComponent {\n    /** 牌节点 */\n    @property({ tooltip: \"牌节点\", type: Node })\n    private nodeCard: Node = null;\n\n    /** 本家方位 */\n    private _hostDir: number = 0;\n    /** 麻将数量列表 */\n    private _numList: number[] = null;\n    /** 麻将位置列表 */\n    private _seatList: Node[][] = null;\n    /** 麻将动画Target列表 */\n    private _seatListTarget: Vec3[][] = null;\n    /** 手牌开始位置 */\n    private _cardStart: number = 0;\n    /** 最后一张手牌间隔 */\n    private _spaceLast: number = 0;\n\n    /** 手牌状态 */\n    private _cardStatus: GameViewConfig.HandCardStatus = GameViewConfig.HandCardStatus.Idle;\n\n    /** override 初始化模块事件 */\n    protected onInitModuleEvent() {\n    };\n\n    onLoad() {\n        this.initData()\n        this.initView()\n    };\n\n\n    start() {\n\n    }\n\n    initData() {\n        this._numList = [0, 0, 0, 0];\n        this._seatList = new Array(4);\n        this._seatListTarget = [[], [], [], []];\n    }\n\n    initView() {\n        let num = 14;\n        let width = GameViewConfig.CardConfig.Width;\n        let spaceLast = width * 0.5; // 行牌玩家新拿的一张牌，放在最右侧，并与其他牌保持一定距离\n        let start = (width * num) / 2 + spaceLast - width / 2;\n\n        this._cardStart = start;\n        this._spaceLast = spaceLast;\n\n        for (let dir = 0; dir < 4; dir++) {\n            // 每个方向的手牌设定一个父节点，方便管理\n            let nodeSeat = new Node();\n            nodeSeat.setRotationFromEuler(0, 90 * dir, 0);\n            this.node.addChild(nodeSeat);\n\n            // 四个方向的手牌都以东方向为基础方向，旋转父节点分别对应到四个方向\n            // 以东为基础方向后，二维坐标系，向右为x轴正方向，向上为y轴正方向\n            this._seatList[dir] = [];\n            for (let i = 0; i < num; i++) {\n                let leftToRight = -start + i * width;\n                if (i == num) {\n                    leftToRight += spaceLast;\n                }\n                let card = instantiate(this.nodeCard);\n                card.setPosition(leftToRight, GameViewConfig.CardConfig.GroundToHandCard, GameViewConfig.CardConfig.CenterToHandCard);\n                card.setRotationFromEuler(90, 0, 0);\n                nodeSeat.addChild(card);\n                this._seatList[dir].push(card);\n            }\n        }\n    }\n\n    resetView() {\n        this._hostDir = RoomMgr.getInstance().mySeatId - 1;\n\n        for (let dir = 0; dir < this._seatListTarget.length; dir++) {\n            let targets = this._seatListTarget[dir];\n            for (let i = 0; i < targets.length; i++) {\n                Tween.stopAllByTarget(targets[i]);\n            }\n        }\n\n        // 清空所有手牌\n        for (let dir = 0; dir < this._seatList.length; dir++) {\n            let cards = this._seatList[dir];\n            for (let i = 0; i < cards.length; i++) {\n                cards[i].active = false;\n                Tween.stopAllByTarget(cards[i]);\n\n                cards[i].setRotationFromEuler(90, 0, 0);\n                let pos = cards[i].getPosition();\n                cards[i].setPosition(pos.x, GameViewConfig.CardConfig.GroundToHandCard, GameViewConfig.CardConfig.CenterToHandCard)\n            }\n        }\n\n        this._numList = [0, 0, 0, 0];\n\n        this._seatListTarget = [[], [], [], []];\n\n        this._cardStatus = GameViewConfig.HandCardStatus.Idle;\n    }\n\n    /** 游戏开始 */\n    onGameStart() {\n        this.resetView();\n    }\n\n    /** 换位 */\n    OnChangedSeat(hostDir: number) {\n        this._hostDir = hostDir; // 换位需要重置手牌（本家不显示手牌）\n    }\n\n    /** 发牌 */\n    onDealCard(data: Game.IDealCard) {\n        this.dealCard(data.cardsCount);\n        this.playAnimOfSort();\n    }\n\n    /** 发牌处理 */\n    private dealCard(countList: number[]) {\n        if (Utils.isNull(this._hostDir) || this._hostDir < 0 || this._hostDir >= 4) {\n            console.log(\"NodeHandCardCtr.dealCard\", \"本家座位号无效\");\n            return;\n        }\n\n        for (let dir = 0; dir < this._seatList.length; dir++) {\n            let num = countList[dir];\n            let cards = this._seatList[dir];\n            for (let i = 0; i < cards.length; i++) {\n                if (dir == this._hostDir) {\n                    cards[i].active = false;\n                } else {\n                    cards[i].active = (i + 1) <= num;\n                }\n            }\n            this._numList[dir] = dir == this._hostDir ? 0 : num;\n            this.adjustPosition(dir)\n        }\n    }\n\n    /** 调整手牌的位置 */\n    private adjustPosition(dir: number) {\n        let num = this._numList[dir];\n        let cards = this._seatList[dir];\n        for (let i = 0; i < num; i++) {\n            let leftToRight = -this._cardStart + i * GameViewConfig.CardConfig.Width;\n            if (i == (num - 1) && this.turnToMe(num)) {\n                leftToRight += this._spaceLast;\n            }\n            let card = cards[i];\n            let pos = card.getPosition();\n            card.setPosition(leftToRight, GameViewConfig.CardConfig.GroundToHandCard, GameViewConfig.CardConfig.CenterToHandCard);\n        }\n    }\n\n    /** 是否轮到我出牌 */\n    private turnToMe(cardNum: number) {\n        return cardNum % 3 == 2\n    }\n\n    /** 触发手牌排序动画 */\n    private playAnimOfSort() {\n        if (this._cardStatus != GameViewConfig.HandCardStatus.Idle) {\n            return;\n        }\n        let t1 = 0.25;\n        let t2 = 0.25;\n\n        for (let dir = 0; dir < this._seatList.length; dir++) {\n            this.playAnimOfSortByDir(dir, t1, t2)\n        }\n        this._cardStatus = GameViewConfig.HandCardStatus.Sort;\n        tween(this.node)\n            .delay(t1 + t2 + 0.01)\n            .call(() => {\n                this._cardStatus = GameViewConfig.HandCardStatus.Idle;\n                for (let dir = 0; dir < this._seatList.length; dir++) {\n                    let cards = this._seatList[dir];\n                    for (let i = 0; i < cards.length; i++) {\n                        cards[i].setRotationFromEuler(90, 0, 0);\n                    }\n                }\n            })\n            .start();\n        EventManager.dispatch(FXJEvent.SYS_PLAY_EFFECT, FXJSound.GameAdjust);\n    }\n\n    /** 播放整理牌的动画 */\n    private playAnimOfSortByDir(dir: number, t1: number, t2: number) {\n        let num = this._numList[dir];\n        let cards = this._seatList[dir];\n        for (let i = 0; i < cards.length; i++) {\n            if ((i + 1) > num) {\n                break;\n            }\n            // 沿麻将牌面下边缘旋转，转到牌面向下后再转回原位置\n            let rotaionEuler = new Vec3(cards[i].eulerAngles);\n            let pos = new Vec3(cards[i].getPosition());\n            let point = new Vec3(pos.x, 0,\n                pos.z + GameViewConfig.CardConfig.Thickness - GameViewConfig.CardConfig.GroundToCard);\n\n            let tweenTargetVec3 = new Vec3(0, 0, 0);\n            let tw = new Tween(tweenTargetVec3)\n                .by(t1, new Vec3(90, 0, 0), {\n                    onUpdate: (target: Vec3, ratio: number) => {\n                        Utils.rotate3DAroundByPositionRotaion(cards[i], pos, rotaionEuler, point, target, true)\n                    }\n                })\n                .by(t2, new Vec3(-90, 0, 0), {\n                    onUpdate: (target: Vec3, ratio: number) => {\n                        Utils.rotate3DAroundByPositionRotaion(cards[i], pos, rotaionEuler, point, target, true)\n                    }\n                })\n                .start();\n\n            this._seatListTarget[dir].push(tweenTargetVec3);\n        }\n    }\n\n    /** 抓牌 */\n    onTakeCard(data: any) {\n        if (Utils.isNull(data.seatId) || data.seatId < 1 || data.seatId > 4) {\n            console.log(\"NodeHandCardCtr.onTakeCard\", \"座位号错误\");\n            return;\n        }\n\n\n        let dir = data.seatId - 1;\n        this.takeCard(dir);\n    }\n\n    /** 抓牌 */\n    private takeCard(dir: number) {\n\n        if (this._hostDir == dir) {\n            return;\n        }\n\n        if (this._cardStatus != GameViewConfig.HandCardStatus.Idle) {\n            return;\n        }\n\n        if (this.turnToMe(this._numList[dir])) {\n            console.log(\"NodeHandCardCtr.takeCard\", \"手牌数量异常，可能未正常移除\", \"dir\", dir);\n        }\n\n        let cards = this._seatList[dir];\n        let num = this._numList[dir] + 1;\n        console.log(\"NodeHandCardCtr.takeCard\", \"dir\", dir, \"num\", num);\n        if (num > cards.length) {\n            console.log(\"NodeHandCardCtr.takeCard\", \"手牌数量太多\", \"dir\", dir);\n            return;\n        }\n        cards[num - 1].active = true;\n        this._numList[dir] = num;\n        this.adjustPosition(dir);\n    }\n\n    /** 出牌 */\n    onOutCard(data: Game.IOperationResult) {\n        let dir = data.seatId - 1;\n\n        if (!this.turnToMe(this._numList[dir])) {\n            console.log(\"NodeHandCardCtr.takeCard\", \"手牌数量异常，可能未正常拿牌\", \"dir\", dir);\n            this.adjustPosition(dir);\n            return;\n        }\n\n        this.outCardAny(dir, 1)\n    }\n\n    /** 出牌或碰杠(一般用于正常出牌、碰或杠) */\n    private outCardAny(dir: number, count: number) {\n        console.log(\"NodeHandCardCtr.outCardAny\", \"dir\", dir, \"count\", count);\n        console.log(\"NodeHandCardCtr.outCardAny\", \"numList\", this._numList);\n        if (this._hostDir == dir) {\n            return;\n        }\n\n        if (this._cardStatus != GameViewConfig.HandCardStatus.Idle) {\n            return;\n        }\n\n        this.adjustPosition(dir);\n\n        let luckyNum = Math.floor(Math.random() * 100);\n        if (luckyNum % 2 == 1) {\n            this.simpleOutCardAny(dir, count);\n        } else {\n            this.normalOutCardAny(dir, count);\n        }\n\n    }\n\n    /** 简单出牌，直接丢出最右侧的牌 */\n    private simpleOutCardAny(dir: number, count: number) {\n        console.log(\"NodeHandCardCtr.simpleOutCardAny\");\n        let num = this._numList[dir];\n        if (num < count) {\n            return;\n        }\n\n        let cards = this._seatList[dir];\n        for (let i = 0; i < count; i++) {\n            cards[num - 1].active = false;\n            num--;\n        }\n        this._numList[dir] = num;\n    }\n\n    /** \n     * 模拟真实出牌，从中间打出一张，然后将最右侧的牌插入到空槽 \n     * 1. [已实现] 直接打出新拿的牌，无需整理\n     * 2. [已实现] 从手牌中抽出一张打出，然后空槽右侧牌全部向左推，整理完成\n     * 3. [未实现] 从手牌中抽出一张打出，最右侧新拿的牌直接插入空槽，整理完成\n     * 4. [未实现] 从手牌中抽出一张打出，中间一部分牌向左或向右移动，产生另一个空槽，再将最右侧新拿的牌插入空槽，整理完成\n     * */\n    private normalOutCardAny(dir: number, count: number) {\n        console.log(\"NodeHandCardCtr.normalOutCardAny begin\", this._numList[dir]);\n        let num = this._numList[dir];\n        if (num < count) {\n            return;\n        }\n\n        let a = count;\n        let b = num - 1;\n        let luckyNum = Math.min(Math.floor(Math.random() * (b + 1 - a) + a), b);\n\n        let cards = this._seatList[dir];\n\n        let removeNodeList = cards.splice(luckyNum - count, count);\n        removeNodeList.forEach((value, index, array) => {\n            value.active = false;\n        });\n\n        for (let i = 0; i < removeNodeList.length; i++) {\n            cards.push(removeNodeList[i]);\n        }\n\n        num -= count;\n        this._numList[dir] = num;\n\n        console.log(\"NodeHandCardCtr.normalOutCardAny end\", this._numList[dir]);\n        //\n        for (let i = 0; i < num; i++) {\n            let pos = cards[i].getPosition();\n            // 使用动画移动到目标位置\n            let x = - this._cardStart + i * GameViewConfig.CardConfig.Width;\n            if (i == (num - 1) && (num % 3 == 2)) {\n                x += this._spaceLast;\n            }\n            tween(cards[i])\n                .to(0.06 * count, { position: new Vec3(x, pos.y, pos.z) })\n                .start();\n        }\n    }\n\n    /** 碰杠 */\n    onPengGang(data: Game.IOperationResult) {\n        let dir = data.seatId - 1;\n        switch (data.opCode) {\n            case OPCode.OPE_PENG: // 碰\n            case OPCode.OPE_QIANG_PENG: // 抢碰\n                this.outCardAny(dir, 2);\n                break;\n            case OPCode.OPE_AN_GANG: // 暗杠\n                this.outCardAny(dir, 1);\n                break;\n            case OPCode.OPE_GANG: // 杠\n                this.outCardAny(dir, 3);\n                break;\n            case OPCode.OPE_BU_GANG: // 补杠\n                this.outCardAny(dir, 4);\n                break;\n            default:\n                break;\n        }\n    }\n\n    /** 胡牌 */\n    onHu(data: Game.IOperationResult) {\n        let dir = data.cardSeatId - 1;\n\n        if (!this.turnToMe(this._numList[dir])) {\n            // 手里是否有一张未打出的牌，有则移除\n            return;\n        }\n        this.outCardAny(dir, 1);\n    }\n\n    /** 游戏结束 */\n    onGameOver(data: Game.IHandCards) {\n        for (let i = 0; i < data.handCards.length; i++) {\n            let dir = i;\n            let cards = data.handCards[i].handCards;\n            if (cards.length > 14) {\n                console.log(\"NodeHandCardCtr.onGameOver\", \"手牌数据异常\", cards);\n                return;\n            }\n\n            // 重置手牌数据\n            this._numList[dir] = cards.length;\n            let nodes = this._seatList[dir];\n            for (let j = 0; j < nodes.length; j++) {\n                if (j < cards.length) {\n                    nodes[j].active = true;\n                    nodes[j].getComponent(NodeCardCtr).setCardByte(cards[j]);\n                } else {\n                    nodes[j].active = false;\n                }\n            }\n            this.adjustPosition(dir)\n\n            if (this.turnToMe(this._numList[dir])) {\n                this.simpleOutCardAny(dir, 1);\n            }\n        }\n\n        this.playAnimOfShow()\n    }\n\n    /** 触发亮牌动画 */\n    private playAnimOfShow() {\n        if (this._cardStatus != GameViewConfig.HandCardStatus.Idle) {\n            return;\n        }\n\n        let duration = 0.3;\n        for (let dir = 0; dir < this._seatList.length; dir++) {\n            let cards = this._seatList[dir];\n            let num = this._numList[dir];\n            for (let i = 0; i < cards.length; i++) {\n                if (i + 1 > num) {\n                    break;\n                }\n\n                let rotaionEuler = new Vec3(cards[i].eulerAngles);\n                let pos = new Vec3(cards[i].getPosition());\n                let point = new Vec3(pos.x, 0,\n                    pos.z - GameViewConfig.CardConfig.GroundToCard);\n\n                let tweenTargetVec3 = new Vec3(0, 0, 0);\n                let tw = new Tween(tweenTargetVec3)\n                    .by(duration, new Vec3(-90, 0, 0), {\n                        onUpdate: (target: Vec3, ratio: number) => {\n                            Utils.rotate3DAroundByPositionRotaion(cards[i], pos, rotaionEuler, point, target, true)\n                        }\n                    })\n                    .start();\n            }\n        }\n\n        this._cardStatus = GameViewConfig.HandCardStatus.Show;\n        tween(this.node)\n            .delay(duration + 0.01)\n            .call(() => {\n                this._cardStatus = GameViewConfig.HandCardStatus.Over;\n            })\n            .start();\n    }\n\n    /** 重连 */\n    onReconnect(data: GameViewConfig.ReconnectConfig) {\n        this.resetView();\n\n        let cardsCount = [0, 0, 0, 0];\n        data.playerList.forEach((value, index, array) => {\n            cardsCount[value.seatId - 1] = value.handCards.length;\n        })\n\n        this.dealCard(cardsCount);\n\n        for (let dir = 0; dir < this._seatList.length; dir++) { \n            this.adjustPosition(dir)\n        }\n    }\n\n    //销毁\n    onDestroy() {\n        this.resetView()\n    };\n}\n\n\n"]}