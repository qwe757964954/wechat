{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/game/module/opmgr/src/OprationMgr.ts"],"names":["Layout","_decorator","Utils","BaseComponent","RoomMgr","OPCode","GameEvent","CardUtil","OprationItem","ccclass","property","OprationMgr","_handlerTimeUpdate","coordinateList","onInitModuleEvent","addModelListener","UPDATE_USER_OPERATION_RESULT","updateUserOperationResult","onLoad","opmgrItem","node","active","x","y","itemScript","getComponent","updateAtlasCodeMap","event","resp","opCode","OPE_OUT_CARD","relativeSeatId","calculatePlayerSeat","getInstance","mySeatId","seatId","coordinate","setPosition","updateItemProps","userId","startOperationTime","stopSchedulerOnce","timeOut","addSchedulerOnce","handler","resetView","start"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACSA,MAAAA,M,OAAAA,M;AAAQC,MAAAA,U,OAAAA,U;;AACRC,MAAAA,K,iBAAAA,K;;AACAC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,S,iBAAAA,S;;AAEAC,MAAAA,Q,iBAAAA,Q;;AAEAC,MAAAA,Y,iBAAAA,Y;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBT,U;AAE9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;6BAGaU,W,WADZF,OAAO,CAAC,aAAD,C,UAINC,QAAQ,CAACV,MAAD,C,2BAJV,MACaW,WADb;AAAA;AAAA,0CAC+C;AAAA;AAAA;;AAAA;;AAAA,eAM9CC,kBAN8C,GAMzB,IANyB;AAAA,eAUtCC,cAVsC,GAUR,EAVQ;AAAA;;AAW9C;AACUC,QAAAA,iBAAiB,GAAG;AAC7B,eAAKC,gBAAL,CAAsB;AAAA;AAAA,sCAAUC,4BAAhC,EAA8D,KAAKC,yBAAnE;AACA;;AAEDC,QAAAA,MAAM,GAAI;AACH,eAAKC,SAAL,CAAeC,IAAf,CAAoBC,MAApB,GAA6B,KAA7B;AACN,eAAKR,cAAL,GAAsB,CACrB;AAAES,YAAAA,CAAC,EAAE,MAAL;AAAaC,YAAAA,CAAC,EAAE,CAAC;AAAjB,WADqB,EACO;AAC5B;AAAED,YAAAA,CAAC,EAAE,OAAL;AAAcC,YAAAA,CAAC,EAAE;AAAjB,WAFqB,EAEM;AAC3B;AAAED,YAAAA,CAAC,EAAE,MAAL;AAAaC,YAAAA,CAAC,EAAE;AAAhB,WAHqB,EAGM;AAC3B;AAAED,YAAAA,CAAC,EAAE,CAAC,OAAN;AAAeC,YAAAA,CAAC,EAAE;AAAlB,WAJqB,CAAtB,CAFS,CAMqB;;AAC9B,cAAIC,UAAuB,GAAG,KAAKL,SAAL,CAAeM,YAAf;AAAA;AAAA,2CAA9B;AACAD,UAAAA,UAAU,CAACE,kBAAX;AACA;;AAEDT,QAAAA,yBAAyB,CAACU,KAAK,GAAG,IAAT,EAAcC,IAAd,EAAyC;AACjE,cAAGA,IAAI,CAACC,MAAL,KAAgB;AAAA;AAAA,gCAAOC,YAA1B,EAAuC;AACtC;AACA;;AACD,gBAAMC,cAAc,GAAG;AAAA;AAAA,oCAASC,mBAAT,CAA6B;AAAA;AAAA,kCAAQC,WAAR,GAAsBC,QAAnD,EAA4DN,IAAI,CAACO,MAAjE,CAAvB;AACA,gBAAMC,UAAU,GAAG,KAAKvB,cAAL,CAAoBkB,cAApB,CAAnB;AACA,eAAKZ,SAAL,CAAeC,IAAf,CAAoBiB,WAApB,CAAgCD,UAAU,CAACd,CAA3C,EAA6Cc,UAAU,CAACb,CAAxD;AACA,eAAKJ,SAAL,CAAeC,IAAf,CAAoBC,MAApB,GAA6B,IAA7B;AACA,cAAIG,UAAuB,GAAG,KAAKL,SAAL,CAAeM,YAAf;AAAA;AAAA,2CAA9B;AACAD,UAAAA,UAAU,CAACc,eAAX,CAA2BV,IAAI,CAACW,MAAhC,EAAuCX,IAAI,CAACC,MAA5C;AACA,eAAKW,kBAAL;AACA;AACD;;;AACAA,QAAAA,kBAAkB,GAAG;AACd,eAAKC,iBAAL,CAAuB,KAAK7B,kBAA5B;AACN,eAAKA,kBAAL,GAA0B,IAA1B;AACM,cAAI8B,OAAc,GAAG,GAArB;AACA,eAAK9B,kBAAL,GAA0B,KAAK+B,gBAAL,CAAsBD,OAAtB,EAA+B;AAAA;AAAA,8BAAME,OAAN,CAAc,IAAd,EAAoB,KAAKC,SAAzB,CAA/B,CAA1B;AACN;;AACDA,QAAAA,SAAS,GAAE;AACV,eAAK1B,SAAL,CAAeC,IAAf,CAAoBC,MAApB,GAA6B,KAA7B;AACA;;AACDyB,QAAAA,KAAK,GAAI,CAER;;AAnD6C,O;;;;;iBAIT,I","sourcesContent":["\nimport { Layout, _decorator } from 'cc';\nimport { Utils } from '../../../../../framework/Utils';\nimport { BaseComponent } from '../../../../../framework/vc/BaseComponent';\nimport { RoomMgr } from '../../../cache/RoomMgr';\nimport { OPCode } from '../../../common/FXJConfig';\nimport { GameEvent } from '../../../common/GameEvent';\nimport { Game } from '../../../common/idl/Game';\nimport { CardUtil } from '../../../util/CardUtil';\nimport { Coordinate } from '../../match/src/Match';\nimport { OprationItem } from './OprationItem';\nconst { ccclass, property } = _decorator;\n\n/**\n * Name = OprationMgr\n * URL = db://assets/package/game/module/opmgr/src/OprationMgr.ts\n * Time = Tue Aug 08 2023 10:06:20 GMT+0800 (中国标准时间)\n * Author = qwe757964\n *\n * Life: onLoad-->onInitModuleEvent-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n * \n */\n \n@ccclass('OprationMgr')\nexport class OprationMgr extends BaseComponent {\n\t// @property({ type: Prefab, visible: false })\n    // _mjPrefab: Prefab | null;\n\t@property(Layout)\n    public opmgrItem: Layout | null = null;\n\t/** 时间更新句柄 */\n\t_handlerTimeUpdate = null;\n\t// @property(Prefab)\n    // public opmgrItem: Prefab | null = null;\n\n\tprivate\tcoordinateList:Coordinate[] = [];\n\t/** override 初始化模块事件 */\n\tprotected onInitModuleEvent() {\n\t\tthis.addModelListener(GameEvent.UPDATE_USER_OPERATION_RESULT, this.updateUserOperationResult);\n\t};\n\t\n\tonLoad () {\n        this.opmgrItem.node.active = false;\n\t\tthis.coordinateList = [\n\t\t\t{ x: 21.979, y: -132.443 }, //下\n\t\t\t{ x: 352.788, y: 85.391 }, //右\n\t\t\t{ x: 22.299, y: 256.069 }, // 上\n\t\t\t{ x: -344.469, y: 84.486 }]; //左\n\t\tlet itemScript:OprationItem = this.opmgrItem.getComponent(OprationItem);\n\t\titemScript.updateAtlasCodeMap();\t\t\n\t};\n\n\tupdateUserOperationResult(event = null,resp:Game.IOperationResult){\n\t\tif(resp.opCode === OPCode.OPE_OUT_CARD){\n\t\t\treturn;\n\t\t}\n\t\tconst relativeSeatId = CardUtil.calculatePlayerSeat(RoomMgr.getInstance().mySeatId,resp.seatId);\n\t\tconst coordinate = this.coordinateList[relativeSeatId];\n\t\tthis.opmgrItem.node.setPosition(coordinate.x,coordinate.y);\n\t\tthis.opmgrItem.node.active = true;\n\t\tlet itemScript:OprationItem = this.opmgrItem.getComponent(OprationItem);\n\t\titemScript.updateItemProps(resp.userId,resp.opCode);\n\t\tthis.startOperationTime();\t\t\n\t}\n\t/** 开始更新时间 */\n\tstartOperationTime() {\n        this.stopSchedulerOnce(this._handlerTimeUpdate);\n\t\tthis._handlerTimeUpdate = null;\n        let timeOut:number = 1.5;\n        this._handlerTimeUpdate = this.addSchedulerOnce(timeOut, Utils.handler(this, this.resetView))\n\t}\n\tresetView(){\n\t\tthis.opmgrItem.node.active = false;\n\t}\n\tstart () {\n\n\t};\n\n}\n\n"]}