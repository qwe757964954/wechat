{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/game/scripts/NodeOutCardCtr.ts"],"names":["Node","Tween","Vec3","_decorator","instantiate","tween","Utils","EventManager","BaseComponent","FXJEvent","GameViewConfig","NodeCardCtr","ccclass","property","NodeOutCardCtr","tooltip","type","_numList","_seatList","_offsetArrow","onInitModuleEvent","onLoad","initData","initView","start","Array","indexStart","CardConfig","Width","SpaceOutCard","distance","CenterToOutCard","dir","nodeSeat","setRotationFromEuler","node","addChild","i","length","layer","Math","floor","index","distanceFromCenter","Height","leftToRight","card","nodeCard","setPosition","GroundToCard","push","ceil","nodeArrow","pos","getPosition","x","y","z","resetView","cards","active","onGameStart","OnChangedSeat","hostDir","onOutCard","data","seatId","showCard","opCard","cardNumber","cardList","num","console","log","getComponent","setCardByte","stopAllByTarget","rotate3DAround","moveTween","by","position","repeatForever","hideCard","showAnim","aniType","AnimType","Hu2","getWorldPosition","dispatch","VIEW_UI_3D_GET_CAMERA","VIEW_OUT_CARD_ANI_PLAY","huTime","delay","call","onPengGang","cardSeatId","onHu","onGameOver","onReconnect","playerList","forEach","value","array","outCards","table_isEmpty","isNotNull","status","onDestroy"],"mappings":"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","sourcesContent":["\nimport { Node, Tween, Vec3, _decorator, instantiate, tween } from 'cc';\nimport { Utils } from '../../../framework/Utils';\nimport { EventManager } from '../../../framework/manager/EventManager';\nimport { BaseComponent } from '../../../framework/vc/BaseComponent';\nimport { FXJEvent } from '../common/FXJEvent';\nimport { GameViewConfig } from '../common/GameViewConfig';\nimport { Game } from '../common/idl/Game';\nimport { NodeCardCtr } from './NodeCardCtr';\nconst { ccclass, property } = _decorator;\n\n/**\n * Name = NodeOutCardCtr\n * URL = db://assets/package/game/scripts/NodeOutCardCtr.ts\n * Time = Mon Aug 14 2023 12:07:51 GMT+0800 (中国标准时间)\n * Author = harvyson\n *\n * Life: onLoad-->onInitModuleEvent-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n * \n */\n\n@ccclass('NodeOutCardCtr')\nexport class NodeOutCardCtr extends BaseComponent {\n    /** 牌节点 */\n    @property({ tooltip: \"牌节点\", type: Node })\n    private nodeCard: Node = null;\n\n    /** 箭头节点 */\n    @property({ tooltip: \"箭头节点\", type: Node })\n    private nodeArrow: Node = null;\n\n    /** 麻将数量列表 */\n    private _numList: number[] = null;\n    /** 麻将位置列表 */\n    private _seatList: Node[][] = null;\n    /** 箭头初始位置 */\n    private _offsetArrow: Vec3 = null;\n\n\n    /** override 初始化模块事件 */\n    protected onInitModuleEvent() {\n    };\n\n    onLoad() {\n        this.initData()\n        this.initView()\n    };\n\n\n    start() {\n\n    }\n\n    initData() {\n        this._numList = [0, 0, 0, 0];\n        this._seatList = new Array(4);\n    }\n\n    initView() {\n        let indexStart = (GameViewConfig.CardConfig.Width * 6 + GameViewConfig.CardConfig.SpaceOutCard * (6 - 1)) / 2\n            - GameViewConfig.CardConfig.Width / 2 - 2 // 往右2米。这里-2\n        let distance = GameViewConfig.CardConfig.CenterToOutCard;\n        for (let dir = 0; dir < 4; dir++) {\n            // 每个方向的手牌设定一个父节点，方便管理\n            let nodeSeat = new Node();\n            nodeSeat.setRotationFromEuler(0, 90 * dir, 0);\n            this.node.addChild(nodeSeat);\n\n            this._seatList[dir] = [];\n            for (let i = 0; i < 18; i++) {\n                let length = this._seatList[dir].length;\n                let layer = Math.floor(length / 6);\n                let index = length % 6;\n                let distanceFromCenter = distance + ((layer - 1) * GameViewConfig.CardConfig.Height); // 离桌面中心的垂直距离\n                let leftToRight = -indexStart + index * (GameViewConfig.CardConfig.Width + GameViewConfig.CardConfig.SpaceOutCard); // 指定层的第index张牌的位置\n                let card = instantiate(this.nodeCard);\n                card.setPosition(leftToRight, GameViewConfig.CardConfig.GroundToCard, distanceFromCenter);\n                nodeSeat.addChild(card);\n                this._seatList[dir].push(card);\n            }\n\n            // 超过18张的地方\n            for (let i = 0; i < 9; i++) {\n                let length = this._seatList[dir].length;\n                let layer = Math.ceil((i + 1) / 3);\n                let index = length % 3;\n                let distanceFromCenter = distance + ((layer - 2) * GameViewConfig.CardConfig.Height); // 离桌面中心的垂直距离\n                let leftToRight = -indexStart + 6 * GameViewConfig.CardConfig.Width + 1 + index * (GameViewConfig.CardConfig.Width + GameViewConfig.CardConfig.SpaceOutCard); // 指定层的第index张牌的位置\n                let card = instantiate(this.nodeCard);\n                card.setPosition(leftToRight, GameViewConfig.CardConfig.GroundToCard, distanceFromCenter);\n                nodeSeat.addChild(card);\n                this._seatList[dir].push(card);\n            }\n        }\n\n        this.nodeArrow.setPosition(0, -4.5, 0);\n        let pos = this.nodeArrow.getPosition();\n        this._offsetArrow = new Vec3(pos.x, pos.y + GameViewConfig.CardConfig.GroundToCard, pos.z);\n        this.nodeArrow.setPosition(this._offsetArrow);\n    }\n\n    resetView() {\n        for (let dir = 0; dir < this._seatList.length; dir++) {\n            let cards = this._seatList[dir];\n            for (let i = 0; i < cards.length; i++) {\n                cards[i].active = false;\n            }\n        }\n\n        this._numList = [0, 0, 0, 0];\n\n        this.nodeArrow.active = false;\n    }\n\n    /** 游戏开始 */\n    onGameStart() {\n        this.resetView();\n    }\n\n    /** 换位 */\n    OnChangedSeat(hostDir: number) {\n        // 换位不影响出牌\n    }\n\n    /** 出牌 */\n    onOutCard(data: Game.IOperationResult) {\n        let dir = data.seatId - 1;\n        this.showCard(dir, data.opCard);\n    }\n\n    private showCard(dir: number, cardNumber: number) {\n        let cardList = this._seatList[dir];\n        let num = this._numList[dir] + 1;\n        if (num > cardList.length) {\n            console.log(\"NodeOutCardCtr.showCard\", \"出牌数量已超上限\", \"num\", num);\n            return;\n        }\n\n        let index = num - 1;\n        cardList[index].active = true;\n        cardList[index].getComponent(NodeCardCtr).setCardByte(cardNumber);\n        let pos = cardList[index].getPosition();\n        this.nodeArrow.active = true;\n        Tween.stopAllByTarget(this.nodeArrow);\n        this.nodeArrow.setPosition(pos.x + this._offsetArrow.x, this._offsetArrow.y, pos.z + this._offsetArrow.z)\n        Utils.rotate3DAround(this.nodeArrow, new Vec3(0, 0, 0), new Vec3(0, 90 * dir, 0), false)\n        let moveTween = tween(this.nodeArrow)\n            .by(0.6, { position: new Vec3(0, 1, 0) })\n            .by(0.6, { position: new Vec3(0, -1, 0) })\n\n        tween(this.nodeArrow)\n            .repeatForever(moveTween)\n            .start();\n        this._numList[dir] = num;\n    }\n\n    private hideCard(dir: number, cardNumber: number, showAnim: boolean) {\n        let cardList = this._seatList[dir];\n        let num = this._numList[dir];\n        if (num < 1) {\n            return;\n        }\n\n        let index = num - 1;\n        if (showAnim) {\n            // 胡牌动画\n            let data: GameViewConfig.AnimConfig = {\n                seatId : dir + 1,\n                aniType : GameViewConfig.AnimType.Hu2,\n                pos : cardList[index].getWorldPosition(),\n            }\n            EventManager.dispatch(FXJEvent.VIEW_UI_3D_GET_CAMERA, FXJEvent.VIEW_OUT_CARD_ANI_PLAY, data);\n\n            let huTime = 0.5\n            tween(this.node)\n                .delay(huTime)\n                .call(() => {\n                    cardList[index].active = false;\n                    this.nodeArrow.active = false;\n                    this._numList[dir] = index;\n                })\n                .start();\n        } else {\n            cardList[index].active = false;\n            this.nodeArrow.active = false;\n            this._numList[dir] = index;\n        }\n    }\n\n    /** 碰杠 */\n    onPengGang(data: Game.IOperationResult) {\n        let dir = data.cardSeatId - 1;\n        this.hideCard(dir, data.opCard, false);\n    }\n\n    /** 胡牌 */\n    onHu(data: Game.IOperationResult) {\n        if (data.cardSeatId == data.seatId) {\n            console.log(\"NodeOutCardCtr.onHu\", \"自摸不需要移除牌\");\n            return;\n        }\n\n        let dir = data.cardSeatId - 1;\n        this.hideCard(dir, data.opCard, true);\n    }\n\n    /** 游戏结束 */\n    onGameOver(data: Game.IHandCards) {\n    }\n\n    /** 重连 */\n    onReconnect(data: GameViewConfig.ReconnectConfig) {\n        this.resetView();\n\n        data.playerList.forEach((value, index, array) => {\n            let dir = value.seatId - 1;\n            let cards = value.outCards;\n            if (!Utils.table_isEmpty(cards)) {\n                for (let i = 0; i < cards.length; i++) { \n                    if (Utils.isNotNull(cards[i].status) && cards[i].status != 1) {\n                        this.showCard(dir, cards[i].card);\n                    }\n                    \n                }\n            }\n        });\n    }\n\n    //销毁\n    onDestroy() {\n        Tween.stopAllByTarget(this.nodeArrow);\n    };\n\n}\n\n\n"]}