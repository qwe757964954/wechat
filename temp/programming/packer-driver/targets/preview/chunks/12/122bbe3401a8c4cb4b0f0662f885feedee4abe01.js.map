{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/hall/scripts/commonBtnPrefabCtr.ts"],"names":["Label","Node","_decorator","GCache","AppEvent","AppSound","GConstants","GameRes","UIID","Utils","EventManager","BaseComponent","Platform","ccclass","property","menu","commonBtnPrefabCtr","tooltip","type","_redDotView","_isShowShopAdd","_isCanClickShop","isShowShop","is","onInitModuleEvent","addModelListener","USER_UPDATE_PROPERTY","updatePropty","NOTIFY_UPDATE_RED_DOT","refreshRedDot","VIEW_UI_OPENED","notifyOpenedUI","VIEW_UI_CLOSED","notifyClosedUI","onLoad","initData","start","initView","event","viewParam","node","isValid","goldNodeAdd","Prefab_Mall","path","active","status","isCanPay","initShopView","param","PropertyType","SILVER_COIN","goldenLabel","string","string_matchStr","User","getUserMoneyByID","keyType","RedDotConf","Email","btnEmailNode","RedDot","need_show_email","imgRedDot","getChildByName","hasRedDot","onKeFuClick","dispatch","SYS_PLAY_EFFECT","CommClick","console","log","isWXPlatform","openCustomerServiceConversation","SYS_TOAST_TIP","content","_doCallBackOpenCus","shareID","NET_REQ_SHARE_AWARD","ReqUrl","shareType","other","onSettingClick","VIEW_UI_OPEN","SettingPrefab","onMailClick","MailPrefab","onGoldenClick","MallPrefab","id","ShopBigTabType","onDiamonClick","onDestroy"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACSA,MAAAA,K,OAAAA,K;AAAOC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,U,OAAAA,U;;AACbC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,I,iBAAAA,I;;AACAC,MAAAA,K,iBAAAA,K;;AACAC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,a,kBAAAA,a;;AACAC,MAAAA,Q,kBAAAA,Q;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA,QAAX;AAAqBC,QAAAA;AAArB,O,GAA8Bb,U;AAEpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;oCAKac,kB,WAHZH,OAAO,CAAC,oBAAD,C,UAEPE,IAAI,CAAC,gCAAD,C,UAgBAD,QAAQ,CAAC;AAAEG,QAAAA,OAAO,EAAE,MAAX;AAAmBC,QAAAA,IAAI,EAAElB;AAAzB,OAAD,C,UAQRc,QAAQ,CAAC;AAAEG,QAAAA,OAAO,EAAE,KAAX;AAAkBC,QAAAA,IAAI,EAAEjB;AAAxB,OAAD,C,UAIRa,QAAQ,CAAC;AAAEG,QAAAA,OAAO,EAAE,QAAX;AAAqBC,QAAAA,IAAI,EAAEjB;AAA3B,OAAD,C,0CA9Bb,MAGae,kBAHb;AAAA;AAAA,0CAGsD;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAoClDG,WApCkD,GAoCpC,EApCoC;AAAA,eAuC1CC,cAvC0C,GAuChB,IAvCgB;AAAA,eA0C1CC,eA1C0C,GA0Cf,IA1Ce;AAAA;;AA8BlD;AACc,YAAVC,UAAU,CAACC,EAAD,EAAc;AACxB,eAAKH,cAAL,GAAsBG,EAAE,IAAI,IAAN,GAAaA,EAAb,GAAkB,IAAxC;AACH;;AAUD;AACUC,QAAAA,iBAAiB,GAAS;AAChC;AACA,eAAKC,gBAAL,CAAsB;AAAA;AAAA,oCAASC,oBAA/B,EAAqD,KAAKC,YAA1D,EAFgC,CAGhC;;AACA,eAAKF,gBAAL,CAAsB;AAAA;AAAA,oCAASG,qBAA/B,EAAsD,KAAKC,aAA3D,EAJgC,CAKhC;;AACA,eAAKJ,gBAAL,CAAsB;AAAA;AAAA,oCAASK,cAA/B,EAA+C,KAAKC,cAApD,EANgC,CAOhC;;AACA,eAAKN,gBAAL,CAAsB;AAAA;AAAA,oCAASO,cAA/B,EAA+C,KAAKC,cAApD;AACH;;AACDC,QAAAA,MAAM,GAAG;AACL,eAAKC,QAAL;AACH;;AAEDC,QAAAA,KAAK,GAAG;AACJ,eAAKC,QAAL;AACH;;AACDN,QAAAA,cAAc,CAACO,KAAD,EAAQC,SAAR,EAAmB;AAC7B,cAAI,CAAC,KAAKC,IAAN,IAAc,KAAKA,IAAL,CAAUC,OAAV,IAAqB,KAAvC,EAA8C;AAC1C;AACH;;AACD,cAAI,CAAC,KAAKC,WAAV,EAAuB;AACnB;AACH;;AACD,cAAIH,SAAS,IAAIA,SAAS,CAAC,QAAD,CAAT,IAAuB;AAAA;AAAA,kCAAQI,WAAR,CAAoBC,IAA5D,EAAkE;AAC9D,iBAAKF,WAAL,CAAiBG,MAAjB,GAA0B,KAA1B;AACA,iBAAKxB,eAAL,GAAuB,KAAvB;AACH;AACJ;;AAEDY,QAAAA,cAAc,CAACK,KAAD,EAAQC,SAAR,EAAmB;AAC7B,cAAI,CAAC,KAAKC,IAAN,IAAc,KAAKA,IAAL,CAAUC,OAAV,IAAqB,KAAvC,EAA8C;AAC1C;AACH;;AACD,cAAI,CAAC,KAAKC,WAAV,EAAuB;AACnB;AACH;;AACD,cAAIH,SAAS,IAAIA,SAAS,CAAC,QAAD,CAAT,IAAuB;AAAA;AAAA,kCAAQI,WAAR,CAAoBC,IAA5D,EAAkE;AAC9D,gBAAIE,MAAM,GAAG;AAAA;AAAA,sCAASC,QAAT,EAAb;AACA,iBAAKL,WAAL,CAAiBG,MAAjB,GAA0BC,MAA1B;AACA,iBAAKzB,eAAL,GAAuByB,MAAvB;AACH;AACJ,SAtFiD,CAwFlD;;;AACAX,QAAAA,QAAQ,GAAG;AACP,eAAKhB,WAAL,GAAmB;AACf;AACA;AAFe,WAAnB;AAIH,SA9FiD,CA+FlD;;;AACAkB,QAAAA,QAAQ,GAAG;AACP,eAAKV,YAAL;AACA,eAAKqB,YAAL;AACA,eAAKnB,aAAL;AACH,SApGiD,CAuGlD;;;AACAmB,QAAAA,YAAY,GAAG;AACX;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA,cAAIF,MAAM,GAAG,IAAb;;AACA,cAAI,KAAK1B,cAAL,IAAuB,KAA3B,EAAkC;AAC9B0B,YAAAA,MAAM,GAAG,KAAT,CAD8B,CAE9B;;AACA,iBAAKJ,WAAL,CAAiBG,MAAjB,GAA0BC,MAA1B;AACA,iBAAKzB,eAAL,GAAuByB,MAAvB;AACH,WALD,MAKO;AACHA,YAAAA,MAAM,GAAG;AAAA;AAAA,sCAASC,QAAT,EAAT,CADG,CAEH;;AACA,iBAAKL,WAAL,CAAiBG,MAAjB,GAA0BC,MAA1B;AACA,iBAAKzB,eAAL,GAAuByB,MAAvB;AACH;AAEJ;AAGD;;;AACAnB,QAAAA,YAAY,CAACW,KAAD,EAAeW,KAAf,EAA6B;AAAA,cAA5BX,KAA4B;AAA5BA,YAAAA,KAA4B,GAApB,IAAoB;AAAA;;AAAA,cAAdW,KAAc;AAAdA,YAAAA,KAAc,GAAN,IAAM;AAAA;;AACrC,cAAIA,KAAJ,EAAW;AACP,gBAAIA,KAAK,CAAC,MAAD,CAAL,IAAiB;AAAA;AAAA,0CAAWC,YAAX,CAAwBC,WAA7C,EAA0D;AACtD,mBAAKC,WAAL,CAAiBC,MAAjB,GAA0B;AAAA;AAAA,kCAAMC,eAAN,CAAsB;AAAA;AAAA,oCAAOC,IAAP,CAAYC,gBAAZ,CAA6B;AAAA;AAAA,4CAAWN,YAAX,CAAwBC,WAArD,CAAtB,CAA1B;AACH;AACJ,WAJD,MAIO;AACH,iBAAKC,WAAL,CAAiBC,MAAjB,GAA0B;AAAA;AAAA,gCAAMC,eAAN,CAAsB;AAAA;AAAA,kCAAOC,IAAP,CAAYC,gBAAZ,CAA6B;AAAA;AAAA,0CAAWN,YAAX,CAAwBC,WAArD,CAAtB,CAA1B;AACH;AAEJ;AAED;;;AACAtB,QAAAA,aAAa,CAACS,KAAD,EAAemB,OAAf,EAA+B;AAAA,cAA9BnB,KAA8B;AAA9BA,YAAAA,KAA8B,GAAtB,IAAsB;AAAA;;AAAA,cAAhBmB,OAAgB;AAAhBA,YAAAA,OAAgB,GAAN,IAAM;AAAA;;AACxC,cAAIA,OAAO,IAAI,IAAf,EAAqB;AACjBA,YAAAA,OAAO,GAAG;AAAA;AAAA,0CAAWC,UAAX,CAAsBC,KAAhC;AACH;;AACD,cAAIF,OAAO,IAAI;AAAA;AAAA,wCAAWC,UAAX,CAAsBC,KAArC,EAA4C;AACxC;AACH;;AACD,eAAKC,YAAL,CAAkBf,MAAlB,GAA2B;AAAA;AAAA,gCAAOgB,MAAP,CAAcC,eAAd,EAA3B;;AACA,cAAI,KAAKF,YAAL,CAAkBf,MAAlB,IAA4B,IAAhC,EAAsC;AAClC,gBAAIkB,SAAS,GAAG,KAAKH,YAAL,CAAkBI,cAAlB,CAAiC,SAAjC,CAAhB;;AACA,gBAAID,SAAJ,EAAe;AACXA,cAAAA,SAAS,CAAClB,MAAV,GAAmB;AAAA;AAAA,oCAAOgB,MAAP,CAAcI,SAAd,CAAwBR,OAAxB,CAAnB;AACH;AACJ;AACJ,SA/JiD,CAiKlD;;;AACAS,QAAAA,WAAW,CAAC5B,KAAD,EAAe;AACtB;AAAA;AAAA,4CAAa6B,QAAb,CAAsB;AAAA;AAAA,oCAASC,eAA/B,EAAgD;AAAA;AAAA,oCAASC,SAAzD;AACAC,UAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ;;AACA,cAAI;AAAA;AAAA,oCAASC,YAAT,EAAJ,EAA6B;AACzB;AAAA;AAAA,sCAASC,+BAAT;AACH,WAFD,MAEO;AACH;AAAA;AAAA,8CAAaN,QAAb,CAAsB;AAAA;AAAA,sCAASO,aAA/B,EAA8C;AAAEC,cAAAA,OAAO,EAAE;AAAX,aAA9C;AACH;AACJ;AACD;AACJ;AACA;AACA;;;AACIC,QAAAA,kBAAkB,CAACC,OAAD,EAAU;AACxB;AAAA;AAAA,4CAAaV,QAAb,CAAsB;AAAA;AAAA,oCAASW,mBAA/B,EAAoDD,OAApD,EAA6D;AAAA;AAAA,wCAAWE,MAAX,CAAkBC,SAAlB,CAA4BC,KAAzF,EAAgG,KAAhG;AACH,SAjLiD,CAmLlD;;;AACAC,QAAAA,cAAc,CAAC5C,KAAD,EAAe;AACzB;AAAA;AAAA,4CAAa6B,QAAb,CAAsB;AAAA;AAAA,oCAASC,eAA/B,EAAgD;AAAA;AAAA,oCAASC,SAAzD;AACA;AAAA;AAAA,4CAAaF,QAAb,CAAsB;AAAA;AAAA,oCAASgB,YAA/B,EAA6C;AAAA;AAAA,4BAAKC,aAAlD;AACH,SAvLiD,CAyLlD;;;AACAC,QAAAA,WAAW,CAAC/C,KAAD,EAAe;AACtB;AAAA;AAAA,4CAAa6B,QAAb,CAAsB;AAAA;AAAA,oCAASC,eAA/B,EAAgD;AAAA;AAAA,oCAASC,SAAzD;AACA;AAAA;AAAA,4CAAaF,QAAb,CAAsB;AAAA;AAAA,oCAASgB,YAA/B,EAA6C;AAAA;AAAA,4BAAKG,UAAlD,EAA8D,IAA9D,EAAoE,IAApE,EAA0E,IAA1E,EAAgF,IAAhF;AACH,SA7LiD,CA+LlD;;;AACAC,QAAAA,aAAa,CAACjD,KAAD,EAAe;AACxB,cAAI,KAAKjB,eAAT,EAA0B;AACtB,gBAAI;AAAA;AAAA,sCAAS0B,QAAT,MAAuB,KAA3B,EAAkC;AAC9B;AACH,aAHqB,CAItB;;;AACA;AAAA;AAAA,8CAAaoB,QAAb,CAAsB;AAAA;AAAA,sCAASgB,YAA/B,EAA6C;AAAA;AAAA,8BAAKK,UAAlD,EAA8D;AAAEC,cAAAA,EAAE,EAAE;AAAA;AAAA,4CAAWC,cAAX,CAA0BvC;AAAhC,aAA9D,EAA6G,EAA7G;AACH;AACJ,SAxMiD,CA0MlD;;;AACAwC,QAAAA,aAAa,CAACrD,KAAD,EAAe,CACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACH,SAnNiD,CAqNlD;;;AACAsD,QAAAA,SAAS,GAAG,CAEX;;AAxNiD,O;;;;;iBAgBd,I;;;;;;;iBAQD,I;;;;;;;iBAIC,I","sourcesContent":["\nimport { Label, Node, _decorator } from 'cc';\nimport { GCache } from '../../../cache/GCache';\nimport { AppEvent } from '../../../config/AppEvent';\nimport { AppSound } from '../../../config/AppSound';\nimport { GConstants } from '../../../config/GameConstant';\nimport { GameRes } from '../../../config/GameRes';\nimport { UIID } from '../../../config/UIConfig';\nimport { Utils } from '../../../framework/Utils';\nimport { EventManager } from '../../../framework/manager/EventManager';\nimport { BaseComponent } from '../../../framework/vc/BaseComponent';\nimport { Platform } from '../../../platform/Platform';\nconst { ccclass, property, menu } = _decorator;\n\n/**\n * Name = commonBtnPrefabCtr\n * URL = db://assets/package/hall/scripts/commonBtnPrefabCtr.ts\n * Time = Wed Sep 07 2022 18:23:56 GMT+0800 (中国标准时间)\n * Author = Tomoe\n *\n * Life: onLoad-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n */\n\n@ccclass('commonBtnPrefabCtr')\n//方便编辑器识别的菜单项目\n@menu('prefab/hall/commonBtnPrefabCtr')\nexport class commonBtnPrefabCtr extends BaseComponent {\n\n    // //钻石展示节点\n    // @property({ tooltip: \"金币展示节点\", type: Node })\n    // private goldNode: Node | null = null;\n\n    // //钻石展示节点\n    // @property({ tooltip: \"钻石展示节点\", type: Node })\n    // private diamondNode: Node | null = null;\n\n    // //钻石数量\n    // @property({ tooltip: \"钻石数量\", type: Label })\n    // private diamondLabel: Label | null = null;\n\n    //银币数量\n    @property({ tooltip: \"银币数量\", type: Label })\n    private goldenLabel: Label | null = null;\n\n    // //金条+\n    // @property({ tooltip: \"金条+\", type: Node })\n    // private diamondNodeAdd: Node | null = null;\n\n    //银币+\n    @property({ tooltip: \"银币+\", type: Node })\n    private goldNodeAdd: Node | null = null;\n\n    //邮件按钮节点\n    @property({ tooltip: \"邮件按钮节点\", type: Node })\n    private btnEmailNode: Node | null = null;\n\n    /**是否点击显示商城*/\n    set isShowShop(is: boolean) {\n        this._isShowShopAdd = is != null ? is : null;\n    };\n\n    /** 红点UI队列 */\n    _redDotView = {};\n\n    /** 是否初始显示 */\n    private _isShowShopAdd: boolean = null;\n\n    /** 是否可点击 */\n    private _isCanClickShop: boolean = true;\n    /**初始化添加事件绑定 */\n    protected onInitModuleEvent(): void {\n        //玩家资产更新\n        this.addModelListener(AppEvent.USER_UPDATE_PROPERTY, this.updatePropty);\n        //红点更新\n        this.addModelListener(AppEvent.NOTIFY_UPDATE_RED_DOT, this.refreshRedDot);\n        //有界面被打开\n        this.addModelListener(AppEvent.VIEW_UI_OPENED, this.notifyOpenedUI);\n        //有界面被关闭\n        this.addModelListener(AppEvent.VIEW_UI_CLOSED, this.notifyClosedUI);\n    }\n    onLoad() {\n        this.initData()\n    };\n\n    start() {\n        this.initView()\n    };\n    notifyOpenedUI(event, viewParam) {\n        if (!this.node || this.node.isValid == false) {\n            return\n        }\n        if (!this.goldNodeAdd) {\n            return;\n        }\n        if (viewParam && viewParam[\"Prefab\"] == GameRes.Prefab_Mall.path) {\n            this.goldNodeAdd.active = false;\n            this._isCanClickShop = false;\n        }\n    }\n\n    notifyClosedUI(event, viewParam) {\n        if (!this.node || this.node.isValid == false) {\n            return\n        }\n        if (!this.goldNodeAdd) {\n            return;\n        }\n        if (viewParam && viewParam[\"Prefab\"] == GameRes.Prefab_Mall.path) {\n            let status = Platform.isCanPay();\n            this.goldNodeAdd.active = status;\n            this._isCanClickShop = status;\n        }\n    }\n\n    //初始化数据\n    initData() {\n        this._redDotView = {\n            /** 邮件 */\n            //\t[GConstants.RedDotConf.Email]: this.btnEmailNode,\n        }\n    }\n    //初始化界面\n    initView() {\n        this.updatePropty();\n        this.initShopView();\n        this.refreshRedDot();\n    }\n\n\n    //初始化商城的显示状态(IOS暂不支持微信支付功能)\n    initShopView() {\n        // if (!this.diamondNode || !this.goldNode) {\n        // \treturn;\n        // }\n\n        // if (Platform.isCanPay()) {\n        // \tthis.diamondNode.active = true;\n        // } else {\n        // \tthis.diamondNode.active = false;\n        // }\n        // this.goldNode.active = true;\n\n        let status = true;\n        if (this._isShowShopAdd == false) {\n            status = false;\n            // this.diamondNodeAdd.active = status;\n            this.goldNodeAdd.active = status;\n            this._isCanClickShop = status;\n        } else {\n            status = Platform.isCanPay();\n            // this.diamondNodeAdd.active = status;\n            this.goldNodeAdd.active = status;\n            this._isCanClickShop = status;\n        }\n\n    }\n\n\n    /**更新玩家资产*/\n    updatePropty(event = null, param = null) {\n        if (param) {\n            if (param[\"type\"] == GConstants.PropertyType.SILVER_COIN) {\n                this.goldenLabel.string = Utils.string_matchStr(GCache.User.getUserMoneyByID(GConstants.PropertyType.SILVER_COIN));\n            }\n        } else {\n            this.goldenLabel.string = Utils.string_matchStr(GCache.User.getUserMoneyByID(GConstants.PropertyType.SILVER_COIN));\n        }\n\n    }\n\n    /** 红点更新 */\n    refreshRedDot(event = null, keyType = null) {\n        if (keyType == null) {\n            keyType = GConstants.RedDotConf.Email;\n        }\n        if (keyType != GConstants.RedDotConf.Email) {\n            return;\n        }\n        this.btnEmailNode.active = GCache.RedDot.need_show_email();\n        if (this.btnEmailNode.active == true) {\n            let imgRedDot = this.btnEmailNode.getChildByName(\"img_dot\");\n            if (imgRedDot) {\n                imgRedDot.active = GCache.RedDot.hasRedDot(keyType);\n            }\n        }\n    }\n\n    //点击客服按钮\n    onKeFuClick(event: Event) {\n        EventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n        console.log(\"点击事件响应===>>>>客服\")\n        if (Platform.isWXPlatform()) {\n            Platform.openCustomerServiceConversation();\n        } else {\n            EventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: \"点击了联系客服\" });\n        }\n    }\n    /**\n     * 待活动完成后转移活动页面 联系客服的回调\n     * @param event \n     */\n    _doCallBackOpenCus(shareID) {\n        EventManager.dispatch(AppEvent.NET_REQ_SHARE_AWARD, shareID, GConstants.ReqUrl.shareType.other, false)\n    }\n\n    //点击设置按钮\n    onSettingClick(event: Event) {\n        EventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n        EventManager.dispatch(AppEvent.VIEW_UI_OPEN, UIID.SettingPrefab);\n    }\n\n    //点击邮箱按钮\n    onMailClick(event: Event) {\n        EventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n        EventManager.dispatch(AppEvent.VIEW_UI_OPEN, UIID.MailPrefab, null, null, null, true);\n    }\n\n    //点击银币按钮\n    onGoldenClick(event: Event) {\n        if (this._isCanClickShop) {\n            if (Platform.isCanPay() == false) {\n                return;\n            }\n            // EventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n            EventManager.dispatch(AppEvent.VIEW_UI_OPEN, UIID.MallPrefab, { id: GConstants.ShopBigTabType.SILVER_COIN }, {});\n        }\n    }\n\n    //点击金条按钮 二期迭代\n    onDiamonClick(event: Event) {\n        // if (this._isCanClickShop) {\n        // \tif (Platform.isCanPay() == false) {\n        // \t\treturn;\n        // \t}\n        // \tEventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n        // \tEventManager.dispatch(AppEvent.VIEW_UI_OPEN, UIID.MallPrefab, { id: GConstants.ShopBigTabType.DIAMOND }, {});\n        // }\n    }\n\n    //销毁\n    onDestroy() {\n\n    };\n\n}\n\n"]}