{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/game/cache/RoomMgr.ts"],"names":["RoomMgr","BaseCache","constructor","name","roomCfg","bankSeatId","dices","mySeatId","totalCardCount","timerInfoList","laiziInfo","rollDice","remainCardsCount","fangangCards","selectFanGangCards","observers","getInstance","instance","addObserver","observer","push","removeObserver","index","indexOf","splice","notifyObservers","updateCardsCount","mySelfIsBanker","getTimeOut","state","timeOut","forEach","timeInfo","timerId","timeout","updateRoomInfo","resp","roomInfo","gameInfo","fanGangPai","updateRemainCardsCount","remainCardCount","count","clear"],"mappings":"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","sourcesContent":["import { BaseCache } from \"../../../framework/vc/BaseCache\";\nimport { GameStatus } from \"../common/FXJConfig\";\nimport { Common } from \"../common/idl/Common\";\nimport { Game } from \"../common/idl/Game\";\nimport { Observer } from \"./PlayerMgr\";\nexport class RoomMgr extends BaseCache {\n    // public roomInfo?: Common.IRoomInfo = null;\n    public roomCfg?:Common.IRoomCfg = null;\n    public bankSeatId: number = null;\n    public dices: number[]  = null;\n    public mySeatId: number = null;\n    public totalCardCount?: number = null;\n    public timerInfoList?: Common.ITimerInfo[] = null;\n    public laiziInfo?: Game.IFixLaizi = null;\n    public rollDice?: Game.IRollDice = null;\n    public remainCardsCount?: number = 0;\n    public fangangCards: number[] = null;\n    public selectFanGangCards: number = null;\n    private static instance: RoomMgr | null = null;\n    private observers: Observer[] = [];\n\n\n\n    constructor(name = \"\") {\n\t\tsuper(name);\n\t};\n    public static getInstance(): RoomMgr {\n        if (!RoomMgr.instance) {\n            RoomMgr.instance = new RoomMgr();\n        }\n        return RoomMgr.instance;\n    }\n    //更新房间信息list数据\n    public addObserver(observer: Observer): void {\n        this.observers.push(observer);\n    }\n    \n    public removeObserver(observer: Observer): void {\n        const index = this.observers.indexOf(observer);\n        if (index !== -1) {\n            this.observers.splice(index, 1);\n        }\n    }\n    \n    public notifyObservers(): void {\n        for (const observer of this.observers) {\n            observer.updateCardsCount();\n        }\n    }\n    \n    public mySelfIsBanker():boolean{\n        return this.bankSeatId === this.mySeatId;\n    }\n\n    public getTimeOut(state:GameStatus):number{\n        let timeOut:number = 0;\n        this.timerInfoList.forEach(timeInfo => {\n            if(timeInfo.timerId == state){\n                timeOut = timeInfo.timeout;\n            }\n        });\n        return timeOut\n    }\n\n    public updateRoomInfo(resp:Game.IUserLoginRoom | Game.IUserReconnect){\n        this.roomCfg = resp.roomInfo.roomCfg;\n        this.bankSeatId = resp.roomInfo.gameInfo.bankSeatId;\n        this.dices = resp.roomInfo.gameInfo.dices;\n        this.fangangCards = resp.roomInfo.gameInfo.fanGangPai;\n        this.mySeatId = resp.roomInfo.gameInfo.mySeatId;\n        this.updateRemainCardsCount(resp.roomInfo.gameInfo.remainCardCount);\n        this.timerInfoList = resp.roomInfo.gameInfo.timerInfoList;\n        this.totalCardCount = resp.roomInfo.gameInfo.totalCardCount;\n    }\n\n    public updateRemainCardsCount(count?:number){\n        this.remainCardsCount = count;\n        this.notifyObservers();\n    } \n\n    //清理房间数据\n\tpublic clear(): void {\n\t\t// this.roomInfo = null;\n\t}\n}"]}