{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/giftbag/script/giftDiscountCtr.ts"],"names":["LabelComponent","Layout","Node","ScrollView","Sprite","UITransform","_decorator","instantiate","GCache","AppEvent","AppSound","GConstants","ReportConfig","Utils","ButtonSimple","DelegateComponent","resLoader","EventManager","BaseComponent","Platform","ccclass","property","giftDiscountCtr","tooltip","type","_holidayConf","_selectedIndex","_currowSelectItemBg","_cloneBtnBuyicon","_FowardPayScene","_sendCheckWatchADsData","onInitModuleEvent","addModelListener","NET_RESP_SHARE_AWARD","respShareAndAdsAward","NET_RESP_ADS_AWARD","ACTIVITY_UPDATE_HOLIDAYSGIFTPACKAGE","updateView","NOTIFY_UPDATE_RED_DOT","redDotUpdate","NET_FORWARD_REPORT_PAY_ORDER","respPayOrder","onLoad","param","getComponent","getParams","console","log","initView","dispatch","NET_REQ_HOLIDAYS_GIFTPACKAGE","RedDot","update_reddot_gift_holiday","start","REPORT_CLIENT_CLICK","eventID","gift_holiday_2","event","isSuccess","respData","reqData","nodeBoxGift","active","scrollowView","node","itemPanel","btnBuy","btnClose","detailData","Activity","getHolidaysGiftPackage","refreshImageBg","self","loadRemote","ext","err","imageAsset","isValid","spriteFrame","image_ImageAssetToSpriteFrame","bgNode","maxDataItem","table_verify","length","i","data","getItemData","hadNum","maxNum","currowNum","children","addChild","removeFromParent","count","nodeItem","updateItemBox","layout","spacingX","updateLayout","addSchedulerOnce","width","enabled","scrollToLeft","updateButton","item","buyBtnIcon","idx","table_isEmpty","goodsId","number_valueOf","SYS_TOAST_TIP","content","payData","ShopInfo","getPriceByGoodsSceneId","GoodsListID","limitPack","isLimit","num","icon","select","getChildByName","bg","check","mask","buy","imgLabel","labelNum","iconUrl","getPreLoaderRemoteRes","spriteComponent","buttonSimple","Interactable","string","onClickChooseItem","currentTarget","SYS_PLAY_EFFECT","CommClick","conf","gid","gift_holiday_3","body","gsubname","oldSelect","getParent","newSelect","onClickBuyButton","_buyItem","gift_holiday_12","payID","boughtNum","PayType","RMB","CurrowPaySceneType","OTHER_PAY_WILL","SHARE","_allowShareMsg","ShareInfo","shareTimeAllowed","ShareSceneConf","shopshare","shareWXFriends","handler","__doCallBackShare","VIDEO","playerAdVideo","__doCallBackWatchADs","goodsID","NET_REQ_SHARE_AWARD","ReqUrl","shareType","shop","status","NET_REQ_ADS_AWARD","onClickClose","destroy","onDestroy","keyType","RedDotConf","Holiday"],"mappings":"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","sourcesContent":["\nimport { EventTouch, LabelComponent, Layout, Node, ScrollView, Sprite, UITransform, _decorator, instantiate } from 'cc';\nimport { GCache } from '../../../cache/GCache';\nimport { AppEvent } from '../../../config/AppEvent';\nimport { AppSound } from '../../../config/AppSound';\nimport { GConstants } from '../../../config/GameConstant';\nimport { ReportConfig } from '../../../config/ReportConfig';\nimport { Utils } from '../../../framework/Utils';\nimport ButtonSimple from '../../../framework/gui/button/ButtonSimple';\nimport { DelegateComponent } from '../../../framework/layer/DelegateComponent';\nimport { resLoader } from '../../../framework/loader/ResLoader';\nimport { EventManager } from '../../../framework/manager/EventManager';\nimport { BaseComponent } from '../../../framework/vc/BaseComponent';\nimport { Platform } from '../../../platform/Platform';\nconst { ccclass, property } = _decorator;\n\n/**\n * Name = giftDiscountCtr\n * URL = db://assets/package/giftbag/scripts/giftDiscountCtr.ts\n * Time = Sun Jan 29 2023 14:47:26 GMT+0800 (中国标准时间)\n * Author = xueya\n * Life: onLoad-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n * 每日特价礼包，支持RMB看视频分享购买\n */\n\n@ccclass('giftDiscountCtr')\nexport class giftDiscountCtr extends BaseComponent {\n\n    //礼包克隆节点\n    @property({ tooltip: \"礼包克隆节点\", type: Node })\n    private nodeBoxGift: Node | null = null;\n    //礼包box容器节点\n    @property({ tooltip: \"礼包滚动容器\", type: ScrollView })\n    private scrollowView: ScrollView | null = null;\n\n    //礼包box容器节点\n    @property({ tooltip: \"礼包box容器节点\", type: Node })\n    private itemPanel: Node | null = null;\n    //关闭节点\n    @property({ tooltip: \"关闭节点\", type: Node })\n    private btnClose: Node | null = null;\n    //购买节点\n    @property({ tooltip: \"购买节点\", type: Node })\n    private btnBuy: Node | null = null;\n\n    //背景节点\n    @property({ tooltip: \"背景节点\", type: Node })\n    private bgNode: Node | null = null;\n    /** 基本配置 */\n    private _holidayConf = {}\n    /** 当前选中的Item索引 （-1：未选择 0 1 2） */\n    private _selectedIndex = -1;\n    /** 当前选中的Item背景图片 */\n    private _currowSelectItemBg = null;\n\n    private _cloneBtnBuyicon = null;\n    /** 上一个跳转过来的付费场景 */\n    private _FowardPayScene: string = null;\n    /** 发送的看广告的数据 */\n    private _sendCheckWatchADsData = null;\n    /**初始化添加事件绑定 */\n    protected onInitModuleEvent(): void {\n        /** 请求分享领奖返回 */\n        this.addModelListener(AppEvent.NET_RESP_SHARE_AWARD, this.respShareAndAdsAward)\n        /** 请求看视频领奖返回 */\n        this.addModelListener(AppEvent.NET_RESP_ADS_AWARD, this.respShareAndAdsAward);\n\n        //限时礼包活动更新\n        this.addModelListener(AppEvent.ACTIVITY_UPDATE_HOLIDAYSGIFTPACKAGE, this.updateView)\n        /** 礼包红点更新 */\n        this.addModelListener(AppEvent.NOTIFY_UPDATE_RED_DOT, this.redDotUpdate);\n\n        //rmb支付回调\n        this.addModelListener(AppEvent.NET_FORWARD_REPORT_PAY_ORDER, this.respPayOrder);\n    }\n\n    onLoad() {\n        //获取上一个付费场景\n        let param = this.getComponent(DelegateComponent).getParams();\n        console.log(param, 'param');\n        this._FowardPayScene = param ? param[\"pay_scene\"] : null;\n        this.initView();\n        this.updateView();\n        //请求限时折扣配置数据\n        EventManager.dispatch(AppEvent.NET_REQ_HOLIDAYS_GIFTPACKAGE);\n        GCache.RedDot.update_reddot_gift_holiday();\n    };\n\n    start() {\n        EventManager.dispatch(AppEvent.REPORT_CLIENT_CLICK, { eventID: ReportConfig.gift_holiday_2 });\n    };\n\n    /** 请求看视频领奖和分享领奖返回 */\n    respShareAndAdsAward(event, isSuccess, respData, reqData) {\n        console.log(\"respShareAndAdsAward\", isSuccess, respData, reqData)\n        if (isSuccess == false) {\n            return;\n        }\n        EventManager.dispatch(AppEvent.NET_REQ_HOLIDAYS_GIFTPACKAGE);\n    }\n\n\n    /** 支付订单返回 */\n    respPayOrder(event, isSuccess, respData, reqData) {\n        console.log(\"respPayOrder:discount\", isSuccess, respData, reqData)\n        if (isSuccess == false) {\n            return;\n        }\n        EventManager.dispatch(AppEvent.NET_REQ_HOLIDAYS_GIFTPACKAGE);\n    }\n\n    /** 初始化界面 */\n    initView() {\n        this.nodeBoxGift.active = false;\n        this.scrollowView.node.active = true;\n        this.itemPanel.active = true;\n        this.btnBuy.active = false;\n        this.btnClose.active = true;\n        this.detailData();\n        this.updateView();\n    }\n\n    /** 处理数据 */\n    detailData() {\n        this._holidayConf = GCache.Activity.getHolidaysGiftPackage()\n    }\n\n    /** 更新背景 */\n    refreshImageBg() {\n        let self = this;\n        if (this._holidayConf && this._holidayConf[\"basemap\"] != \"\") {\n            resLoader.loadRemote(this._holidayConf[\"basemap\"], { ext: `.jpg` }, (err, imageAsset) => {\n                if (!imageAsset) { //资源可能还在加载中\n                    return\n                }\n                if (!self.node || self.node.isValid == false) {\n                    return;\n                }\n                let spriteFrame = Utils.image_ImageAssetToSpriteFrame(imageAsset)\n                if (spriteFrame) {\n                    this.bgNode.getComponent(Sprite).spriteFrame = spriteFrame;\n                }\n            });\n        }\n    }\n\n    /** 更新界面 */\n    updateView() {\n        //当有更新时，重新获取一次礼包缓存数据\n        this.detailData();\n        // this.refreshImageBg()\n        let maxDataItem = Utils.table_verify(this._holidayConf['giftpack'], true).length\n        this._selectedIndex = -1;\n        for (let i = 0; i < maxDataItem; i++) {\n            let data = this.getItemData(i);\n            if (data) {\n                if (data.hadNum < data.maxNum || data.maxNum == 0) {\n                    this._selectedIndex = i;\n                    break;\n                }\n            }\n        }\n        let currowNum = this.itemPanel.children.length;\n        if (currowNum < maxDataItem) {\n            for (let i = currowNum; i < maxDataItem; i++) {\n                let node = instantiate(this.nodeBoxGift);\n                this.itemPanel.addChild(node);\n            }\n        } else if (currowNum > maxDataItem) {\n            for (let i = (currowNum - 1); i >= maxDataItem; i--) {\n                let node = this.itemPanel.children[i];\n                if (node) {\n                    node.removeFromParent();\n                }\n            }\n        }\n        this._currowSelectItemBg = null;\n        let count = 0;\n        for (let i = 0; i < this.itemPanel.children.length; i++) {\n            let nodeItem = this.itemPanel.children[i];\n            count = count + 1;\n            this.updateItemBox(nodeItem, i);\n        }\n        let self = this;\n        let layout = self.itemPanel.getComponent(Layout);\n        layout.spacingX = (count == 2 ? 100 : 0);\n        layout.updateLayout();\n        this.addSchedulerOnce(0, () => {\n            if (self.itemPanel.getComponent(UITransform).width > self.scrollowView.node.getComponent(UITransform).width) {\n                self.scrollowView.enabled = true;\n                self.scrollowView.scrollToLeft(0.01, false);\n            } else {\n                self.scrollowView.enabled = false;\n            }\n        })\n        this.updateButton()\n    }\n\n    /** 更新按钮 */\n    updateButton() {\n        let self = this;\n        if (this._holidayConf['giftpack']) {\n            let item = this._holidayConf['giftpack'][this._selectedIndex];\n            if (item.buyBtnIcon) {\n                resLoader.loadRemote(item.buyBtnIcon, { ext: `.jpg` }, (err, imageAsset) => {\n                    if (!imageAsset) { //资源可能还在加载中\n                        return\n                    }\n                    if (!self.node || self.node.isValid == false) {\n                        return;\n                    }\n                    let spriteFrame = Utils.image_ImageAssetToSpriteFrame(imageAsset)\n                    if (spriteFrame) {\n                        this.btnBuy.getComponent(Sprite).spriteFrame = spriteFrame;\n                    }\n                });\n                this.btnBuy.active = true;\n            }\n        } else {\n            this.btnBuy.active = false;\n        }\n\n    }\n\n\n    /**\n     * 获取单个item的数据\n     * @param idx 数据下标 0 1 2\n     * @returns {}\n     */\n    getItemData(idx) {\n        if (this._holidayConf == null || this._holidayConf['giftpack'] == null) {\n            return null;\n        }\n        let item = this._holidayConf['giftpack'][idx]\n        if (Utils.table_isEmpty(item)) {\n            return null;\n        }\n        let goodsId = Utils.number_valueOf(item['gid'], 0)\n\n        if (goodsId <= 0) {\n            EventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: \"err:找不到商品数据\" });\n            return;\n        }\n        let payData = GCache.ShopInfo.getPriceByGoodsSceneId(GConstants.GoodsListID.limitPack, goodsId);\n        let maxNum = Utils.number_valueOf(payData['limitNum'], 0);\n        let isLimit = Utils.number_valueOf(payData['limit_buy_way'], 0);\n        maxNum = isLimit > 0 ? maxNum : 0;\n        return {\n            maxNum: maxNum,\n            hadNum: item.num,\n            icon: item.icon\n        }\n    }\n\n\n    /**\n     * \n     * @param node 节点\n     * @param idx 索引\n     * @returns \n     */\n    updateItemBox(node: Node, idx) {\n        let select = node.getChildByName(\"select\");\n        let bg = node.getChildByName(\"bg\");\n        //选中\n        let check = bg.getChildByName(\"check\");\n        //蒙版\n        let mask = bg.getChildByName(\"mask\");\n        //购买\n        let buy = bg.getChildByName(\"buy\");\n        let imgLabel = node.getChildByName(\"imgLabel\");\n        let labelNum = imgLabel.getChildByName(\"labelNum\")\n        let data = this.getItemData(idx);\n        if (!data) {\n            node.active = false;\n            return;\n        }\n\n        //初始化\n        node.active = true;\n        check.active = false;\n        select.active = false;\n        mask.active = false;\n        buy.active = false;\n\n        node[\"Index\"] = idx;\n        let iconUrl = data.icon;\n        console.log(\"_selectedIndex:updateItemBox:\", this._selectedIndex)\n        if (data.hadNum < data.maxNum || data.maxNum == 0) {\n            if (this._selectedIndex == idx) {\n                this._currowSelectItemBg = bg;\n                check.active = true;\n                select.active = true;\n            }\n        } else {\n            //已经购买\n            mask.active = true\n            buy.active = true\n            imgLabel.active = false;\n            labelNum.active = false;\n        }\n        this.getPreLoaderRemoteRes(iconUrl, '.jpg', (imageAsset) => {\n            if (!imageAsset) { //资源可能还在加载中\n                return\n            }\n            if (!bg || bg.isValid == false) {\n                return;\n            }\n            let spriteFrame = Utils.image_ImageAssetToSpriteFrame(imageAsset)\n            if (spriteFrame) {\n                let spriteComponent = bg.getComponent(Sprite);\n                spriteComponent.spriteFrame = spriteFrame;\n            }\n        })\n        let buttonSimple = node.getComponent(ButtonSimple);\n        if (data.maxNum > 0) {\n            buttonSimple.Interactable = (data.hadNum < data.maxNum);\n            labelNum.getComponent(LabelComponent).string = data.hadNum + \"/\" + data.maxNum;\n        }\n        else {\n            imgLabel.active = false;\n            labelNum.active = false;\n        }\n    }\n\n    /**\n     * 点击了单个Item\n     * @param event \n     * @returns \n     */\n    onClickChooseItem(event: EventTouch) {\n        if (event.currentTarget[\"Index\"] == null) {\n            return;\n        }\n        let idx = event.currentTarget[\"Index\"];\n        if (this._selectedIndex == idx) {\n            return;\n        }\n        EventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n        let conf = this._holidayConf['giftpack'][idx]\n        let goodsId = Utils.number_valueOf(conf.gid, 0)\n        EventManager.dispatch(AppEvent.REPORT_CLIENT_CLICK, { eventID: ReportConfig.gift_holiday_3, body: { gsubname: goodsId } });\n        //让当前选的进入选中状态,让老的选中进入未选中状态\n        let _currowSelectItemBg = this._currowSelectItemBg;\n        //老的成为未选中\n        _currowSelectItemBg.getChildByName(\"check\").active = false;\n        let oldSelect = _currowSelectItemBg.getParent().getChildByName(\"select\");\n        oldSelect.active = false;\n        this._currowSelectItemBg = event.currentTarget.getChildByName(\"bg\");\n        this._currowSelectItemBg.getChildByName(\"check\").active = true;\n        let newSelect = this._currowSelectItemBg.getParent().getChildByName(\"select\");\n        newSelect.active = true;\n        this._selectedIndex = idx;\n        console.log(\"_selectedIndex:onClickChooseItem:\", this._selectedIndex);\n        this.updateButton();\n    }\n\n\n    /** 点击了购买 */\n    onClickBuyButton(event: EventTouch) {\n        if (this._selectedIndex == -1) {\n            return;\n        }\n        EventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n        this._buyItem(this._selectedIndex);\n    }\n\n    /**\n     * 点击购买每日特价礼包\n     * @param idx 索引\n     * @returns \n     */\n    _buyItem(idx) {\n        let conf = this._holidayConf['giftpack'][idx]\n        let goodsId = Utils.number_valueOf(conf.gid, 0)\n        if (Utils.table_isEmpty(conf) || goodsId <= 0) {\n            EventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: \"err:找不到商品数据，支付失败\" });\n            return;\n        }\n        EventManager.dispatch(AppEvent.REPORT_CLIENT_CLICK, { eventID: ReportConfig.gift_holiday_12, body: { gsubname: goodsId } });\n        let payData = GCache.ShopInfo.getPriceByGoodsSceneId(GConstants.GoodsListID.limitPack, goodsId);\n        console.log(\"paydata:\", payData)\n        let payID = Utils.number_valueOf(payData['payID'], 0)\n        if (payID <= 0) {\n            EventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: \"err:找不到商品支付方式，支付失败\" });\n            return;\n        }\n        let boughtNum = Utils.number_valueOf(conf[\"num\"], 0);\n        let maxNum = Utils.number_valueOf(payData[\"limitNum\"], 0)\n        let isLimit = Utils.number_valueOf(payData['limit_buy_way'], 0);\n        maxNum = isLimit > 0 ? maxNum : 0;\n        if (boughtNum >= maxNum && maxNum > 0) {\n            EventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: \"已超过最大次数上限\" })\n            return;\n        }\n        switch (payID) {\n            case GConstants.PayType.RMB: //rmb 1\n                GCache.CurrowPaySceneType = GConstants.GoodsListID.limitPack;\n                EventManager.dispatch(AppEvent.OTHER_PAY_WILL, GConstants.GoodsListID.limitPack, goodsId);\n                break;\n            case GConstants.PayType.SHARE://分享支付\n                let self = this\n                let _allowShareMsg = GCache.ShareInfo.shareTimeAllowed(goodsId, GConstants.ShareSceneConf.shopshare);\n                if (_allowShareMsg['allowShare']) {\n                    Platform.shareWXFriends(_allowShareMsg['shareParams'], Utils.handler(self, self.__doCallBackShare), goodsId);\n                } else {\n                    EventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: `请勿在短时间内重复分享` });\n                }\n                break;\n            case GConstants.PayType.VIDEO://看视频\n                Platform.playerAdVideo(Utils.handler(this, this.__doCallBackWatchADs), goodsId)\n                break;\n            default:\n                EventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: \"err:不支持的支付方式 code=\" + payID });\n                break;\n        }\n    }\n\n    /**\n     * 分享完商品发放奖励发奖励\n     * @param goodsID 商品ID\n     */\n    __doCallBackShare(goodsID) {\n        console.log('__doCallBackShare', goodsID)\n        EventManager.dispatch(AppEvent.NET_REQ_SHARE_AWARD, goodsID, GConstants.ReqUrl.shareType.shop, true)\n    }\n\n\n    /**\n     * 看完视频广告发奖励\n     * @param status 是否成功\n     * @param goodsID 商品ID\n     * @returns \n     */\n    __doCallBackWatchADs(status: boolean, goodsID) {\n        if (status != true) {\n            EventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: \"err:看广告失败\" });\n            return;\n        }\n        EventManager.dispatch(AppEvent.NET_REQ_ADS_AWARD, goodsID, GConstants.ReqUrl.shareType.shop, true)\n    }\n\n\n\n\n    /** 点击了关闭 */\n    onClickClose(event: EventTouch) {\n        EventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n        this.node.destroy();\n    }\n\n    //销毁\n    onDestroy() {\n\n    };\n\n    /**\n     * 红点更新\n     * @param event \n     * @param keyType 红点类型\n     */\n    redDotUpdate(event, keyType) {\n        if (keyType == GConstants.RedDotConf.Holiday) {\n\n        }\n    }\n\n}\n\n"]}