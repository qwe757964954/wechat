{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/game/scripts/NodeUserPrefabCtr.ts"],"names":["Label","Node","SpriteAtlas","UITransform","Vec3","_decorator","GCache","Utils","SpriteLoad","EventManager","BaseComponent","PlayerMgr","RoomMgr","FXJConfig","FXJConstant","FXJEvent","FXJRes","FXJUIID","FXJSound","GameEvent","CardUtil","ccclass","property","menu","NodeUserPrefabCtr","tooltip","type","_handlerChatTextAutoHide","_isReload","_uid","_posID","onInitModuleEvent","addModelListener","VIEW_BROADCAST_PLAYER_EXIT","palyerExit","VIEW_PLAYER_UPDATE_PROPERTY","updateCoin","VIEW_PLAYER_CHAT_SHOW","showChatMsg","VIEW_PLAYER_EMOJ_SHOW","showEmojMsg","VIEW_PLAYER_AI_SHOW","modifyPlayerDeposit","VIEW_BROADCAST_DING_ZHUANG","palyerDingZhuang","onLoad","console","log","preloadRes","initUI","infoBgPlayer","active","nodeBtnMask","nodeChat","nodeEmoji","node","nodeDeposit","nodeZhuang","palyerRefresh","getPreLoaderRes","Atlas_Game_CardNum","bundle","path","Atlas_Player_Common","start","UID","PosID","posID","initData","data","uid","isValid","player","getInstance","findPlayerWithUserId","destroy","event","calculatePlayerSeat","mySeatId","seatId","updatePos","updateUserHead","gameUserInfo","sex","avatar_s","userId","url","spriteLoad","headNode","getComponent","string_isEmpty","setRemoteUrl","setLocalLoad","Picture_UserBigHead_girl","Picture_UserBigHead_boy","palyer","coinLabel","string","string_moneyToShortNumber","money","uiTransform","getParent","position","width","height","respData","mid","ai","body","faceValue","mojiIndex","Math","pow","aniName","ChatEmojiAniConf","movex","emojiAni","parentNode","resConf","Spine_Emoji","trackIndex","isLoop","skin","toPos","dispatch","SYS_ANI_PLAY","warn","PosId","isNotNull","msg","audioType","audioIndex","key","ChatText","Object","prototype","hasOwnProperty","call","arr","isArray","tmpIndex","indexOf","audioName","gender","User","getUserSex","SYS_PLAY_EFFECT","QuickChatXiaoBo","QuickChatXiaoYa","stopSchedulerOnce","childNameList","currowName","forEach","nodeName","pNode","getChildByName","bg","label","String","addSchedulerOnce","ChatTextAutoHide","handler","hideChatText","onClickUserInfo","CommClick","Desk","PlayType","MATCH","SYS_TOAST_TIP","content","getUserMid","VIEW_UI_OPEN","PlayerInfoCenter","GAME_OPEN_POPUP","GameHeadInfoPrefab","onDestroy"],"mappings":"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","sourcesContent":["\nimport { Label, Node, SpriteAtlas, UITransform, Vec3, _decorator } from 'cc';\nimport { GCache } from '../../../cache/GCache';\nimport { inf_SpineAniCreate } from '../../../framework/InterfaceDefines';\nimport { Utils } from '../../../framework/Utils';\nimport SpriteLoad from '../../../framework/gui/sprite/SpriteLoad';\nimport { EventManager } from '../../../framework/manager/EventManager';\nimport { BaseComponent } from '../../../framework/vc/BaseComponent';\nimport { PlayerMgr } from '../cache/PlayerMgr';\nimport { RoomMgr } from '../cache/RoomMgr';\nimport { FXJConfig } from '../common/FXJConfig';\nimport { FXJConstant } from '../common/FXJConstant';\nimport { FXJEvent } from '../common/FXJEvent';\nimport { FXJRes, FXJUIID } from '../common/FXJRes';\nimport { FXJSound } from '../common/FXJSound';\nimport { GameEvent } from '../common/GameEvent';\nimport { Common } from '../common/idl/Common';\nimport { FaceType, MsgType } from '../common/server/ChatServer';\nimport { CardUtil } from '../util/CardUtil';\nconst { ccclass, property, menu } = _decorator;\n\n/**\n * Name = NodeUserPrefabCtr\n * URL = db://assets/package/game/scripts/NodeUserPrefabCtr.ts\n * Time = Fri Sep 16 2022 11:06:58 GMT+0800 (中国标准时间)\n * Author = Tomoe\n *\n * Life: onLoad-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n * 玩家节点\n */\n\n@ccclass('NodeUserPrefabCtr')\n//方便编辑器识别的菜单项目\n@menu('prefab/game/NodeUserPrefabCtr')\nexport class NodeUserPrefabCtr extends BaseComponent {\n\n\t//玩家信息背景\n\t@property({ tooltip: \"玩家信息背景\", type: Node })\n\tprivate infoBgPlayer: Node | null = null;\n\n\t//玩家点击遮罩\n\t@property({ tooltip: \"玩家点击遮罩\", type: Node })\n\tprivate nodeBtnMask: Node | null = null;\n\n\t/** 玩家托管 */\n\t@property({ tooltip: \"玩家显示托管状态\", type: Node })\n\tprivate nodeDeposit: Node | null = null;\n\n\t//用户头像\n\t@property({ tooltip: \"用户头像\", type: Node })\n\theadNode: Node = null!;\n\n\t//银币\n\t@property({ tooltip: \"银币\", type: Label })\n\tprivate coinLabel: Label | null = null;\n\n\t//聊天气泡节点\n\t@property({ tooltip: \"聊天气泡节点\", type: Node })\n\tprivate nodeChat: Node | null = null;\n\n\t//表情动画节点\n\t@property({ tooltip: \"表情动画节点\", type: Node })\n\tprivate nodeEmoji: Node | null = null;\n\n\t//庄家节点\n\t@property({ tooltip: \"庄家节点\", type: Node })\n\tprivate nodeZhuang: Node = null!;\n\n\t/** 自动隐藏快捷聊天的句柄 */\n\tprivate _handlerChatTextAutoHide = null;\n\t//是否已经加载了\n\tprivate _isReload: boolean = false;\n\t//玩家id\n\tprivate _uid: number = null;\n\t//玩家座位号\n\tprivate _posID: number = null;\n\t/**初始化添加事件绑定 */\n\tprotected onInitModuleEvent(): void {\n\t\t//玩家退出\n\t\tthis.addModelListener(GameEvent.VIEW_BROADCAST_PLAYER_EXIT, this.palyerExit);\n\t\t//玩家资产有更新\n\t\tthis.addModelListener(FXJEvent.VIEW_PLAYER_UPDATE_PROPERTY, this.updateCoin);\n\t\t//玩家表情聊天通知\n\t\tthis.addModelListener(FXJEvent.VIEW_PLAYER_CHAT_SHOW, this.showChatMsg);\n\t\tthis.addModelListener(GameEvent.VIEW_PLAYER_EMOJ_SHOW, this.showEmojMsg);\n\t\t\n        // 通知托管\n\t\tthis.addModelListener(GameEvent.VIEW_PLAYER_AI_SHOW, this.modifyPlayerDeposit);\n\n\t\t// 定庄\n\t\tthis.addModelListener(GameEvent.VIEW_BROADCAST_DING_ZHUANG, this.palyerDingZhuang);\n\t}\n\n\tonLoad() {\n\t\tthis._isReload = true;\n\t\tconsole.log(\"NodeUser: onload==>\", this._uid);\n\t\tthis.preloadRes();\n\t\tthis.initUI();\n\t}\n\tinitUI() {\n\t\tthis.infoBgPlayer.active = true;\n\t\tthis.nodeBtnMask.active = true;\n\t\tthis.nodeChat.active = false;\n\t\tthis.nodeEmoji.active = true;\n\t\tthis.node.active = true;\n\t\tthis.nodeDeposit.active = false;\n\t\tthis.nodeZhuang.active = false;\n\t\tthis.palyerRefresh(null, this._uid);\n\t}\n\t/** 预加载 */\n\tpreloadRes() {\n\t\tthis.getPreLoaderRes(FXJRes.Atlas_Game_CardNum.bundle, FXJRes.Atlas_Game_CardNum.path, SpriteAtlas);\n\t\tthis.getPreLoaderRes(FXJRes.Atlas_Player_Common.bundle, FXJRes.Atlas_Player_Common.path, SpriteAtlas);\n\n\t}\n\tstart() {\n\n\t};\n\t/** get uid */\n\tget UID() {\n\t\treturn this._uid;\n\t}\n\t/** set PosID */\n\tset PosID(posID) {\n\t\tthis._posID = posID;\n\t}\n\t/** get PosID */\n\tget PosID() {\n\t\treturn this._posID;\n\t}\n\n\tpublic initData(data) {\n\t\tif (data) {\n\t\t\tthis._posID = data.posID;\n\t\t\tthis._uid = data.uid;\n\t\t}\n\t\tif (!this.node || this.node.isValid == false) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._uid) {\n\t\t\tlet player = PlayerMgr.getInstance().findPlayerWithUserId(this._uid);\n\t\t\tif (player != null) {\n\t\t\t\tthis.palyerRefresh(null, this._uid);\n\t\t\t} else {\n\t\t\t\tthis.node.destroy();\n\t\t\t}\n\t\t}\n\t}\n\t/** 用户刷新 */\n\tpalyerRefresh(event, uid: number) {\n\t\tif (!uid || uid != this._uid) {\n\t\t\treturn;\n\t\t}\n\t\tlet player = PlayerMgr.getInstance().findPlayerWithUserId(uid);\n\t\tif (player) {\n\t\t\tthis._posID = CardUtil.calculatePlayerSeat(RoomMgr.getInstance().mySeatId,player.seatId);\n\n\t\t\tthis.infoBgPlayer.active = true;\n\t\t\tthis.nodeBtnMask.active = true;\n\t\t\tthis.updatePos();\n\t\t\tthis.updateUserHead(player.gameUserInfo.sex, player.gameUserInfo.avatar_s)\n\t\t\tthis.updateCoin(null, player.userId);\n\t\t}\n\t}\n\n\t//更新用户头像\n\tupdateUserHead(sex: number, url: string) {\n\t\tlet spriteLoad = this.headNode.getComponent(SpriteLoad);\n\t\t\n\t\tif (!Utils.string_isEmpty(url)) {\n\t\t\tspriteLoad.setRemoteUrl(url)\n\t\t} else { \n\t\t\tif (sex == 2) {\n\t\t\t\tspriteLoad.setLocalLoad(FXJRes.Picture_UserBigHead_girl.bundle, FXJRes.Picture_UserBigHead_girl.path);\n\t\t\t} else {\n\t\t\t\tspriteLoad.setLocalLoad(FXJRes.Picture_UserBigHead_boy.bundle, FXJRes.Picture_UserBigHead_boy.path);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**更新玩家银币*/\n\tupdateCoin(event = null, uid: number = null) {\n\t\tif (uid && uid == this._uid) {\n\t\t\tlet palyer = PlayerMgr.getInstance().findPlayerWithUserId(uid);\n\t\t\tthis.coinLabel.string = Utils.string_moneyToShortNumber(palyer ? palyer.money : 0,true);\n\t\t}\n\t}\n\n\t/** 更新当前位置 */\n\tupdatePos() {\n        let uiTransform = this.node.getParent().getComponent(UITransform)\n\t\tswitch (this._posID) {\n\t\t\tcase 0:\n\t\t\t\tthis.node.position = new Vec3(- (uiTransform.width / 2 - 90), -(uiTransform.height / 2 - 100), 0);\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tthis.node.position = new Vec3((uiTransform.width / 2 - 120), 5, 0);\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tthis.node.position = new Vec3((uiTransform.width / 2 - 390), (uiTransform.height / 2 - 90), 0);\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tthis.node.position = new Vec3(-(uiTransform.width / 2 -120), 5, 0);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tmodifyPlayerDeposit(event, respData){\n\t\t// 自己托管不用显示托管标志\n\t\tif (respData.mid != null) {\n\t\t\tif (respData.mid == this._uid) {\n\t\t\t\tthis.nodeDeposit.active = respData.ai;\n\t\t\t}\n\t\t}\n\t}\n\n\tshowEmojMsg(event, body:FaceType){\n\t\t/*\n\t\tnodeUserPrefabCtr.ts:238 显示聊天气泡或表情 \n\t\t{mid: 9465533, faceValue: 65549, vipType: -1}\n\t\t*/\n\t\tif (this._uid !== body.mid) {\n\t\t\tthis.nodeEmoji.active = false;\n\t\t\treturn;\n\t\t}\n\t\tif (body.faceValue == null) { \n\t\t\treturn;\n\t\t}\n\t\tlet mojiIndex = body.faceValue - Math.pow(2, 16)\n\t\t\n\t\tlet aniName = FXJConstant.ChatEmojiAniConf[mojiIndex]\n\t\tif (aniName) {\n\t\t\t//表情\n\t\t\tthis.nodeEmoji.active = true;\n\t\t\tlet movex = 0;\n\t\t\t//表情动画\n\t\t\tlet emojiAni: inf_SpineAniCreate = {\n\t\t\t\tparentNode: this.nodeEmoji,\n\t\t\t\tresConf: FXJRes.Spine_Emoji,\n\t\t\t\taniName: aniName,\n\t\t\t\ttrackIndex: 0,\n\t\t\t\tisLoop: false,\n\t\t\t\tskin: null,\n\t\t\t\ttoPos: new Vec3(movex, 0, 0)\n\t\t\t}\n\t\t\tEventManager.dispatch(FXJEvent.SYS_ANI_PLAY, emojiAni);\n\t\t} else { \n\t\t\tconsole.warn(\"Err:不支持的快捷表情\",body)\n\t\t}\n\t}\n\n\n\t/** 显示聊天气泡或表情 */\n\tshowChatMsg(event, body: MsgType) {\n\t\t/*\n\t\t显示聊天气泡或表情 \n\t\tnodeUserPrefabCtr.ts:238 显示聊天气泡或表情 \n\t\t{mid: 2503717, msg: '退退退', index: 2}\n\t\t*/\n\t\tconsole.log(\"聊天接收到的是:\", body)\n\t\tlet player: Common.IPlayerInfo = PlayerMgr.getInstance().findPlayerWithUserId(body.mid);\n\t\tif (this._uid !== body.mid) {\n\t\t\tthis.nodeChat.active = false;\n\t\t\treturn;\n\t\t}\n\t\tlet PosId:number = CardUtil.calculatePlayerSeat(RoomMgr.getInstance().mySeatId,player.seatId);\n\t\t//快捷聊天\n\t\tif (Utils.isNotNull(PosId, body.msg)) {\n\t\t\tlet msg = body.msg;\n\t\t\t//根据msg 去索引得到音效名\n\t\t\tlet audioType = '';\n\t\t\tlet audioIndex = -1;\n\t\t\tfor (const key in FXJConstant.ChatText) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(FXJConstant.ChatText, key)) {\n\t\t\t\t\tconst arr = FXJConstant.ChatText[key];\n\t\t\t\t\tif (Utils.isArray(arr)) {\n\t\t\t\t\t\tlet tmpIndex = arr.indexOf(msg); \n\t\t\t\t\t\tif (tmpIndex != -1) {\n\t\t\t\t\t\t\taudioType = key;\n\t\t\t\t\t\t\taudioIndex = tmpIndex;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (Utils.string_isEmpty(audioType) || audioIndex==-1) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet audioName = audioType + '_' + audioIndex;\n\t\t\tlet gender = GCache.User.getUserSex();\n\t\t\tif (gender==2) {\n\t\t\t\tEventManager.dispatch(FXJEvent.SYS_PLAY_EFFECT, { bundle: FXJSound.QuickChatXiaoBo.bundle, path: FXJSound.QuickChatXiaoYa.path + audioName});\n\t\t\t} else {\n\t\t\t\tEventManager.dispatch(FXJEvent.SYS_PLAY_EFFECT, { bundle: FXJSound.QuickChatXiaoBo.bundle, path: FXJSound.QuickChatXiaoBo.path + audioName});\n\t\t\t}\t\n\t\t\t\n\t\t\tthis.stopSchedulerOnce(this._handlerChatTextAutoHide);\n\t\t\tthis._handlerChatTextAutoHide = null;\n\t\t\tthis.nodeChat.active = true;\n\t\t\tlet childNameList = [\"right\", \"left\",\"bottom\"];\n\t\t\tlet currowName = childNameList[0];\n\t\t\tif (PosId === 1 || PosId === 2) {\n\t\t\t\tcurrowName = childNameList[PosId];\n\t\t\t}\n\t\t\tlet parentNode = null;\n\t\t\tchildNameList.forEach((nodeName, key) => {\n\t\t\t\tlet pNode = this.nodeChat.getChildByName(nodeName);\n\t\t\t\tif (nodeName == currowName) {\n\t\t\t\t\tpNode.active = true;\n\t\t\t\t\tparentNode = pNode;\n\t\t\t\t} else {\n\t\t\t\t\tpNode.active = false;\n\t\t\t\t}\n\t\t\t})\n\t\t\tif (!parentNode) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet bg = parentNode.getChildByName(\"bg\");\n\t\t\tlet label = bg?.getChildByName(\"Label\");\n\t\t\tif (label) {\n\t\t\t\tlabel.getComponent(Label).string = String(body.msg);\n\t\t\t}\n\t\t\tthis._handlerChatTextAutoHide = this.addSchedulerOnce(FXJConfig.ChatTextAutoHide, Utils.handler(this, this.hideChatText))\n\t\t}\n\n\t};\n\t/** 隐藏快捷聊天 */\n\thideChatText() {\n\t\tif (this.nodeChat && this.nodeChat.isValid == true) {\n\t\t\tthis.nodeChat.active = false;\n\t\t}\n\t\tthis._handlerChatTextAutoHide = null;\n\t}\n\n\t//点击个人信息\n\tonClickUserInfo(event) {\n\t\tlet palyer = PlayerMgr.getInstance().findPlayerWithUserId(this._uid);\n\t\tif (!palyer) {\n\t\t\treturn;\n\t\t}\n\t\tEventManager.dispatch(FXJEvent.SYS_PLAY_EFFECT, FXJSound.CommClick);\n\t\tif (GCache.Desk.PlayType == FXJConstant.PlayType.MATCH) {\n\t\t\tEventManager.dispatch(FXJEvent.SYS_TOAST_TIP, { content: \"比赛中无法查看玩家信息\" });\n\t\t\treturn;\n\t\t}\n\t\tif (palyer.userId == GCache.User.getUserMid()) {\n\t\t\tEventManager.dispatch(FXJEvent.VIEW_UI_OPEN, FXJUIID.PlayerInfoCenter, null, null, null, true);\n\t\t} else {\n\t\t\tlet data = {\n\t\t\t\tuid: palyer.userId,\t\t\t\n\t\t\t\tposID: palyer.seatId,\n\t\t\t}\n\t\t\tEventManager.dispatch(FXJEvent.GAME_OPEN_POPUP, FXJUIID.GameHeadInfoPrefab, data, {});\n\t\t}\n\t}\n\n\t//玩家退出房间\n\tpalyerExit(event, uid: number = null) {\n\t\tif(Utils.isNotNull(uid)) {\n\t\t\tif (uid == this._uid) {\n\t\t\t\tthis.node.active = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tpalyerDingZhuang(event, seatId: number = null) {\n\t\tif(Utils.isNotNull(seatId)) {\n\t\t\tthis.nodeZhuang.active = CardUtil.calculatePlayerSeat(RoomMgr.getInstance().mySeatId,seatId) == this._posID;\n\t\t}\n\t\t\n\t}\n\n\t//销毁\n\tonDestroy() {\n\n\t};\n\n}\n\n"]}