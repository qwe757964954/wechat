{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/framework/LocalStorage.ts"],"names":["sys","PREVIEW","Md5","_key","_iv","_id","init","key","iv","setUser","id","set","value","newKey","console","error","warn","remove","JSON","stringify","e","localStorage","setItem","get","defaultValue","str","getItem","Number","String","parse","removeItem","clear","LocalStorage"],"mappings":"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","sourcesContent":["/**\n * Name = LocalStorage\n * URL = db://assets/framework/LocalStorage.ts\n * Time = Mon Apr 11 2022 21:14:48 GMT+0800 (中国标准时间)\n * Author = xueya\n * 本地存储管理\n */\n\nimport { sys } from \"cc\";\nimport { PREVIEW } from \"cc/env\";\nimport { Md5 } from \"./crypto/Md5\";\n\n\nexport namespace LocalStorage {\n\tlet _key: string | null = null;\n\tlet _iv: string | null = null;\n\tlet _id: number = -1;\n\n\t/**\n\t * 初始化密钥\n\t * @param key aes加密的key \n\t * @param iv  aes加密的iv\n\t */\n\texport function init(key: string, iv: string) {\n\t\t_key = Md5(key);\n\t\t_iv = Md5(iv);\n\t}\n\n\t/**\n\t * 设置用户标识\n\t * @param id \n\t */\n\texport function setUser(id: number) {\n\t\t_id = id;\n\t}\n\n\t/**\n\t * 存储\n\t * @param key 存储key\n\t * @param value 存储值\n\t * @returns \n\t */\n\texport function set(key: string, value: any) {\n\t\tlet newKey = `${key}_${_id}`;\n\n\t\tif (null == newKey) {\n\t\t\tconsole.error(`[${key}]存储的key不能为空`);\n\t\t\treturn;\n\t\t}\n\t\tif (!PREVIEW) {\n\t\t\tnewKey = Md5(newKey);\n\t\t}\n\t\tif (null == value) {\n\t\t\tconsole.warn(`[${key}]存储的值为空，则直接移除该存储`);\n\t\t\tremove(key);\n\t\t\treturn;\n\t\t}\n\t\tif (typeof value === 'function') {\n\t\t\tconsole.error(`[${key}]储存的值不能为方法`);\n\t\t\treturn;\n\t\t}\n\t\tif (typeof value === 'object') {\n\t\t\ttry {\n\t\t\t\tvalue = JSON.stringify(value);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tconsole.error(`[${key}]解析失败，str = ${value}`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\telse if (typeof value === 'number') {\n\t\t\tvalue = value + \"\";\n\t\t}\n\t\t// if (!PREVIEW && null != _key && null != _iv) {\n\t\t// \ttry {\n\t\t// \t\tvalue = Encrypt.aesEncrypt(value, _key, _iv);\n\t\t// \t}\n\t\t// \tcatch (e) {\n\t\t// \t\tvalue = null;\n\t\t// \t}\n\t\t// }\n\t\t// console.log(\"key===>set：\",key, newKey, value)\n\t\tsys.localStorage.setItem(newKey, value);\n\t}\n\n\t/**\n\t * 获取\n\t * @param key 获取的key\n\t * @param defaultValue 获取的默认值\n\t * @returns \n\t */\n\texport function get(key: string, defaultValue?: any) {\n\t\tif (null == key) {\n\t\t\tconsole.error(`[${key}]存储的key不能为空`);\n\t\t\treturn;\n\t\t}\n\n\t\tlet newKey = `${key}_${_id}`;\n\t\tif (!PREVIEW) {\n\t\t\tnewKey = Md5(newKey);\n\t\t}\n\t\tlet str: string | null = sys.localStorage.getItem(newKey);\n\t\t// if (null != str && '' !== str && !PREVIEW && null != _key && null != _iv) {\n\t\t// \ttry {\n\t\t// \t\tconsole.log(\"获取本地之前：\", key, _iv, str)\n\t\t// \t\tstr = Encrypt.aesDecrypt(str, _key, _iv); //str可为\"null\" \"undefined\"  \"true\"\n\t\t// \t\tconsole.log(\"获取本地 解密后：\", key, _iv, str)\n\t\t// \t}\n\t\t// \tcatch (e) {\n\t\t// \t\tstr = null;\n\t\t// \t}\n\n\t\t// }\n\t\t// console.log(\"key===>get：\", key,newKey, str)\n\t\t/** 注：可能为空字符串 */\n\t\tif (str == \"null\" || str == \"undefined\") {\n\t\t\tstr = null;\n\t\t}\n\t\tif (null == defaultValue || typeof defaultValue === 'string') {\n\t\t\treturn str;\n\t\t}\n\t\tif (null === str) {\n\t\t\treturn defaultValue;\n\t\t}\n\t\tif (typeof defaultValue === 'number') {\n\t\t\treturn Number(str) || 0;\n\t\t}\n\t\tif (typeof defaultValue === 'boolean') {\n\t\t\treturn \"true\" == String(str); // 不要使用Boolean(\"false\");\n\t\t}\n\t\tif (typeof defaultValue === 'object') {\n\t\t\ttry {\n\t\t\t\treturn JSON.parse(str);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tconsole.error(`[${key}]解析数据失败,str=` + str);\n\t\t\t\treturn defaultValue;\n\t\t\t}\n\n\t\t}\n\t\treturn str;\n\t}\n\n\t/**\n\t * 移除某个值\n\t * @param key 需要移除的key \n\t * @returns \n\t */\n\texport function remove(key: string) {\n\t\tif (null == key) {\n\t\t\tconsole.error(`[${key}]存储的key不能为空`);\n\t\t\treturn;\n\t\t}\n\n\t\tkey = `${key}_${_id}`;\n\t\tif (!PREVIEW) {\n\t\t\tkey = Md5(key);\n\t\t}\n\t\tsys.localStorage.removeItem(key);\n\t}\n\n\t/**\n\t * 清空整个本地存储\n\t */\n\texport function clear() {\n\t\tsys.localStorage.clear();\n\t}\n}\n//设置通用密钥\nLocalStorage.init(\"Creator\", \"3.62\")\n//设置用户标识\nLocalStorage.setUser(0)"]}