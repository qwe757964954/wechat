{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/hall/scripts/buyPropDialogCtr.ts"],"names":["Button","ImageAsset","Label","Node","Sprite","_decorator","GCache","AppEvent","AppSound","GConstants","GameRes","UIID","Utils","resLoader","EventManager","BaseComponent","Platform","ccclass","property","menu","buyPropDialogCtr","tooltip","type","_currowParam","goodsId","itmeId","scene","fromGame","pay_scene","_currowViewParam","num","payInfo","onInitModuleEvent","addModelListener","NOTIFY_EXCHANGE_RESULT","notifyExchangeRes","onLoad","getParams","initView","start","table_isEmpty","node","destroy","updateView","comp","getComponent","params","btnBuy","active","nodeCenter","isExitGoods","ShopInfo","isExitByGoodsid","console","log","temp","getPriceByResId","ShopSmallTabType","PROPS","goodsID","config","item","nodeItem","getChildByName","name","setSpriteFrame","icon","string","updateBuyConf","updateOptBtnState","payID","PayType","SILVER","path","Picture_Hall_Coin_bg","self","getPreLoaderRes","bundle","imgAssert","btnBuyIcon","isValid","spriteFrame","image_ImageAssetToSpriteFrame","updateBuyPrice","price","btnBuyPrice","nullToDefault","onClicBtnCut","event","dispatch","SYS_PLAY_EFFECT","CommClick","itemNum","String","onClicBtnAdd","btnCut","interactable","grayscale","GOLD","lower","User","LoginRoomState","Desk","levelData","LevelData","antes_room","limit","in_bankroll_limit","number_valueOf","getUserMoneyByID","PropertyType","SILVER_COIN","btnAdd","limitNum","onClickBuy","res","_checkProperty","SYS_TOAST_TIP","content","jump_temp","ShopBigTabType","RMB","isCanPay","VIEW_UI_OPEN","MallPrefab","id","_startExchange","itemData","gid","gnum","NET_CMD_REQ_BUY_MALL_PROP","onClickClose","table_verify","isSliced","string_isHttp","loadRemote","ext","err","imageAsset","sprite","onDestroy"],"mappings":"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","sourcesContent":["\nimport { Button, EventTouch, ImageAsset, Label, Node, Sprite, _decorator } from 'cc';\nimport { GCache } from '../../../cache/GCache';\nimport { AppEvent } from '../../../config/AppEvent';\nimport { AppSound } from '../../../config/AppSound';\nimport { GConstants } from '../../../config/GameConstant';\nimport { GameRes } from '../../../config/GameRes';\nimport { UIID } from '../../../config/UIConfig';\nimport { Utils } from '../../../framework/Utils';\nimport { resLoader } from '../../../framework/loader/ResLoader';\nimport { EventManager } from '../../../framework/manager/EventManager';\nimport { BaseComponent } from '../../../framework/vc/BaseComponent';\nimport { Platform } from '../../../platform/Platform';\n\nconst { ccclass, property, menu } = _decorator;\n\n/**\n * Name = buyPropDialogCtr\n * Time = Wed Apr 13 2022 16:27:07 GMT+0800 (中国标准时间)\n * Author = Aby\n * Life: onLoad-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n * 购买道具通用弹窗\n */\n\n@ccclass('buyPropDialogCtr')\n\n//方便编辑器识别的菜单项目\n@menu('vc/buyPropDialogCtr')\n\n\nexport class buyPropDialogCtr extends BaseComponent {\n\n    //标题Node\n    @property({ tooltip: \"顶部标题节点\", type: Node })\n    titleNode: Node = null!;\n\n    //道具父节点\n    @property({ tooltip: \"道具父节点\", type: Node })\n    nodeCenter: Node = null!;\n    //道具节点\n    @property({ tooltip: \"道具节点\", type: Node })\n    nodeItem: Node = null!;\n\n    //购买按钮节点\n    @property({ tooltip: \"购买按钮节点\", type: Node })\n    btnBuy: Node = null!;\n\n    //购买按钮节点-icon\n    @property({ tooltip: \"购买按钮节点-icon\", type: Sprite })\n    btnBuyIcon: Sprite = null!;\n\n    //购买按钮节点-price\n    @property({ tooltip: \"购买按钮节点-price\", type: Label })\n    btnBuyPrice: Label = null!;\n\n\n    //道具数量\n    @property({ tooltip: \"购买按钮节点-price\", type: Label })\n    itemNum: Label = null!;\n\n    //增加按钮节点\n    @property({ tooltip: \"增加按钮节点\", type: Node })\n    btnAdd: Node = null!;\n    //减少按钮节点\n    @property({ tooltip: \"减少按钮节点\", type: Node })\n    btnCut: Node = null!;\n\n\n    //当前传递的参数\n    private _currowParam = {\n        /** 商品ID */\n        goodsId: null,\n        /** 分类ID（可不传） */\n        itmeId: null,\n        /** 支付场景 */\n        scene: null,\n        /** 是否来自游戏 */\n        fromGame: false,\n        /** 付费场景 */\n        pay_scene: null\n    };\n\n    private _currowViewParam = {\n        num: 1,\n        payInfo: null\n    };\n    //fromGame:false\n    // goodsId: goodid,\n    // itmeId: GConstants.GoodItemIDs.SIGN_CARD,\n    // scene: GConstants.PayModel.sign_card\n\n\n    onInitModuleEvent() {\n        //添加兑换结果监听\n        this.addModelListener(AppEvent.NOTIFY_EXCHANGE_RESULT, this.notifyExchangeRes)\n    }\n    onLoad() {\n        this.getParams();\n        this.initView();\n    };\n\n    start() {\n        if (Utils.table_isEmpty(this._currowParam)) {\n            this.node.destroy();\n            return;\n        }\n        this.updateView();\n    };\n\n    getParams() {\n        let comp;\n        comp = this.node.getComponent(\"DelegateComponent\")\n        if (comp) {\n            let params = comp.getParams();\n            if (Utils.table_isEmpty(params)) {\n                this._currowParam = null;\n                return;\n            }\n            this._currowParam = params;\n        }\n    }\n\n\n    initView() {\n        this.btnBuy.active = false;\n        this.nodeCenter.active = false;\n    }\n    updateView() {\n        let isExitGoods = GCache.ShopInfo.isExitByGoodsid(this._currowParam.goodsId);\n        console.log(\"购买道具界面传递的参数\", this._currowParam, isExitGoods)\n        if (isExitGoods == false) {\n            if (this._currowParam.itmeId != null) {\n                let temp = GCache.ShopInfo.getPriceByResId(GConstants.ShopSmallTabType.PROPS, this._currowParam.itmeId);\n                this._currowParam.goodsId = temp.goodsID;\n            } else {\n                return;\n            }\n        }\n\n        let config = {\n            num: 1,\n            payInfo: GCache.ShopInfo.getPriceByResId(GConstants.ShopSmallTabType.PROPS, this._currowParam.goodsId),\n        }\n        this._currowViewParam = config;\n        console.log(\"输出商品：\" + this._currowParam.goodsId)\n        let item = this.nodeItem.getChildByName(\"item\");\n        let name = this.nodeItem.getChildByName(\"name\");\n        this.setSpriteFrame(item, config.payInfo.icon)\n        name.getComponent(Label).string = config.payInfo.name || \"\";\n        this.updateBuyConf();\n        this.updateOptBtnState();\n        this.btnBuy.active = true;\n        this.nodeCenter.active = true;\n\n    }\n    //更新购买价格和货币图标显示\n    updateBuyConf() {\n        console.log('this._currowViewParam', this._currowViewParam)\n        console.log('渲染价格', this._currowViewParam.payInfo.payID, GConstants.PayType.SILVER)\n        if (this._currowViewParam.payInfo.payID == GConstants.PayType.SILVER) {\n            let path = GameRes.Picture_Hall_Coin_bg;\n            let self = this;\n            this.getPreLoaderRes(path.bundle, path.path, ImageAsset, (imgAssert: ImageAsset) => {\n                if (!self.btnBuyIcon || self.btnBuyIcon.isValid == false) {\n                    return;\n                }\n                let spriteFrame = Utils.image_ImageAssetToSpriteFrame(imgAssert)\n                if (spriteFrame) {\n                    self.btnBuyIcon.spriteFrame = spriteFrame;\n                }\n            })\n        }\n        //道具默认银币购买 预留金条\n        this.updateBuyPrice();\n\n    }\n    /** 更新购买价格 */\n    updateBuyPrice() {\n        let price = this._currowViewParam.payInfo.price * this._currowViewParam.num;\n        this.btnBuyPrice.string = Utils.nullToDefault(price, \"--\");\n    }\n    /** 按钮减的点击事件 */\n    onClicBtnCut(event: EventTouch) {\n        EventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n        this._currowViewParam.num = this._currowViewParam.num - 1;\n        this.itemNum.string = String(this._currowViewParam.num);\n        this.updateBuyPrice();\n        this.updateOptBtnState();\n    }\n    /** 按钮加的点击事件 */\n    onClicBtnAdd(event: EventTouch) {\n        EventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n        this._currowViewParam.num = this._currowViewParam.num + 1;\n        this.itemNum.string = String(this._currowViewParam.num);\n        this.updateBuyPrice();\n        this.updateOptBtnState();\n    }\n    /** 更新增减按钮的状态 */\n    updateOptBtnState() {\n        if (this._currowViewParam.num <= 1) {\n            this.btnCut.getComponent(Button).interactable = false;\n            this.btnCut.getComponent(Sprite).grayscale = true;\n        } else {\n            this.btnCut.getComponent(Button).interactable = true;\n            this.btnCut.getComponent(Sprite).grayscale = false;\n        }\n        if (this._currowViewParam.payInfo.payID == GConstants.PayType.GOLD) {\n            let lower = 0;\n            if (GCache.User.LoginRoomState == true && GCache.Desk) {\n                let levelData = GCache.Desk.LevelData;\n                if (levelData && levelData.antes_room) {\n                    let limit = levelData.antes_room.in_bankroll_limit || [];\n                    lower = Utils.number_valueOf(limit[0]);\n                }\n            }\n            if ((GCache.User.getUserMoneyByID(GConstants.PropertyType.SILVER_COIN) - lower) < (this._currowViewParam.payInfo.price * (this._currowViewParam.num + 1))) {\n                this.btnAdd.getComponent(Button).interactable = false;\n                this.btnAdd.getComponent(Sprite).grayscale = true;\n            } else {\n                this.btnAdd.getComponent(Button).interactable = true;\n                this.btnAdd.getComponent(Sprite).grayscale = false;\n            }\n        }\n        //判断当前选择的数量是否已经超过购买限制数量\n        if (this._currowViewParam.payInfo && this._currowViewParam.payInfo.limitNum != null) {\n            let limitNum = this._currowViewParam.payInfo.limitNum;\n            if ((limitNum[\"hadNum\"] + this._currowViewParam.num) >= limitNum[\"maxNum\"]) {\n                //超过数量限制，按钮不开点击\n                this.btnAdd.getComponent(Button).interactable = false;\n                this.btnAdd.getComponent(Sprite).grayscale = true;\n            }\n        }\n    }\n    /** 点击了购买 */\n    onClickBuy(event: EventTouch) {\n        console.log('点击了购买')\n        let res = this._checkProperty();\n        if (res) {\n            EventManager.dispatch(AppEvent.SYS_TOAST_TIP, { content: res[1] });\n            let jump_temp = {\n                //银币跳转道具\n                [GConstants.PayType.SILVER]: GConstants.ShopBigTabType.PROPS,\n                //人民币跳转银币 \n                [GConstants.PayType.RMB]: GConstants.ShopBigTabType.SILVER_COIN,\n            }\n            if (jump_temp[res[0]] != null) {\n                this.node.destroy();\n                if (Platform.isCanPay() == false) {\n                    return;\n                }\n                //跳转商城\n                EventManager.dispatch(AppEvent.VIEW_UI_OPEN, UIID.MallPrefab, { id: jump_temp[res[0]] }, {});\n                return;\n            }\n        }\n        this._startExchange();\n    }\n\n    /** 开始兑换 */\n    _startExchange() {\n        let itemData = {\n            gid: this._currowViewParam.payInfo.goodsID,  //商品ID\n            gnum: this._currowViewParam.num,    //兑换的数量\n        }\n        console.log('银币兑换道具参数', itemData)\n        EventManager.dispatch(AppEvent.NET_CMD_REQ_BUY_MALL_PROP, itemData);\n    }\n    /** 检查资产是否满足条件 */\n    _checkProperty() {\n        if (this._currowViewParam.payInfo.payID == GConstants.PayType.GOLD) {\n            let lower = 0;  //房间内最低资产下限\n            if (GCache.User.LoginRoomState == true && GCache.Desk) {\n                let levelData = GCache.Desk.LevelData;\n                if (levelData && levelData.antes_room) {\n                    let limit = levelData.antes_room.in_bankroll_limit || [];\n                    lower = Utils.number_valueOf(limit[0]);\n                }\n            }\n            if ((GCache.User.getUserMoneyByID(GConstants.PropertyType.SILVER_COIN) - lower) < (this._currowViewParam.payInfo.price * this._currowViewParam.num)) {\n                return [this._currowViewParam.payInfo.payID, \"您的银币不足\"];\n            }\n        }\n        return null;\n    }\n\n    //点击了关闭\n    onClickClose(event: EventTouch) {\n        EventManager.dispatch(AppEvent.SYS_PLAY_EFFECT, AppSound.CommClick);\n        this.node.destroy();\n    }\n    /** 通知兑换结果 */\n    notifyExchangeRes(event, res) {\n        res = Utils.table_verify(res);\n        if (res[\"state\"] == true) {\n            // 销毁当前节点\n            this.node.destroy();\n        }\n    }\n    /**设置远端图片 */\n    setSpriteFrame(node, path, isSliced = false) {\n        if (Utils.string_isHttp(path)) {\n            let self = this;\n            resLoader.loadRemote(path, { ext: '.jpg' }, (err, imageAsset) => {\n                if (!imageAsset) { //资源可能还在加载中\n                    return\n                }\n                if (!node || node.isValid == false) {\n                    return;\n                }\n\n                let spriteFrame = Utils.image_ImageAssetToSpriteFrame(imageAsset)\n                if (spriteFrame) {\n                    let sprite: Sprite = node.getComponent(Sprite);\n                    sprite.spriteFrame = spriteFrame;\n                }\n                node.active = true;\n            })\n        } else {\n            node.active = false;\n        }\n    }\n\n    //销毁\n    onDestroy() {\n\n    };\n}\n\n"]}