{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/proj/GameRoomHelper.ts"],"names":["_GameRoomHelper","GCache","AppEvent","GConstants","GameTxt","UIConfigData","UIID","LayerManager","EventManager","Utils","BaseControll","Platform","constructor","checkShowBankruptParam","initData","intoRoomInit","getBankruptGifts","gameId","levelID","isExit","number_valueOf","newBankUpGiftData","BankrupData","getNewBankUpGiftConf","table_verify","i","Object","prototype","hasOwnProperty","call","v","string_endsWith","nullToDefault","checkShowBankruptView","gameID","moneyID","status","time","isMineBankrupt","print","data","table_isEmpty","dispatch","NET_REQ_BANKRUPT_GIFT_CONF","body","config","NET_REQ_BANKRUPT_COUNT","needMoney","info","SelectGame","getGameRoomInfoByRoomLevelID","Math","abs","User","getUserMoneyByID","checkBankrupt","isCanPay","NET_REQ_BANKRUPT","clear","BankupGift","layer","VIEW_UI_OPEN","dump","UserBankUpType","BANKRUPT_TYPE_OVER","bankup_gift_title_1","_type","BankupDialogType","GIVE_UP","BANKRUPT_TYPE_MINI","BANKRUPT_TYPE_SAFEBOX","bankup_gift_title_2","has_first_pay","FIRST_SAFEBOX","BANKRUPT_SAFEBOX","isBankruptRewardRemain","BANKRUPT_TYPE_BANKRUPT","bankup_gift_title_3","BANKRUPT_FIRST","BANKRUPT_BANKRUPTGIFT","FIRST_NOBANKRUPT","BANKRUPTGIFT_NOBANKRUPT","checkBankruptFeedBackRedDot","bankruptFeedBackData","getBankUpFeedbackData","GAME_ROOM_BANKUP_REDDOT_REFRESH","isShow","value","goods","b","checkIsBankrupt","getPropByLevelPropName","checkIsBankruptAfterGameOver","state","isShowBankruptPayInRoom","NET_REQ_GOODS_INFO","scene","GoodsListID","Bankruptcy","NET_REQ_LOGOUT_IN_GAME_FORCE","checkIsLevelUp","isByLoginMoney","kickStatus","Desk","KickUserStatus","flag","roomUpLevelInfo","getRoomUpLevelInfo","_handleLevelUp","_handleLevelDown","setRoomUpLevelInfo","newLevelId","isNull","setCurLevelID","updateRoomInfoByKey","GAME_ROOM_LEVEL_CHANGE","exp","level","GAME_ROOM_LEVEL_UP","curGameId","getCurGameID","curLevelId","getCurLevelID","minLoginMoney","userMoney","mySelfPlayer","money","diff","GAME_ROOM_LEVEL_DOWN_RECHANGE","setDegradeInfo","checkIsLegalPlay","_checkIsLegal","isByExitMoney","GameRoomHelper"],"mappings":"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","sourcesContent":["/**\n * Name = GameRoomHelper\n * URL = db://assets/proj/GameRoomHelper.ts\n * Time = Fri Jun 17 2022 12:11:10 GMT+0800 (中国标准时间)\n * Author = xueya\n * 游戏房间帮助类\n */\n\nimport { GCache } from \"../cache/GCache\";\nimport { AppEvent } from \"../config/AppEvent\";\nimport { GConstants } from \"../config/GameConstant\";\nimport { GameTxt } from \"../config/GameTxt\";\nimport { UIConfigData, UIID } from \"../config/UIConfig\";\nimport { LayerManager } from \"../framework/layer/LayerManager\";\nimport { EventManager } from \"../framework/manager/EventManager\";\nimport { Utils } from \"../framework/Utils\";\nimport { BaseControll } from \"../framework/vc/BaseController\";\nimport { Platform } from \"../platform/Platform\";\n\n/**\n [[\n\t破产弹窗逻辑，先判断是否有首充礼包\n\t 1、有首充礼包，保险箱资产是否足够\n\t\t\t 1.1、保险箱资产足够，首充+保险箱取款        弹窗1\n\t\t\t 1.2、保险箱资产不足，判断是否还有破产补助\n\t\t\t\t 1.2.1 有破产补助：首充+破产补助          弹窗3\n\t\t\t\t 1.2.2 无破产补助：首充+无破产补助提示     弹窗5\n\t 2、无首充礼包，显示破产礼包,保险箱资产是否足够\n\t\t 2.1、保险箱资产足够，破产礼包+保险箱取款        弹窗2\n\t\t 2.2、保险箱资产不足，判断是否还有破产补助\n\t\t\t 2.2.1 有破产补助：破产礼包+破产补助          弹窗4\n\t\t\t 2.2.2 无破产补助：破产礼包+无破产补助提示     弹窗6\n ]]\n */\n\nclass _GameRoomHelper extends BaseControll {\n\n\tconstructor() {\n\t\tsuper(\"GameRoomHelper\")\n\t}\n\t//请求了检查破产礼包 但此时无数据 在返回数据是要显示\n\tcheckShowBankruptParam = null;\n\n\tinitData() {\n\t\tthis.checkShowBankruptParam = null;\n\t}\n\t//进入房间主动调用方法\n\tintoRoomInit() {\n\t\tthis.initData();\n\n\t}\n\n\t/**获取游戏对应场次是否存在破产礼包信息 */\n\tgetBankruptGifts(gameId, levelID) {\n\t\tlet isExit = false;\n\t\tlevelID = Utils.number_valueOf(levelID, 0);\n\n\t\tlet newBankUpGiftData = GCache.BankrupData.getNewBankUpGiftConf();\n\t\tnewBankUpGiftData = Utils.table_verify(newBankUpGiftData);\n\n\t\tif (newBankUpGiftData[\"gameids\"] && newBankUpGiftData[\"levelids\"]) {\n\t\t\tfor (let i in newBankUpGiftData[\"gameids\"]) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(newBankUpGiftData[\"gameids\"], i)) {\n\t\t\t\t\tlet v = newBankUpGiftData[\"gameids\"][i];\n\t\t\t\t\tif (Utils.number_valueOf(v, -1) == Utils.number_valueOf(gameId, -2)) {\n\t\t\t\t\t\tisExit = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (isExit) {\n\t\t\tisExit = false;\n\t\t\tfor (let i in newBankUpGiftData[\"levelids\"]) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(newBankUpGiftData[\"levelids\"], i)) {\n\t\t\t\t\tlet v = newBankUpGiftData[\"levelids\"][i];\n\t\t\t\t\tif (Utils.string_endsWith(levelID, Utils.nullToDefault(v, -1)) == true) {\n\t\t\t\t\t\tisExit = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (isExit) {\n\t\t\treturn Utils.table_verify(newBankUpGiftData);\n\t\t} else {\n\t\t\treturn {}\n\t\t}\n\t}\n\t/**\n\t * 检查显示破产界面\n\t * @param gameID 游戏ID\n\t * @param levelID 房间level\n\t * @param moneyID 货币id\n\t * @param status \n\t * @param time \n\t * @returns \n\t */\n\tcheckShowBankruptView(gameID, levelID, moneyID, status = null, time = null) {\n\t\tgameID = Utils.number_valueOf(gameID, null);\n\t\tlevelID = Utils.number_valueOf(levelID, null);\n\t\tif (gameID == null || levelID == null) {\n\t\t\treturn;\n\t\t}\n\t\tif (GCache.BankrupData.isMineBankrupt() == true) {\n\t\t\tthis.print(\"===破产了  即将显示破产界面逻辑===\");\n\t\t\t//破产礼包数据\n\t\t\tlet data = this.getBankruptGifts(gameID, levelID);\n\n\t\t\tif (Utils.table_isEmpty(data) || Utils.table_isEmpty(data[\"giftPack\"])) {\n\t\t\t\t//没有礼包配置数据，发送请求获取\n\t\t\t\tEventManager.dispatch(AppEvent.NET_REQ_BANKRUPT_GIFT_CONF, gameID, levelID);\n\t\t\t\t//标注破产礼包返回时要再次调用\n\t\t\t\tthis.checkShowBankruptParam = { gameID: gameID, levelID: levelID, moneyID: moneyID, status: status, time: time };\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet body = {\n\t\t\t\tgameID: gameID,\n\t\t\t\tlevelID: levelID,\n\t\t\t\tmoneyID: moneyID,\n\t\t\t\tstatus: status,\n\t\t\t\ttime: time,\n\t\t\t\tconfig: data\n\t\t\t}\n\n\t\t\t//请求破产次数\n\t\t\tEventManager.dispatch(AppEvent.NET_REQ_BANKRUPT_COUNT);\n\n\t\t\tlet needMoney = 3000;\n\t\t\tlet info = GCache.SelectGame.getGameRoomInfoByRoomLevelID(gameID, levelID);\n\t\t\tinfo = Utils.table_verify(info);\n\t\t\t//当前场次需要多少银币\n\t\t\tneedMoney = Utils.number_valueOf(info[\"min_money\"], needMoney);\n\t\t\t//需要购买的银币数\n\t\t\tbody[\"difMoney\"] = Math.abs(needMoney - GCache.User.getUserMoneyByID(body.moneyID));\n\n\t\t\t//是否还有首充\n\t\t\tbody[\"has_first_pay\"] = false;\n\t\t\t//检查数据\n\t\t\tbody = this.checkBankrupt(data);\n\n\t\t\tif (Platform.isCanPay() == false) {//不支持支付 则直接领取救济金\n\t\t\t\tthis.print(\"不支持支付 则直接领取救济金\");\n\t\t\t\t//领取救济金\n\t\t\t\tEventManager.dispatch(AppEvent.NET_REQ_BANKRUPT);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t//打开破产界面\n\t\t\tLayerManager.clear(UIConfigData[UIID.BankupGift].layer);\n\t\t\tEventManager.dispatch(AppEvent.VIEW_UI_OPEN, UIID.BankupGift, body);\n\t\t\tUtils.dump(\"打开破产界面造的数据==>\", body)\n\t\t}\n\n\t}\n\t//检查破产的 首充礼包、破产奖励、保险箱 逻辑\n\tcheckBankrupt(data) {\n\t\tif (Utils.number_valueOf(data[\"status\"]) == 1) {\n\t\t\t//忽略保险箱和破产补助\n\t\t\t//无破产补助：破产礼包+无破产补助提示\n\t\t\tdata[\"bankrupt_type\"] = GConstants.UserBankUpType.BANKRUPT_TYPE_OVER;\n\t\t\tdata[\"title\"] = GameTxt.bankup_gift_title_1;\n\t\t\tdata._type = GConstants.BankupDialogType.GIVE_UP;\n\t\t\treturn data;\n\t\t}\n\t\tif (GCache.User.getUserMoneyByID(data.moneyID, true) >= GConstants.UserBankUpType.BANKRUPT_TYPE_MINI) {\n\t\t\t//总资产足够，破产礼包+保险箱取款\n\t\t\tdata[\"bankrupt_type\"] = GConstants.UserBankUpType.BANKRUPT_TYPE_SAFEBOX;\n\t\t\tdata[\"title\"] = GameTxt.bankup_gift_title_2;\n\t\t\tdata._type = data.has_first_pay ? GConstants.BankupDialogType.FIRST_SAFEBOX : GConstants.BankupDialogType.BANKRUPT_SAFEBOX;\n\t\t} else {\n\t\t\tif (GCache.BankrupData.isMineBankrupt() && GCache.BankrupData.isBankruptRewardRemain()) {\n\t\t\t\t//有破产补助：破产礼包+破产补助，并且没有配置破产回馈配置 \n\t\t\t\tdata[\"bankrupt_type\"] = GConstants.UserBankUpType.BANKRUPT_TYPE_BANKRUPT;\n\t\t\t\tdata[\"title\"] = GameTxt.bankup_gift_title_3;\n\t\t\t\tdata._type = data.has_first_pay ? GConstants.BankupDialogType.BANKRUPT_FIRST : GConstants.BankupDialogType.BANKRUPT_BANKRUPTGIFT;\n\n\t\t\t} else {\n\t\t\t\t//无破产补助：破产礼包+无破产补助提示\n\t\t\t\tdata[\"bankrupt_type\"] = GConstants.UserBankUpType.BANKRUPT_TYPE_OVER;\n\t\t\t\tdata[\"title\"] = GameTxt.bankup_gift_title_1;\n\t\t\t\tdata._type = data.has_first_pay ? GConstants.BankupDialogType.FIRST_NOBANKRUPT : GConstants.BankupDialogType.BANKRUPTGIFT_NOBANKRUPT;;\n\t\t\t}\n\t\t}\n\t\treturn data;\n\t}\n\n\t/** 检查破产小红点 */\n\tcheckBankruptFeedBackRedDot() {\n\t\tlet bankruptFeedBackData = GCache.BankrupData.getBankUpFeedbackData();\n\t\tbankruptFeedBackData = Utils.table_verify(bankruptFeedBackData);\n\t\tbankruptFeedBackData[\"eTime\"] = Utils.number_valueOf(bankruptFeedBackData[\"eTime\"], 0);\n\t\tif (bankruptFeedBackData[\"eTime\"] < Utils.time()) {\n\t\t\t//刷新破产小红点\n\t\t\tEventManager.dispatch(AppEvent.GAME_ROOM_BANKUP_REDDOT_REFRESH, false);\n\t\t\treturn;\n\t\t}\n\t\tlet isShow = false;\n\t\tif (bankruptFeedBackData[\"stallData\"]) {\n\t\t\tbankruptFeedBackData[\"stallData\"] = Utils.table_verify(bankruptFeedBackData[\"stallData\"]);\n\t\t\tfor (let i in bankruptFeedBackData[\"stallData\"]) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(bankruptFeedBackData[\"stallData\"], i)) {\n\t\t\t\t\tlet value = bankruptFeedBackData[\"stallData\"][i];\n\t\t\t\t\tif (value[\"state\"] == 1) {//已购买\n\t\t\t\t\t\tlet goods = Utils.table_verify(value[\"goods\"]);\n\t\t\t\t\t\tfor (let b in goods) {\n\t\t\t\t\t\t\tif (Object.prototype.hasOwnProperty.call(goods, b)) {\n\t\t\t\t\t\t\t\tif (goods[b][\"state\"] == 1) {\n\t\t\t\t\t\t\t\t\tisShow = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t//刷新破产小红点\n\t\tEventManager.dispatch(AppEvent.GAME_ROOM_BANKUP_REDDOT_REFRESH, isShow);\n\t}\n\n\t/** 检查是否破产 */\n\tcheckIsBankrupt(gameID, levelID) {\n\t\tgameID = Utils.nullToDefault(gameID, null);\n\t\tlevelID = Utils.nullToDefault(levelID, null);\n\t\tif (GCache.SelectGame.getPropByLevelPropName(gameID, levelID, \"broken_stat_in\") == false) {\n\t\t\t//子游戏不检查破产\n\t\t\tthis.print(\"checkIsBankrupt : 子游戏不检查破产\");\n\t\t\treturn false;\n\t\t}\n\t\treturn GCache.BankrupData.isMineBankrupt();\n\t}\n\n\t/**\n\t * 结算后检查是否破产\n\t * 破产逻辑：房间内判断破产后，调用 当破产时发送消息checkIsBankruptAfterGameOver 如果配置开启了破产支付，就会调用支付。否则会退出房间\n\t * @returns \n\t */\n\tcheckIsBankruptAfterGameOver() {\n\t\tlet state = GCache.BankrupData.isMineBankrupt();\n\t\tif (state) {\n\t\t\tif (GCache.BankrupData.isShowBankruptPayInRoom()) {\n\t\t\t\t//房间破产需要弹出破产支付弹框\n\t\t\t\tEventManager.dispatch(AppEvent.NET_REQ_GOODS_INFO, { scene: GConstants.GoodsListID.Bankruptcy });\n\n\t\t\t} else {\n\t\t\t\t//没有房间破产充值的情况下，踢出房间\n\t\t\t\tEventManager.dispatch(AppEvent.NET_REQ_LOGOUT_IN_GAME_FORCE);\n\t\t\t}\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t//结算时，检测场次升降级\n\tcheckIsLevelUp(isByLoginMoney = false) {\n\t\tlet kickStatus = GCache.Desk.KickUserStatus;\n\t\tif (GCache.Desk.KickUserStatus == 9001) {//此时server要升级，重新走换桌流程\n\t\t\tGCache.Desk.KickUserStatus = 0;\n\t\t}\n\t\tlet flag = false;\n\t\tlet roomUpLevelInfo = GCache.SelectGame.getRoomUpLevelInfo(); //升降级信息\n\t\tif (roomUpLevelInfo) {\n\t\t\tif (roomUpLevelInfo[\"flag\"] == 1) {//升级\n\t\t\t\tthis._handleLevelUp(roomUpLevelInfo[\"level\"])\n\t\t\t\tflag = true;\n\t\t\t} else if (roomUpLevelInfo[\"flag\"] == -1) {\n\t\t\t\tthis._handleLevelDown(roomUpLevelInfo[\"level\"]);\n\t\t\t\t// 降级时，调用支付\n\t\t\t\tGCache.SelectGame.setRoomUpLevelInfo({});\n\t\t\t\tflag = false;\n\t\t\t}\n\t\t} else {\n\t\t\tif (isByLoginMoney) {\n\n\t\t\t} else { }\n\t\t}\n\t}\n\t/** 游戏升场 */\n\t_handleLevelUp(newLevelId) {\n\t\tif (Utils.isNull(newLevelId)) {\n\t\t\treturn;\n\t\t}\n\t\tGCache.Desk.setCurLevelID(newLevelId)\n\t\tGCache.Desk.updateRoomInfoByKey(\"level\", newLevelId);\n\n\t\tEventManager.dispatch(AppEvent.GAME_ROOM_LEVEL_CHANGE)\n\t\tlet data = { exp: 0, level: newLevelId };\n\t\tEventManager.dispatch(AppEvent.GAME_ROOM_LEVEL_UP, data)\n\t\tGCache.SelectGame.setRoomUpLevelInfo({});\n\n\t}\n\t/** 资产不足降场 */\n\t_handleLevelDown(newLevelId) {\n\t\tif (Utils.isNull(newLevelId)) {\n\t\t\treturn;\n\t\t}\n\t\tlet curGameId = GCache.Desk.getCurGameID();\n\t\tlet curLevelId = GCache.Desk.getCurLevelID();\n\t\tlet minLoginMoney = GCache.SelectGame.getPropByLevelPropName(curGameId, curLevelId, \"min_money\");\n\t\tminLoginMoney = Utils.number_valueOf(minLoginMoney);\n\t\tlet userMoney = GCache.Desk.mySelfPlayer.money;\n\n\t\tlet diff = minLoginMoney - userMoney;\n\t\t// let data = {\n\t\t// \tgameid : curGameId,\n\t\t// \tlevel :curLevelId,\n\t\t// \tnewLevel : level,\n\t\t// \tscene : PayIsolater.eGoodsListId.RoomLevelDown,\n\t\t// \tdiffMoney = diff,\n\t\t// };\n\t\t// let info = {\n\t\t// \tparam : data,\n\t\t// \tscene : data.scene,\n\t\t// \tdiffMoney : diff;\n\t\t// \tnewLevel : level;\n\t\t// \tpropertyType = RoomPropertyData.getInstance(): getCurPropertyId();\n\t\t// };\n\t\t// let action = GameMechineConfig.ACTION_RECHARGE;\n\t\t// MechineManage.getInstance(): receiveAction(action, info);\n\t\tEventManager.dispatch(AppEvent.GAME_ROOM_LEVEL_DOWN_RECHANGE);\n\t\tGCache.SelectGame.setDegradeInfo({});\n\t}\n\n\t//当前场次是否能继续游戏\n\t//根据入场银币上下线来判断\n\t/** 当前场次是否能继续游戏  根据入场银币上下线来判断*/\n\tcheckIsLegalPlay() {\n\t\treturn this._checkIsLegal(false);\n\t}\n\t/**\n\t * \n\t * @param isByExitMoney 是否以退场下限值为判断条件\n\t * @param data \n\t */\n\t_checkIsLegal(isByExitMoney = false, data = null) {\n\n\t}\n}\n\n\nexport const GameRoomHelper = new _GameRoomHelper();\n\n"]}