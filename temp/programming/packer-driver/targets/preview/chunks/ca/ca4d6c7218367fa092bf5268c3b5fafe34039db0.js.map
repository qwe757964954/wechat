{"version":3,"sources":["file:///Users/mac/work/WXGame_FlySmallChick/assets/package/game/module/match/src/Match.ts"],"names":["Prefab","_decorator","AppEvent","EventManager","BaseComponent","PlayerMgr","RoomMgr","FXJRes","GameEvent","CardUtil","ccclass","property","Match","coordinateList","playerList","onInitModuleEvent","addModelListener","VIEW_BROADCAST_PLAYER_ENTER","addPlayer","VIEW_BROADCAST_PLAYER_EXIT","onPalyerExit","onLoad","resetPlayer","loadPlayerList","onReady","getInstance","getMyPlayerInfo","isReady","dispatch","NET_REQ_PLAYER_READY","forEach","nodeRes","removeFromParent","player","showPlayer","start","x","y","getPreLoaderRes","Prefab_Match_Player","bundle","path","node","addChild","seatId","calculatePlayerSeat","mySeatId","setPosition","scriptPlayer","getComponent","updatePlayerProperty","push","hidenPlayer","console","log","event","uid","findPlayerWithUserId","deletePlayer"],"mappings":"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","sourcesContent":["\nimport { Prefab, _decorator } from 'cc';\nimport { AppEvent } from '../../../../../config/AppEvent';\nimport { EventManager } from '../../../../../framework/manager/EventManager';\nimport { BaseComponent } from '../../../../../framework/vc/BaseComponent';\nimport { PlayerMgr } from '../../../cache/PlayerMgr';\nimport { RoomMgr } from '../../../cache/RoomMgr';\nimport { FXJRes } from '../../../common/FXJRes';\nimport { GameEvent } from '../../../common/GameEvent';\nimport { Common } from '../../../common/idl/Common';\nimport { CardUtil } from '../../../util/CardUtil';\nimport { Player } from './Player';\n\nconst { ccclass, property } = _decorator;\n\n/**\n * Name = match\n * URL = db://assets/package/game/module/match/src/match.ts\n * Time = Fri Aug 04 2023 11:18:15 GMT+0800 (中国标准时间)\n * Author = qwe757964\n *\n * Life: onLoad-->onInitModuleEvent-->onEnable->start->update->lateUpdate->onDisable->onDestroy\n * \n */\nexport interface Coordinate {\n\tx: number;\n\ty: number;\n}\n   \n\n\n@ccclass('Match')\nexport class Match extends BaseComponent {\n    private\tcoordinateList:Coordinate[] = [];\n\tprivate\tplayerList:any[] = [];\n\n\t/** override 初始化模块事件 */\n\tprotected onInitModuleEvent() {\n\t\tthis.addModelListener(GameEvent.VIEW_BROADCAST_PLAYER_ENTER, this.addPlayer);\n\t\tthis.addModelListener(GameEvent.VIEW_BROADCAST_PLAYER_EXIT, this.onPalyerExit);\n\t};\n\t\n\tonLoad () {\n\t\tthis.resetPlayer();\n\t\tthis.loadPlayerList();\n\t\tthis.onReady();\n\t};\n\n\tonReady(){\n\t\tif(!PlayerMgr.getInstance().getMyPlayerInfo().isReady){\n\t\t\tEventManager.dispatch(AppEvent.NET_REQ_PLAYER_READY);\n\t\t}\n\t}\n\n\tresetPlayer(){\n\t\tthis.playerList.forEach((nodeRes:any) => {\n\t\t\tif(nodeRes){\n\t\t\t\tnodeRes.removeFromParent();\n\t\t\t}\n\t\t});\n\t\tthis.playerList = [];\n\t}\n\n\t  \n\tpublic loadPlayerList(){\n\t\tPlayerMgr.getInstance().playerList.forEach(player => {\n\t\t\tthis.showPlayer(player);\n\t\t});\n\t}\n\n\t\n\tstart () {\n\t\t\n\t\t\n\t};\n\t\n\tshowPlayer(player:Common.IPlayerInfo){\n\t\tthis.coordinateList = [\n\t\t\t{ x: -377.029, y: -58.805 },\n\t\t\t{ x: -104.611, y: -58.805 },\n\t\t\t{ x: 163.975, y: -58.805 },\n\t\t\t{ x: 435.111, y: -58.805 }];\n\t\tthis.getPreLoaderRes(FXJRes.Prefab_Match_Player.bundle, FXJRes.Prefab_Match_Player.path, Prefab, (nodeRes) => {\n\t\t\t// let nodeRes = res.data;\n\t\t\tthis.node.addChild(nodeRes);\n\t\t\tlet seatId:number = CardUtil.calculatePlayerSeat(RoomMgr.getInstance().mySeatId,player.seatId);\n\t\t\tnodeRes.setPosition(this.coordinateList[seatId].x, this.coordinateList[seatId].y);\n\t\t\tvar scriptPlayer:Player = nodeRes.getComponent(\"Player\");\n\t\t\tscriptPlayer.updatePlayerProperty(player);\n\t\t\tthis.playerList.push(nodeRes)\n\t\t})\n\t\t\n\t}\n\thidenPlayer(player:Common.IPlayerInfo){\n\t\tthis.playerList.forEach((nodeRes:any) => {\n\t\t\tvar scriptPlayer:Player = nodeRes.getComponent(\"Player\");\n\t\t\tif(scriptPlayer.seatId === player.seatId){\n\t\t\t\tnodeRes.removeFromParent();\n\t\t\t\t// this.playerList = this.playerList.filter(item => item.seatId === player.seatId);\n\t\t\t\tconsole.log(\"this.playerList______________\",this.playerList);\n\t\t\t}\n\t\t});\n\t\t\n\t}\n\n\taddPlayer(event, uid) {\n\t\tlet player:Common.IPlayerInfo = PlayerMgr.getInstance().findPlayerWithUserId(uid);\n\t\tthis.showPlayer(player);\n\t}\n\tonPalyerExit(event, uid){\n\t\tlet player = PlayerMgr.getInstance().findPlayerWithUserId(uid);\n\t\tthis.deletePlayer(player);\n\t}\n\n\n\tpublic deletePlayer(player:Common.IPlayerInfo){\n\t\tthis.hidenPlayer(player);\n\t}\n}\n\n"]}